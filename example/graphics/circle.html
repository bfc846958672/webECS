<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>circle 圆形/椭圆/圆弧示例</title>
</head>

<body>
  <div id="app">
    <div id="game-container">
      <canvas id="game-canvas" width="1200" height="800" style="border:1px solid #000;"></canvas>
    </div>
  </div>

  <script type="module">
    import { Engine, Components } from '../../src/main.ts';

    const canvas = document.getElementById('game-canvas');
    const engine = new Engine(canvas);
    engine.boxDebug = true;

    // 1) 标准圆：填充 + 描边
    {
      const e = engine.ecs.createEntity();
      const circle = new Components.Circle(engine, {
        radius: 70,
        fillStyle: '#2ecc71',
        strokeStyle: '#145a32',
        lineWidth: 6,
      });
      const transform = new Components.Transform(engine, { x: 160, y: 160 });
      engine.ecs.addComponent(e, circle);
      engine.ecs.addComponent(e, transform);
      engine.add(e);
    }

    // 2) 椭圆：radiusY != radius
    {
      const e = engine.ecs.createEntity();
      const circle = new Components.Circle(engine, {
        radius: 110,
        radiusY: 55,
        fillStyle: '#3498db',
        strokeStyle: '#1b4f72',
        lineWidth: 4,
      });
      const transform = new Components.Transform(engine, { x: 520, y: 160 });
      engine.ecs.addComponent(e, circle);
      engine.ecs.addComponent(e, transform);
      engine.add(e);
    }

    // 3) 圆弧（顺时针）：startAngle -> endAngle
    {
      const e = engine.ecs.createEntity();
      const circle = new Components.Circle(engine, {
        radius: 90,
        fillStyle: 'rgba(231, 76, 60, 0.85)',
        strokeStyle: '#922b21',
        lineWidth: 3,
        startAngle: 0,
        endAngle: Math.PI * 1.5,
        clockwise: true,
      });
      const transform = new Components.Transform(engine, { x: 880, y: 160 });
      engine.ecs.addComponent(e, circle);
      engine.ecs.addComponent(e, transform);
      engine.add(e);
    }

    // 4) 圆弧（逆时针）：对比 clockwise=false
    {
      const e = engine.ecs.createEntity();
      const circle = new Components.Circle(engine, {
        radius: 90,
        fillStyle: 'rgba(241, 196, 15, 0.85)',
        strokeStyle: '#7d6608',
        lineWidth: 3,
        startAngle: 0,
        endAngle: Math.PI * 1.5,
        clockwise: false,
      });
      const transform = new Components.Transform(engine, { x: 160, y: 440 });
      engine.ecs.addComponent(e, circle);
      engine.ecs.addComponent(e, transform);
      engine.add(e);
    }

    // 5) Transform 变换：旋转 + 缩放 + 斜切（验证 worldMatrix attribute 管线）
    {
      const e = engine.ecs.createEntity();
      const circle = new Components.Circle(engine, {
        radius: 80,
        radiusY: 80,
        fillStyle: '#9b59b6',
        strokeStyle: '#512e5f',
        lineWidth: 5,
      });
      const transform = new Components.Transform(engine, {
        x: 520,
        y: 440,
        rotation: Math.PI / 8,
        scaleX: 1.4,
        scaleY: 0.8,
        skewX: 0.45,
        skewY: 0.0,
      });
      engine.ecs.addComponent(e, circle);
      engine.ecs.addComponent(e, transform);
      engine.add(e);
    }

    // 6) 动态示例：半径/角度/旋转随时间变化 + 点击事件
    {
      const e = engine.ecs.createEntity();
      const circle = new Components.Circle(engine, {
        radius: 70,
        radiusY: 40,
        fillStyle: '#e67e22',
        strokeStyle: '#6e2c00',
        lineWidth: 4,
        startAngle: 0,
        endAngle: Math.PI * 1.2,
        clockwise: true,
      });
      const transform = new Components.Transform(engine, {
        x: 880,
        y: 440,
        rotation: 0,
        scaleX: 1,
        scaleY: 1,
      });
      const event = new Components.EventComponent(engine);

      engine.ecs.addComponent(e, circle);
      engine.ecs.addComponent(e, transform);
      engine.ecs.addComponent(e, event);
      engine.add(e);

      event.on('click', (ev) => {
        console.log('circle clicked', ev);
      });

      const baseRadius = 70;
      const baseRadiusY = 40;
      engine.ticker.add(() => {
        const t = performance.now() * 0.001;

        // 旋转
        transform.rotation = t * 0.6;

        // 半径脉冲（椭圆）
        circle.radius = baseRadius + Math.sin(t * 2.0) * 18;
        circle.radiusY = baseRadiusY + Math.cos(t * 1.7) * 10;

        // 圆弧角度动态
        circle.startAngle = (t * 0.8) % (Math.PI * 2);
        circle.endAngle = circle.startAngle + (Math.sin(t * 1.3) * 0.5 + 1.2);
      });
    }

    engine.start();
  </script>
</body>

</html>
