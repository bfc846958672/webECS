<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>curve 曲线示例（fill + stroke）</title>
</head>

<body>
  <div id="app">
    <div id="game-container">
      <canvas id="game-canvas" width="1200" height="800" style="border:1px solid #000;"></canvas>
    </div>
  </div>

  <script type="module">
    import { Engine, Components } from '../../src/main.ts';

    const canvas = document.getElementById('game-canvas');
    const engine = new Engine(canvas);
    engine.boxDebug = true;

    function addCurve({ x, y, rotation = 0, scaleX = 1, scaleY = 1, skewX = 0, skewY = 0 }, curveConfig, withEvent = false) {
      const e = engine.ecs.createEntity();
      const curve = new Components.Curve(engine, curveConfig);
      const transform = new Components.Transform(engine, { x, y, rotation, scaleX, scaleY, skewX, skewY });

      engine.ecs.addComponent(e, curve);
      engine.ecs.addComponent(e, transform);

      let event = null;
      if (withEvent) {
        event = new Components.EventComponent(engine);
        engine.ecs.addComponent(e, event);
      }

      engine.add(e);
      return { e, curve, transform, event };
    }

    // 1) 二次贝塞尔：fill + stroke（自动 end->start 闭合填充）
    addCurve(
      { x: 140, y: 200 },
      {
        start: [0, 0],
        cp1: [140, -140],
        end: [280, 0],
        lineWidth: 8,
        strokeStyle: '#e74c3c',
        fill: 'rgba(231, 76, 60, 0.22)',
        alpha: 1,
      },
      true
    ).event.on('click', (_ev, id) => {
      console.log('点击：二次贝塞尔(fill+stroke)', id);
    });

    // 2) 三次贝塞尔：fill + stroke
    addCurve(
      { x: 520, y: 200 },
      {
        start: [0, 0],
        cp1: [90, -140],
        cp2: [210, 140],
        end: [300, 0],
        lineWidth: 6,
        strokeStyle: '#2980b9',
        fill: 'rgba(52, 152, 219, 0.20)',
        alpha: 1,
      }
    );

    // 3) 仅描边：Transform 变换（旋转/缩放/斜切）
    addCurve(
      { x: 920, y: 220, rotation: Math.PI / 10, scaleX: 1.3, scaleY: 0.9, skewX: 0.35, skewY: 0 },
      {
        start: [0, 0],
        cp1: [120, -120],
        cp2: [180, 140],
        end: [280, 0],
        lineWidth: 10,
        strokeStyle: '#27ae60',
        alpha: 0.95,
      },
      true
    ).event.on('click', (_ev, id) => {
      console.log('点击：Transform 曲线(stroke)', id);
    });

    // 4) 动态曲线：控制点/旋转随时间变化
    {
      const { curve, transform } = addCurve(
        { x: 520, y: 560 },
        {
          start: [0, 0],
          cp1: [90, -120],
          cp2: [210, 120],
          end: [300, 0],
          lineWidth: 7,
          strokeStyle: '#8e44ad',
          fill: 'rgba(142, 68, 173, 0.18)',
          alpha: 1,
        },
        true
      );

      engine.ticker.add(() => {
        const t = performance.now() * 0.001;
        transform.rotation = Math.sin(t * 0.6) * 0.18;

        curve.cp1 = [90 + Math.cos(t * 1.3) * 40, -120 + Math.sin(t * 1.1) * 50];
        curve.cp2 = [210 + Math.sin(t * 1.0) * 50, 120 + Math.cos(t * 1.2) * 40];
      });
    }

    engine.start();
  </script>
</body>

</html>
