{"version":3,"file":"web-ecs.umd.js","sources":["../src/ecs/EntityManager.ts","../src/ecs/ComponentManager.ts","../src/ecs/registry/ComponentRegistry.ts","../src/ecs/Archetype.ts","../src/ecs/ArchetypeManager.ts","../src/components/render/RenderComponent.ts","../src/ecs/EntityComponentManager.ts","../src/ecs/ECSEvent.ts","../src/ecs/ECS.ts","../src/ecs/Ticker.ts","../src/ecs/SceneTree.ts","../node_modules/.pnpm/reflect-metadata@0.2.2/node_modules/reflect-metadata/Reflect.js","../src/ecs/decorators/Component.ts","../node_modules/.pnpm/gl-matrix@3.4.4/node_modules/gl-matrix/esm/common.js","../node_modules/.pnpm/gl-matrix@3.4.4/node_modules/gl-matrix/esm/mat3.js","../node_modules/.pnpm/gl-matrix@3.4.4/node_modules/gl-matrix/esm/vec2.js","../src/components/Transform.ts","../src/ecs/RootEntity.ts","../src/ecs/System.ts","../src/components/render/Rect.ts","../src/systems/render/RectRenderer.ts","../src/components/render/Circle.ts","../src/systems/render/CircleRenderer.ts","../src/components/render/Image.ts","../src/systems/render/ImageRenderer.ts","../src/components/BoundingBoxComponent.ts","../src/systems/TransformProcess.ts","../src/systems/AABB/CircleBoundingBox.ts","../src/systems/AABB/RectBoundingBox.ts","../src/systems/AABB/ImageBoundingBox.ts","../src/components/render/Polyline.ts","../src/systems/AABB/PolylineBoundingBox.ts","../src/components/render/Curve.ts","../src/systems/AABB/CurveBoundingBox.ts","../src/components/render/Path.ts","../src/systems/AABB/PathBoundingBox.ts","../src/systems/AABB/aabbProcess.ts","../src/systems/render/PathRenderer.ts","../src/systems/render/PolylineRenderer.ts","../src/systems/render/CurveRenderer.ts","../src/systems/SceneTreeRenderSystem.ts","../src/systems/AABB/hitprocess.ts","../src/systems/PickEntitySystem.ts","../src/ecs/EngineEvent.ts","../src/systems/BoxDebugSystem.ts","../src/components/Event.ts","../src/systems/EventSystem.ts","../src/ecs/Engine.ts","../src/utils/fetchImage.ts"],"sourcesContent":["export class EntityManager {\r\n    private nextId: number = 0;\r\n    private entities: Set<number> = new Set();\r\n\r\n    /** 创建实体 */\r\n    createEntity(): number {\r\n        const id = this.nextId++;\r\n        this.entities.add(id);\r\n        return id;\r\n    }\r\n\r\n    /** 删除实体 */\r\n    removeEntity(id: number) {\r\n        this.entities.delete(id);\r\n    }\r\n\r\n    /** 是否存在 */\r\n    hasEntity(id: number): boolean {\r\n        return this.entities.has(id);\r\n    }\r\n\r\n    /** 获取所有实体 */\r\n    getAllEntities(): number[] {\r\n        return Array.from(this.entities);\r\n    }\r\n}\r\n\r\n// 使用\r\n","/**\r\n * ComponentManager - 类型安全版\r\n * 用泛型约束组件类型，移除 any\r\n */\r\n\r\nexport class ComponentManager {\r\n    // 每种组件类型对应一个 Map<entityId, component>\r\n    private componentsByType = new Map<Function, Map<number, unknown>>();\r\n\r\n    /** 添加组件 */\r\n    addComponent<T extends object>(entityId: number, component: T): void {\r\n        const type = component.constructor;\r\n        let store = this.componentsByType.get(type);\r\n        if (!store) {\r\n            store = new Map<number, T>();\r\n            this.componentsByType.set(type, store);\r\n        }\r\n        (store as Map<number, T>).set(entityId, component);\r\n    }\r\n\r\n    /** 移除组件 */\r\n    removeComponent<T extends object>(entityId: number, componentClass: new (...args: any[]) => T): void {\r\n        const store = this.componentsByType.get(componentClass);\r\n        (store as Map<number, T> | undefined)?.delete(entityId);\r\n    }\r\n\r\n    /** 获取组件 */\r\n    getComponent<T extends object>(entityId: number, componentClass: new (...args: any[]) => T): T | undefined {\r\n        const store = this.componentsByType.get(componentClass);\r\n        return (store as Map<number, T> | undefined)?.get(entityId);\r\n    }\r\n\r\n    /** 获取拥有该组件的所有实体 */\r\n    getEntitiesWithComponent<T extends object>(componentClass: new (...args: any[]) => T): number[] {\r\n        const store = this.componentsByType.get(componentClass);\r\n        return store ? Array.from((store as Map<number, T>).keys()) : [];\r\n    }\r\n\r\n    /** 检查实体是否有该组件 */\r\n    hasComponent<T extends object>(entityId: number, componentClass: new (...args: any[]) => T): boolean {\r\n        const store = this.componentsByType.get(componentClass);\r\n        return (store as Map<number, T> | undefined)?.has(entityId) ?? false;\r\n    }\r\n}\r\n","export const ComponentRegistry = new Map<string, Function>();","import { IComponent } from \"./interface/IComponent.ts\";\r\n\r\n/**\r\n * Archetype：管理一组固定组件组合的实体集合\r\n * 只负责列式存储和实体的增删\r\n */\r\nexport class Archetype {\r\n  /** 实体ID数组 */\r\n  public entities: number[] = [];\r\n\r\n  /** 组件类型集合（固定） */\r\n  public componentTypes: Set<Function>;\r\n\r\n  /** 列式存储：组件类型 -> 对应组件实例数组 */\r\n  public columns: Map<Function, IComponent[]> = new Map();\r\n\r\n  constructor(componentTypes: Set<Function>) {\r\n    this.componentTypes = componentTypes;\r\n    for (const c of componentTypes) {\r\n      this.columns.set(c, []);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 添加实体及对应组件实例\r\n   * @param entityId 实体ID\r\n   * @param components Map<组件类, 组件实例>，必须包含该 Archetype 的所有组件\r\n   */\r\n  add(entityId: number, components: Map<Function, IComponent>) {\r\n    this.entities.push(entityId);\r\n    for (const c of this.componentTypes) {\r\n      const col = this.columns.get(c)!;\r\n      const comp = components.get(c);\r\n      if (!comp) {\r\n        throw new Error(`Missing component ${c.name} for entity ${entityId}`);\r\n      }\r\n      col.push(comp);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 从 Archetype 移除实体及对应组件实例\r\n   */\r\n  remove(entityId: number) {\r\n    const index = this.entities.indexOf(entityId);\r\n    if (index === -1) return;\r\n\r\n    this.entities.splice(index, 1);\r\n    for (const col of this.columns.values()) {\r\n      col.splice(index, 1); // 保持列对齐\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 判断 Archetype 是否包含指定组件集合（子集匹配）\r\n   */\r\n  matches(queryComponents: Function[]): boolean {\r\n    return queryComponents.every(c => this.componentTypes.has(c));\r\n  }\r\n\r\n  /**\r\n   * 获取实体对应组件实例\r\n   */\r\n  getComponent<T extends IComponent>(entityId: number, componentClass: Function): T | undefined {\r\n    const index = this.entities.indexOf(entityId);\r\n    if (index === -1) return undefined;\r\n    const col = this.columns.get(componentClass);\r\n    return col ? (col[index] as T) : undefined;\r\n  }\r\n}\r\n","import { Archetype } from \"./Archetype.ts\";\r\nimport { IComponent } from \"./interface/IComponent.ts\";\r\n\r\nexport class ArchetypeManager {\r\n    private entityArchetypeMap: Map<number, Archetype> = new Map();\r\n    private archetypeMap: Map<string, Archetype> = new Map();\r\n\r\n    /** 生成组件组合 key */\r\n    private getComponentKey(components: Set<Function>): string {\r\n        return Array.from(components).map(c => c.name).sort().join(\"|\");\r\n    }\r\n\r\n    /** 获取或创建 Archetype */\r\n    getOrCreateArchetype(comps: Map<Function, IComponent>): Archetype {\r\n        const key = this.getComponentKey(new Set(comps.keys()));\r\n        let archetype = this.archetypeMap.get(key);\r\n        if (!archetype) {\r\n            archetype = new Archetype(new Set(comps.keys()));\r\n            this.archetypeMap.set(key, archetype);\r\n        }\r\n        return archetype;\r\n    }\r\n\r\n    /** 迁移实体到新的 Archetype */\r\n    migrateEntity(entityId: number, comps: Map<Function, IComponent>) {\r\n        const oldArchetype = this.entityArchetypeMap.get(entityId);\r\n        if (oldArchetype) oldArchetype.remove(entityId);\r\n\r\n        const newArchetype = this.getOrCreateArchetype(comps);\r\n        newArchetype.add(entityId, comps);\r\n        this.entityArchetypeMap.set(entityId, newArchetype);\r\n    }\r\n\r\n    /** 获取实体对应的 Archetype */\r\n    getArchetypeOf(entityId: number): Archetype | undefined {\r\n        return this.entityArchetypeMap.get(entityId);\r\n    }\r\n\r\n    /** 查询 Archetypes */\r\n    queryArchetypes(componentClasses: Function[]): Archetype[] {\r\n        const key = this.getComponentKey(new Set(componentClasses));\r\n        const archetype = this.archetypeMap.get(key);\r\n        return archetype ? [archetype] : [];\r\n    }\r\n\r\n    /** 删除实体 */\r\n    removeEntity(entityId: number) {\r\n        const archetype = this.entityArchetypeMap.get(entityId);\r\n        if (archetype) archetype.remove(entityId);\r\n        this.entityArchetypeMap.delete(entityId);\r\n    }\r\n}\r\n","import { IComponent } from \"../../ecs/interface/IComponent\";\r\nimport { Engine } from \"../../ecs/Engine.ts\";\r\n/**\r\n * 渲染组件，保证实体仅有一个渲染组件\r\n */\r\nexport class RenderComponent implements IComponent {\r\n  #engine: Engine | null;\r\n  constructor(engine: Engine | null, { }: Partial<RenderComponent> = {}) {\r\n    this.#engine = engine;\r\n    this.#engine;\r\n  }\r\n}\r\n\r\n","import { RenderComponent } from \"../components/render/RenderComponent.ts\";\r\nimport { IComponent, ComponentConstructor } from \"./interface/IComponent.ts\";\r\ntype IComponentClass = ComponentConstructor<IComponent>;\r\nexport class EntityComponentManager {\r\n    // 保证只有一个渲染组件\r\n    private renderMap = new Map<number, IComponentClass>();\r\n    // 实体 ==> 组件映射表\r\n    private map = new Map<number, Map<IComponentClass, IComponent>>();\r\n    // 新增：组件实例 ==> 实体映射\r\n    private componentEntityMap = new Map<IComponent, number>();\r\n\r\n    getComponentsMap(entityId: number): Map<IComponentClass, IComponent> | undefined {\r\n        return this.map.get(entityId);\r\n    }\r\n    isRenderComponent(component: IComponent) {\r\n        return component instanceof RenderComponent;\r\n    }\r\n    addComponent(entityId: number, component: IComponent) {\r\n        if (!this.map.has(entityId)) {\r\n            this.map.set(entityId, new Map());\r\n        }\r\n        const components = this.map.get(entityId)!;\r\n        const componentClass = component.constructor as IComponentClass;\r\n\r\n        // 如果是渲染组件，保证唯一\r\n        if (this.isRenderComponent(component)) {\r\n            const renderClass = this.renderMap.get(entityId);\r\n            if (renderClass) {\r\n                const oldComp = components.get(renderClass);\r\n                if (oldComp) this.componentEntityMap.delete(oldComp); //  删除旧映射\r\n                components.delete(renderClass);\r\n            }\r\n            this.renderMap.set(entityId, componentClass);\r\n        }\r\n\r\n        components.set(componentClass, component);\r\n        this.componentEntityMap.set(component, entityId); // 新增映射\r\n    }\r\n\r\n    removeEntity(entityId: number) {\r\n        const comps = this.map.get(entityId);\r\n        if (comps) {\r\n            for (const comp of comps.values()) {\r\n                this.componentEntityMap.delete(comp);\r\n            }\r\n        }\r\n        this.map.delete(entityId);\r\n        this.renderMap.delete(entityId);\r\n    }\r\n\r\n    removeComponent(entityId: number, componentClass: IComponentClass) {\r\n        if (componentClass === RenderComponent) {\r\n            this.renderMap.delete(entityId);\r\n        }\r\n        const comps = this.map.get(entityId);\r\n        if (!comps) return;\r\n\r\n        const comp = comps.get(componentClass);\r\n        if (comp) this.componentEntityMap.delete(comp); // 删除映射\r\n        comps.delete(componentClass);\r\n\r\n        if (comps.size === 0) {\r\n            this.map.delete(entityId);\r\n        }\r\n    }\r\n\r\n    getComponent<T extends IComponent>(entityId: number, componentClass: ComponentConstructor<T>): T | undefined {\r\n        return this.map.get(entityId)?.get(componentClass) as T | undefined;\r\n    }\r\n\r\n    getComponents(entityId: number) {\r\n        return this.map.get(entityId);\r\n    }\r\n\r\n    hasComponent(entityId: number, componentClass: IComponentClass): boolean {\r\n        return this.map.get(entityId)?.has(componentClass) ?? false;\r\n    }\r\n\r\n    /** 新增方法：根据组件实例获取所属实体ID */\r\n    getEntityIdByComponent(component: IComponent) {\r\n        return this.componentEntityMap.get(component);\r\n    }\r\n}\r\n","import type { IComponent, ComponentConstructor } from \"./interface/IComponent.ts\";\r\n\r\n/** 定义 ECS 事件及其参数类型 */\r\nexport interface ECSEventMap {\r\n  create_entity: [entityId: number];\r\n  remove_entity: [entityId: number];\r\n  add_component: [entityId: number, component: IComponent];\r\n  remove_component: [entityId: number, componentClass: ComponentConstructor<IComponent>];\r\n  // 可以增加自定义事件\r\n  [key: string]: unknown[];\r\n}\r\n\r\n/** 事件监听器类型 */\r\ntype ECSEventListener<T extends unknown[]> = (...args: T) => void;\r\n\r\nexport class ECSEvent<Events extends ECSEventMap = ECSEventMap> {\r\n  private listeners: {\r\n    [K in keyof Events]?: Set<ECSEventListener<Events[K]>>;\r\n  } = {};\r\n\r\n  /** 注册事件监听 */\r\n  on<K extends keyof Events>(event: K, listener: ECSEventListener<Events[K]>): void {\r\n    if (!this.listeners[event]) {\r\n      this.listeners[event] = new Set();\r\n    }\r\n    this.listeners[event]!.add(listener);\r\n  }\r\n\r\n  /** 注销事件监听 */\r\n  off<K extends keyof Events>(event: K, listener?: ECSEventListener<Events[K]>): void {\r\n    const set = this.listeners[event];\r\n    if (!set) return;\r\n\r\n    if (listener) {\r\n      set.delete(listener);\r\n    } else {\r\n      delete this.listeners[event];\r\n    }\r\n  }\r\n\r\n  /** 触发事件 */\r\n  emit<K extends keyof Events>(event: K, ...args: Events[K]): void {\r\n    const set = this.listeners[event];\r\n    if (!set) return;\r\n\r\n    for (const fn of set) {\r\n      fn(...args);\r\n    }\r\n  }\r\n\r\n  /** 清空所有事件监听 */\r\n  clear(): void {\r\n    for (const key in this.listeners) {\r\n      delete this.listeners[key];\r\n    }\r\n  }\r\n}\r\n","import { EntityManager } from \"./EntityManager.ts\";\r\nimport { ComponentManager } from \"./ComponentManager.ts\";\r\nimport type { ISystem, ISystemClass } from \"./System.ts\";\r\nimport { IComponent, ComponentConstructor } from \"./interface/IComponent.ts\";\r\nimport { ComponentRegistry } from \"./registry/ComponentRegistry.ts\";\r\nimport { ArchetypeManager } from \"./ArchetypeManager.ts\";\r\nimport { EntityComponentManager } from \"./EntityComponentManager.ts\";\r\nimport { ECSEvent } from \"./ECSEvent.ts\";\r\nexport class ECS {\r\n    public canvas!: HTMLCanvasElement;  // 挂载 Canvas\r\n    public event = new ECSEvent();\r\n    public entities = new EntityManager();\r\n    public components = new ComponentManager();\r\n    private systems: ISystem[] = [];\r\n    public ComponentRegistry = ComponentRegistry;\r\n    // 简单 Map：实体ID -> 组件名 -> 组件实例\r\n    private entityComponents = new EntityComponentManager();\r\n\r\n    private archetypeManager = new ArchetypeManager();\r\n\r\n    #system: Map<ISystemClass, ISystem> = new Map();\r\n    addSystem(system: ISystem) {\r\n        system.init(this);\r\n        this.systems.push(system);\r\n        this.#system.set(system.constructor as ISystemClass, system);\r\n    }\r\n    getSystem<T extends ISystem>(systemClass: ISystemClass<T>): T {\r\n        return this.#system.get(systemClass) as T;\r\n    }\r\n    hasEntity(entityId: number) {\r\n        return this.entities.hasEntity(entityId);\r\n    }\r\n    createEntity() {\r\n        const entityId = this.entities.createEntity();\r\n        this.event.emit(\"create_entity\", entityId);\r\n        return entityId;\r\n    }\r\n    removeEntity(entityId: number) {\r\n        if (!this.hasEntity(entityId)) throw new Error(`Entity ${entityId} not exists`);\r\n        this.entities.removeEntity(entityId);\r\n        this.entityComponents.removeEntity(entityId);\r\n        this.archetypeManager.removeEntity(entityId);\r\n    }\r\n    update(delta: number) {\r\n        for (const sys of this.systems) sys.update(delta);\r\n    }\r\n    addComponent(entityId: number, component: IComponent) {\r\n        if (!this.hasEntity(entityId)) throw new Error(`Entity ${entityId} not exists`);\r\n        // 1️⃣ 检查组件是否注册\r\n        const name = Reflect.getMetadata(\"component:name\", component.constructor);\r\n        if (!this.ComponentRegistry.has(name)) {\r\n            throw new Error(`Component \"${name}\" is not registered!`);\r\n        }\r\n        this.entityComponents.addComponent(entityId, component);\r\n        const comps = this.entityComponents.getComponentsMap(entityId)!;\r\n        this.archetypeManager.migrateEntity(entityId, comps);\r\n\r\n        this.event.emit(\"add_component\", entityId, component);\r\n    }\r\n    removeComponent(entityId: number, componentClass: ComponentConstructor<IComponent>) {\r\n        if (!this.hasEntity(entityId)) throw new Error(`Entity ${entityId} not exists`);\r\n        this.entityComponents.removeComponent(entityId, componentClass);\r\n        const comps = this.entityComponents.getComponentsMap(entityId);\r\n\r\n        if (comps && comps.size > 0) {\r\n            this.archetypeManager.migrateEntity(entityId, comps);\r\n        } else {\r\n            this.archetypeManager.removeEntity(entityId);\r\n        }\r\n        this.event.emit(\"remove_component\", entityId, componentClass);\r\n    }\r\n\r\n\r\n    // ------------------ 查询组件 ------------------\r\n    getComponent<T extends IComponent>(entityId: number, componentClass: ComponentConstructor<T>): T | undefined {\r\n        return this.entityComponents.getComponent<T>(entityId, componentClass);\r\n    }\r\n    getComponents(entityId: number) {\r\n        return this.entityComponents.getComponents(entityId);\r\n    }\r\n    hasComponent<T extends IComponent>(entityId: number, componentClass: ComponentConstructor<T>): boolean {\r\n        return this.entityComponents.hasComponent(entityId, componentClass);\r\n    }\r\n\r\n    /** 返回拥有指定组件组合的实体列表 */\r\n    getEntitiesWith(components: ComponentConstructor<IComponent>[]): number[] {\r\n        const archetypes = this.archetypeManager.queryArchetypes(components);\r\n        const result: number[] = [];\r\n        for (const arch of archetypes) {\r\n            result.push(...arch.entities);\r\n        }\r\n        return result;\r\n    }\r\n   \r\n    getEntityIdByComponent(component: IComponent) {\r\n        return this.entityComponents.getEntityIdByComponent(component);\r\n    }\r\n}\r\n\r\n\r\n","export class Ticker {\r\n  private lastTime = 0;\r\n  private running = false;\r\n  private callbacks: ((dt: number) => void)[] = [];\r\n\r\n  constructor() {\r\n    this.loop = this.loop.bind(this); // 绑定 this 上下文\r\n  }\r\n\r\n  add(callback: (dt: number) => void) {\r\n    this.callbacks.push(callback);\r\n  }\r\n\r\n  remove(callback: (dt: number) => void) {\r\n    const i = this.callbacks.indexOf(callback);\r\n    if (i !== -1) this.callbacks.splice(i, 1);\r\n  }\r\n\r\n  start() {\r\n    if (this.running) return;\r\n    this.running = true;\r\n    this.lastTime = performance.now();\r\n    setInterval(() => {\r\n      this.loop(performance.now());\r\n    }, 20);\r\n  }\r\n\r\n  stop() {\r\n    this.running = false;\r\n  }\r\n\r\n  private loop(now: number) {\r\n    if (!this.running) return;\r\n    const dt = (now - this.lastTime) / 1000; // 秒为单位\r\n    this.lastTime = now;\r\n\r\n    for (const cb of this.callbacks) {\r\n      cb(dt);\r\n    }\r\n    // 递归调用，实现循环,暂时不使用 requestAnimationFrame\r\n    // requestAnimationFrame(this.loop);\r\n\r\n  }\r\n}\r\n","\r\n// SceneNode.ts\r\nexport class SceneNode {\r\n    public parent: SceneNode | null = null;\r\n    public children: SceneNode[] = [];\r\n    constructor(public entityId: number) { }\r\n\r\n    /**\r\n     * 添加子节点\r\n     * @param child SceneNode\r\n     */\r\n    addChild(child: SceneNode) {\r\n        if (child.parent) {\r\n            // 从原父节点移除\r\n            const idx = child.parent.children.indexOf(child);\r\n            if (idx !== -1) child.parent.children.splice(idx, 1);\r\n        }\r\n        child.parent = this;\r\n        this.children.push(child);\r\n    }\r\n    removeChild(child: SceneNode) {\r\n        const index = this.children.indexOf(child);\r\n        if (index === -1) {\r\n            throw new Error(`Cannot remove child: entity ${child.entityId} is not a child of entity ${this.entityId}`);\r\n        }\r\n        this.children.splice(index, 1);\r\n        child.parent = null;\r\n    }\r\n\r\n    /**\r\n     * 获取所有后代节点，深度优先顺序\r\n     */\r\n    getDescendants(): SceneNode[] {\r\n        const result: SceneNode[] = [];\r\n        for (const child of this.children) {\r\n            result.push(child);\r\n            result.push(...child.getDescendants());\r\n        }\r\n        return result;\r\n    }\r\n}\r\n\r\n/**\r\n * 场景树管理\r\n * - 使用单一根节点 rootNode\r\n * - 所有实体挂在根节点下或其子节点下\r\n */\r\nexport class SceneTree {\r\n    /** 节点映射: entityId -> SceneNode */\r\n    private nodes: Map<number, SceneNode> = new Map();\r\n    /** 隐形根节点 */\r\n    readonly root: SceneNode;\r\n\r\n    constructor(public rootEntityId: number) {\r\n        this.root = new SceneNode(rootEntityId);\r\n\r\n        this.nodes.set(rootEntityId, this.root);\r\n    }\r\n\r\n    /**\r\n     * 添加节点到场景树\r\n     * @param entityId 实体ID\r\n     * @param parentId 可选父节点ID, 默认挂到 rootNode\r\n     */\r\n    add(entityId: number, parentId?: number) {\r\n        this._version++;\r\n        if (!this.nodes.has(entityId)) { this.nodes.set(entityId, new SceneNode(entityId)); }\r\n        if (parentId === undefined) parentId = this.rootEntityId;\r\n\r\n        const node = this.nodes.get(entityId)!;\r\n        const parentNode = this.nodes.get(parentId)!;\r\n        node.parent = parentNode;\r\n        parentNode.children.push(node);\r\n        this.displayList = this.build();\r\n    }\r\n    remove(entityId: number) {\r\n        this._version++;\r\n        const node = this.nodes.get(entityId);\r\n        if (!node) throw new Error(`remove fail, Entity ${entityId} not found`);\r\n        if (node.parent) {\r\n            node.parent.removeChild(node);\r\n        }\r\n        this.displayList = this.build();\r\n    }\r\n    /**\r\n     * 获取节点\r\n     */\r\n    get(entityId: number): SceneNode {\r\n        if (!this.nodes.has(entityId)) {\r\n            this.nodes.set(entityId, new SceneNode(entityId));\r\n        }\r\n        return this.nodes.get(entityId)!;\r\n    }\r\n    has(entityId: number): boolean {\r\n        return this.nodes.has(entityId);\r\n    }\r\n    /**\r\n     * 删除节点（递归删除子节点）\r\n     */\r\n    destory(entityId: number) {\r\n        this._version++;\r\n        const node = this.nodes.get(entityId);\r\n        if (!node) throw new Error(`destory fail, Entity ${entityId} not found`);\r\n\r\n        // 递归删除子节点\r\n        const descendants = node.getDescendants();\r\n        for (const desc of descendants) {\r\n            this.nodes.delete(desc.entityId);\r\n        }\r\n\r\n        // 从父节点 children 中移除自己\r\n        if (node.parent) {\r\n            const index = node.parent.children.indexOf(node);\r\n            if (index !== -1) node.parent.children.splice(index, 1);\r\n        }\r\n\r\n        this.nodes.delete(entityId);\r\n        this.displayList = this.build();\r\n    }\r\n\r\n    /**\r\n     * 获取指定节点的父节点\r\n     */\r\n    getParent(entityId: number): SceneNode | null {\r\n        const node = this.nodes.get(entityId);\r\n        return node?.parent || null;\r\n    }\r\n\r\n    /**\r\n     * 获取场景树中所有节点\r\n     */\r\n    all(): SceneNode[] {\r\n        return Array.from(this.nodes.values());\r\n    }\r\n    /** 清空所有非根节点 */\r\n    clear() {\r\n        this._version++;\r\n        // 复制 rootNode.children 避免遍历删除时修改数组\r\n        for (const child of this.root.children.slice()) {\r\n            this.destory(child.entityId);\r\n        }\r\n        this.displayList = this.build();\r\n    }\r\n\r\n    caches: Array<{ entityId: number; parentEntityId: number | null }> = [];\r\n    version = -1\r\n    _version = 0\r\n    forEach<T = unknown>(\r\n        callback: (entityId: number, parentEntityId: number | null, context: T, parentContext: T | null) => void,\r\n        rootContext?: T,\r\n        reverse = false\r\n    ) {\r\n        if (this.version === this._version && this.caches.length > 0) {\r\n            this.forEachCaches(callback, rootContext, reverse);\r\n            return;\r\n        }\r\n        const newCaches: Array<{ entityId: number; parentEntityId: number | null }> = [];\r\n\r\n        const map = new Map<number, T>();\r\n        map.set(this.root.entityId, rootContext ?? ({} as T));\r\n        const visit = (node: SceneNode) => {\r\n            const parentEntityId = node.parent?.entityId ?? null;\r\n            const parentContext = parentEntityId != null ? map.get(parentEntityId)! : null;\r\n            if (!map.has(node.entityId)) map.set(node.entityId, {} as T);\r\n            const context = map.get(node.entityId)!;\r\n            newCaches.push({ entityId: node.entityId, parentEntityId });\r\n\r\n            if (!reverse) {\r\n                callback(node.entityId, parentEntityId, context, parentContext);\r\n                for (let i = 0; i < node.children.length; i++) {\r\n                    visit(node.children[i]);\r\n                }\r\n            } else {\r\n                for (let i = node.children.length - 1; i >= 0; i--) {\r\n                    visit(node.children[i]);\r\n                }\r\n                callback(node.entityId, parentEntityId, context, parentContext);\r\n            }\r\n\r\n        };\r\n        visit(this.root);\r\n        this.caches = newCaches;\r\n        this.version = this._version;\r\n    }\r\n    forEachCaches<T = unknown>(\r\n        callback: (entityId: number, parentEntityId: number | null, context: T, parentContext: Readonly<T> | null) => void,\r\n        rootContext?: T,\r\n        reverse = false\r\n    ) {\r\n        const map = new Map<number, T>();\r\n        map.set(this.root.entityId, rootContext ?? ({} as T));\r\n        const loop = (entityId: number, parentEntityId: number | null) => {\r\n            const context = map.get(entityId) ?? ({} as T);\r\n            map.set(entityId, context);\r\n            const parentContext = parentEntityId != null ? map.get(parentEntityId)! : null;\r\n            callback(entityId, parentEntityId, context, parentContext ? parentContext as T : null);\r\n        }\r\n        if (reverse) {\r\n            for (let i = this.caches.length - 1; i >= 0; i--) {\r\n                const { entityId, parentEntityId } = this.caches[i];\r\n                loop(entityId, parentEntityId);\r\n            }\r\n        } else {\r\n            for (let i = 0; i < this.caches.length; i++) {\r\n                const { entityId, parentEntityId } = this.caches[i];\r\n                loop(entityId, parentEntityId);\r\n            }\r\n        }\r\n    }\r\n    build() {\r\n        const result: Array<[number, number | null]> = [];\r\n        function visit(node: SceneNode, parent: SceneNode | null) {\r\n            result.push([node.entityId, parent?.entityId ?? null]);\r\n            if (node.children) {\r\n                for (const child of node.children) { visit(child, node); }\r\n            }\r\n        }\r\n        visit(this.root, null);\r\n        return result;\r\n    }\r\n    displayList: Array<[number, number | null]> = []\r\n}\r\n// // 前序遍历：先访问当前节点，再递归遍历每个子节点\r\n// function visit(node, parent) {\r\n//     // 更新当前节点矩阵\r\n//     calcMatrix(node);\r\n//     // 渲染当前节点\r\n//     render(node)\r\n//     const childrenResult = []\r\n//     for (const child of node.children) {\r\n//         const result = visit(child, parent);\r\n//         childrenResult.push(result);\r\n//     }\r\n//     // 根据自身和子节点执行 计算包围盒\r\n//     calcBox(node, childrenResult);\r\n//     return result;\r\n// }","/*! *****************************************************************************\nCopyright (C) Microsoft. All rights reserved.\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\nthis file except in compliance with the License. You may obtain a copy of the\nLicense at http://www.apache.org/licenses/LICENSE-2.0\n\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\nMERCHANTABLITY OR NON-INFRINGEMENT.\n\nSee the Apache Version 2.0 License for specific language governing permissions\nand limitations under the License.\n***************************************************************************** */\nvar Reflect;\n(function (Reflect) {\n    // Metadata Proposal\n    // https://rbuckton.github.io/reflect-metadata/\n    (function (factory) {\n        var root = typeof globalThis === \"object\" ? globalThis :\n            typeof global === \"object\" ? global :\n                typeof self === \"object\" ? self :\n                    typeof this === \"object\" ? this :\n                        sloppyModeThis();\n        var exporter = makeExporter(Reflect);\n        if (typeof root.Reflect !== \"undefined\") {\n            exporter = makeExporter(root.Reflect, exporter);\n        }\n        factory(exporter, root);\n        if (typeof root.Reflect === \"undefined\") {\n            root.Reflect = Reflect;\n        }\n        function makeExporter(target, previous) {\n            return function (key, value) {\n                Object.defineProperty(target, key, { configurable: true, writable: true, value: value });\n                if (previous)\n                    previous(key, value);\n            };\n        }\n        function functionThis() {\n            try {\n                return Function(\"return this;\")();\n            }\n            catch (_) { }\n        }\n        function indirectEvalThis() {\n            try {\n                return (void 0, eval)(\"(function() { return this; })()\");\n            }\n            catch (_) { }\n        }\n        function sloppyModeThis() {\n            return functionThis() || indirectEvalThis();\n        }\n    })(function (exporter, root) {\n        var hasOwn = Object.prototype.hasOwnProperty;\n        // feature test for Symbol support\n        var supportsSymbol = typeof Symbol === \"function\";\n        var toPrimitiveSymbol = supportsSymbol && typeof Symbol.toPrimitive !== \"undefined\" ? Symbol.toPrimitive : \"@@toPrimitive\";\n        var iteratorSymbol = supportsSymbol && typeof Symbol.iterator !== \"undefined\" ? Symbol.iterator : \"@@iterator\";\n        var supportsCreate = typeof Object.create === \"function\"; // feature test for Object.create support\n        var supportsProto = { __proto__: [] } instanceof Array; // feature test for __proto__ support\n        var downLevel = !supportsCreate && !supportsProto;\n        var HashMap = {\n            // create an object in dictionary mode (a.k.a. \"slow\" mode in v8)\n            create: supportsCreate\n                ? function () { return MakeDictionary(Object.create(null)); }\n                : supportsProto\n                    ? function () { return MakeDictionary({ __proto__: null }); }\n                    : function () { return MakeDictionary({}); },\n            has: downLevel\n                ? function (map, key) { return hasOwn.call(map, key); }\n                : function (map, key) { return key in map; },\n            get: downLevel\n                ? function (map, key) { return hasOwn.call(map, key) ? map[key] : undefined; }\n                : function (map, key) { return map[key]; },\n        };\n        // Load global or shim versions of Map, Set, and WeakMap\n        var functionPrototype = Object.getPrototypeOf(Function);\n        var _Map = typeof Map === \"function\" && typeof Map.prototype.entries === \"function\" ? Map : CreateMapPolyfill();\n        var _Set = typeof Set === \"function\" && typeof Set.prototype.entries === \"function\" ? Set : CreateSetPolyfill();\n        var _WeakMap = typeof WeakMap === \"function\" ? WeakMap : CreateWeakMapPolyfill();\n        var registrySymbol = supportsSymbol ? Symbol.for(\"@reflect-metadata:registry\") : undefined;\n        var metadataRegistry = GetOrCreateMetadataRegistry();\n        var metadataProvider = CreateMetadataProvider(metadataRegistry);\n        /**\n         * Applies a set of decorators to a property of a target object.\n         * @param decorators An array of decorators.\n         * @param target The target object.\n         * @param propertyKey (Optional) The property key to decorate.\n         * @param attributes (Optional) The property descriptor for the target key.\n         * @remarks Decorators are applied in reverse order.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     Example = Reflect.decorate(decoratorsArray, Example);\n         *\n         *     // property (on constructor)\n         *     Reflect.decorate(decoratorsArray, Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     Reflect.decorate(decoratorsArray, Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     Object.defineProperty(Example, \"staticMethod\",\n         *         Reflect.decorate(decoratorsArray, Example, \"staticMethod\",\n         *             Object.getOwnPropertyDescriptor(Example, \"staticMethod\")));\n         *\n         *     // method (on prototype)\n         *     Object.defineProperty(Example.prototype, \"method\",\n         *         Reflect.decorate(decoratorsArray, Example.prototype, \"method\",\n         *             Object.getOwnPropertyDescriptor(Example.prototype, \"method\")));\n         *\n         */\n        function decorate(decorators, target, propertyKey, attributes) {\n            if (!IsUndefined(propertyKey)) {\n                if (!IsArray(decorators))\n                    throw new TypeError();\n                if (!IsObject(target))\n                    throw new TypeError();\n                if (!IsObject(attributes) && !IsUndefined(attributes) && !IsNull(attributes))\n                    throw new TypeError();\n                if (IsNull(attributes))\n                    attributes = undefined;\n                propertyKey = ToPropertyKey(propertyKey);\n                return DecorateProperty(decorators, target, propertyKey, attributes);\n            }\n            else {\n                if (!IsArray(decorators))\n                    throw new TypeError();\n                if (!IsConstructor(target))\n                    throw new TypeError();\n                return DecorateConstructor(decorators, target);\n            }\n        }\n        exporter(\"decorate\", decorate);\n        // 4.1.2 Reflect.metadata(metadataKey, metadataValue)\n        // https://rbuckton.github.io/reflect-metadata/#reflect.metadata\n        /**\n         * A default metadata decorator factory that can be used on a class, class member, or parameter.\n         * @param metadataKey The key for the metadata entry.\n         * @param metadataValue The value for the metadata entry.\n         * @returns A decorator function.\n         * @remarks\n         * If `metadataKey` is already defined for the target and target key, the\n         * metadataValue for that key will be overwritten.\n         * @example\n         *\n         *     // constructor\n         *     @Reflect.metadata(key, value)\n         *     class Example {\n         *     }\n         *\n         *     // property (on constructor, TypeScript only)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         static staticProperty;\n         *     }\n         *\n         *     // property (on prototype, TypeScript only)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         property;\n         *     }\n         *\n         *     // method (on constructor)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         static staticMethod() { }\n         *     }\n         *\n         *     // method (on prototype)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         method() { }\n         *     }\n         *\n         */\n        function metadata(metadataKey, metadataValue) {\n            function decorator(target, propertyKey) {\n                if (!IsObject(target))\n                    throw new TypeError();\n                if (!IsUndefined(propertyKey) && !IsPropertyKey(propertyKey))\n                    throw new TypeError();\n                OrdinaryDefineOwnMetadata(metadataKey, metadataValue, target, propertyKey);\n            }\n            return decorator;\n        }\n        exporter(\"metadata\", metadata);\n        /**\n         * Define a unique metadata entry on the target.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param metadataValue A value that contains attached metadata.\n         * @param target The target object on which to define metadata.\n         * @param propertyKey (Optional) The property key for the target.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example);\n         *\n         *     // property (on constructor)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example.prototype, \"method\");\n         *\n         *     // decorator factory as metadata-producing annotation.\n         *     function MyAnnotation(options): Decorator {\n         *         return (target, key?) => Reflect.defineMetadata(\"custom:annotation\", options, target, key);\n         *     }\n         *\n         */\n        function defineMetadata(metadataKey, metadataValue, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryDefineOwnMetadata(metadataKey, metadataValue, target, propertyKey);\n        }\n        exporter(\"defineMetadata\", defineMetadata);\n        /**\n         * Gets a value indicating whether the target object or its prototype chain has the provided metadata key defined.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata key was defined on the target object or its prototype chain; otherwise, `false`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function hasMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryHasMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"hasMetadata\", hasMetadata);\n        /**\n         * Gets a value indicating whether the target object has the provided metadata key defined.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata key was defined on the target object; otherwise, `false`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function hasOwnMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryHasOwnMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"hasOwnMetadata\", hasOwnMetadata);\n        /**\n         * Gets the metadata value for the provided metadata key on the target object or its prototype chain.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns The metadata value for the metadata key if found; otherwise, `undefined`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function getMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryGetMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"getMetadata\", getMetadata);\n        /**\n         * Gets the metadata value for the provided metadata key on the target object.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns The metadata value for the metadata key if found; otherwise, `undefined`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function getOwnMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryGetOwnMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"getOwnMetadata\", getOwnMetadata);\n        /**\n         * Gets the metadata keys defined on the target object or its prototype chain.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns An array of unique metadata keys.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getMetadataKeys(Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getMetadataKeys(Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getMetadataKeys(Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getMetadataKeys(Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getMetadataKeys(Example.prototype, \"method\");\n         *\n         */\n        function getMetadataKeys(target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryMetadataKeys(target, propertyKey);\n        }\n        exporter(\"getMetadataKeys\", getMetadataKeys);\n        /**\n         * Gets the unique metadata keys defined on the target object.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns An array of unique metadata keys.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getOwnMetadataKeys(Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getOwnMetadataKeys(Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getOwnMetadataKeys(Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getOwnMetadataKeys(Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getOwnMetadataKeys(Example.prototype, \"method\");\n         *\n         */\n        function getOwnMetadataKeys(target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryOwnMetadataKeys(target, propertyKey);\n        }\n        exporter(\"getOwnMetadataKeys\", getOwnMetadataKeys);\n        /**\n         * Deletes the metadata entry from the target object with the provided key.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata entry was found and deleted; otherwise, false.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function deleteMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            var provider = GetMetadataProvider(target, propertyKey, /*Create*/ false);\n            if (IsUndefined(provider))\n                return false;\n            return provider.OrdinaryDeleteMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"deleteMetadata\", deleteMetadata);\n        function DecorateConstructor(decorators, target) {\n            for (var i = decorators.length - 1; i >= 0; --i) {\n                var decorator = decorators[i];\n                var decorated = decorator(target);\n                if (!IsUndefined(decorated) && !IsNull(decorated)) {\n                    if (!IsConstructor(decorated))\n                        throw new TypeError();\n                    target = decorated;\n                }\n            }\n            return target;\n        }\n        function DecorateProperty(decorators, target, propertyKey, descriptor) {\n            for (var i = decorators.length - 1; i >= 0; --i) {\n                var decorator = decorators[i];\n                var decorated = decorator(target, propertyKey, descriptor);\n                if (!IsUndefined(decorated) && !IsNull(decorated)) {\n                    if (!IsObject(decorated))\n                        throw new TypeError();\n                    descriptor = decorated;\n                }\n            }\n            return descriptor;\n        }\n        // 3.1.1.1 OrdinaryHasMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryhasmetadata\n        function OrdinaryHasMetadata(MetadataKey, O, P) {\n            var hasOwn = OrdinaryHasOwnMetadata(MetadataKey, O, P);\n            if (hasOwn)\n                return true;\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (!IsNull(parent))\n                return OrdinaryHasMetadata(MetadataKey, parent, P);\n            return false;\n        }\n        // 3.1.2.1 OrdinaryHasOwnMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryhasownmetadata\n        function OrdinaryHasOwnMetadata(MetadataKey, O, P) {\n            var provider = GetMetadataProvider(O, P, /*Create*/ false);\n            if (IsUndefined(provider))\n                return false;\n            return ToBoolean(provider.OrdinaryHasOwnMetadata(MetadataKey, O, P));\n        }\n        // 3.1.3.1 OrdinaryGetMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarygetmetadata\n        function OrdinaryGetMetadata(MetadataKey, O, P) {\n            var hasOwn = OrdinaryHasOwnMetadata(MetadataKey, O, P);\n            if (hasOwn)\n                return OrdinaryGetOwnMetadata(MetadataKey, O, P);\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (!IsNull(parent))\n                return OrdinaryGetMetadata(MetadataKey, parent, P);\n            return undefined;\n        }\n        // 3.1.4.1 OrdinaryGetOwnMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarygetownmetadata\n        function OrdinaryGetOwnMetadata(MetadataKey, O, P) {\n            var provider = GetMetadataProvider(O, P, /*Create*/ false);\n            if (IsUndefined(provider))\n                return;\n            return provider.OrdinaryGetOwnMetadata(MetadataKey, O, P);\n        }\n        // 3.1.5.1 OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarydefineownmetadata\n        function OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P) {\n            var provider = GetMetadataProvider(O, P, /*Create*/ true);\n            provider.OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P);\n        }\n        // 3.1.6.1 OrdinaryMetadataKeys(O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarymetadatakeys\n        function OrdinaryMetadataKeys(O, P) {\n            var ownKeys = OrdinaryOwnMetadataKeys(O, P);\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (parent === null)\n                return ownKeys;\n            var parentKeys = OrdinaryMetadataKeys(parent, P);\n            if (parentKeys.length <= 0)\n                return ownKeys;\n            if (ownKeys.length <= 0)\n                return parentKeys;\n            var set = new _Set();\n            var keys = [];\n            for (var _i = 0, ownKeys_1 = ownKeys; _i < ownKeys_1.length; _i++) {\n                var key = ownKeys_1[_i];\n                var hasKey = set.has(key);\n                if (!hasKey) {\n                    set.add(key);\n                    keys.push(key);\n                }\n            }\n            for (var _a = 0, parentKeys_1 = parentKeys; _a < parentKeys_1.length; _a++) {\n                var key = parentKeys_1[_a];\n                var hasKey = set.has(key);\n                if (!hasKey) {\n                    set.add(key);\n                    keys.push(key);\n                }\n            }\n            return keys;\n        }\n        // 3.1.7.1 OrdinaryOwnMetadataKeys(O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryownmetadatakeys\n        function OrdinaryOwnMetadataKeys(O, P) {\n            var provider = GetMetadataProvider(O, P, /*create*/ false);\n            if (!provider) {\n                return [];\n            }\n            return provider.OrdinaryOwnMetadataKeys(O, P);\n        }\n        // 6 ECMAScript Data Types and Values\n        // https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values\n        function Type(x) {\n            if (x === null)\n                return 1 /* Null */;\n            switch (typeof x) {\n                case \"undefined\": return 0 /* Undefined */;\n                case \"boolean\": return 2 /* Boolean */;\n                case \"string\": return 3 /* String */;\n                case \"symbol\": return 4 /* Symbol */;\n                case \"number\": return 5 /* Number */;\n                case \"object\": return x === null ? 1 /* Null */ : 6 /* Object */;\n                default: return 6 /* Object */;\n            }\n        }\n        // 6.1.1 The Undefined Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-undefined-type\n        function IsUndefined(x) {\n            return x === undefined;\n        }\n        // 6.1.2 The Null Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-null-type\n        function IsNull(x) {\n            return x === null;\n        }\n        // 6.1.5 The Symbol Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-symbol-type\n        function IsSymbol(x) {\n            return typeof x === \"symbol\";\n        }\n        // 6.1.7 The Object Type\n        // https://tc39.github.io/ecma262/#sec-object-type\n        function IsObject(x) {\n            return typeof x === \"object\" ? x !== null : typeof x === \"function\";\n        }\n        // 7.1 Type Conversion\n        // https://tc39.github.io/ecma262/#sec-type-conversion\n        // 7.1.1 ToPrimitive(input [, PreferredType])\n        // https://tc39.github.io/ecma262/#sec-toprimitive\n        function ToPrimitive(input, PreferredType) {\n            switch (Type(input)) {\n                case 0 /* Undefined */: return input;\n                case 1 /* Null */: return input;\n                case 2 /* Boolean */: return input;\n                case 3 /* String */: return input;\n                case 4 /* Symbol */: return input;\n                case 5 /* Number */: return input;\n            }\n            var hint = PreferredType === 3 /* String */ ? \"string\" : PreferredType === 5 /* Number */ ? \"number\" : \"default\";\n            var exoticToPrim = GetMethod(input, toPrimitiveSymbol);\n            if (exoticToPrim !== undefined) {\n                var result = exoticToPrim.call(input, hint);\n                if (IsObject(result))\n                    throw new TypeError();\n                return result;\n            }\n            return OrdinaryToPrimitive(input, hint === \"default\" ? \"number\" : hint);\n        }\n        // 7.1.1.1 OrdinaryToPrimitive(O, hint)\n        // https://tc39.github.io/ecma262/#sec-ordinarytoprimitive\n        function OrdinaryToPrimitive(O, hint) {\n            if (hint === \"string\") {\n                var toString_1 = O.toString;\n                if (IsCallable(toString_1)) {\n                    var result = toString_1.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n                var valueOf = O.valueOf;\n                if (IsCallable(valueOf)) {\n                    var result = valueOf.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n            }\n            else {\n                var valueOf = O.valueOf;\n                if (IsCallable(valueOf)) {\n                    var result = valueOf.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n                var toString_2 = O.toString;\n                if (IsCallable(toString_2)) {\n                    var result = toString_2.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n            }\n            throw new TypeError();\n        }\n        // 7.1.2 ToBoolean(argument)\n        // https://tc39.github.io/ecma262/2016/#sec-toboolean\n        function ToBoolean(argument) {\n            return !!argument;\n        }\n        // 7.1.12 ToString(argument)\n        // https://tc39.github.io/ecma262/#sec-tostring\n        function ToString(argument) {\n            return \"\" + argument;\n        }\n        // 7.1.14 ToPropertyKey(argument)\n        // https://tc39.github.io/ecma262/#sec-topropertykey\n        function ToPropertyKey(argument) {\n            var key = ToPrimitive(argument, 3 /* String */);\n            if (IsSymbol(key))\n                return key;\n            return ToString(key);\n        }\n        // 7.2 Testing and Comparison Operations\n        // https://tc39.github.io/ecma262/#sec-testing-and-comparison-operations\n        // 7.2.2 IsArray(argument)\n        // https://tc39.github.io/ecma262/#sec-isarray\n        function IsArray(argument) {\n            return Array.isArray\n                ? Array.isArray(argument)\n                : argument instanceof Object\n                    ? argument instanceof Array\n                    : Object.prototype.toString.call(argument) === \"[object Array]\";\n        }\n        // 7.2.3 IsCallable(argument)\n        // https://tc39.github.io/ecma262/#sec-iscallable\n        function IsCallable(argument) {\n            // NOTE: This is an approximation as we cannot check for [[Call]] internal method.\n            return typeof argument === \"function\";\n        }\n        // 7.2.4 IsConstructor(argument)\n        // https://tc39.github.io/ecma262/#sec-isconstructor\n        function IsConstructor(argument) {\n            // NOTE: This is an approximation as we cannot check for [[Construct]] internal method.\n            return typeof argument === \"function\";\n        }\n        // 7.2.7 IsPropertyKey(argument)\n        // https://tc39.github.io/ecma262/#sec-ispropertykey\n        function IsPropertyKey(argument) {\n            switch (Type(argument)) {\n                case 3 /* String */: return true;\n                case 4 /* Symbol */: return true;\n                default: return false;\n            }\n        }\n        function SameValueZero(x, y) {\n            return x === y || x !== x && y !== y;\n        }\n        // 7.3 Operations on Objects\n        // https://tc39.github.io/ecma262/#sec-operations-on-objects\n        // 7.3.9 GetMethod(V, P)\n        // https://tc39.github.io/ecma262/#sec-getmethod\n        function GetMethod(V, P) {\n            var func = V[P];\n            if (func === undefined || func === null)\n                return undefined;\n            if (!IsCallable(func))\n                throw new TypeError();\n            return func;\n        }\n        // 7.4 Operations on Iterator Objects\n        // https://tc39.github.io/ecma262/#sec-operations-on-iterator-objects\n        function GetIterator(obj) {\n            var method = GetMethod(obj, iteratorSymbol);\n            if (!IsCallable(method))\n                throw new TypeError(); // from Call\n            var iterator = method.call(obj);\n            if (!IsObject(iterator))\n                throw new TypeError();\n            return iterator;\n        }\n        // 7.4.4 IteratorValue(iterResult)\n        // https://tc39.github.io/ecma262/2016/#sec-iteratorvalue\n        function IteratorValue(iterResult) {\n            return iterResult.value;\n        }\n        // 7.4.5 IteratorStep(iterator)\n        // https://tc39.github.io/ecma262/#sec-iteratorstep\n        function IteratorStep(iterator) {\n            var result = iterator.next();\n            return result.done ? false : result;\n        }\n        // 7.4.6 IteratorClose(iterator, completion)\n        // https://tc39.github.io/ecma262/#sec-iteratorclose\n        function IteratorClose(iterator) {\n            var f = iterator[\"return\"];\n            if (f)\n                f.call(iterator);\n        }\n        // 9.1 Ordinary Object Internal Methods and Internal Slots\n        // https://tc39.github.io/ecma262/#sec-ordinary-object-internal-methods-and-internal-slots\n        // 9.1.1.1 OrdinaryGetPrototypeOf(O)\n        // https://tc39.github.io/ecma262/#sec-ordinarygetprototypeof\n        function OrdinaryGetPrototypeOf(O) {\n            var proto = Object.getPrototypeOf(O);\n            if (typeof O !== \"function\" || O === functionPrototype)\n                return proto;\n            // TypeScript doesn't set __proto__ in ES5, as it's non-standard.\n            // Try to determine the superclass constructor. Compatible implementations\n            // must either set __proto__ on a subclass constructor to the superclass constructor,\n            // or ensure each class has a valid `constructor` property on its prototype that\n            // points back to the constructor.\n            // If this is not the same as Function.[[Prototype]], then this is definately inherited.\n            // This is the case when in ES6 or when using __proto__ in a compatible browser.\n            if (proto !== functionPrototype)\n                return proto;\n            // If the super prototype is Object.prototype, null, or undefined, then we cannot determine the heritage.\n            var prototype = O.prototype;\n            var prototypeProto = prototype && Object.getPrototypeOf(prototype);\n            if (prototypeProto == null || prototypeProto === Object.prototype)\n                return proto;\n            // If the constructor was not a function, then we cannot determine the heritage.\n            var constructor = prototypeProto.constructor;\n            if (typeof constructor !== \"function\")\n                return proto;\n            // If we have some kind of self-reference, then we cannot determine the heritage.\n            if (constructor === O)\n                return proto;\n            // we have a pretty good guess at the heritage.\n            return constructor;\n        }\n        // Global metadata registry\n        // - Allows `import \"reflect-metadata\"` and `import \"reflect-metadata/no-conflict\"` to interoperate.\n        // - Uses isolated metadata if `Reflect` is frozen before the registry can be installed.\n        /**\n         * Creates a registry used to allow multiple `reflect-metadata` providers.\n         */\n        function CreateMetadataRegistry() {\n            var fallback;\n            if (!IsUndefined(registrySymbol) &&\n                typeof root.Reflect !== \"undefined\" &&\n                !(registrySymbol in root.Reflect) &&\n                typeof root.Reflect.defineMetadata === \"function\") {\n                // interoperate with older version of `reflect-metadata` that did not support a registry.\n                fallback = CreateFallbackProvider(root.Reflect);\n            }\n            var first;\n            var second;\n            var rest;\n            var targetProviderMap = new _WeakMap();\n            var registry = {\n                registerProvider: registerProvider,\n                getProvider: getProvider,\n                setProvider: setProvider,\n            };\n            return registry;\n            function registerProvider(provider) {\n                if (!Object.isExtensible(registry)) {\n                    throw new Error(\"Cannot add provider to a frozen registry.\");\n                }\n                switch (true) {\n                    case fallback === provider: break;\n                    case IsUndefined(first):\n                        first = provider;\n                        break;\n                    case first === provider: break;\n                    case IsUndefined(second):\n                        second = provider;\n                        break;\n                    case second === provider: break;\n                    default:\n                        if (rest === undefined)\n                            rest = new _Set();\n                        rest.add(provider);\n                        break;\n                }\n            }\n            function getProviderNoCache(O, P) {\n                if (!IsUndefined(first)) {\n                    if (first.isProviderFor(O, P))\n                        return first;\n                    if (!IsUndefined(second)) {\n                        if (second.isProviderFor(O, P))\n                            return first;\n                        if (!IsUndefined(rest)) {\n                            var iterator = GetIterator(rest);\n                            while (true) {\n                                var next = IteratorStep(iterator);\n                                if (!next) {\n                                    return undefined;\n                                }\n                                var provider = IteratorValue(next);\n                                if (provider.isProviderFor(O, P)) {\n                                    IteratorClose(iterator);\n                                    return provider;\n                                }\n                            }\n                        }\n                    }\n                }\n                if (!IsUndefined(fallback) && fallback.isProviderFor(O, P)) {\n                    return fallback;\n                }\n                return undefined;\n            }\n            function getProvider(O, P) {\n                var providerMap = targetProviderMap.get(O);\n                var provider;\n                if (!IsUndefined(providerMap)) {\n                    provider = providerMap.get(P);\n                }\n                if (!IsUndefined(provider)) {\n                    return provider;\n                }\n                provider = getProviderNoCache(O, P);\n                if (!IsUndefined(provider)) {\n                    if (IsUndefined(providerMap)) {\n                        providerMap = new _Map();\n                        targetProviderMap.set(O, providerMap);\n                    }\n                    providerMap.set(P, provider);\n                }\n                return provider;\n            }\n            function hasProvider(provider) {\n                if (IsUndefined(provider))\n                    throw new TypeError();\n                return first === provider || second === provider || !IsUndefined(rest) && rest.has(provider);\n            }\n            function setProvider(O, P, provider) {\n                if (!hasProvider(provider)) {\n                    throw new Error(\"Metadata provider not registered.\");\n                }\n                var existingProvider = getProvider(O, P);\n                if (existingProvider !== provider) {\n                    if (!IsUndefined(existingProvider)) {\n                        return false;\n                    }\n                    var providerMap = targetProviderMap.get(O);\n                    if (IsUndefined(providerMap)) {\n                        providerMap = new _Map();\n                        targetProviderMap.set(O, providerMap);\n                    }\n                    providerMap.set(P, provider);\n                }\n                return true;\n            }\n        }\n        /**\n         * Gets or creates the shared registry of metadata providers.\n         */\n        function GetOrCreateMetadataRegistry() {\n            var metadataRegistry;\n            if (!IsUndefined(registrySymbol) && IsObject(root.Reflect) && Object.isExtensible(root.Reflect)) {\n                metadataRegistry = root.Reflect[registrySymbol];\n            }\n            if (IsUndefined(metadataRegistry)) {\n                metadataRegistry = CreateMetadataRegistry();\n            }\n            if (!IsUndefined(registrySymbol) && IsObject(root.Reflect) && Object.isExtensible(root.Reflect)) {\n                Object.defineProperty(root.Reflect, registrySymbol, {\n                    enumerable: false,\n                    configurable: false,\n                    writable: false,\n                    value: metadataRegistry\n                });\n            }\n            return metadataRegistry;\n        }\n        function CreateMetadataProvider(registry) {\n            // [[Metadata]] internal slot\n            // https://rbuckton.github.io/reflect-metadata/#ordinary-object-internal-methods-and-internal-slots\n            var metadata = new _WeakMap();\n            var provider = {\n                isProviderFor: function (O, P) {\n                    var targetMetadata = metadata.get(O);\n                    if (IsUndefined(targetMetadata))\n                        return false;\n                    return targetMetadata.has(P);\n                },\n                OrdinaryDefineOwnMetadata: OrdinaryDefineOwnMetadata,\n                OrdinaryHasOwnMetadata: OrdinaryHasOwnMetadata,\n                OrdinaryGetOwnMetadata: OrdinaryGetOwnMetadata,\n                OrdinaryOwnMetadataKeys: OrdinaryOwnMetadataKeys,\n                OrdinaryDeleteMetadata: OrdinaryDeleteMetadata,\n            };\n            metadataRegistry.registerProvider(provider);\n            return provider;\n            function GetOrCreateMetadataMap(O, P, Create) {\n                var targetMetadata = metadata.get(O);\n                var createdTargetMetadata = false;\n                if (IsUndefined(targetMetadata)) {\n                    if (!Create)\n                        return undefined;\n                    targetMetadata = new _Map();\n                    metadata.set(O, targetMetadata);\n                    createdTargetMetadata = true;\n                }\n                var metadataMap = targetMetadata.get(P);\n                if (IsUndefined(metadataMap)) {\n                    if (!Create)\n                        return undefined;\n                    metadataMap = new _Map();\n                    targetMetadata.set(P, metadataMap);\n                    if (!registry.setProvider(O, P, provider)) {\n                        targetMetadata.delete(P);\n                        if (createdTargetMetadata) {\n                            metadata.delete(O);\n                        }\n                        throw new Error(\"Wrong provider for target.\");\n                    }\n                }\n                return metadataMap;\n            }\n            // 3.1.2.1 OrdinaryHasOwnMetadata(MetadataKey, O, P)\n            // https://rbuckton.github.io/reflect-metadata/#ordinaryhasownmetadata\n            function OrdinaryHasOwnMetadata(MetadataKey, O, P) {\n                var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n                if (IsUndefined(metadataMap))\n                    return false;\n                return ToBoolean(metadataMap.has(MetadataKey));\n            }\n            // 3.1.4.1 OrdinaryGetOwnMetadata(MetadataKey, O, P)\n            // https://rbuckton.github.io/reflect-metadata/#ordinarygetownmetadata\n            function OrdinaryGetOwnMetadata(MetadataKey, O, P) {\n                var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n                if (IsUndefined(metadataMap))\n                    return undefined;\n                return metadataMap.get(MetadataKey);\n            }\n            // 3.1.5.1 OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P)\n            // https://rbuckton.github.io/reflect-metadata/#ordinarydefineownmetadata\n            function OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P) {\n                var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ true);\n                metadataMap.set(MetadataKey, MetadataValue);\n            }\n            // 3.1.7.1 OrdinaryOwnMetadataKeys(O, P)\n            // https://rbuckton.github.io/reflect-metadata/#ordinaryownmetadatakeys\n            function OrdinaryOwnMetadataKeys(O, P) {\n                var keys = [];\n                var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n                if (IsUndefined(metadataMap))\n                    return keys;\n                var keysObj = metadataMap.keys();\n                var iterator = GetIterator(keysObj);\n                var k = 0;\n                while (true) {\n                    var next = IteratorStep(iterator);\n                    if (!next) {\n                        keys.length = k;\n                        return keys;\n                    }\n                    var nextValue = IteratorValue(next);\n                    try {\n                        keys[k] = nextValue;\n                    }\n                    catch (e) {\n                        try {\n                            IteratorClose(iterator);\n                        }\n                        finally {\n                            throw e;\n                        }\n                    }\n                    k++;\n                }\n            }\n            function OrdinaryDeleteMetadata(MetadataKey, O, P) {\n                var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n                if (IsUndefined(metadataMap))\n                    return false;\n                if (!metadataMap.delete(MetadataKey))\n                    return false;\n                if (metadataMap.size === 0) {\n                    var targetMetadata = metadata.get(O);\n                    if (!IsUndefined(targetMetadata)) {\n                        targetMetadata.delete(P);\n                        if (targetMetadata.size === 0) {\n                            metadata.delete(targetMetadata);\n                        }\n                    }\n                }\n                return true;\n            }\n        }\n        function CreateFallbackProvider(reflect) {\n            var defineMetadata = reflect.defineMetadata, hasOwnMetadata = reflect.hasOwnMetadata, getOwnMetadata = reflect.getOwnMetadata, getOwnMetadataKeys = reflect.getOwnMetadataKeys, deleteMetadata = reflect.deleteMetadata;\n            var metadataOwner = new _WeakMap();\n            var provider = {\n                isProviderFor: function (O, P) {\n                    var metadataPropertySet = metadataOwner.get(O);\n                    if (!IsUndefined(metadataPropertySet) && metadataPropertySet.has(P)) {\n                        return true;\n                    }\n                    if (getOwnMetadataKeys(O, P).length) {\n                        if (IsUndefined(metadataPropertySet)) {\n                            metadataPropertySet = new _Set();\n                            metadataOwner.set(O, metadataPropertySet);\n                        }\n                        metadataPropertySet.add(P);\n                        return true;\n                    }\n                    return false;\n                },\n                OrdinaryDefineOwnMetadata: defineMetadata,\n                OrdinaryHasOwnMetadata: hasOwnMetadata,\n                OrdinaryGetOwnMetadata: getOwnMetadata,\n                OrdinaryOwnMetadataKeys: getOwnMetadataKeys,\n                OrdinaryDeleteMetadata: deleteMetadata,\n            };\n            return provider;\n        }\n        /**\n         * Gets the metadata provider for an object. If the object has no metadata provider and this is for a create operation,\n         * then this module's metadata provider is assigned to the object.\n         */\n        function GetMetadataProvider(O, P, Create) {\n            var registeredProvider = metadataRegistry.getProvider(O, P);\n            if (!IsUndefined(registeredProvider)) {\n                return registeredProvider;\n            }\n            if (Create) {\n                if (metadataRegistry.setProvider(O, P, metadataProvider)) {\n                    return metadataProvider;\n                }\n                throw new Error(\"Illegal state.\");\n            }\n            return undefined;\n        }\n        // naive Map shim\n        function CreateMapPolyfill() {\n            var cacheSentinel = {};\n            var arraySentinel = [];\n            var MapIterator = /** @class */ (function () {\n                function MapIterator(keys, values, selector) {\n                    this._index = 0;\n                    this._keys = keys;\n                    this._values = values;\n                    this._selector = selector;\n                }\n                MapIterator.prototype[\"@@iterator\"] = function () { return this; };\n                MapIterator.prototype[iteratorSymbol] = function () { return this; };\n                MapIterator.prototype.next = function () {\n                    var index = this._index;\n                    if (index >= 0 && index < this._keys.length) {\n                        var result = this._selector(this._keys[index], this._values[index]);\n                        if (index + 1 >= this._keys.length) {\n                            this._index = -1;\n                            this._keys = arraySentinel;\n                            this._values = arraySentinel;\n                        }\n                        else {\n                            this._index++;\n                        }\n                        return { value: result, done: false };\n                    }\n                    return { value: undefined, done: true };\n                };\n                MapIterator.prototype.throw = function (error) {\n                    if (this._index >= 0) {\n                        this._index = -1;\n                        this._keys = arraySentinel;\n                        this._values = arraySentinel;\n                    }\n                    throw error;\n                };\n                MapIterator.prototype.return = function (value) {\n                    if (this._index >= 0) {\n                        this._index = -1;\n                        this._keys = arraySentinel;\n                        this._values = arraySentinel;\n                    }\n                    return { value: value, done: true };\n                };\n                return MapIterator;\n            }());\n            var Map = /** @class */ (function () {\n                function Map() {\n                    this._keys = [];\n                    this._values = [];\n                    this._cacheKey = cacheSentinel;\n                    this._cacheIndex = -2;\n                }\n                Object.defineProperty(Map.prototype, \"size\", {\n                    get: function () { return this._keys.length; },\n                    enumerable: true,\n                    configurable: true\n                });\n                Map.prototype.has = function (key) { return this._find(key, /*insert*/ false) >= 0; };\n                Map.prototype.get = function (key) {\n                    var index = this._find(key, /*insert*/ false);\n                    return index >= 0 ? this._values[index] : undefined;\n                };\n                Map.prototype.set = function (key, value) {\n                    var index = this._find(key, /*insert*/ true);\n                    this._values[index] = value;\n                    return this;\n                };\n                Map.prototype.delete = function (key) {\n                    var index = this._find(key, /*insert*/ false);\n                    if (index >= 0) {\n                        var size = this._keys.length;\n                        for (var i = index + 1; i < size; i++) {\n                            this._keys[i - 1] = this._keys[i];\n                            this._values[i - 1] = this._values[i];\n                        }\n                        this._keys.length--;\n                        this._values.length--;\n                        if (SameValueZero(key, this._cacheKey)) {\n                            this._cacheKey = cacheSentinel;\n                            this._cacheIndex = -2;\n                        }\n                        return true;\n                    }\n                    return false;\n                };\n                Map.prototype.clear = function () {\n                    this._keys.length = 0;\n                    this._values.length = 0;\n                    this._cacheKey = cacheSentinel;\n                    this._cacheIndex = -2;\n                };\n                Map.prototype.keys = function () { return new MapIterator(this._keys, this._values, getKey); };\n                Map.prototype.values = function () { return new MapIterator(this._keys, this._values, getValue); };\n                Map.prototype.entries = function () { return new MapIterator(this._keys, this._values, getEntry); };\n                Map.prototype[\"@@iterator\"] = function () { return this.entries(); };\n                Map.prototype[iteratorSymbol] = function () { return this.entries(); };\n                Map.prototype._find = function (key, insert) {\n                    if (!SameValueZero(this._cacheKey, key)) {\n                        this._cacheIndex = -1;\n                        for (var i = 0; i < this._keys.length; i++) {\n                            if (SameValueZero(this._keys[i], key)) {\n                                this._cacheIndex = i;\n                                break;\n                            }\n                        }\n                    }\n                    if (this._cacheIndex < 0 && insert) {\n                        this._cacheIndex = this._keys.length;\n                        this._keys.push(key);\n                        this._values.push(undefined);\n                    }\n                    return this._cacheIndex;\n                };\n                return Map;\n            }());\n            return Map;\n            function getKey(key, _) {\n                return key;\n            }\n            function getValue(_, value) {\n                return value;\n            }\n            function getEntry(key, value) {\n                return [key, value];\n            }\n        }\n        // naive Set shim\n        function CreateSetPolyfill() {\n            var Set = /** @class */ (function () {\n                function Set() {\n                    this._map = new _Map();\n                }\n                Object.defineProperty(Set.prototype, \"size\", {\n                    get: function () { return this._map.size; },\n                    enumerable: true,\n                    configurable: true\n                });\n                Set.prototype.has = function (value) { return this._map.has(value); };\n                Set.prototype.add = function (value) { return this._map.set(value, value), this; };\n                Set.prototype.delete = function (value) { return this._map.delete(value); };\n                Set.prototype.clear = function () { this._map.clear(); };\n                Set.prototype.keys = function () { return this._map.keys(); };\n                Set.prototype.values = function () { return this._map.keys(); };\n                Set.prototype.entries = function () { return this._map.entries(); };\n                Set.prototype[\"@@iterator\"] = function () { return this.keys(); };\n                Set.prototype[iteratorSymbol] = function () { return this.keys(); };\n                return Set;\n            }());\n            return Set;\n        }\n        // naive WeakMap shim\n        function CreateWeakMapPolyfill() {\n            var UUID_SIZE = 16;\n            var keys = HashMap.create();\n            var rootKey = CreateUniqueKey();\n            return /** @class */ (function () {\n                function WeakMap() {\n                    this._key = CreateUniqueKey();\n                }\n                WeakMap.prototype.has = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? HashMap.has(table, this._key) : false;\n                };\n                WeakMap.prototype.get = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? HashMap.get(table, this._key) : undefined;\n                };\n                WeakMap.prototype.set = function (target, value) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ true);\n                    table[this._key] = value;\n                    return this;\n                };\n                WeakMap.prototype.delete = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? delete table[this._key] : false;\n                };\n                WeakMap.prototype.clear = function () {\n                    // NOTE: not a real clear, just makes the previous data unreachable\n                    this._key = CreateUniqueKey();\n                };\n                return WeakMap;\n            }());\n            function CreateUniqueKey() {\n                var key;\n                do\n                    key = \"@@WeakMap@@\" + CreateUUID();\n                while (HashMap.has(keys, key));\n                keys[key] = true;\n                return key;\n            }\n            function GetOrCreateWeakMapTable(target, create) {\n                if (!hasOwn.call(target, rootKey)) {\n                    if (!create)\n                        return undefined;\n                    Object.defineProperty(target, rootKey, { value: HashMap.create() });\n                }\n                return target[rootKey];\n            }\n            function FillRandomBytes(buffer, size) {\n                for (var i = 0; i < size; ++i)\n                    buffer[i] = Math.random() * 0xff | 0;\n                return buffer;\n            }\n            function GenRandomBytes(size) {\n                if (typeof Uint8Array === \"function\") {\n                    var array = new Uint8Array(size);\n                    if (typeof crypto !== \"undefined\") {\n                        crypto.getRandomValues(array);\n                    }\n                    else if (typeof msCrypto !== \"undefined\") {\n                        msCrypto.getRandomValues(array);\n                    }\n                    else {\n                        FillRandomBytes(array, size);\n                    }\n                    return array;\n                }\n                return FillRandomBytes(new Array(size), size);\n            }\n            function CreateUUID() {\n                var data = GenRandomBytes(UUID_SIZE);\n                // mark as random - RFC 4122 § 4.4\n                data[6] = data[6] & 0x4f | 0x40;\n                data[8] = data[8] & 0xbf | 0x80;\n                var result = \"\";\n                for (var offset = 0; offset < UUID_SIZE; ++offset) {\n                    var byte = data[offset];\n                    if (offset === 4 || offset === 6 || offset === 8)\n                        result += \"-\";\n                    if (byte < 16)\n                        result += \"0\";\n                    result += byte.toString(16).toLowerCase();\n                }\n                return result;\n            }\n        }\n        // uses a heuristic used by v8 and chakra to force an object into dictionary mode.\n        function MakeDictionary(obj) {\n            obj.__ = undefined;\n            delete obj.__;\n            return obj;\n        }\n    });\n})(Reflect || (Reflect = {}));\n","import 'reflect-metadata';\r\nimport { ComponentRegistry } from '../registry/ComponentRegistry.ts';\r\nexport function Component(name: string) {\r\n  return function (ctor: Function) {\r\n    // 绑定元数据（方便 ECS 或调试工具读取）\r\n    Reflect.defineMetadata(\"component:name\", name, ctor);\r\n    // 自动注册到全局组件注册表\r\n    ComponentRegistry.set(name, ctor);\r\n  };\r\n}\r\n\r\n","/**\n * Common utilities\n * @module glMatrix\n */\n\n// Configuration Constants\nexport var EPSILON = 0.000001;\nexport var ARRAY_TYPE = typeof Float32Array !== \"undefined\" ? Float32Array : Array;\nexport var RANDOM = Math.random;\nexport var ANGLE_ORDER = \"zyx\";\n\n/**\n * Symmetric round\n * see https://www.npmjs.com/package/round-half-up-symmetric#user-content-detailed-background\n *\n * @param {Number} a value to round\n */\nexport function round(a) {\n  if (a >= 0) return Math.round(a);\n  return a % 0.5 === 0 ? Math.floor(a) : Math.round(a);\n}\n\n/**\n * Sets the type of array used when creating new vectors and matrices\n *\n * @param {Float32ArrayConstructor | ArrayConstructor} type Array type, such as Float32Array or Array\n */\nexport function setMatrixArrayType(type) {\n  ARRAY_TYPE = type;\n}\nvar degree = Math.PI / 180;\nvar radian = 180 / Math.PI;\n\n/**\n * Convert Degree To Radian\n *\n * @param {Number} a Angle in Degrees\n */\nexport function toRadian(a) {\n  return a * degree;\n}\n\n/**\n * Convert Radian To Degree\n *\n * @param {Number} a Angle in Radians\n */\nexport function toDegree(a) {\n  return a * radian;\n}\n\n/**\n * Tests whether or not the arguments have approximately the same value, within an absolute\n * or relative tolerance of glMatrix.EPSILON (an absolute tolerance is used for values less\n * than or equal to 1.0, and a relative tolerance is used for larger values)\n *\n * @param {Number} a          The first number to test.\n * @param {Number} b          The second number to test.\n * @param {Number} tolerance  Absolute or relative tolerance (default glMatrix.EPSILON)\n * @returns {Boolean} True if the numbers are approximately equal, false otherwise.\n */\nexport function equals(a, b) {\n  var tolerance = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : EPSILON;\n  return Math.abs(a - b) <= tolerance * Math.max(1, Math.abs(a), Math.abs(b));\n}","import * as glMatrix from \"./common.js\";\n\n/**\n * 3x3 Matrix\n * @module mat3\n */\n\n/**\n * Creates a new identity mat3\n *\n * @returns {mat3} a new 3x3 matrix\n */\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(9);\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[5] = 0;\n    out[6] = 0;\n    out[7] = 0;\n  }\n  out[0] = 1;\n  out[4] = 1;\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Copies the upper-left 3x3 values into the given mat3.\n *\n * @param {mat3} out the receiving 3x3 matrix\n * @param {ReadonlyMat4} a   the source 4x4 matrix\n * @returns {mat3} out\n */\nexport function fromMat4(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[4];\n  out[4] = a[5];\n  out[5] = a[6];\n  out[6] = a[8];\n  out[7] = a[9];\n  out[8] = a[10];\n  return out;\n}\n\n/**\n * Creates a new mat3 initialized with values from an existing matrix\n *\n * @param {ReadonlyMat3} a matrix to clone\n * @returns {mat3} a new 3x3 matrix\n */\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(9);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  return out;\n}\n\n/**\n * Copy the values from one mat3 to another\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the source matrix\n * @returns {mat3} out\n */\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  return out;\n}\n\n/**\n * Create a new mat3 with the given values\n *\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m10 Component in column 1, row 0 position (index 3)\n * @param {Number} m11 Component in column 1, row 1 position (index 4)\n * @param {Number} m12 Component in column 1, row 2 position (index 5)\n * @param {Number} m20 Component in column 2, row 0 position (index 6)\n * @param {Number} m21 Component in column 2, row 1 position (index 7)\n * @param {Number} m22 Component in column 2, row 2 position (index 8)\n * @returns {mat3} A new mat3\n */\nexport function fromValues(m00, m01, m02, m10, m11, m12, m20, m21, m22) {\n  var out = new glMatrix.ARRAY_TYPE(9);\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m10;\n  out[4] = m11;\n  out[5] = m12;\n  out[6] = m20;\n  out[7] = m21;\n  out[8] = m22;\n  return out;\n}\n\n/**\n * Set the components of a mat3 to the given values\n *\n * @param {mat3} out the receiving matrix\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m10 Component in column 1, row 0 position (index 3)\n * @param {Number} m11 Component in column 1, row 1 position (index 4)\n * @param {Number} m12 Component in column 1, row 2 position (index 5)\n * @param {Number} m20 Component in column 2, row 0 position (index 6)\n * @param {Number} m21 Component in column 2, row 1 position (index 7)\n * @param {Number} m22 Component in column 2, row 2 position (index 8)\n * @returns {mat3} out\n */\nexport function set(out, m00, m01, m02, m10, m11, m12, m20, m21, m22) {\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m10;\n  out[4] = m11;\n  out[5] = m12;\n  out[6] = m20;\n  out[7] = m21;\n  out[8] = m22;\n  return out;\n}\n\n/**\n * Set a mat3 to the identity matrix\n *\n * @param {mat3} out the receiving matrix\n * @returns {mat3} out\n */\nexport function identity(out) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 1;\n  out[5] = 0;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Transpose the values of a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the source matrix\n * @returns {mat3} out\n */\nexport function transpose(out, a) {\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\n  if (out === a) {\n    var a01 = a[1],\n      a02 = a[2],\n      a12 = a[5];\n    out[1] = a[3];\n    out[2] = a[6];\n    out[3] = a01;\n    out[5] = a[7];\n    out[6] = a02;\n    out[7] = a12;\n  } else {\n    out[0] = a[0];\n    out[1] = a[3];\n    out[2] = a[6];\n    out[3] = a[1];\n    out[4] = a[4];\n    out[5] = a[7];\n    out[6] = a[2];\n    out[7] = a[5];\n    out[8] = a[8];\n  }\n  return out;\n}\n\n/**\n * Inverts a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the source matrix\n * @returns {mat3 | null} out, or null if source matrix is not invertible\n */\nexport function invert(out, a) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2];\n  var a10 = a[3],\n    a11 = a[4],\n    a12 = a[5];\n  var a20 = a[6],\n    a21 = a[7],\n    a22 = a[8];\n  var b01 = a22 * a11 - a12 * a21;\n  var b11 = -a22 * a10 + a12 * a20;\n  var b21 = a21 * a10 - a11 * a20;\n\n  // Calculate the determinant\n  var det = a00 * b01 + a01 * b11 + a02 * b21;\n  if (!det) {\n    return null;\n  }\n  det = 1.0 / det;\n  out[0] = b01 * det;\n  out[1] = (-a22 * a01 + a02 * a21) * det;\n  out[2] = (a12 * a01 - a02 * a11) * det;\n  out[3] = b11 * det;\n  out[4] = (a22 * a00 - a02 * a20) * det;\n  out[5] = (-a12 * a00 + a02 * a10) * det;\n  out[6] = b21 * det;\n  out[7] = (-a21 * a00 + a01 * a20) * det;\n  out[8] = (a11 * a00 - a01 * a10) * det;\n  return out;\n}\n\n/**\n * Calculates the adjugate of a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the source matrix\n * @returns {mat3} out\n */\nexport function adjoint(out, a) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2];\n  var a10 = a[3],\n    a11 = a[4],\n    a12 = a[5];\n  var a20 = a[6],\n    a21 = a[7],\n    a22 = a[8];\n  out[0] = a11 * a22 - a12 * a21;\n  out[1] = a02 * a21 - a01 * a22;\n  out[2] = a01 * a12 - a02 * a11;\n  out[3] = a12 * a20 - a10 * a22;\n  out[4] = a00 * a22 - a02 * a20;\n  out[5] = a02 * a10 - a00 * a12;\n  out[6] = a10 * a21 - a11 * a20;\n  out[7] = a01 * a20 - a00 * a21;\n  out[8] = a00 * a11 - a01 * a10;\n  return out;\n}\n\n/**\n * Calculates the determinant of a mat3\n *\n * @param {ReadonlyMat3} a the source matrix\n * @returns {Number} determinant of a\n */\nexport function determinant(a) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2];\n  var a10 = a[3],\n    a11 = a[4],\n    a12 = a[5];\n  var a20 = a[6],\n    a21 = a[7],\n    a22 = a[8];\n  return a00 * (a22 * a11 - a12 * a21) + a01 * (-a22 * a10 + a12 * a20) + a02 * (a21 * a10 - a11 * a20);\n}\n\n/**\n * Multiplies two mat3's\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the first operand\n * @param {ReadonlyMat3} b the second operand\n * @returns {mat3} out\n */\nexport function multiply(out, a, b) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2];\n  var a10 = a[3],\n    a11 = a[4],\n    a12 = a[5];\n  var a20 = a[6],\n    a21 = a[7],\n    a22 = a[8];\n  var b00 = b[0],\n    b01 = b[1],\n    b02 = b[2];\n  var b10 = b[3],\n    b11 = b[4],\n    b12 = b[5];\n  var b20 = b[6],\n    b21 = b[7],\n    b22 = b[8];\n  out[0] = b00 * a00 + b01 * a10 + b02 * a20;\n  out[1] = b00 * a01 + b01 * a11 + b02 * a21;\n  out[2] = b00 * a02 + b01 * a12 + b02 * a22;\n  out[3] = b10 * a00 + b11 * a10 + b12 * a20;\n  out[4] = b10 * a01 + b11 * a11 + b12 * a21;\n  out[5] = b10 * a02 + b11 * a12 + b12 * a22;\n  out[6] = b20 * a00 + b21 * a10 + b22 * a20;\n  out[7] = b20 * a01 + b21 * a11 + b22 * a21;\n  out[8] = b20 * a02 + b21 * a12 + b22 * a22;\n  return out;\n}\n\n/**\n * Translate a mat3 by the given vector\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the matrix to translate\n * @param {ReadonlyVec2} v vector to translate by\n * @returns {mat3} out\n */\nexport function translate(out, a, v) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2],\n    a10 = a[3],\n    a11 = a[4],\n    a12 = a[5],\n    a20 = a[6],\n    a21 = a[7],\n    a22 = a[8],\n    x = v[0],\n    y = v[1];\n  out[0] = a00;\n  out[1] = a01;\n  out[2] = a02;\n  out[3] = a10;\n  out[4] = a11;\n  out[5] = a12;\n  out[6] = x * a00 + y * a10 + a20;\n  out[7] = x * a01 + y * a11 + a21;\n  out[8] = x * a02 + y * a12 + a22;\n  return out;\n}\n\n/**\n * Rotates a mat3 by the given angle\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat3} out\n */\nexport function rotate(out, a, rad) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2],\n    a10 = a[3],\n    a11 = a[4],\n    a12 = a[5],\n    a20 = a[6],\n    a21 = a[7],\n    a22 = a[8],\n    s = Math.sin(rad),\n    c = Math.cos(rad);\n  out[0] = c * a00 + s * a10;\n  out[1] = c * a01 + s * a11;\n  out[2] = c * a02 + s * a12;\n  out[3] = c * a10 - s * a00;\n  out[4] = c * a11 - s * a01;\n  out[5] = c * a12 - s * a02;\n  out[6] = a20;\n  out[7] = a21;\n  out[8] = a22;\n  return out;\n}\n\n/**\n * Scales the mat3 by the dimensions in the given vec2\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the matrix to scale\n * @param {ReadonlyVec2} v the vec2 to scale the matrix by\n * @returns {mat3} out\n **/\nexport function scale(out, a, v) {\n  var x = v[0],\n    y = v[1];\n  out[0] = x * a[0];\n  out[1] = x * a[1];\n  out[2] = x * a[2];\n  out[3] = y * a[3];\n  out[4] = y * a[4];\n  out[5] = y * a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  return out;\n}\n\n/**\n * Creates a matrix from a vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat3.identity(dest);\n *     mat3.translate(dest, dest, vec);\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {ReadonlyVec2} v Translation vector\n * @returns {mat3} out\n */\nexport function fromTranslation(out, v) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 1;\n  out[5] = 0;\n  out[6] = v[0];\n  out[7] = v[1];\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from a given angle\n * This is equivalent to (but much faster than):\n *\n *     mat3.identity(dest);\n *     mat3.rotate(dest, dest, rad);\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat3} out\n */\nexport function fromRotation(out, rad) {\n  var s = Math.sin(rad),\n    c = Math.cos(rad);\n  out[0] = c;\n  out[1] = s;\n  out[2] = 0;\n  out[3] = -s;\n  out[4] = c;\n  out[5] = 0;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from a vector scaling\n * This is equivalent to (but much faster than):\n *\n *     mat3.identity(dest);\n *     mat3.scale(dest, dest, vec);\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {ReadonlyVec2} v Scaling vector\n * @returns {mat3} out\n */\nexport function fromScaling(out, v) {\n  out[0] = v[0];\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = v[1];\n  out[5] = 0;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Copies the values from a mat2d into a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat2d} a the matrix to copy\n * @returns {mat3} out\n **/\nexport function fromMat2d(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = 0;\n  out[3] = a[2];\n  out[4] = a[3];\n  out[5] = 0;\n  out[6] = a[4];\n  out[7] = a[5];\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Calculates a 3x3 matrix from the given quaternion\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {ReadonlyQuat} q Quaternion to create matrix from\n *\n * @returns {mat3} out\n */\nexport function fromQuat(out, q) {\n  var x = q[0],\n    y = q[1],\n    z = q[2],\n    w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var yx = y * x2;\n  var yy = y * y2;\n  var zx = z * x2;\n  var zy = z * y2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - yy - zz;\n  out[3] = yx - wz;\n  out[6] = zx + wy;\n  out[1] = yx + wz;\n  out[4] = 1 - xx - zz;\n  out[7] = zy - wx;\n  out[2] = zx - wy;\n  out[5] = zy + wx;\n  out[8] = 1 - xx - yy;\n  return out;\n}\n\n/**\n * Calculates a 3x3 normal matrix (transpose inverse) from the 4x4 matrix\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {ReadonlyMat4} a Mat4 to derive the normal matrix from\n *\n * @returns {mat3} out\n */\nexport function normalFromMat4(out, a) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2],\n    a03 = a[3];\n  var a10 = a[4],\n    a11 = a[5],\n    a12 = a[6],\n    a13 = a[7];\n  var a20 = a[8],\n    a21 = a[9],\n    a22 = a[10],\n    a23 = a[11];\n  var a30 = a[12],\n    a31 = a[13],\n    a32 = a[14],\n    a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32;\n\n  // Calculate the determinant\n  var det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n  if (!det) {\n    return null;\n  }\n  det = 1.0 / det;\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n  out[1] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n  out[2] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n  out[3] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n  out[4] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n  out[5] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n  out[6] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n  out[7] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n  out[8] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n  return out;\n}\n\n/**\n * Generates a 2D projection matrix with the given bounds\n *\n * @param {mat3} out mat3 frustum matrix will be written into\n * @param {number} width Width of your gl context\n * @param {number} height Height of gl context\n * @returns {mat3} out\n */\nexport function projection(out, width, height) {\n  out[0] = 2 / width;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = -2 / height;\n  out[5] = 0;\n  out[6] = -1;\n  out[7] = 1;\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Returns a string representation of a mat3\n *\n * @param {ReadonlyMat3} a matrix to represent as a string\n * @returns {String} string representation of the matrix\n */\nexport function str(a) {\n  return \"mat3(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \", \" + a[4] + \", \" + a[5] + \", \" + a[6] + \", \" + a[7] + \", \" + a[8] + \")\";\n}\n\n/**\n * Returns Frobenius norm of a mat3\n *\n * @param {ReadonlyMat3} a the matrix to calculate Frobenius norm of\n * @returns {Number} Frobenius norm\n */\nexport function frob(a) {\n  return Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2] + a[3] * a[3] + a[4] * a[4] + a[5] * a[5] + a[6] * a[6] + a[7] * a[7] + a[8] * a[8]);\n}\n\n/**\n * Adds two mat3's\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the first operand\n * @param {ReadonlyMat3} b the second operand\n * @returns {mat3} out\n */\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  out[4] = a[4] + b[4];\n  out[5] = a[5] + b[5];\n  out[6] = a[6] + b[6];\n  out[7] = a[7] + b[7];\n  out[8] = a[8] + b[8];\n  return out;\n}\n\n/**\n * Subtracts matrix b from matrix a\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the first operand\n * @param {ReadonlyMat3} b the second operand\n * @returns {mat3} out\n */\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  out[4] = a[4] - b[4];\n  out[5] = a[5] - b[5];\n  out[6] = a[6] - b[6];\n  out[7] = a[7] - b[7];\n  out[8] = a[8] - b[8];\n  return out;\n}\n\n/**\n * Multiply each element of the matrix by a scalar.\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the matrix to scale\n * @param {Number} b amount to scale the matrix's elements by\n * @returns {mat3} out\n */\nexport function multiplyScalar(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  out[4] = a[4] * b;\n  out[5] = a[5] * b;\n  out[6] = a[6] * b;\n  out[7] = a[7] * b;\n  out[8] = a[8] * b;\n  return out;\n}\n\n/**\n * Adds two mat3's after multiplying each element of the second operand by a scalar value.\n *\n * @param {mat3} out the receiving vector\n * @param {ReadonlyMat3} a the first operand\n * @param {ReadonlyMat3} b the second operand\n * @param {Number} scale the amount to scale b's elements by before adding\n * @returns {mat3} out\n */\nexport function multiplyScalarAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  out[3] = a[3] + b[3] * scale;\n  out[4] = a[4] + b[4] * scale;\n  out[5] = a[5] + b[5] * scale;\n  out[6] = a[6] + b[6] * scale;\n  out[7] = a[7] + b[7] * scale;\n  out[8] = a[8] + b[8] * scale;\n  return out;\n}\n\n/**\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyMat3} a The first matrix.\n * @param {ReadonlyMat3} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] && a[8] === b[8];\n}\n\n/**\n * Returns whether or not the matrices have approximately the same elements in the same position.\n *\n * @param {ReadonlyMat3} a The first matrix.\n * @param {ReadonlyMat3} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\nexport function equals(a, b) {\n  var a0 = a[0],\n    a1 = a[1],\n    a2 = a[2],\n    a3 = a[3],\n    a4 = a[4],\n    a5 = a[5],\n    a6 = a[6],\n    a7 = a[7],\n    a8 = a[8];\n  var b0 = b[0],\n    b1 = b[1],\n    b2 = b[2],\n    b3 = b[3],\n    b4 = b[4],\n    b5 = b[5],\n    b6 = b[6],\n    b7 = b[7],\n    b8 = b[8];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7)) && Math.abs(a8 - b8) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a8), Math.abs(b8));\n}\n\n/**\n * Alias for {@link mat3.multiply}\n * @function\n */\nexport var mul = multiply;\n\n/**\n * Alias for {@link mat3.subtract}\n * @function\n */\nexport var sub = subtract;","import * as glMatrix from \"./common.js\";\n\n/**\n * 2 Dimensional Vector\n * @module vec2\n */\n\n/**\n * Creates a new, empty vec2\n *\n * @returns {vec2} a new 2D vector\n */\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(2);\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n  }\n  return out;\n}\n\n/**\n * Creates a new vec2 initialized with values from an existing vector\n *\n * @param {ReadonlyVec2} a vector to clone\n * @returns {vec2} a new 2D vector\n */\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(2);\n  out[0] = a[0];\n  out[1] = a[1];\n  return out;\n}\n\n/**\n * Creates a new vec2 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @returns {vec2} a new 2D vector\n */\nexport function fromValues(x, y) {\n  var out = new glMatrix.ARRAY_TYPE(2);\n  out[0] = x;\n  out[1] = y;\n  return out;\n}\n\n/**\n * Copy the values from one vec2 to another\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the source vector\n * @returns {vec2} out\n */\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  return out;\n}\n\n/**\n * Set the components of a vec2 to the given values\n *\n * @param {vec2} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @returns {vec2} out\n */\nexport function set(out, x, y) {\n  out[0] = x;\n  out[1] = y;\n  return out;\n}\n\n/**\n * Adds two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  return out;\n}\n\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  return out;\n}\n\n/**\n * Multiplies two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  return out;\n}\n\n/**\n * Divides two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  return out;\n}\n\n/**\n * Math.ceil the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to ceil\n * @returns {vec2} out\n */\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  return out;\n}\n\n/**\n * Math.floor the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to floor\n * @returns {vec2} out\n */\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  return out;\n}\n\n/**\n * Returns the minimum of two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  return out;\n}\n\n/**\n * Returns the maximum of two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  return out;\n}\n\n/**\n * symmetric round the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to round\n * @returns {vec2} out\n */\nexport function round(out, a) {\n  out[0] = glMatrix.round(a[0]);\n  out[1] = glMatrix.round(a[1]);\n  return out;\n}\n\n/**\n * Scales a vec2 by a scalar number\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec2} out\n */\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  return out;\n}\n\n/**\n * Adds two vec2's after scaling the second operand by a scalar value\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec2} out\n */\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  return out;\n}\n\n/**\n * Calculates the euclidian distance between two vec2's\n *\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {Number} distance between a and b\n */\nexport function distance(a, b) {\n  var x = b[0] - a[0],\n    y = b[1] - a[1];\n  return Math.sqrt(x * x + y * y);\n}\n\n/**\n * Calculates the squared euclidian distance between two vec2's\n *\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {Number} squared distance between a and b\n */\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0],\n    y = b[1] - a[1];\n  return x * x + y * y;\n}\n\n/**\n * Calculates the length of a vec2\n *\n * @param {ReadonlyVec2} a vector to calculate length of\n * @returns {Number} length of a\n */\nexport function length(a) {\n  var x = a[0],\n    y = a[1];\n  return Math.sqrt(x * x + y * y);\n}\n\n/**\n * Calculates the squared length of a vec2\n *\n * @param {ReadonlyVec2} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\nexport function squaredLength(a) {\n  var x = a[0],\n    y = a[1];\n  return x * x + y * y;\n}\n\n/**\n * Negates the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to negate\n * @returns {vec2} out\n */\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  return out;\n}\n\n/**\n * Returns the inverse of the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to invert\n * @returns {vec2} out\n */\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  return out;\n}\n\n/**\n * Normalize a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to normalize\n * @returns {vec2} out\n */\nexport function normalize(out, a) {\n  var x = a[0],\n    y = a[1];\n  var len = x * x + y * y;\n  if (len > 0) {\n    //TODO: evaluate use of glm_invsqrt here?\n    len = 1 / Math.sqrt(len);\n  }\n  out[0] = a[0] * len;\n  out[1] = a[1] * len;\n  return out;\n}\n\n/**\n * Calculates the dot product of two vec2's\n *\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {Number} dot product of a and b\n */\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1];\n}\n\n/**\n * Computes the cross product of two vec2's\n * Note that the cross product must by definition produce a 3D vector\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec3} out\n */\nexport function cross(out, a, b) {\n  var z = a[0] * b[1] - a[1] * b[0];\n  out[0] = out[1] = 0;\n  out[2] = z;\n  return out;\n}\n\n/**\n * Performs a linear interpolation between two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec2} out\n */\nexport function lerp(out, a, b, t) {\n  var ax = a[0],\n    ay = a[1];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  return out;\n}\n\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec2} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If omitted, a unit vector will be returned\n * @returns {vec2} out\n */\nexport function random(out, scale) {\n  scale = scale === undefined ? 1.0 : scale;\n  var r = glMatrix.RANDOM() * 2.0 * Math.PI;\n  out[0] = Math.cos(r) * scale;\n  out[1] = Math.sin(r) * scale;\n  return out;\n}\n\n/**\n * Transforms the vec2 with a mat2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat2} m matrix to transform with\n * @returns {vec2} out\n */\nexport function transformMat2(out, a, m) {\n  var x = a[0],\n    y = a[1];\n  out[0] = m[0] * x + m[2] * y;\n  out[1] = m[1] * x + m[3] * y;\n  return out;\n}\n\n/**\n * Transforms the vec2 with a mat2d\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat2d} m matrix to transform with\n * @returns {vec2} out\n */\nexport function transformMat2d(out, a, m) {\n  var x = a[0],\n    y = a[1];\n  out[0] = m[0] * x + m[2] * y + m[4];\n  out[1] = m[1] * x + m[3] * y + m[5];\n  return out;\n}\n\n/**\n * Transforms the vec2 with a mat3\n * 3rd vector component is implicitly '1'\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat3} m matrix to transform with\n * @returns {vec2} out\n */\nexport function transformMat3(out, a, m) {\n  var x = a[0],\n    y = a[1];\n  out[0] = m[0] * x + m[3] * y + m[6];\n  out[1] = m[1] * x + m[4] * y + m[7];\n  return out;\n}\n\n/**\n * Transforms the vec2 with a mat4\n * 3rd vector component is implicitly '0'\n * 4th vector component is implicitly '1'\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat4} m matrix to transform with\n * @returns {vec2} out\n */\nexport function transformMat4(out, a, m) {\n  var x = a[0];\n  var y = a[1];\n  out[0] = m[0] * x + m[4] * y + m[12];\n  out[1] = m[1] * x + m[5] * y + m[13];\n  return out;\n}\n\n/**\n * Rotate a 2D vector\n * @param {vec2} out The receiving vec2\n * @param {ReadonlyVec2} a The vec2 point to rotate\n * @param {ReadonlyVec2} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec2} out\n */\nexport function rotate(out, a, b, rad) {\n  //Translate point to the origin\n  var p0 = a[0] - b[0],\n    p1 = a[1] - b[1],\n    sinC = Math.sin(rad),\n    cosC = Math.cos(rad);\n\n  //perform rotation and translate to correct position\n  out[0] = p0 * cosC - p1 * sinC + b[0];\n  out[1] = p0 * sinC + p1 * cosC + b[1];\n  return out;\n}\n\n/**\n * Get the smallest angle between two 2D vectors\n * @param {ReadonlyVec2} a The first operand\n * @param {ReadonlyVec2} b The second operand\n * @returns {Number} The angle in radians\n */\nexport function angle(a, b) {\n  var ax = a[0],\n    ay = a[1],\n    bx = b[0],\n    by = b[1];\n  return Math.abs(Math.atan2(ay * bx - ax * by, ax * bx + ay * by));\n}\n\n/**\n * Get the signed angle in the interval [-pi,pi] between two 2D vectors (positive if `a` is to the right of `b`)\n * \n * @param {ReadonlyVec2} a The first vector\n * @param {ReadonlyVec2} b The second vector\n * @returns {number} The signed angle in radians\n */\nexport function signedAngle(a, b) {\n  var ax = a[0],\n    ay = a[1],\n    bx = b[0],\n    by = b[1];\n  return Math.atan2(ax * by - ay * bx, ax * bx + ay * by);\n}\n\n/**\n * Set the components of a vec2 to zero\n *\n * @param {vec2} out the receiving vector\n * @returns {vec2} out\n */\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  return out;\n}\n\n/**\n * Returns a string representation of a vector\n *\n * @param {ReadonlyVec2} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\nexport function str(a) {\n  return \"vec2(\" + a[0] + \", \" + a[1] + \")\";\n}\n\n/**\n * Returns whether or not the vectors exactly have the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyVec2} a The first vector.\n * @param {ReadonlyVec2} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1];\n}\n\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {ReadonlyVec2} a The first vector.\n * @param {ReadonlyVec2} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\nexport function equals(a, b) {\n  var a0 = a[0],\n    a1 = a[1];\n  var b0 = b[0],\n    b1 = b[1];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1));\n}\n\n/**\n * Alias for {@link vec2.length}\n * @function\n */\nexport var len = length;\n\n/**\n * Alias for {@link vec2.subtract}\n * @function\n */\nexport var sub = subtract;\n\n/**\n * Alias for {@link vec2.multiply}\n * @function\n */\nexport var mul = multiply;\n\n/**\n * Alias for {@link vec2.divide}\n * @function\n */\nexport var div = divide;\n\n/**\n * Alias for {@link vec2.distance}\n * @function\n */\nexport var dist = distance;\n\n/**\n * Alias for {@link vec2.squaredDistance}\n * @function\n */\nexport var sqrDist = squaredDistance;\n\n/**\n * Alias for {@link vec2.squaredLength}\n * @function\n */\nexport var sqrLen = squaredLength;\n\n/**\n * Perform some operation over an array of vec2s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec2. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec2s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n    if (!stride) {\n      stride = 2;\n    }\n    if (!offset) {\n      offset = 0;\n    }\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n    }\n    return a;\n  };\n}();","import { Component } from \"../ecs/decorators/Component\";\r\nimport { IComponent } from \"../ecs/interface/IComponent\";\r\nimport { mat3 } from \"gl-matrix\";\r\nimport { Engine } from \"../ecs/Engine.ts\";\r\n@Component('Transform')\r\nexport class Transform implements IComponent {\r\n  #x = 0;\r\n  #y = 0;\r\n  #scaleX = 1;\r\n  #scaleY = 1;\r\n  #rotation = 0;\r\n  #skewX = 0;\r\n  #skewY = 0;\r\n  #pivotX = 0;\r\n  #pivotY = 0;\r\n\r\n  localMatrix = mat3.create();\r\n  worldMatrix = mat3.create();\r\n  dirty = true;\r\n  #engine: Engine | null;\r\n  constructor(engine: Engine | null, params: Partial<Transform> = {}) {\r\n    this.#engine = engine;\r\n    this.#engine;\r\n    const keys = [\"x\", \"y\", \"scaleX\", \"scaleY\", \"rotation\", \"skewX\", \"skewY\", \"pivotX\", \"pivotY\"] as const;\r\n    for (const key of keys) {\r\n      if (params[key] !== undefined) { this[key] = params[key]!; }\r\n    }\r\n  }\r\n\r\n  get x() { return this.#x; }\r\n  set x(v: number) { this.#x = v; this.dirty = true; }\r\n\r\n  get y() { return this.#y; }\r\n  set y(v: number) { this.#y = v; this.dirty = true; }\r\n\r\n  get scaleX() { return this.#scaleX; }\r\n  set scaleX(v: number) { this.#scaleX = v; this.dirty = true; }\r\n\r\n  get scaleY() { return this.#scaleY; }\r\n  set scaleY(v: number) { this.#scaleY = v; this.dirty = true; }\r\n\r\n  get rotation() { return this.#rotation; }\r\n  set rotation(v: number) { this.#rotation = v; this.dirty = true; }\r\n\r\n  get skewX() { return this.#skewX; }\r\n  set skewX(v: number) { this.#skewX = v; this.dirty = true; }\r\n\r\n  get skewY() { return this.#skewY; }\r\n  set skewY(v: number) { this.#skewY = v; this.dirty = true; }\r\n\r\n  get pivotX() { return this.#pivotX; }\r\n  set pivotX(v: number) { this.#pivotX = v; this.dirty = true; }\r\n\r\n  get pivotY() { return this.#pivotY; }\r\n  set pivotY(v: number) { this.#pivotY = v; this.dirty = true; }\r\n}\r\n","// src/ecs/RootEntity.ts\r\nimport { Engine } from \"./Engine.ts\";\r\nimport { Transform } from \"../components/Transform.ts\";\r\n\r\nexport class RootEntity {\r\n    public readonly entityId: number;\r\n\r\n    constructor(private engine: Engine) {\r\n        this.entityId = this.engine.ecs.createEntity();\r\n        this.engine.ecs.addComponent(this.entityId, new Transform(this.engine, { x: 0, y: 0, }));\r\n    }\r\n\r\n    /**\r\n     * 获取 Transform 组件\r\n     */\r\n    get transform(): Transform | undefined {\r\n        return this.engine.ecs.getComponent(this.entityId, Transform);\r\n    }\r\n}\r\n","import type { ECS } from \"./ECS.ts\";\r\nimport { Engine } from \"./Engine.ts\";\r\nimport { SceneTree } from \"./SceneTree.ts\";\r\n\r\nexport abstract class ISystem {\r\n    ecs!: ECS;\r\n    constructor(public engine: Engine, public sceneTree: SceneTree) { }\r\n    init(ecs: ECS): void {\r\n        this.ecs = ecs;\r\n        this.onInit();\r\n    }\r\n\r\n    protected onInit(): void {\r\n    }\r\n    abstract update(delta: number): void;\r\n}\r\n/**\r\n * 系统类构造函数类型\r\n * T 是 ISystem 的子类\r\n */\r\nexport type ISystemClass<T extends ISystem = ISystem> = new (engine: Engine, sceneTree: SceneTree) => T;","import { Component } from \"../../ecs/decorators/Component\";\r\nimport { IComponent } from \"../../ecs/interface/IComponent\";\r\nimport { RenderComponent } from \"./RenderComponent.ts\";\r\nimport { Engine } from \"../../ecs/Engine.ts\";\r\n\r\n/**\r\n * 矩形组件，仅存储渲染数据\r\n * 不包含绘制逻辑，系统负责渲染\r\n */\r\n@Component(\"Rect\")\r\nexport class Rect extends RenderComponent implements IComponent {\r\n  width: number;\r\n  height: number;\r\n  render: boolean = true;\r\n  fillStyle: string;\r\n  strokeStyle?: string;\r\n  lineWidth: number;\r\n  alpha: number;\r\n  radius: number;\r\n  constructor(engine: Engine | null, {\r\n    width = 0,\r\n    height = 0,\r\n    fillStyle = \"#181b1dff\",\r\n    strokeStyle,\r\n    lineWidth = 0,\r\n    alpha = 1.0,\r\n    render = true,\r\n    radius = 0,\r\n  }: Partial<Rect> = {}) {\r\n    super(engine);\r\n    this.width = width;\r\n    this.height = height;\r\n    this.fillStyle = fillStyle || \"#181b1dff\";\r\n    this.strokeStyle = strokeStyle || \"#181b1dff\";\r\n    this.lineWidth = lineWidth || 0;\r\n    this.alpha = alpha || 1.0;\r\n    this.radius = radius || 0;\r\n    this.render = render;\r\n  }\r\n}\r\n\r\n","import { ECS } from \"../../ecs/ECS.ts\";\r\nimport { Transform } from \"../../components/Transform.ts\";\r\nimport { Rect } from \"../../components/render/Rect.ts\";\r\nimport { IProcess } from \"../../ecs/interface/IRender.ts\";\r\nimport type { ISystem } from \"../../ecs/System.ts\";\r\n\r\n/**\r\n * 渲染器：负责绘制 Rect 组件（支持圆角矩形）\r\n */\r\nexport class RectRenderer implements IProcess {\r\n    match(ecs: ECS, entityId: number) {\r\n        return ecs.hasComponent(entityId, Rect);\r\n    }\r\n\r\n    exec(system: ISystem, entityId: number) {\r\n        const ecs = system.ecs;\r\n        const ctx = ecs.canvas.getContext(\"2d\")!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n        const rect = ecs.getComponent(entityId, Rect)!;\r\n        if (!rect.render) return;\r\n\r\n        ctx.save();\r\n        ctx.globalAlpha = rect.alpha;\r\n\r\n        const m = transform.worldMatrix;\r\n        ctx.setTransform(\r\n            m[0], // a = m00\r\n            m[1], // b = m10\r\n            m[3], // c = m01\r\n            m[4], // d = m11\r\n            m[6], // e = m20 (平移x)\r\n            m[7]  // f = m21 (平移y)\r\n        );\r\n\r\n        // 支持圆角矩形\r\n        const { width, height, radius = 0 } = rect;\r\n        ctx.beginPath();\r\n        if (radius > 0) {\r\n            // 使用 modern Canvas API roundRect（兼容大多数浏览器）\r\n            ctx.roundRect(0, 0, width, height, radius);\r\n        } else {\r\n            ctx.rect(0, 0, width, height);\r\n        }\r\n\r\n        if (rect.fillStyle) {\r\n            ctx.fillStyle = rect.fillStyle;\r\n            ctx.fill();\r\n        }\r\n\r\n        if (rect.strokeStyle && rect.lineWidth > 0) {\r\n            ctx.strokeStyle = rect.strokeStyle;\r\n            ctx.lineWidth = rect.lineWidth;\r\n            ctx.stroke();\r\n        }\r\n\r\n        ctx.restore();\r\n    }\r\n}\r\n","import { Component } from \"../../ecs/decorators/Component\";\r\nimport { IComponent } from \"../../ecs/interface/IComponent\";\r\nimport { RenderComponent } from \"./RenderComponent.ts\";\r\nimport { Engine } from \"../../ecs/Engine.ts\";\r\n\r\n/**\r\n * Circle（兼容椭圆与圆弧）\r\n * 若 radiusY 与 radius 相同，则为圆形；否则为椭圆。\r\n * 可通过 startAngle、endAngle 和 clockwise 绘制圆弧。\r\n */\r\n@Component(\"Circle\")\r\nexport class Circle extends RenderComponent implements IComponent {\r\n  render = true;\r\n\r\n  /** 主半径（x 方向） */\r\n  radius: number;\r\n  /** 次半径（y 方向，默认为 radius） */\r\n  radiusY!: number;\r\n  /** 填充颜色 */\r\n  fillStyle: string;\r\n  /** 描边颜色 */\r\n  strokeStyle?: string;\r\n  /** 描边宽度 */\r\n  lineWidth: number;\r\n  /** 透明度 */\r\n  alpha: number;\r\n  /** 椭圆旋转角度（弧度） */\r\n  rotation: number;\r\n\r\n  /** 圆弧起始角度（弧度，0 = 3点钟方向） */\r\n  startAngle: number;\r\n  /** 圆弧结束角度（弧度） */\r\n  endAngle: number;\r\n  /** 是否顺时针绘制圆弧（默认为 true） */\r\n  clockwise: boolean;\r\n\r\n  constructor(\r\n    engine: Engine | null,\r\n    {\r\n      radius = 10,\r\n      radiusY, // 可选，不传时自动与 radius 相等\r\n      fillStyle = \"#e74c3c\",\r\n      strokeStyle,\r\n      lineWidth = 0,\r\n      alpha = 1.0,\r\n      rotation = 0,\r\n      render = true,\r\n      startAngle = 0,\r\n      endAngle = Math.PI * 2,\r\n      clockwise = true,\r\n    }: Partial<Circle> = {}\r\n  ) {\r\n    super(engine);\r\n    this.radius = radius;\r\n    if (radiusY) this.radiusY = radiusY; // 默认与 radius 相等（圆形）\r\n    this.fillStyle = fillStyle;\r\n    this.strokeStyle = strokeStyle ?? \"#c0392b\";\r\n    this.lineWidth = lineWidth;\r\n    this.alpha = alpha;\r\n    this.rotation = rotation;\r\n    this.render = render;\r\n    this.startAngle = startAngle;\r\n    this.endAngle = endAngle;\r\n    this.clockwise = clockwise;\r\n  }\r\n\r\n  /** 是否是圆形（辅助判断） */\r\n  get isCircle(): boolean {\r\n    return this.radius === this.radiusY;\r\n  }\r\n\r\n  /** 是否是完整圆或完整椭圆（start = 0, end = 2π） */\r\n  get isFullCircle(): boolean {\r\n    return (\r\n      Math.abs(this.endAngle - this.startAngle) >= Math.PI * 2 &&\r\n      this.isCircle\r\n    );\r\n  }\r\n}\r\n","import { ECS } from \"../../ecs/ECS.ts\";\r\nimport { Transform } from \"../../components/Transform.ts\";\r\nimport { Circle } from \"../../components/render/Circle.ts\";\r\nimport { IProcess } from \"../../ecs/interface/IRender.ts\";\r\nimport type { ISystem } from \"../../ecs/System.ts\";\r\n\r\n/**\r\n * 渲染器：负责绘制 Circle 组件\r\n * Canvas API 原生渲染，startAngle/endAngle/clockwise 原样使用\r\n */\r\nexport class CircleRenderer implements IProcess {\r\n  match(ecs: ECS, entityId: number) {\r\n    return ecs.hasComponent(entityId, Circle);\r\n  }\r\n\r\n  exec(system: ISystem, entityId: number) {\r\n    const ecs = system.ecs;\r\n    const ctx = ecs.canvas.getContext(\"2d\")!;\r\n    const transform = ecs.getComponent(entityId, Transform)!;\r\n    const circle = ecs.getComponent(entityId, Circle)!;\r\n    if (!circle.render) return;\r\n\r\n    ctx.save();\r\n    ctx.globalAlpha = circle.alpha;\r\n\r\n    // 应用世界变换矩阵\r\n    const m = transform.worldMatrix;\r\n    ctx.setTransform(\r\n      m[0], m[1], m[3], m[4], m[6], m[7]\r\n    );\r\n\r\n    const { radius, radiusY = radius, rotation = 0, startAngle = 0, endAngle = Math.PI*2, clockwise = false } = circle;\r\n    ctx.beginPath();\r\n    if (radiusY === radius) {\r\n      // 圆 / 圆弧\r\n      ctx.arc(0, 0, radius, startAngle, endAngle, !!clockwise);\r\n    } else {\r\n      // 椭圆 / 椭圆弧\r\n      ctx.ellipse(0, 0, radius, radiusY, rotation, startAngle, endAngle, !!clockwise);\r\n    }\r\n\r\n    // 填充\r\n    if (circle.fillStyle) {\r\n      ctx.fillStyle = circle.fillStyle;\r\n      ctx.fill();\r\n    }\r\n\r\n    // 描边\r\n    if (circle.strokeStyle && circle.lineWidth > 0) {\r\n      ctx.strokeStyle = circle.strokeStyle;\r\n      ctx.lineWidth = circle.lineWidth;\r\n      ctx.stroke();\r\n    }\r\n\r\n    ctx.restore();\r\n  }\r\n}\r\n","import { Component } from \"../../ecs/decorators/Component\";\r\nimport { IComponent } from \"../../ecs/interface/IComponent\";\r\nimport { RenderComponent } from \"./RenderComponent.ts\";\r\nimport { Engine } from \"../../ecs/Engine.ts\";\r\n\r\n/**\r\n * 图片组件，仅存储渲染数据\r\n * 不包含绘制逻辑，系统负责渲染\r\n */\r\n@Component(\"Image\")\r\nexport class Image extends RenderComponent implements IComponent {\r\n    #bitmap: ImageBitmap | null = null;  // 私有 bitmap\r\n    #width: number = 0;                   // 私有宽度\r\n    #height: number = 0;                  // 私有高度\r\n    alpha: number = 1.0;                  // 透明度\r\n    render: boolean = true;               // 是否渲染\r\n    clip?: [number, number, number, number] = undefined; // 裁剪区域 [x, y, w, h]\r\n    constructor(engine: Engine | null, params: Partial<Image> = {}) {\r\n        super(engine);\r\n        if (params.clip !== undefined) this.clip = params.clip;\r\n        if (params.bitmap !== undefined) this.bitmap = params.bitmap;\r\n        if (params.width !== undefined) this.width = params.width;\r\n        if (params.height !== undefined) this.height = params.height;\r\n        if (params.alpha !== undefined) this.alpha = params.alpha;\r\n        if (params.render !== undefined) this.render = params.render;\r\n    }\r\n    get bitmap(): ImageBitmap | null {\r\n        return this.#bitmap;\r\n    }\r\n    set bitmap(value: ImageBitmap | null) {\r\n        this.#bitmap = value;\r\n        // 如果 width/height 未设置，则默认取 bitmap 尺寸\r\n        if (value && this.#width === 0) this.#width = value.width;\r\n        if (value && this.#height === 0) this.#height = value.height;\r\n    }\r\n\r\n    get width(): number {\r\n        return this.#width;\r\n    }\r\n    set width(value: number) {\r\n        this.#width = value;\r\n    }\r\n\r\n    get height(): number {\r\n        return this.#height;\r\n    }\r\n    set height(value: number) {\r\n        this.#height = value;\r\n    }\r\n}","import { ECS } from \"../../ecs/ECS.ts\";\r\nimport { Transform } from \"../../components/Transform.ts\";\r\nimport { Image } from \"../../components/render/Image.ts\";\r\nimport { IProcess } from \"../../ecs/interface/IRender.ts\";\r\nimport type { ISystem } from \"../../ecs/System.ts\";\r\n\r\n/**\r\n * 渲染器：负责绘制 Image 组件\r\n */\r\nexport class ImageRenderer implements IProcess {\r\n\r\n  match(ecs: ECS, entityId: number) {\r\n    return ecs.hasComponent(entityId, Image);\r\n  }\r\n\r\n  exec(system: ISystem, entityId: number) {\r\n    const ecs = system.ecs;\r\n    const ctx = ecs.canvas.getContext(\"2d\")!;\r\n\r\n    const transform = ecs.getComponent(entityId, Transform)!;\r\n    const image = ecs.getComponent(entityId, Image)!;\r\n    if (!image.render) return;\r\n    if (!image.bitmap) return; // 没有纹理就不画\r\n\r\n    ctx.save();\r\n    ctx.globalAlpha = image.alpha;\r\n    const [clipX, clipY, clipW, clipH] = image.clip || [0, 0, image.bitmap.width, image.bitmap.height];\r\n    // 应用世界矩阵\r\n    const m = transform.worldMatrix;\r\n    ctx.setTransform(\r\n      m[0], // a = m00\r\n      m[1], // b = m10\r\n      m[3], // c = m01\r\n      m[4], // d = m11\r\n      m[6], // e = m20\r\n      m[7]  // f = m21\r\n    );\r\n    // 绘制图片，缩放到指定大小\r\n    ctx.drawImage(\r\n      image.bitmap,\r\n      clipX, clipY,\r\n      clipW, clipH,\r\n\r\n      0, 0,                       // 目标起点\r\n      image.width,                // 目标宽\r\n      image.height                // 目标高\r\n    );\r\n\r\n    ctx.restore();\r\n  }\r\n}\r\n","import { Component } from \"../ecs/decorators/Component\";\r\nimport { IComponent } from \"../ecs/interface/IComponent\";\r\nimport { IAABB } from \"../interface/AABB\";\r\n\r\n/**\r\n * BoundingBoxComponent\r\n * 维护三类包围盒：\r\n * - selfAABB: 当前节点自身图形\r\n * - childrenAABB: 所有子节点包围盒\r\n * - totalAABB: self + children\r\n */\r\n@Component(\"BoundingBoxComponent\")\r\nexport class BoundingBoxComponent implements IComponent {\r\n    // 当前节点自身图形包围盒\r\n    selfAABB: IAABB = { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity };\r\n    childrenAABB: IAABB = { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity };\r\n    totalAABB: IAABB = { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity };\r\n    dirty: boolean = true;\r\n    constructor() { }\r\n    reset() {\r\n        this.selfAABB = { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity };\r\n        this.childrenAABB = { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity };\r\n        this.totalAABB = { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity };\r\n    }\r\n    // 设置自身 AABB\r\n    setSelf(aabb: IAABB) {\r\n        this.selfAABB.minX = aabb.minX;\r\n        this.selfAABB.minY = aabb.minY;\r\n        this.selfAABB.maxX = aabb.maxX;\r\n        this.selfAABB.maxY = aabb.maxY;\r\n        this.dirty = true; \r\n    }\r\n\r\n    // 设置子节点 AABB\r\n    setChildren(aabb: IAABB) {\r\n        this.childrenAABB.minX = aabb.minX;\r\n        this.childrenAABB.minY = aabb.minY;\r\n        this.childrenAABB.maxX = aabb.maxX;\r\n        this.childrenAABB.maxY = aabb.maxY;\r\n        this.dirty = true; \r\n    }\r\n\r\n    // 计算总包围盒（self + children）\r\n    updateTotalAABB() {\r\n        this.totalAABB = { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity };\r\n        this.merge(this.totalAABB, this.selfAABB);\r\n        this.merge(this.totalAABB, this.childrenAABB);\r\n        this.dirty = false;\r\n    }\r\n\r\n    // 命中检测（可以选择 self / children / total）\r\n    hitTest(px: number, py: number, type: \"self\" | \"children\" | \"total\" = \"total\"): boolean {\r\n        let box: IAABB;\r\n        switch (type) {\r\n            case \"self\": box = this.selfAABB; break;\r\n            case \"children\": box = this.childrenAABB; break;\r\n            case \"total\": box = this.totalAABB; break;\r\n        }\r\n        return px >= box.minX && py >= box.minY && px <= box.maxX && py <= box.maxY;\r\n    }\r\n    merge(a1: IAABB, a2: IAABB) {\r\n        a1.minX = Math.min(a1.minX, a2.minX);\r\n        a1.minY = Math.min(a1.minY, a2.minY);\r\n        a1.maxX = Math.max(a1.maxX, a2.maxX);\r\n        a1.maxY = Math.max(a1.maxY, a2.maxY);\r\n    }\r\n}\r\n","import { ECS } from \"../ecs/ECS.ts\";\r\nimport { Transform } from \"../components/Transform.ts\";\r\nimport { IProcess } from \"../ecs/interface/IRender.ts\";\r\nimport { mat3 } from \"gl-matrix\";\r\nimport { BoundingBoxComponent } from \"../components/BoundingBoxComponent.ts\";\r\nimport type { ISystem } from \"../ecs/System.ts\";\r\n\r\nconst unit = mat3.create();\r\nexport class TransformProcess implements IProcess<{ dirty: boolean }, { dirty: boolean }> {\r\n    match(ecs: ECS, entityId: number) {\r\n        return true || ecs.hasComponent(entityId, Transform);\r\n    }\r\n    /**\r\n     * 执行渲染逻辑\r\n     */\r\n    exec(system: ISystem, entityId: number, _parentEntityId: number | null, context: { dirty: boolean }, parentContext: { dirty: boolean } | null) {\r\n        const ecs = system.ecs;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n        context.dirty = transform.dirty;\r\n        const needUpdate = context.dirty || (parentContext ? parentContext.dirty : false);\r\n        if (!needUpdate) return;\r\n        // 向未来子节点传递 dirty 标记\r\n        context.dirty = true;\r\n        transform.dirty = false;\r\n        // 标记包围盒\r\n        const boundingBox = system.ecs.getComponent(entityId, BoundingBoxComponent);\r\n        if (boundingBox) boundingBox.dirty = true\r\n        this.updateEntityMatrix(system, entityId);\r\n    }\r\n    updateEntityMatrix(system: ISystem, entityId: number) {\r\n        const ecs = system.ecs;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n\r\n        mat3.identity(transform.localMatrix);\r\n\r\n        const px = transform.pivotX;\r\n        const py = transform.pivotY;\r\n        // M=T(position)⋅T(pivot)⋅R⋅S⋅T(−pivot)\r\n        mat3.translate(transform.localMatrix, transform.localMatrix, [transform.x + px, transform.y + py]);\r\n        mat3.rotate(transform.localMatrix, transform.localMatrix, transform.rotation);\r\n        if (transform.skewX !== 0 || transform.skewY !== 0) {\r\n            const skewMat = mat3.fromValues(\r\n                1, Math.tan(transform.skewX), 0,\r\n                Math.tan(transform.skewY), 1, 0,\r\n                0, 0, 1\r\n            );\r\n            mat3.multiply(transform.localMatrix, transform.localMatrix, skewMat);\r\n        }\r\n        // 缩放\r\n        mat3.scale(transform.localMatrix, transform.localMatrix, [transform.scaleX, transform.scaleY]);\r\n        mat3.translate(transform.localMatrix, transform.localMatrix, [-px, -py]);\r\n\r\n        // 计算世界矩阵\r\n        const parent = system.sceneTree.getParent(entityId);\r\n        if (parent != null) {\r\n            const parentTransform = ecs.getComponent(parent.entityId, Transform);\r\n            const parentMatrix = parentTransform?.worldMatrix || unit;\r\n            mat3.multiply(transform.worldMatrix, parentMatrix, transform.localMatrix);\r\n        } else {\r\n            mat3.copy(transform.worldMatrix, transform.localMatrix);\r\n        }\r\n    }\r\n}","import { ECS } from \"../../ecs/ECS.ts\";\r\nimport { Transform } from \"../../components/Transform.ts\";\r\nimport { Circle } from \"../../components/render/Circle.ts\";\r\nimport { IBoundingBoxStrategy } from \"./AABB\";\r\nimport { mat3, vec2 } from \"gl-matrix\";\r\n\r\n/**\r\n * Circle / Ellipse 包围盒策略\r\n * 完整支持圆弧 / 扇形\r\n */\r\nexport class CircleBoundingBox implements IBoundingBoxStrategy {\r\n  match(ecs: ECS, entityId: number) {\r\n    return ecs.hasComponent(entityId, Circle);\r\n  }\r\n\r\n  /** 计算世界空间下 AABB */\r\n  computeAABB(ecs: ECS, entityId: number) {\r\n    const circle = ecs.getComponent(entityId, Circle)!;\r\n    const transform = ecs.getComponent(entityId, Transform)!;\r\n    const { radius, radiusY = radius, rotation = 0, startAngle, endAngle, clockwise } = circle;\r\n    const m = transform.worldMatrix;\r\n\r\n    const cx = m[6];\r\n    const cy = m[7];\r\n\r\n    // 提取缩放分量\r\n    const a = m[0], b = m[1], c = m[3], d = m[4];\r\n    const rx = radius * Math.hypot(a, b);\r\n    const ry = radiusY * Math.hypot(c, d);\r\n\r\n    const isFull = startAngle === 0 && endAngle === 2 * Math.PI;\r\n\r\n    if (isFull) {\r\n      // 完整圆/椭圆\r\n      const cosR = Math.cos(rotation);\r\n      const sinR = Math.sin(rotation);\r\n      const halfW = Math.abs(rx * cosR) + Math.abs(ry * sinR);\r\n      const halfH = Math.abs(rx * sinR) + Math.abs(ry * cosR);\r\n      return {\r\n        minX: cx - halfW,\r\n        minY: cy - halfH,\r\n        maxX: cx + halfW,\r\n        maxY: cy + halfH,\r\n      };\r\n    } else {\r\n      // 圆弧/椭圆弧 → 考虑 start/end + 关键角 + 圆心闭合\r\n      const angles = [startAngle, endAngle];\r\n      const criticalAngles = [0, Math.PI / 2, Math.PI, (3 * Math.PI) / 2];\r\n      for (const a of criticalAngles) {\r\n        if (this.isAngleBetween(a, startAngle, endAngle, clockwise)) angles.push(a);\r\n      }\r\n\r\n      let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\r\n      const cosR = Math.cos(rotation);\r\n      const sinR = Math.sin(rotation);\r\n\r\n      for (const angle of angles) {\r\n        const px = rx * Math.cos(angle);\r\n        const py = ry * Math.sin(angle);\r\n        const rxRot = px * cosR - py * sinR;\r\n        const ryRot = px * sinR + py * cosR;\r\n        minX = Math.min(minX, rxRot);\r\n        minY = Math.min(minY, ryRot);\r\n        maxX = Math.max(maxX, rxRot);\r\n        maxY = Math.max(maxY, ryRot);\r\n      }\r\n\r\n      // 包括圆心闭合\r\n      minX = Math.min(minX, 0);\r\n      minY = Math.min(minY, 0);\r\n      maxX = Math.max(maxX, 0);\r\n      maxY = Math.max(maxY, 0);\r\n\r\n      return {\r\n        minX: cx + minX,\r\n        minY: cy + minY,\r\n        maxX: cx + maxX,\r\n        maxY: cy + maxY,\r\n      };\r\n    }\r\n  }\r\n\r\n  /** 命中检测 */\r\n  hit(ecs: ECS, entityId: number, x: number, y: number): boolean {\r\n    const circle = ecs.getComponent(entityId, Circle)!;\r\n    const isFull = circle.startAngle === 0 && circle.endAngle === 2 * Math.PI;\r\n    return isFull\r\n      ? this.hitFullCircle(ecs, entityId, x, y)\r\n      : this.hitArc(ecs, entityId, x, y);\r\n  }\r\n\r\n  /** 完整圆 / 椭圆命中检测 */\r\n  private hitFullCircle(ecs: ECS, entityId: number, x: number, y: number): boolean {\r\n    const circle = ecs.getComponent(entityId, Circle)!;\r\n    const transform = ecs.getComponent(entityId, Transform)!;\r\n    const { radius, radiusY = radius, rotation = 0 } = circle;\r\n\r\n    const m = transform.worldMatrix;\r\n    const inv = mat3.create();\r\n    mat3.invert(inv, m);\r\n    const local = vec2.fromValues(x, y);\r\n    vec2.transformMat3(local, local, inv);\r\n\r\n    let lx = local[0];\r\n    let ly = local[1];\r\n    if (rotation !== 0) {\r\n      const cosR = Math.cos(-rotation);\r\n      const sinR = Math.sin(-rotation);\r\n      const tmpX = lx * cosR - ly * sinR;\r\n      const tmpY = lx * sinR + ly * cosR;\r\n      lx = tmpX;\r\n      ly = tmpY;\r\n    }\r\n\r\n    const norm = (lx * lx) / (radius * radius) + (ly * ly) / (radiusY * radiusY);\r\n    return norm <= 1;\r\n  }\r\n\r\n  /** 圆弧 / 扇形命中检测 */\r\n  private hitArc(ecs: ECS, entityId: number, x: number, y: number): boolean {\r\n    const circle = ecs.getComponent(entityId, Circle)!;\r\n    const transform = ecs.getComponent(entityId, Transform)!;\r\n    const { radius, radiusY = radius, rotation = 0, startAngle, endAngle, clockwise } = circle;\r\n\r\n    const m = transform.worldMatrix;\r\n    const inv = mat3.create();\r\n    mat3.invert(inv, m);\r\n    const local = vec2.fromValues(x, y);\r\n    vec2.transformMat3(local, local, inv);\r\n\r\n    let lx = local[0];\r\n    let ly = local[1];\r\n    if (rotation !== 0) {\r\n      const cosR = Math.cos(-rotation);\r\n      const sinR = Math.sin(-rotation);\r\n      const tmpX = lx * cosR - ly * sinR;\r\n      const tmpY = lx * sinR + ly * cosR;\r\n      lx = tmpX;\r\n      ly = tmpY;\r\n    }\r\n\r\n    // 归一化椭圆坐标\r\n    const dx = lx / radius;\r\n    const dy = ly / radiusY;\r\n    const distance = Math.hypot(dx, dy);\r\n\r\n    // 参数角 t\r\n    let t_p = Math.atan2(dy, dx);\r\n    if (t_p < 0) t_p += 2 * Math.PI;\r\n\r\n    const inArc = this.isAngleBetween(t_p, startAngle, endAngle, clockwise);\r\n\r\n    // 点在圆弧范围内\r\n    if (distance <= 1 && inArc) return true;\r\n\r\n    // Canvas 扇形闭合面积，圆心 + 起点 + 终点\r\n    const startX = radius * Math.cos(startAngle);\r\n    const startY = radiusY * Math.sin(startAngle);\r\n    const endX = radius * Math.cos(endAngle);\r\n    const endY = radiusY * Math.sin(endAngle);\r\n\r\n    const polygon = clockwise\r\n      ? [{ x: 0, y: 0 }, { x: startX, y: startY }, { x: endX, y: endY }]\r\n      : [{ x: 0, y: 0 }, { x: endX, y: endY }, { x: startX, y: startY }];\r\n\r\n    if (this.pointInPolygon({ x: lx, y: ly }, polygon)) return true;\r\n\r\n    return false;\r\n  }\r\n\r\n  /** 判断角度是否在弧段内（顺时针或逆时针） */\r\n  private isAngleBetween(angle: number, start: number, end: number, clockwise: boolean) {\r\n    angle = (angle + 2 * Math.PI) % (2 * Math.PI);\r\n    start = (start + 2 * Math.PI) % (2 * Math.PI);\r\n    end = (end + 2 * Math.PI) % (2 * Math.PI);\r\n    return clockwise\r\n      ? ((start - angle + 2 * Math.PI) % (2 * Math.PI)) <= ((start - end + 2 * Math.PI) % (2 * Math.PI))\r\n      : ((angle - start + 2 * Math.PI) % (2 * Math.PI)) <= ((end - start + 2 * Math.PI) % (2 * Math.PI));\r\n  }\r\n\r\n  /** 点是否在多边形内（射线法） */\r\n  private pointInPolygon(p: { x: number, y: number }, polygon: { x: number, y: number }[]) {\r\n    let inside = false;\r\n    const n = polygon.length;\r\n    for (let i = 0, j = n - 1; i < n; j = i++) {\r\n      const xi = polygon[i].x, yi = polygon[i].y;\r\n      const xj = polygon[j].x, yj = polygon[j].y;\r\n      const intersect = ((yi > p.y) !== (yj > p.y)) &&\r\n                        (p.x < (xj - xi) * (p.y - yi) / (yj - yi + 1e-10) + xi);\r\n      if (intersect) inside = !inside;\r\n    }\r\n    return inside;\r\n  }\r\n}\r\n","import { vec2, mat3 } from \"gl-matrix\";\r\nimport { ECS } from \"../../ecs/ECS\";\r\nimport { Transform } from \"../../components/Transform\";\r\nimport { Rect } from \"../../components/render/Rect\";\r\nimport { IBoundingBoxStrategy } from \"./AABB\";\r\n\r\n/**\r\n * Rect 包围盒策略（支持圆角矩形）\r\n */\r\nexport class RectBoundingBox implements IBoundingBoxStrategy {\r\n    match(ecs: ECS, entityId: number) {\r\n        return ecs.hasComponent(entityId, Rect);\r\n    }\r\n\r\n    computeAABB(ecs: ECS, entityId: number) {\r\n        const rect = ecs.getComponent(entityId, Rect)!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n\r\n        const { width, height } = rect;\r\n        const { pivotX, pivotY } = transform;\r\n        const m = transform.worldMatrix;\r\n\r\n        // 四个局部顶点（考虑 pivot）\r\n        const points = [\r\n            vec2.fromValues(-pivotX, -pivotY),\r\n            vec2.fromValues(width - pivotX, -pivotY),\r\n            vec2.fromValues(width - pivotX, height - pivotY),\r\n            vec2.fromValues(-pivotX, height - pivotY),\r\n        ];\r\n\r\n        // 变换到世界坐标\r\n        const worldPoints = points.map((p) => vec2.transformMat3(vec2.create(), p, m));\r\n\r\n        // 计算AABB\r\n        let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\r\n        for (const p of worldPoints) {\r\n            minX = Math.min(minX, p[0]);\r\n            minY = Math.min(minY, p[1]);\r\n            maxX = Math.max(maxX, p[0]);\r\n            maxY = Math.max(maxY, p[1]);\r\n        }\r\n\r\n        return { minX, minY, maxX, maxY };\r\n    }\r\n\r\n    hit(ecs: ECS, entityId: number, x: number, y: number): boolean {\r\n        const rect = ecs.getComponent(entityId, Rect)!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n\r\n        const { width, height, radius = 0 } = rect;\r\n        const { pivotX, pivotY } = transform;\r\n        const m = transform.worldMatrix;\r\n\r\n        // 将世界坐标反变换回局部空间\r\n        const inv = mat3.create();\r\n        mat3.invert(inv, m);\r\n        const local = vec2.fromValues(x, y);\r\n        vec2.transformMat3(local, local, inv);\r\n        const lx = local[0];\r\n        const ly = local[1];\r\n\r\n        // 1. 快速排除矩形外部\r\n        if (lx < -pivotX || lx > width - pivotX || ly < -pivotY || ly > height - pivotY) {\r\n            return false;\r\n        }\r\n\r\n        if (radius <= 0) return true; // 普通矩形直接命中\r\n\r\n        // 2. 检查四个圆角\r\n        const corners = [\r\n            [-pivotX + radius, -pivotY + radius], // 左上\r\n            [width - pivotX - radius, -pivotY + radius], // 右上\r\n            [width - pivotX - radius, height - pivotY - radius], // 右下\r\n            [-pivotX + radius, height - pivotY - radius], // 左下\r\n        ];\r\n\r\n        const cornerChecks = [\r\n            lx < -pivotX + radius && ly < -pivotY + radius, // 左上\r\n            lx > width - pivotX - radius && ly < -pivotY + radius, // 右上\r\n            lx > width - pivotX - radius && ly > height - pivotY - radius, // 右下\r\n            lx < -pivotX + radius && ly > height - pivotY - radius, // 左下\r\n        ];\r\n\r\n        for (let i = 0; i < 4; i++) {\r\n            if (cornerChecks[i]) {\r\n                const dx = lx - corners[i][0];\r\n                const dy = ly - corners[i][1];\r\n                if (dx * dx + dy * dy > radius * radius) return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n}\r\n","import { ECS } from \"../../ecs/ECS\";\r\nimport { Transform } from \"../../components/Transform\";\r\nimport { Image } from \"../../components/render/Image\";\r\nimport { IBoundingBoxStrategy } from \"./AABB\";\r\nimport { mat3, vec2 } from \"gl-matrix\";\r\n\r\n/**\r\n * Image 包围盒策略\r\n */\r\nexport class ImageBoundingBox implements IBoundingBoxStrategy {\r\n    match(ecs: ECS, entityId: number) {\r\n        return ecs.hasComponent(entityId, Image);\r\n    }\r\n\r\n    /**\r\n     * 计算图片的世界包围盒（考虑变换矩阵）\r\n     */\r\n    computeAABB(ecs: ECS, entityId: number) {\r\n        const img = ecs.getComponent(entityId, Image)!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n\r\n        const { width, height } = img;\r\n        const m = transform.worldMatrix; // mat3 (列主序)\r\n\r\n        // 图片四个顶点（局部坐标）\r\n        const points = [\r\n            vec2.fromValues(0, 0),\r\n            vec2.fromValues(width, 0),\r\n            vec2.fromValues(0, height),\r\n            vec2.fromValues(width, height),\r\n        ];\r\n\r\n        // 转换到世界坐标\r\n        const worldPts = points.map(p => {\r\n            const wp = vec2.create();\r\n            vec2.transformMat3(wp, p, m);\r\n            return wp;\r\n        });\r\n\r\n        // 求最小包围盒\r\n        let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\r\n        for (const p of worldPts) {\r\n            if (p[0] < minX) minX = p[0];\r\n            if (p[1] < minY) minY = p[1];\r\n            if (p[0] > maxX) maxX = p[0];\r\n            if (p[1] > maxY) maxY = p[1];\r\n        }\r\n\r\n        return { minX, minY, maxX, maxY };\r\n    }\r\n\r\n    /**\r\n     * 命中检测：判断点击点 (x, y) 是否落在图片内部（考虑旋转、缩放、平移）\r\n     */\r\n    hit(ecs: ECS, entityId: number, x: number, y: number): boolean {\r\n        const img = ecs.getComponent(entityId, Image)!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n\r\n        const { width, height } = img;\r\n        const m = transform.worldMatrix;\r\n\r\n        // 逆矩阵，把世界坐标转回本地坐标\r\n        const inv = mat3.create();\r\n        mat3.invert(inv, m);\r\n\r\n        const local = vec2.fromValues(x, y);\r\n        vec2.transformMat3(local, local, inv);\r\n\r\n        const lx = local[0];\r\n        const ly = local[1];\r\n\r\n        // 检查是否在 [0, width] × [0, height] 内\r\n        return lx >= 0 && lx <= width && ly >= 0 && ly <= height;\r\n    }\r\n}\r\n","import { Component } from \"../../ecs/decorators/Component\";\r\nimport { IComponent } from \"../../ecs/interface/IComponent\";\r\nimport { RenderComponent } from \"./RenderComponent.ts\";\r\nimport { Engine } from \"../../ecs/Engine.ts\";\r\n\r\n/**\r\n * 折线 / 多边形组件\r\n * 仅存储渲染数据，不包含绘制逻辑\r\n * 系统（RenderSystem）负责渲染\r\n */\r\n@Component(\"Polyline\")\r\nexport class Polyline extends RenderComponent implements IComponent {\r\n  /** 顶点列表，例如 [{x:0, y:0}, {x:100, y:50}] */\r\n  points: [number,number][] = [];\r\n\r\n  /** 是否闭合成多边形 */\r\n  closed: boolean = false;\r\n\r\n  /** 填充样式（闭合时有效） */\r\n  fillStyle?: string;\r\n\r\n  /** 线条样式 */\r\n  strokeStyle: string;\r\n\r\n  /** 线宽 */\r\n  lineWidth: number;\r\n\r\n  /** 透明度 */\r\n  alpha: number;\r\n\r\n  /** 是否参与渲染 */\r\n  render: boolean = true;\r\n\r\n  constructor(\r\n    engine: Engine | null,\r\n    {\r\n      points = [],\r\n      closed = false,\r\n      fillStyle,\r\n      strokeStyle = \"#000000\",\r\n      lineWidth = 1,\r\n      alpha = 1.0,\r\n      render = true,\r\n    }: Partial<Polyline> = {}\r\n  ) {\r\n    super(engine);\r\n    this.points = points;\r\n    this.closed = closed;\r\n    this.fillStyle = fillStyle;\r\n    this.strokeStyle = strokeStyle;\r\n    this.lineWidth = lineWidth;\r\n    this.alpha = alpha;\r\n    this.render = render;\r\n  }\r\n}\r\n","import { vec2, mat3 } from \"gl-matrix\";\r\nimport { ECS } from \"../../ecs/ECS\";\r\nimport { Transform } from \"../../components/Transform\";\r\nimport { Polyline } from \"../../components/render/Polyline\";\r\nimport { IBoundingBoxStrategy } from \"./AABB\";\r\n\r\n/**\r\n * Polyline 包围盒策略\r\n */\r\nexport class PolylineBoundingBox implements IBoundingBoxStrategy {\r\n    match(ecs: ECS, entityId: number) {\r\n        return ecs.hasComponent(entityId, Polyline);\r\n    }\r\n\r\n    computeAABB(ecs: ECS, entityId: number) {\r\n        const polyline = ecs.getComponent(entityId, Polyline)!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n        const m = transform.worldMatrix;\r\n\r\n        if (!polyline.points || polyline.points.length === 0) {\r\n            return { minX: 0, minY: 0, maxX: 0, maxY: 0 };\r\n        }\r\n\r\n        // 将所有点变换到世界坐标\r\n        const worldPoints = polyline.points.map((p) =>\r\n            vec2.transformMat3(vec2.create(), vec2.fromValues(p[0], p[1]), m)\r\n        );\r\n\r\n        // 计算 AABB\r\n        let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\r\n        for (const p of worldPoints) {\r\n            minX = Math.min(minX, p[0]);\r\n            minY = Math.min(minY, p[1]);\r\n            maxX = Math.max(maxX, p[0]);\r\n            maxY = Math.max(maxY, p[1]);\r\n        }\r\n\r\n        return { minX, minY, maxX, maxY };\r\n    }\r\n\r\n    hit(ecs: ECS, entityId: number, x: number, y: number): boolean {\r\n        const polyline = ecs.getComponent(entityId, Polyline)!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n\r\n        if (!polyline.points || polyline.points.length < 2) return false;\r\n\r\n        // 世界 -> 局部\r\n        const inv = mat3.create();\r\n        mat3.invert(inv, transform.worldMatrix);\r\n        const local = vec2.fromValues(x, y);\r\n        vec2.transformMat3(local, local, inv);\r\n\r\n        const pts = polyline.points;\r\n        const px = local[0], py = local[1];\r\n\r\n        if (polyline.closed) {\r\n            // --- 闭合路径：点在多边形内检测（奇偶规则）\r\n            let inside = false;\r\n            for (let i = 0, j = pts.length - 1; i < pts.length; j = i++) {\r\n                const xi = pts[i][0], yi = pts[i][1];\r\n                const xj = pts[j][0], yj = pts[j][1];\r\n\r\n                const intersect =\r\n                    yi > py !== yj > py &&\r\n                    px < ((xj - xi) * (py - yi)) / (yj - yi) + xi;\r\n\r\n                if (intersect) inside = !inside;\r\n            }\r\n            return inside;\r\n        } else {\r\n            // --- 非闭合折线：判断点到线段的最短距离是否小于阈值\r\n            const threshold = 3; // 可根据像素密度调整\r\n            for (let i = 0; i < pts.length - 1; i++) {\r\n                const p1 = pts[i], p2 = pts[i + 1];\r\n                if (this.pointToSegmentDistance(px, py, p1[0], p1[1], p2[0], p2[1]) <= threshold)\r\n                    return true;\r\n            }\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /** 计算点到线段的最短距离 */\r\n    private pointToSegmentDistance(px: number, py: number, x1: number, y1: number, x2: number, y2: number): number {\r\n        const dx = x2 - x1;\r\n        const dy = y2 - y1;\r\n        if (dx === 0 && dy === 0) {\r\n            return Math.hypot(px - x1, py - y1);\r\n        }\r\n        const t = ((px - x1) * dx + (py - y1) * dy) / (dx * dx + dy * dy);\r\n        const clampedT = Math.max(0, Math.min(1, t));\r\n        const closestX = x1 + clampedT * dx;\r\n        const closestY = y1 + clampedT * dy;\r\n        return Math.hypot(px - closestX, py - closestY);\r\n    }\r\n}\r\n","import { Component } from \"../../ecs/decorators/Component\";\r\nimport { IComponent } from \"../../ecs/interface/IComponent\";\r\nimport { RenderComponent } from \"./RenderComponent\";\r\nimport { Engine } from \"../../ecs/Engine\";\r\n\r\n@Component(\"Curve\")\r\nexport class Curve extends RenderComponent implements IComponent {\r\n  start: [number, number] = [0, 0];\r\n  cp1: [number, number] = [0, 0];\r\n  cp2?: [number, number];\r\n  end: [number, number] = [0, 0];\r\n\r\n  strokeStyle: string = \"#000\";\r\n  lineWidth: number = 1;\r\n  alpha: number = 1;\r\n  render: boolean = true;\r\n\r\n  constructor(engine: Engine | null, opts: Partial<Curve> = {}) {\r\n    super(engine);\r\n    this.start = opts.start || this.start;\r\n    this.cp1 = opts.cp1 || this.cp1;\r\n    this.cp2 = opts.cp2 || this.cp2;\r\n    this.end = opts.end || this.end;\r\n    this.strokeStyle = opts.strokeStyle || this.strokeStyle;\r\n    this.lineWidth = opts.lineWidth || this.lineWidth;\r\n    this.alpha = opts.alpha || this.alpha;\r\n    this.render = opts.render || this.render;\r\n  }\r\n}\r\n","import { vec2, mat3 } from \"gl-matrix\";\r\nimport { ECS } from \"../../ecs/ECS\";\r\nimport { Transform } from \"../../components/Transform\";\r\nimport { Curve } from \"../../components/render/Curve\";\r\nimport { IBoundingBoxStrategy } from \"./AABB\";\r\n\r\n/**\r\n * Curve 包围盒策略\r\n */\r\nexport class CurveBoundingBox implements IBoundingBoxStrategy {\r\n    match(ecs: ECS, entityId: number) {\r\n        return ecs.hasComponent(entityId, Curve);\r\n    }\r\n\r\n    computeAABB(ecs: ECS, entityId: number) {\r\n        const curve = ecs.getComponent(entityId, Curve)!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n        const m = transform.worldMatrix;\r\n\r\n        // 采样曲线点\r\n        const points: vec2[] = [];\r\n        const steps = 30; // 分段数，越大越精确\r\n        for (let t = 0; t <= 1; t += 1 / steps) {\r\n            let x: number, y: number;\r\n            if (curve.cp2) {\r\n                // 三次贝塞尔\r\n                const u = 1 - t;\r\n                x = u ** 3 * curve.start[0] +\r\n                    3 * u ** 2 * t * curve.cp1[0] +\r\n                    3 * u * t ** 2 * curve.cp2[0] +\r\n                    t ** 3 * curve.end[0];\r\n                y = u ** 3 * curve.start[1] +\r\n                    3 * u ** 2 * t * curve.cp1[1] +\r\n                    3 * u * t ** 2 * curve.cp2[1] +\r\n                    t ** 3 * curve.end[1];\r\n            } else {\r\n                // 二次贝塞尔\r\n                const u = 1 - t;\r\n                x = u ** 2 * curve.start[0] + 2 * u * t * curve.cp1[0] + t ** 2 * curve.end[0];\r\n                y = u ** 2 * curve.start[1] + 2 * u * t * curve.cp1[1] + t ** 2 * curve.end[1];\r\n            }\r\n            const p = vec2.fromValues(x, y);\r\n            vec2.transformMat3(p, p, m);\r\n            points.push(p);\r\n        }\r\n\r\n        // 计算AABB\r\n        let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\r\n        for (const p of points) {\r\n            minX = Math.min(minX, p[0]);\r\n            minY = Math.min(minY, p[1]);\r\n            maxX = Math.max(maxX, p[0]);\r\n            maxY = Math.max(maxY, p[1]);\r\n        }\r\n\r\n        return { minX, minY, maxX, maxY };\r\n    }\r\n\r\n    hit(ecs: ECS, entityId: number, x: number, y: number): boolean {\r\n        const curve = ecs.getComponent(entityId, Curve)!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n        const m = transform.worldMatrix;\r\n\r\n        // 将世界坐标反变换回局部空间\r\n        const inv = mat3.create();\r\n        mat3.invert(inv, m);\r\n        const local = vec2.fromValues(x, y);\r\n        vec2.transformMat3(local, local, inv);\r\n\r\n        // 点到曲线距离，使用简单采样法\r\n        const steps = 50;\r\n        let minDist = Infinity;\r\n        for (let t = 0; t <= 1; t += 1 / steps) {\r\n            let px: number, py: number;\r\n            if (curve.cp2) {\r\n                const u = 1 - t;\r\n                px = u ** 3 * curve.start[0] +\r\n                    3 * u ** 2 * t * curve.cp1[0] +\r\n                    3 * u * t ** 2 * curve.cp2[0] +\r\n                    t ** 3 * curve.end[0];\r\n                py = u ** 3 * curve.start[1] +\r\n                    3 * u ** 2 * t * curve.cp1[1] +\r\n                    3 * u * t ** 2 * curve.cp2[1] +\r\n                    t ** 3 * curve.end[1];\r\n            } else {\r\n                const u = 1 - t;\r\n                px = u ** 2 * curve.start[0] + 2 * u * t * curve.cp1[0] + t ** 2 * curve.end[0];\r\n                py = u ** 2 * curve.start[1] + 2 * u * t * curve.cp1[1] + t ** 2 * curve.end[1];\r\n            }\r\n            const dx = local[0] - px;\r\n            const dy = local[1] - py;\r\n            minDist = Math.min(minDist, Math.sqrt(dx * dx + dy * dy));\r\n        }\r\n\r\n        return minDist <= (curve.lineWidth || 5); // 允许一定像素误差\r\n    }\r\n}\r\n","import { Component } from \"../../ecs/decorators/Component.ts\";\r\nimport { IComponent } from \"../../ecs/interface/IComponent.ts\";\r\nimport { RenderComponent } from \"./RenderComponent.ts\";\r\nimport { Engine } from \"../../ecs/Engine.ts\";\r\n\r\n/** 🧩 支持的路径命令 */\r\nexport type IPathCommand =\r\n  | { type: \"moveTo\"; x: number; y: number }\r\n  | { type: \"lineTo\"; x: number; y: number }\r\n  | { type: \"quadraticCurveTo\"; cp: [number, number]; end: [number, number] }\r\n  | { type: \"bezierCurveTo\"; cp1: [number, number]; cp2: [number, number]; end: [number, number] }\r\n  | { type: \"arc\"; center: [number, number]; radius: number; start: number; end: number; counterClockwise?: boolean }\r\n  | { type: \"arcTo\"; cp1: [number, number]; cp2: [number, number]; radius: number }\r\n  | { type: \"ellipse\"; center: [number, number]; radiusX: number; radiusY: number; rotation?: number; start?: number; end?: number; counterClockwise?: boolean } // 新增椭圆\r\n  | { type: \"close\" };\r\n\r\n@Component(\"Path\")\r\nexport class Path extends RenderComponent implements IComponent {\r\n  commands: IPathCommand[] = [];\r\n  strokeStyle?: string;\r\n  fillStyle?: string;\r\n  lineWidth: number = 1;\r\n  alpha: number = 1.0;\r\n  render: boolean = true;\r\n\r\n  /** 🆕 缓存 Path2D 对象 */\r\n  path2D?: Path2D;\r\n\r\n  constructor(engine: Engine | null, options: Partial<Path> & { commands?: IPathCommand[] } = {}) {\r\n    super(engine);\r\n    this.commands = options.commands || [];\r\n    this.strokeStyle = options.strokeStyle || \"#000000\";\r\n    this.fillStyle = options.fillStyle || undefined;\r\n    this.lineWidth = options.lineWidth ?? 1;\r\n    this.alpha = options.alpha ?? 1.0;\r\n    this.render = options.render ?? true;\r\n    this.updatePath2D();\r\n  }\r\n\r\n  /** 添加一个命令 */\r\n  addCommand(cmd: IPathCommand) {\r\n    this.commands.push(cmd);\r\n    this.updatePath2D();\r\n  }\r\n\r\n  /** 清空路径 */\r\n  clear() {\r\n    this.commands.length = 0;\r\n    this.updatePath2D(); // 更新 Path2D\r\n  }\r\n\r\n  /** 🆕 根据 commands 更新 Path2D 对象 */\r\n  updatePath2D() {\r\n    const path = new Path2D();\r\n\r\n    for (const cmd of this.commands) {\r\n      switch (cmd.type) {\r\n        case \"moveTo\":\r\n          path.moveTo(cmd.x, cmd.y);\r\n          break;\r\n        case \"lineTo\":\r\n          path.lineTo(cmd.x, cmd.y);\r\n          break;\r\n        case \"quadraticCurveTo\":\r\n          path.quadraticCurveTo(cmd.cp[0], cmd.cp[1], cmd.end[0], cmd.end[1]);\r\n          break;\r\n        case \"bezierCurveTo\":\r\n          path.bezierCurveTo(cmd.cp1[0], cmd.cp1[1], cmd.cp2[0], cmd.cp2[1], cmd.end[0], cmd.end[1]);\r\n          break;\r\n        case \"arc\":\r\n          path.arc(cmd.center[0], cmd.center[1], cmd.radius, cmd.start, cmd.end, cmd.counterClockwise);\r\n          break;\r\n        case \"arcTo\":\r\n          path.arcTo(cmd.cp1[0], cmd.cp1[1], cmd.cp2[0], cmd.cp2[1], cmd.radius);\r\n          break;\r\n        case \"ellipse\":\r\n          path.ellipse(\r\n            cmd.center[0],\r\n            cmd.center[1],\r\n            cmd.radiusX,\r\n            cmd.radiusY,\r\n            cmd.rotation ?? 0,\r\n            cmd.start ?? 0,\r\n            cmd.end ?? 2 * Math.PI,\r\n            cmd.counterClockwise ?? false\r\n          );\r\n          break;\r\n        case \"close\":\r\n          path.closePath();\r\n          break;\r\n      }\r\n    }\r\n\r\n    this.path2D = path;\r\n  }\r\n}\r\n","import { vec2, mat3 } from \"gl-matrix\";\r\nimport { ECS } from \"../../ecs/ECS\";\r\nimport { Transform } from \"../../components/Transform\";\r\nimport { Path } from \"../../components/render/Path\";\r\nimport { IBoundingBoxStrategy } from \"./AABB\";\r\n\r\nexport class PathBoundingBox implements IBoundingBoxStrategy {\r\n    private offscreenCanvas: HTMLCanvasElement;\r\n    private offscreenCtx: CanvasRenderingContext2D;\r\n\r\n    constructor() {\r\n        this.offscreenCanvas = document.createElement(\"canvas\");\r\n        this.offscreenCanvas.width = 1;\r\n        this.offscreenCanvas.height = 1;\r\n        const ctx = this.offscreenCanvas.getContext(\"2d\");\r\n        if (!ctx) throw new Error(\"Offscreen canvas context not available\");\r\n        this.offscreenCtx = ctx;\r\n    }\r\n\r\n    match(ecs: ECS, entityId: number) {\r\n        return ecs.hasComponent(entityId, Path);\r\n    }\r\n\r\n    computeAABB(ecs: ECS, entityId: number) {\r\n        const path = ecs.getComponent(entityId, Path)!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n        const m = transform.worldMatrix;\r\n\r\n        const points: vec2[] = [];\r\n        let lastPos: [number, number] = [0, 0];\r\n        const steps = 20;\r\n\r\n        for (const cmd of path.commands) {\r\n            switch (cmd.type) {\r\n                case \"moveTo\":\r\n                    lastPos = [cmd.x, cmd.y];\r\n                    points.push(vec2.fromValues(...lastPos));\r\n                    break;\r\n                case \"lineTo\":\r\n                    lastPos = [cmd.x, cmd.y];\r\n                    points.push(vec2.fromValues(...lastPos));\r\n                    break;\r\n                case \"quadraticCurveTo\":\r\n                    for (let t = 0; t <= 1; t += 1 / steps) {\r\n                        const u = 1 - t;\r\n                        const x = u ** 2 * lastPos[0] + 2 * u * t * cmd.cp[0] + t ** 2 * cmd.end[0];\r\n                        const y = u ** 2 * lastPos[1] + 2 * u * t * cmd.cp[1] + t ** 2 * cmd.end[1];\r\n                        points.push(vec2.fromValues(x, y));\r\n                    }\r\n                    lastPos = [...cmd.end];\r\n                    break;\r\n                case \"bezierCurveTo\":\r\n                    for (let t = 0; t <= 1; t += 1 / steps) {\r\n                        const u = 1 - t;\r\n                        const x =\r\n                            u ** 3 * lastPos[0] +\r\n                            3 * u ** 2 * t * cmd.cp1[0] +\r\n                            3 * u * t ** 2 * cmd.cp2[0] +\r\n                            t ** 3 * cmd.end[0];\r\n                        const y =\r\n                            u ** 3 * lastPos[1] +\r\n                            3 * u ** 2 * t * cmd.cp1[1] +\r\n                            3 * u * t ** 2 * cmd.cp2[1] +\r\n                            t ** 3 * cmd.end[1];\r\n                        points.push(vec2.fromValues(x, y));\r\n                    }\r\n                    lastPos = [...cmd.end];\r\n                    break;\r\n                case \"arc\": {\r\n                    const [cx, cy] = cmd.center;\r\n                    for (let t = 0; t <= 1; t += 1 / steps) {\r\n                        const angle = cmd.start + t * (cmd.end - cmd.start);\r\n                        const x = cx + cmd.radius * Math.cos(angle);\r\n                        const y = cy + cmd.radius * Math.sin(angle);\r\n                        points.push(vec2.fromValues(x, y));\r\n                    }\r\n                    lastPos = [cx + cmd.radius * Math.cos(cmd.end), cy + cmd.radius * Math.sin(cmd.end)];\r\n                    break;\r\n                }\r\n                case \"arcTo\":\r\n                    points.push(vec2.fromValues(cmd.cp1[0], cmd.cp1[1]));\r\n                    points.push(vec2.fromValues(cmd.cp2[0], cmd.cp2[1]));\r\n                    lastPos = [...cmd.cp2];\r\n                    break;\r\n                case \"ellipse\": {\r\n                    const [cx, cy] = cmd.center;\r\n                    const rx = cmd.radiusX;\r\n                    const ry = cmd.radiusY;\r\n                    const rotation = cmd.rotation ?? 0;\r\n                    for (let t = 0; t <= 1; t += 1 / steps) {\r\n                        const angle = t * 2 * Math.PI;\r\n                        const cos = Math.cos(angle);\r\n                        const sin = Math.sin(angle);\r\n                        const x = cx + rx * cos * Math.cos(rotation) - ry * sin * Math.sin(rotation);\r\n                        const y = cy + rx * cos * Math.sin(rotation) + ry * sin * Math.cos(rotation);\r\n                        points.push(vec2.fromValues(x, y));\r\n                    }\r\n                    lastPos = [cx + rx * Math.cos(0), cy + ry * Math.sin(0)];\r\n                    break;\r\n                }\r\n                case \"close\":\r\n                    break;\r\n            }\r\n        }\r\n\r\n        const worldPoints = points.map(p => vec2.transformMat3(vec2.create(), p, m));\r\n        let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\r\n        for (const p of worldPoints) {\r\n            minX = Math.min(minX, p[0]);\r\n            minY = Math.min(minY, p[1]);\r\n            maxX = Math.max(maxX, p[0]);\r\n            maxY = Math.max(maxY, p[1]);\r\n        }\r\n\r\n        return { minX, minY, maxX, maxY };\r\n    }\r\n\r\n    hit(ecs: ECS, entityId: number, x: number, y: number): boolean {\r\n        const path = ecs.getComponent(entityId, Path)!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n        const m = transform.worldMatrix;\r\n\r\n        const inv = mat3.create();\r\n        mat3.invert(inv, m);\r\n        const local = vec2.fromValues(x, y);\r\n        vec2.transformMat3(local, local, inv);\r\n\r\n        const hasClose = path.commands.some(cmd => cmd.type === \"close\");\r\n\r\n        if (path.path2D) {\r\n            const ctx = this.offscreenCtx;\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, 1, 1);\r\n            ctx.lineWidth = path.lineWidth ?? 1;\r\n            const result = hasClose \r\n                ? ctx.isPointInPath(path.path2D, local[0], local[1])\r\n                : ctx.isPointInStroke(path.path2D, local[0], local[1]);\r\n            ctx.restore();\r\n            return result;\r\n        } else {\r\n            if (hasClose) {\r\n                return this.isPointInPath(path, local[0], local[1]);\r\n            } else {\r\n                return PathBoundingBox.isPointNearPath(path, local[0], local[1]);\r\n            }\r\n        }\r\n    }\r\n\r\n    private isPointInPath(path: Path, x: number, y: number): boolean {\r\n        const ctx = this.offscreenCtx;\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, 1, 1);\r\n\r\n        ctx.beginPath();\r\n        for (const cmd of path.commands) {\r\n            switch (cmd.type) {\r\n                case \"moveTo\": ctx.moveTo(cmd.x, cmd.y); break;\r\n                case \"lineTo\": ctx.lineTo(cmd.x, cmd.y); break;\r\n                case \"quadraticCurveTo\": ctx.quadraticCurveTo(cmd.cp[0], cmd.cp[1], cmd.end[0], cmd.end[1]); break;\r\n                case \"bezierCurveTo\": ctx.bezierCurveTo(cmd.cp1[0], cmd.cp1[1], cmd.cp2[0], cmd.cp2[1], cmd.end[0], cmd.end[1]); break;\r\n                case \"arc\": ctx.arc(cmd.center[0], cmd.center[1], cmd.radius, cmd.start, cmd.end, cmd.counterClockwise); break;\r\n                case \"arcTo\": ctx.arcTo(cmd.cp1[0], cmd.cp1[1], cmd.cp2[0], cmd.cp2[1], cmd.radius); break;\r\n                case \"ellipse\": ctx.ellipse(cmd.center[0], cmd.center[1], cmd.radiusX, cmd.radiusY, cmd.rotation ?? 0, 0, 2 * Math.PI); break;\r\n                case \"close\": ctx.closePath(); break;\r\n            }\r\n        }\r\n\r\n        const result = ctx.isPointInPath(x, y);\r\n        ctx.restore();\r\n        return result;\r\n    }\r\n\r\n    static isPointNearPath(path: Path, x: number, y: number): boolean {\r\n        const steps = 50;\r\n        const lineWidth = path.lineWidth ?? 5;\r\n        let lastPos: [number, number] = [0, 0];\r\n        let minDist = Infinity;\r\n\r\n        for (const cmd of path.commands) {\r\n            switch (cmd.type) {\r\n                case \"moveTo\": lastPos = [cmd.x, cmd.y]; break;\r\n                case \"lineTo\": {\r\n                    const dx = cmd.x - lastPos[0];\r\n                    const dy = cmd.y - lastPos[1];\r\n                    if (dx !== 0 || dy !== 0) {\r\n                        const t = ((x - lastPos[0]) * dx + (y - lastPos[1]) * dy) / (dx * dx + dy * dy);\r\n                        const tt = Math.max(0, Math.min(1, t));\r\n                        const px = lastPos[0] + dx * tt;\r\n                        const py = lastPos[1] + dy * tt;\r\n                        minDist = Math.min(minDist, Math.hypot(x - px, y - py));\r\n                    }\r\n                    lastPos = [cmd.x, cmd.y];\r\n                    break;\r\n                }\r\n                case \"quadraticCurveTo\":\r\n                    for (let t = 0; t <= 1; t += 1 / steps) {\r\n                        const u = 1 - t;\r\n                        const px = u ** 2 * lastPos[0] + 2 * u * t * cmd.cp[0] + t ** 2 * cmd.end[0];\r\n                        const py = u ** 2 * lastPos[1] + 2 * u * t * cmd.cp[1] + t ** 2 * cmd.end[1];\r\n                        minDist = Math.min(minDist, Math.hypot(x - px, y - py));\r\n                    }\r\n                    lastPos = [...cmd.end];\r\n                    break;\r\n                case \"bezierCurveTo\":\r\n                    for (let t = 0; t <= 1; t += 1 / steps) {\r\n                        const u = 1 - t;\r\n                        const px =\r\n                            u ** 3 * lastPos[0] +\r\n                            3 * u ** 2 * t * cmd.cp1[0] +\r\n                            3 * u * t ** 2 * cmd.cp2[0] +\r\n                            t ** 3 * cmd.end[0];\r\n                        const py =\r\n                            u ** 3 * lastPos[1] +\r\n                            3 * u ** 2 * t * cmd.cp1[1] +\r\n                            3 * u * t ** 2 * cmd.cp2[1] +\r\n                            t ** 3 * cmd.end[1];\r\n                        minDist = Math.min(minDist, Math.hypot(x - px, y - py));\r\n                    }\r\n                    lastPos = [...cmd.end];\r\n                    break;\r\n                case \"arc\": {\r\n                    const [cx, cy] = cmd.center;\r\n                    const startAngle = cmd.start;\r\n                    const endAngle = cmd.end;\r\n                    const stepAngle = (endAngle - startAngle) / steps;\r\n                    for (let i = 0; i <= steps; i++) {\r\n                        const angle = startAngle + stepAngle * i;\r\n                        const px = cx + cmd.radius * Math.cos(angle);\r\n                        const py = cy + cmd.radius * Math.sin(angle);\r\n                        minDist = Math.min(minDist, Math.hypot(x - px, y - py));\r\n                    }\r\n                    lastPos = [cx + cmd.radius * Math.cos(endAngle), cy + cmd.radius * Math.sin(endAngle)];\r\n                    break;\r\n                }\r\n                case \"arcTo\": {\r\n                    const [x1, y1] = lastPos;\r\n                    const [x2, y2] = cmd.cp1;\r\n                    const [x3, y3] = cmd.cp2;\r\n                    const r = cmd.radius;\r\n\r\n                    const dx1 = x1 - x2;\r\n                    const dy1 = y1 - y2;\r\n                    const dx2 = x3 - x2;\r\n                    const dy2 = y3 - y2;\r\n\r\n                    const a1 = Math.atan2(dy1, dx1);\r\n                    const a2 = Math.atan2(dy2, dx2);\r\n                    const angleDiff = ((a2 - a1 + Math.PI * 3) % (Math.PI * 2)) - Math.PI;\r\n\r\n                    const centerAngle = a1 + angleDiff / 2;\r\n                    const cx = x2 + r * Math.cos(centerAngle + Math.PI / 2);\r\n                    const cy = y2 + r * Math.sin(centerAngle + Math.PI / 2);\r\n\r\n                    const startAngle = Math.atan2(y1 - cy, x1 - cx);\r\n                    const endAngle = Math.atan2(y3 - cy, x3 - cx);\r\n\r\n                    for (let i = 0; i <= steps; i++) {\r\n                        const t = i / steps;\r\n                        const angle = startAngle + (endAngle - startAngle) * t;\r\n                        const px = cx + r * Math.cos(angle);\r\n                        const py = cy + r * Math.sin(angle);\r\n                        minDist = Math.min(minDist, Math.hypot(x - px, y - py));\r\n                    }\r\n                    lastPos = [x3, y3];\r\n                    break;\r\n                }\r\n                case \"ellipse\": {\r\n                    const [cx, cy] = cmd.center;\r\n                    const rx = cmd.radiusX;\r\n                    const ry = cmd.radiusY;\r\n                    const rotation = cmd.rotation ?? 0;\r\n                    for (let i = 0; i <= steps; i++) {\r\n                        const t = i / steps * 2 * Math.PI;\r\n                        const cos = Math.cos(t);\r\n                        const sin = Math.sin(t);\r\n                        const px = cx + rx * cos * Math.cos(rotation) - ry * sin * Math.sin(rotation);\r\n                        const py = cy + rx * cos * Math.sin(rotation) + ry * sin * Math.cos(rotation);\r\n                        minDist = Math.min(minDist, Math.hypot(x - px, y - py));\r\n                    }\r\n                    lastPos = [cx + rx * Math.cos(0), cy + ry * Math.sin(0)];\r\n                    break;\r\n                }\r\n                case \"close\": break;\r\n            }\r\n        }\r\n\r\n        return minDist <= Math.max(5, lineWidth / 2);\r\n    }\r\n}\r\n","import { ECS } from \"../../ecs/ECS.ts\";\r\nimport { IProcess } from \"../../ecs/interface/IRender.ts\";\r\nimport type { ISystem } from \"../../ecs/System.ts\";\r\nimport { IBoundingBoxStrategy } from \"./AABB.ts\";\r\nimport { CircleBoundingBox } from \"./CircleBoundingBox.ts\";\r\nimport { RectBoundingBox } from \"./RectBoundingBox.ts\";\r\nimport { ImageBoundingBox } from \"./ImageBoundingBox.ts\";\r\nimport { PolylineBoundingBox } from \"./PolylineBoundingBox.ts\";\r\nimport { CurveBoundingBox } from \"./CurveBoundingBox.ts\";\r\nimport { BoundingBoxComponent } from \"../../components/BoundingBoxComponent.ts\";\r\nimport { IAABB } from \"../../interface/AABB.ts\";\r\nimport { IShareContext } from \"../../interface/System.ts\";\r\nimport { PathBoundingBox } from \"./PathBoundingBox.ts\";\r\nexport class BoundingBoxProcess implements IProcess {\r\n    match(_ecs: ECS, _entityId: number) {\r\n        return true\r\n    }\r\n    private strategies: IBoundingBoxStrategy[];\r\n    // 某一组子节点的包围盒，遍历完子节点后 更新\r\n    none: () => IAABB = () => ({ minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity });\r\n    constructor() {\r\n        this.strategies = [];\r\n        this.strategies.push(new CircleBoundingBox());\r\n        this.strategies.push(new RectBoundingBox());\r\n        this.strategies.push(new ImageBoundingBox());\r\n        this.strategies.push(new PolylineBoundingBox());\r\n        this.strategies.push(new CurveBoundingBox());\r\n        this.strategies.push(new PathBoundingBox());    \r\n    }\r\n    compute(ecs: ECS, entityId: number) {\r\n        for (const s of this.strategies) {\r\n            if (s.match(ecs, entityId)) {\r\n                const aabb = s.computeAABB(ecs, entityId);\r\n                return aabb;\r\n            }\r\n        }\r\n        return { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity } as IAABB;\r\n    }\r\n    exec(system: ISystem, entityId: number, parentEntityId: number | null, context: IShareContext, parentContext: IShareContext | null) {\r\n        let bbox = system.ecs.getComponent(entityId, BoundingBoxComponent);\r\n        if (!bbox) {\r\n            bbox = new BoundingBoxComponent();\r\n            system.ecs.addComponent(entityId, bbox);\r\n        }\r\n        if (!bbox.dirty) return;\r\n        const selfAABB = this.compute(system.ecs, entityId);\r\n        bbox.setSelf(selfAABB);\r\n        bbox.setChildren(context.childrenAABB || this.none());\r\n        bbox.updateTotalAABB();\r\n        if (parentEntityId !== null && parentContext !== null) {\r\n            let parentBBox = system.ecs.getComponent(parentEntityId!, BoundingBoxComponent);\r\n            if (!parentBBox) {\r\n                parentBBox = new BoundingBoxComponent();\r\n                system.ecs.addComponent(parentEntityId!, parentBBox);\r\n            }\r\n            if (!parentContext.childrenAABB) {\r\n                parentContext.childrenAABB = this.none();\r\n            }\r\n            this.merge(parentContext.childrenAABB, bbox.totalAABB);\r\n            parentBBox.dirty = true;\r\n        }\r\n    }\r\n    merge(aabb: IAABB, bbox: IAABB) {\r\n        aabb.minX = Math.min(aabb.minX, bbox.minX);\r\n        aabb.minY = Math.min(aabb.minY, bbox.minY);\r\n        aabb.maxX = Math.max(aabb.maxX, bbox.maxX);\r\n        aabb.maxY = Math.max(aabb.maxY, bbox.maxY);\r\n    }\r\n}","import { ECS } from \"../../ecs/ECS.ts\";\r\nimport { Transform } from \"../../components/Transform.ts\";\r\nimport { Path } from \"../../components/render/Path.ts\";\r\nimport { IProcess } from \"../../ecs/interface/IRender.ts\";\r\nimport type { ISystem } from \"../../ecs/System.ts\";\r\n\r\n/**\r\n * 渲染器：负责绘制 Path 组件（支持 moveTo/lineTo/曲线/arc/arcTo/ellipse）\r\n */\r\nexport class PathRenderer implements IProcess {\r\n    match(ecs: ECS, entityId: number) {\r\n        return ecs.hasComponent(entityId, Path);\r\n    }\r\n\r\n    /**\r\n     * 执行渲染逻辑\r\n     */\r\n    exec(system: ISystem, entityId: number) {\r\n        const ecs = system.ecs;\r\n        const ctx = ecs.canvas.getContext(\"2d\")!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n        const path = ecs.getComponent(entityId, Path)!;\r\n\r\n        if (!path.render || !path.commands.length) return;\r\n\r\n        ctx.save();\r\n        ctx.globalAlpha = path.alpha;\r\n        const m = transform.worldMatrix;\r\n        ctx.setTransform(\r\n            m[0], // a = m00\r\n            m[1], // b = m10\r\n            m[3], // c = m01\r\n            m[4], // d = m11\r\n            m[6], // e = m20 (平移x)\r\n            m[7]  // f = m21 (平移y)\r\n        );\r\n\r\n        ctx.beginPath();\r\n\r\n        for (const cmd of path.commands) {\r\n            switch (cmd.type) {\r\n                case \"moveTo\":\r\n                    ctx.moveTo(cmd.x, cmd.y);\r\n                    break;\r\n                case \"lineTo\":\r\n                    ctx.lineTo(cmd.x, cmd.y);\r\n                    break;\r\n                case \"quadraticCurveTo\":\r\n                    ctx.quadraticCurveTo(cmd.cp[0], cmd.cp[1], cmd.end[0], cmd.end[1]);\r\n                    break;\r\n                case \"bezierCurveTo\":\r\n                    ctx.bezierCurveTo(cmd.cp1[0], cmd.cp1[1], cmd.cp2[0], cmd.cp2[1], cmd.end[0], cmd.end[1]);\r\n                    break;\r\n                case \"arc\":\r\n                    ctx.arc(cmd.center[0], cmd.center[1], cmd.radius, cmd.start, cmd.end, !!cmd.counterClockwise);\r\n                    break;\r\n                case \"arcTo\":\r\n                    ctx.arcTo(cmd.cp1[0], cmd.cp1[1], cmd.cp2[0], cmd.cp2[1], cmd.radius);\r\n                    break;\r\n                case \"ellipse\":\r\n                    ctx.ellipse(\r\n                        cmd.center[0],\r\n                        cmd.center[1],\r\n                        cmd.radiusX,\r\n                        cmd.radiusY,\r\n                        cmd.rotation ?? 0,\r\n                        cmd.start ?? 0,\r\n                        cmd.end ?? 2 * Math.PI,\r\n                        !!cmd.counterClockwise\r\n                    );\r\n                    break;\r\n                case \"close\":\r\n                    ctx.closePath();\r\n                    break;\r\n            }\r\n        }\r\n\r\n        if (path.fillStyle) {\r\n            ctx.fillStyle = path.fillStyle;\r\n            ctx.fill();\r\n        }\r\n\r\n        if (path.strokeStyle && path.lineWidth > 0) {\r\n            ctx.strokeStyle = path.strokeStyle;\r\n            ctx.lineWidth = path.lineWidth;\r\n            ctx.stroke();\r\n        }\r\n\r\n        ctx.restore();\r\n    }\r\n}\r\n","import { ECS } from \"../../ecs/ECS.ts\";\r\nimport { Transform } from \"../../components/Transform.ts\";\r\nimport { Polyline } from \"../../components/render/Polyline.ts\";\r\nimport { IProcess } from \"../../ecs/interface/IRender.ts\";\r\nimport type { ISystem } from \"../../ecs/System.ts\";\r\n\r\n/**\r\n * 渲染器：负责绘制 Polyline 组件\r\n */\r\nexport class PolylineRenderer implements IProcess {\r\n    match(ecs: ECS, entityId: number) {\r\n        return ecs.hasComponent(entityId, Polyline);\r\n    }\r\n\r\n    exec(system: ISystem, entityId: number) {\r\n        const ecs = system.ecs;\r\n        const ctx = ecs.canvas.getContext(\"2d\")!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n        const polyline = ecs.getComponent(entityId, Polyline)!;\r\n        if (!polyline.render || polyline.points.length < 2) return;\r\n\r\n        ctx.save();\r\n        ctx.globalAlpha = polyline.alpha;\r\n\r\n        // 设置世界变换矩阵\r\n        const m = transform.worldMatrix;\r\n        ctx.setTransform(\r\n            m[0], // a\r\n            m[1], // b\r\n            m[3], // c\r\n            m[4], // d\r\n            m[6], // e\r\n            m[7]  // f\r\n        );\r\n\r\n        ctx.beginPath();\r\n\r\n        // 绘制折线路径\r\n        const pts = polyline.points;\r\n        ctx.moveTo(pts[0][0], pts[0][1]);\r\n        for (let i = 1; i < pts.length; i++) {\r\n            ctx.lineTo(pts[i][0], pts[i][1]);\r\n        }\r\n\r\n        // 闭合路径（可选）\r\n        if (polyline.closed) {\r\n            ctx.closePath();\r\n        }\r\n\r\n        // 填充（仅在闭合时生效）\r\n        if (polyline.closed && polyline.fillStyle) {\r\n            ctx.fillStyle = polyline.fillStyle;\r\n            ctx.fill();\r\n        }\r\n\r\n        // 描边\r\n        if (polyline.strokeStyle && polyline.lineWidth > 0) {\r\n            ctx.strokeStyle = polyline.strokeStyle;\r\n            ctx.lineWidth = polyline.lineWidth;\r\n            ctx.stroke();\r\n        }\r\n\r\n        ctx.restore();\r\n    }\r\n}\r\n","import { ECS } from \"../../ecs/ECS.ts\";\r\nimport { Transform } from \"../../components/Transform.ts\";\r\nimport { Curve } from \"../../components/render/Curve.ts\";\r\nimport { IProcess } from \"../../ecs/interface/IRender.ts\";\r\nimport type { ISystem } from \"../../ecs/System.ts\";\r\n\r\n/**\r\n * 渲染器：负责绘制 Curve 组件（支持二次和三次贝塞尔曲线）\r\n */\r\nexport class CurveRenderer implements IProcess {\r\n    match(ecs: ECS, entityId: number) {\r\n        return ecs.hasComponent(entityId, Curve);\r\n    }\r\n\r\n    exec(system: ISystem, entityId: number) {\r\n        const ecs = system.ecs;\r\n        const ctx = ecs.canvas.getContext(\"2d\")!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n        const curve = ecs.getComponent(entityId, Curve)!;\r\n\r\n        if (!curve.render) return;\r\n\r\n        ctx.save();\r\n        ctx.globalAlpha = curve.alpha;\r\n\r\n        const m = transform.worldMatrix;\r\n        ctx.setTransform(\r\n            m[0], // a = m00\r\n            m[1], // b = m10\r\n            m[3], // c = m01\r\n            m[4], // d = m11\r\n            m[6], // e = m20 (平移x)\r\n            m[7]  // f = m21 (平移y)\r\n        );\r\n\r\n        ctx.beginPath();\r\n        ctx.moveTo(curve.start[0], curve.start[1]);\r\n\r\n        if (curve.cp2) {\r\n            // 三次贝塞尔曲线\r\n            ctx.bezierCurveTo(\r\n                curve.cp1[0], curve.cp1[1],\r\n                curve.cp2[0], curve.cp2[1],\r\n                curve.end[0], curve.end[1]\r\n            );\r\n        } else {\r\n            // 二次贝塞尔曲线\r\n            ctx.quadraticCurveTo(\r\n                curve.cp1[0], curve.cp1[1],\r\n                curve.end[0], curve.end[1]\r\n            );\r\n        }\r\n\r\n        if (curve.strokeStyle && curve.lineWidth > 0) {\r\n            ctx.strokeStyle = curve.strokeStyle;\r\n            ctx.lineWidth = curve.lineWidth;\r\n            ctx.stroke();\r\n        }\r\n\r\n        ctx.restore();\r\n    }\r\n}\r\n","import { ISystem } from \"../ecs/System.ts\";\r\nimport { SceneTree } from \"../ecs/SceneTree.ts\";\r\nimport { IProcess } from \"../ecs/interface/IRender.ts\";\r\nimport { RectRenderer } from './render/RectRenderer.ts'\r\nimport { CircleRenderer } from './render/CircleRenderer.ts'\r\nimport { ImageRenderer } from './render/ImageRenderer.ts'\r\nimport { TransformProcess } from './TransformProcess.ts'\r\nimport { Engine } from \"../ecs/Engine.ts\";\r\nimport { BoundingBoxProcess } from './AABB/aabbProcess.ts'\r\nimport { PathRenderer } from \"./render/PathRenderer.ts\";\r\nimport { IShareContext } from \"../interface/System.ts\";\r\nimport { PolylineRenderer } from \"./render/PolylineRenderer.ts\";\r\nimport { CurveRenderer } from \"./render/CurveRenderer.ts\";\r\nexport class SceneTreeRenderSystem extends ISystem {\r\n\r\n    ctx!: CanvasRenderingContext2D;\r\n    constructor(public engine: Engine, public sceneTree: SceneTree) {\r\n        super(engine, sceneTree);\r\n    }\r\n    processes: IProcess<{ dirty: boolean }, { dirty: boolean }>[] = [];\r\n    protected onInit(): void {\r\n        const canvas = this.ecs.canvas;\r\n        if (!canvas) throw new Error(\"Canvas not set on ECS\");\r\n        const ctx = canvas.getContext(\"2d\");\r\n        if (!ctx) throw new Error(\"Cannot get CanvasRenderingContext2D\");\r\n        this.ctx = ctx;\r\n\r\n        this.processes.push(\r\n            new TransformProcess(),\r\n            new RectRenderer(),\r\n            new CircleRenderer(),\r\n            new ImageRenderer(),\r\n            new PolylineRenderer(),\r\n            new CurveRenderer(),\r\n            new PathRenderer(),\r\n        );\r\n        this.bboxProcess = new BoundingBoxProcess();\r\n    }\r\n    bboxProcess!: BoundingBoxProcess;\r\n    update(): void {\r\n        console.log('渲染')\r\n        this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n        const map = new Map<number | null, IShareContext>();\r\n        // 根节点的父节点的上下文\r\n        map.set(null, { dirty: false } as IShareContext);\r\n        const displayList = this.sceneTree.displayList;\r\n        for (let i = 0; i < displayList.length; i++) {\r\n            const [entityId, parentEntityId] = displayList[i];\r\n            if (!map.has(entityId)) map.set(entityId, {} as IShareContext);\r\n            const context = map.get(entityId)!;\r\n            const parentContext = map.get(parentEntityId)!;\r\n            for (const process of this.processes) {\r\n                if (process.match(this.ecs, entityId)) {\r\n                    process.exec(this, entityId, parentEntityId, context, parentContext);\r\n                }\r\n            }\r\n        }\r\n        for (let i = displayList.length - 1; i >= 0; i--) {\r\n            const [entityId, parentEntityId] = displayList[i];\r\n            const context = map.get(entityId)!;\r\n            const parentContext = map.get(parentEntityId)!;\r\n            this.bboxProcess.exec(this, entityId, parentEntityId, context, parentContext);\r\n        }\r\n    }\r\n}\r\n","import { ECS } from \"../../ecs/ECS.ts\";\r\nimport { IProcess } from \"../../ecs/interface/IRender.ts\";\r\nimport type { ISystem } from \"../../ecs/System.ts\";\r\nimport { IBoundingBoxStrategy } from \"./AABB.ts\";\r\nimport { CircleBoundingBox } from \"./CircleBoundingBox.ts\";\r\nimport { RectBoundingBox } from \"./RectBoundingBox.ts\";\r\nimport { ImageBoundingBox } from \"./ImageBoundingBox.ts\";\r\nimport { PolylineBoundingBox } from \"./PolylineBoundingBox.ts\";\r\nimport { CurveBoundingBox } from \"./CurveBoundingBox.ts\";\r\nimport { PathBoundingBox } from \"./PathBoundingBox.ts\";\r\n\r\nimport { IShareContext } from \"../../interface/System.ts\";\r\nexport class RenderableHitProcess implements IProcess {\r\n    match(_ecs: ECS, _entityId: number) {\r\n        return true\r\n    }\r\n    private strategies: IBoundingBoxStrategy[];\r\n    // 某一组子节点的包围盒，遍历完子节点后 更新\r\n    constructor() {\r\n        this.strategies = [];\r\n        this.strategies.push(new CircleBoundingBox());\r\n        this.strategies.push(new RectBoundingBox());\r\n        this.strategies.push(new ImageBoundingBox());\r\n        this.strategies.push(new PolylineBoundingBox());\r\n        this.strategies.push(new CurveBoundingBox());\r\n        this.strategies.push(new PathBoundingBox());\r\n    }\r\n    hit(ecs: ECS, entityId: number, x: number, y: number) {\r\n        for (const s of this.strategies) {\r\n            if (s.match(ecs, entityId)) {\r\n                return s.hit(ecs, entityId, x, y);\r\n            }\r\n        }\r\n        return false\r\n    }\r\n    exec(_system: ISystem, _entityId: number, _parentEntityId: number | null, _context: IShareContext, _parentContext: unknown) {\r\n    }\r\n}","// import { RenderComponent } from \"../components/render/RenderComponent.ts\";\r\nimport { IAABB } from \"../interface/AABB.ts\";\r\nimport { SceneNode } from \"../ecs/SceneTree.ts\";\r\nimport { ISystem } from \"../ecs/System.ts\";\r\nimport { BoundingBoxComponent } from \"../components/BoundingBoxComponent.ts\";\r\nimport { BoundingBoxProcess } from './AABB/aabbProcess.ts'\r\nimport { RenderableHitProcess } from './AABB/hitprocess.ts'\r\n\r\n\r\nimport { TransformProcess } from './TransformProcess.ts'\r\nimport { IShareContext } from \"../interface/System.ts\";\r\nexport class PickEntitySystem extends ISystem {\r\n    ctx!: CanvasRenderingContext2D;\r\n    eventEntities: number[] = [];\r\n    bboxProcess!: BoundingBoxProcess;\r\n    transformProcess!: TransformProcess;\r\n    RenderableHitProcess!: RenderableHitProcess;    \r\n    protected onInit(): void {\r\n        this.transformProcess = new TransformProcess();\r\n        this.bboxProcess = new BoundingBoxProcess();\r\n        this.RenderableHitProcess = new RenderableHitProcess();\r\n    }\r\n    hitAABB(x: number, y: number, box: IAABB) {\r\n        return x >= box.minX && y >= box.minY && x <= box.maxX && y <= box.maxY;\r\n    }\r\n    hitRenderable(x: number, y: number, entityId: number) {\r\n        return this.RenderableHitProcess.hit(this.ecs, entityId, x, y);\r\n    }\r\n    hitTree(x: number, y: number) {\r\n        const tree = this.sceneTree;\r\n        const visitHit = (node: SceneNode): SceneNode | null => {\r\n            if (node === null) return null;\r\n            const bbox = this.ecs.getComponent(node.entityId, BoundingBoxComponent)!;\r\n            if (!this.hitAABB(x, y, bbox.totalAABB)) return null;\r\n\r\n            // 逆序遍历子节点（后渲染的在前面）\r\n            for (let i = node.children.length - 1; i >= 0; i--) {\r\n                const hit = visitHit(node.children[i]);\r\n                if (hit) return hit;\r\n            }\r\n            // 再检测自身包围盒\r\n            if (this.hitAABB(x, y, bbox.selfAABB) && this.hitRenderable(x, y, node.entityId)) {\r\n                return node;\r\n            }\r\n            return null\r\n        }\r\n        const node = visitHit(tree.root);\r\n        return node !== null ? node.entityId : null\r\n    }\r\n    pickEntityAt(x: number, y: number) {\r\n        this.updateTree();\r\n        return this.hitTree(x, y);\r\n    }\r\n\r\n    updateTree() {\r\n        const map = new Map<number | null, IShareContext>();\r\n        // 根节点的父节点的上下文\r\n        map.set(null, { dirty: false } as IShareContext);\r\n        const displayList = this.sceneTree.displayList;\r\n        for (let i = 0; i < displayList.length; i++) {\r\n            const [entityId, parentEntityId] = displayList[i];\r\n            if (!map.has(entityId)) map.set(entityId, {} as IShareContext);\r\n            const context = map.get(entityId)!;\r\n            const parentContext = map.get(parentEntityId)!;\r\n            this.transformProcess.exec(this, entityId, parentEntityId, context, parentContext);\r\n        }\r\n        for (let i = displayList.length - 1; i >= 0; i--) {\r\n            const [entityId, parentEntityId] = displayList[i];\r\n            const context = map.get(entityId)!;\r\n            const parentContext = map.get(parentEntityId)!;\r\n            this.bboxProcess.exec(this, entityId, parentEntityId, context, parentContext);\r\n        }\r\n    }\r\n    update() { }\r\n}","// 文件：ecs/EngineEvent.ts\r\n\r\nimport { IEngine } from \"./interface/IEngine.ts\";\r\n\r\n/**\r\n * 泛型事件系统（零 any 版本）\r\n * 支持类型安全的 on/off/emit 调用\r\n */\r\nexport class EngineEvent<\r\n  // ✅ 改动：允许任意接口（不强制 Record<string, ...>）\r\n  T extends { [K in keyof T]: (...args: never[]) => void } = IEngine\r\n> {\r\n  private listeners: {\r\n    [K in keyof T]?: Set<T[K]>;\r\n  } = {};\r\n\r\n  /** 监听事件 */\r\n  on<K extends keyof T>(event: K, callback: T[K]): void {\r\n    (this.listeners[event] ??= new Set()).add(callback);\r\n  }\r\n\r\n  /** 取消监听 */\r\n  off<K extends keyof T>(event: K, callback?: T[K]): void {\r\n    if (callback) this.listeners[event]?.delete(callback);\r\n    else delete this.listeners[event];\r\n  }\r\n\r\n  /** 触发事件 */\r\n  emit<K extends keyof T>(event: K, ...args: Parameters<T[K]>): void {\r\n    const set = this.listeners[event];\r\n    if (!set) return;\r\n    for (const cb of set) cb(...args);\r\n  }\r\n\r\n  /** 清除监听器 */\r\n  clear<K extends keyof T>(event?: K): void {\r\n    if (event) delete this.listeners[event];\r\n    else this.listeners = {};\r\n  }\r\n}\r\n","import { ISystem } from \"../ecs/System.ts\";\r\nimport { SceneTree } from \"../ecs/SceneTree.ts\";\r\nimport { IProcess } from \"../ecs/interface/IRender.ts\";\r\nimport { Engine } from \"../ecs/Engine.ts\";\r\nimport { IShareContext } from \"../interface/System.ts\";\r\nimport { BoundingBoxComponent } from \"../main.ts\";\r\nimport { IAABB } from \"../interface/AABB.ts\";\r\nexport class BoxDebugSystem extends ISystem {\r\n\r\n    ctx!: CanvasRenderingContext2D;\r\n    constructor(public engine: Engine, public sceneTree: SceneTree) {\r\n        super(engine, sceneTree);\r\n    }\r\n    processes: IProcess<{ dirty: boolean }, { dirty: boolean }>[] = [];\r\n    protected onInit(): void {\r\n        const canvas = this.ecs.canvas;\r\n        if (!canvas) throw new Error(\"Canvas not set on ECS\");\r\n        const ctx = canvas.getContext(\"2d\");\r\n        if (!ctx) throw new Error(\"Cannot get CanvasRenderingContext2D\");\r\n        this.ctx = ctx;\r\n    }\r\n\r\n    update(): void {\r\n        if (!(this.engine).boxDebug) return;\r\n        // this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n        const map = new Map<number | null, IShareContext>();\r\n        // 根节点的父节点的上下文\r\n        map.set(null, { dirty: false } as IShareContext);\r\n        const displayList = this.sceneTree.displayList;\r\n        for (let i = displayList.length - 1; i >= 0; i--) {\r\n            const [entityId, _parentEntityId] = displayList[i];\r\n            if (!map.has(entityId)) map.set(entityId, {} as IShareContext);\r\n            this.drawTotal(entityId);\r\n            // this.drawChildren(entityId);\r\n            this.drawSelf(entityId);\r\n        }\r\n    }\r\n    drawSelf(entityId: number,): void {\r\n        const bbox = this.ecs.getComponent(entityId, BoundingBoxComponent)!;\r\n        if (!bbox) return;\r\n        this.draw(bbox.totalAABB, '#ff0000', 1);\r\n    }\r\n    drawTotal(entityId: number,): void {\r\n        const bbox = this.ecs.getComponent(entityId, BoundingBoxComponent)!;\r\n        if (!bbox) return;\r\n        this.draw(bbox.selfAABB, 'blue', 3);\r\n    }\r\n    drawChildren(entityId: number,): void {\r\n        const bbox = this.ecs.getComponent(entityId, BoundingBoxComponent)!;\r\n        if (!bbox) return;\r\n        this.draw(bbox.childrenAABB, 'green', 2);\r\n    }\r\n\r\n    draw(aabb: IAABB, color: string = '#ff0000', width: number = 1): void {\r\n        const ctx = this.ctx;\r\n        ctx.save()\r\n        ctx.beginPath()\r\n        ctx.moveTo(aabb.minX, aabb.minY)\r\n        ctx.lineTo(aabb.maxX, aabb.minY)\r\n        ctx.lineTo(aabb.maxX, aabb.maxY)\r\n        ctx.lineTo(aabb.minX, aabb.maxY)\r\n        ctx.closePath()\r\n        ctx.strokeStyle = color\r\n        ctx.lineWidth = width\r\n        ctx.stroke()\r\n        ctx.restore()\r\n    }\r\n}\r\n","import { Component } from \"../ecs/decorators/Component.ts\";\r\nimport { IComponent } from \"../ecs/interface/IComponent.ts\";\r\n\r\nexport type IEventType =\r\n    | \"click\" | \"dblclick\"\r\n    | \"mousedown\" | \"mouseup\" | \"mousemove\" | \"contextmenu\" | \"wheel\"\r\n    | \"touchstart\" | \"touchmove\" | \"touchend\" | \"touchcancel\"\r\n    | \"pointerdown\" | \"pointermove\" | \"pointerup\" | \"pointercancel\";\r\n\r\nexport type IScreenEvent = MouseEvent | PointerEvent | WheelEvent | TouchEvent;\r\nexport type EventCallback = (event: IScreenEvent, entityId: number) => boolean | void;\r\n\r\n@Component(\"Event\")\r\nexport class EventComponent implements IComponent {\r\n    public events = new Map<IEventType, EventCallback[]>();\r\n\r\n    /** 注册事件 */\r\n    on(type: IEventType, callback: EventCallback) {\r\n        if (!this.events.has(type)) this.events.set(type, []);\r\n        this.events.get(type)!.push(callback);\r\n    }\r\n\r\n    /** 移除事件 */\r\n    off(type: IEventType, callback?: EventCallback) {\r\n        if (!callback) {\r\n            this.events.delete(type);\r\n        } else {\r\n            const arr = this.events.get(type);\r\n            if (!arr) return;\r\n            this.events.set(type, arr.filter(cb => cb !== callback));\r\n        }\r\n    }\r\n\r\n    /** 触发事件，返回 true 表示阻止冒泡 */\r\n    emit(type: IEventType, event: IScreenEvent, entityId: number) {\r\n        const arr = this.events.get(type);\r\n        if (!arr) return false;\r\n\r\n        let stop = false;\r\n        for (const cb of arr) {\r\n            const result = cb(event, entityId);\r\n            if (result === true) stop = true;\r\n        }\r\n        return stop;\r\n    }\r\n}\r\n","import { ISystem } from \"../ecs/System.ts\";\r\nimport { EventComponent, IEventType, IScreenEvent } from \"../components/Event.ts\";\r\nimport { SceneNode } from \"../ecs/SceneTree.ts\";\r\nimport { PickEntitySystem } from \"./PickEntitySystem.ts\";\r\n/**\r\n * EventSystem：仅处理具有屏幕坐标的输入事件\r\n * 包含鼠标、触摸、指针、滚轮等\r\n */\r\nexport class EventSystem extends ISystem {\r\n    protected onInit(): void {\r\n        this.initPointerEvents();\r\n    }\r\n\r\n    /** 初始化事件监听 */\r\n    private initPointerEvents() {\r\n        const canvas = (this.ecs as any).canvas as HTMLCanvasElement;\r\n        if (!canvas) throw new Error(\"ECS.canvas 未设置\");\r\n\r\n        const eventTypes: IEventType[] = [\r\n            // 鼠标事件\r\n            \"click\",\r\n            // \"dblclick\",\r\n            // \"mousedown\",\r\n            // \"mouseup\",\r\n            // \"mousemove\",\r\n            // \"contextmenu\",\r\n            // \"wheel\",\r\n\r\n            // // 触摸事件\r\n            // \"touchstart\",\r\n            // \"touchmove\",\r\n            // \"touchend\",\r\n            // \"touchcancel\",\r\n\r\n            // // 指针事件\r\n            // \"pointerdown\",\r\n            // \"pointermove\",\r\n            // \"pointerup\",\r\n            // \"pointercancel\",\r\n        ];\r\n\r\n        for (const type of eventTypes) {\r\n            canvas.addEventListener(type, (e) => this.handleEvent(e as IScreenEvent, type));\r\n        }\r\n    }\r\n\r\n    /** 提取带坐标的事件类型 */\r\n    private handleEvent(e: IScreenEvent, type: IEventType) {\r\n        const canvas = (this.ecs as any).canvas as HTMLCanvasElement;\r\n        const rect = canvas.getBoundingClientRect();\r\n\r\n        // 计算坐标\r\n        let x = 0, y = 0;\r\n\r\n        if (\"clientX\" in e && \"clientY\" in e) {\r\n            // 鼠标、指针、滚轮事件\r\n            x = e.clientX - rect.left;\r\n            y = e.clientY - rect.top;\r\n        } else if (\"touches\" in e && e.touches.length > 0) {\r\n            // 触摸事件\r\n            const t = e.touches[0];\r\n            x = t.clientX - rect.left;\r\n            y = t.clientY - rect.top;\r\n        }\r\n\r\n        // 命中检测\r\n        const entityId = this.ecs.getSystem(PickEntitySystem).pickEntityAt(x, y);\r\n        if (entityId == null) return;\r\n\r\n        this.propagateEvent(entityId, type, e);\r\n    }\r\n\r\n    /** 冒泡事件分发 */\r\n    private propagateEvent(entityId: number, type: IEventType, e: IScreenEvent) {\r\n        let node: SceneNode | null = this.sceneTree.get(entityId);\r\n        while (node) {\r\n            const ev = this.ecs.getComponent(node.entityId, EventComponent);\r\n            if (ev) {\r\n                const stop = ev.emit(type, e, node.entityId);\r\n                if (stop) break; // 阻止冒泡\r\n            }\r\n            node = node.parent;\r\n        }\r\n    }\r\n\r\n    update(): void {}\r\n}\r\n","import { ECS } from \"./ECS.ts\";\r\nimport { Ticker } from \"./Ticker.ts\";\r\nimport { SceneTree } from \"../ecs/SceneTree\";\r\nimport { RootEntity } from \"./RootEntity.ts\";\r\nimport { SceneTreeRenderSystem } from \"../systems/SceneTreeRenderSystem.ts\";\r\nimport { PickEntitySystem } from \"../systems/PickEntitySystem.ts\";\r\nimport { IEngine } from \"./interface/IEngine.ts\";\r\nimport { EngineEvent } from \"./EngineEvent.ts\";\r\nimport { BoxDebugSystem } from \"../systems/BoxDebugSystem.ts\";\r\nimport { EventSystem } from \"../systems/EventSystem.ts\";\r\nexport class Engine implements IEngine {\r\n    public boxDebug: boolean = false;\r\n    public ecs: ECS;\r\n    private ticker: Ticker;\r\n    public sceneTree: SceneTree;\r\n    public rootEntity: RootEntity;\r\n    public event: EngineEvent<IEngine>;\r\n    constructor(canvas: HTMLCanvasElement) {\r\n        this.event = new EngineEvent();\r\n        this.ecs = new ECS();\r\n        this.ecs.canvas = canvas;\r\n        this.rootEntity = new RootEntity(this);\r\n        this.sceneTree = new SceneTree(this.rootEntity.entityId);\r\n\r\n        // 注册系统\r\n        this.ecs.addSystem(new SceneTreeRenderSystem(this, this.sceneTree));\r\n        this.ecs.addSystem(new BoxDebugSystem(this, this.sceneTree));\r\n        this.ecs.addSystem(new PickEntitySystem(this, this.sceneTree));\r\n        this.ecs.addSystem(new EventSystem(this, this.sceneTree));\r\n        // 绑定 Ticker → ECS\r\n        this.ticker = new Ticker();\r\n        this.ticker.add((dt) => this.ecs.update(dt));\r\n    }\r\n    start() {\r\n        this.ticker.start();\r\n        this.event.emit(\"start\");\r\n    }\r\n\r\n    stop() {\r\n        this.ticker.stop();\r\n        this.event.emit(\"stop\");\r\n    }\r\n\r\n    /**\r\n     * 在场景树中添加一个实体\r\n     * @param entityId 新实体ID\r\n     * @param parentId 父实体ID, 默认挂到根节点\r\n     */\r\n    add(entityId: number, parentId?: number) {\r\n        if (!this.ecs.hasEntity(entityId)) throw new Error(`Entity ${entityId} not exists`);\r\n        if (parentId && !this.ecs.hasEntity(parentId)) throw new Error(`Parent entity ${parentId} not found`);\r\n        // 检查是否已存在\r\n        if (parentId && !this.sceneTree.has(parentId))\r\n            throw new Error(`Entity ${parentId} not exists`);\r\n        this.sceneTree.add(entityId, parentId);\r\n        // 通知系统添加实体\r\n        this.event.emit(\"add\", entityId);\r\n    }\r\n\r\n    /**\r\n     * 将子节点添加到父节点\r\n     */\r\n    setParent(parentId: number, childId: number,) {\r\n        if (!this.ecs.hasEntity(childId)) throw new Error(`Entity ${childId} not exists`);\r\n        if (parentId && !this.ecs.hasEntity(parentId)) throw new Error(`Parent entity ${parentId} not found`);\r\n        // 检查树中是否存在\r\n        if (!this.sceneTree.has(parentId))\r\n            throw new Error(`Entity ${parentId} not exists`);\r\n        const parentNode = this.sceneTree.get(parentId);\r\n        const childNode = this.sceneTree.get(childId);\r\n\r\n        parentNode.addChild(childNode);\r\n        // 通知系统设置父节点\r\n        this.event.emit(\"setParent\", parentId, childId);\r\n    }\r\n\r\n    /**\r\n     * 删除实体及其子节点\r\n     */\r\n    remove(entityId: number) {\r\n        this.sceneTree.destory(entityId);\r\n        this.ecs.removeEntity(entityId);\r\n        // 通知系统删除实体\r\n        this.event.emit(\"remove\", entityId);\r\n    }\r\n\r\n    /**\r\n     * 获取实体的父节点\r\n     */\r\n    getParent(entityId: number) {\r\n        return this.sceneTree.getParent(entityId);\r\n    }\r\n\r\n    /**\r\n     * 获取实体对应的 SceneNode\r\n     */\r\n    getNode(entityId: number) {\r\n        return this.sceneTree.get(entityId);\r\n    }\r\n\r\n    /**\r\n     * 清空场景树（保留根节点）\r\n     */\r\n    clear() {\r\n        this.sceneTree.clear();\r\n        // 通知系统清空场景树\r\n        this.event.emit(\"clear\");\r\n    }\r\n}\r\n","/**\r\n * 异步加载图片并返回 ImageBitmap\r\n * @param url 图片地址\r\n * @param crop 可选裁剪区域：[sx, sy, sw, sh]\r\n * @param options 可选 createImageBitmap 参数\r\n */\r\nexport async function loadImageBitmap(\r\n  url: string,\r\n  crop?: [number, number, number, number],\r\n  options?: ImageBitmapOptions\r\n): Promise<ImageBitmap> {\r\n  try {\r\n    const response = await fetch(url, { mode: \"cors\" });\r\n    if (!response.ok) {\r\n      throw new Error(`Failed to load image: ${url}, status ${response.status}`);\r\n    }\r\n\r\n    const blob = await response.blob();\r\n\r\n    // 根据是否提供 crop 决定调用方式\r\n    if (crop) {\r\n      const [sx, sy, sw, sh] = crop;\r\n      return await createImageBitmap(blob, sx, sy, sw, sh, options);\r\n    } else {\r\n      return await createImageBitmap(blob, options);\r\n    }\r\n  } catch (err) {\r\n    console.error(\"loadImageBitmap error:\", err);\r\n    throw err;\r\n  }\r\n}\r\n"],"names":["EntityManager","id","ComponentManager","entityId","component","type","store","componentClass","ComponentRegistry","Archetype","componentTypes","c","components","col","comp","index","queryComponents","ArchetypeManager","comps","key","archetype","oldArchetype","newArchetype","componentClasses","RenderComponent","#engine","engine","EntityComponentManager","renderClass","oldComp","ECSEvent","event","listener","set","args","fn","ECS","#system","system","systemClass","delta","sys","name","archetypes","result","arch","Ticker","callback","i","now","dt","cb","SceneNode","child","idx","SceneTree","rootEntityId","parentId","node","parentNode","descendants","desc","rootContext","reverse","newCaches","map","visit","parentEntityId","parentContext","context","loop","parent","Reflect","factory","root","global","sloppyModeThis","exporter","makeExporter","target","previous","value","functionThis","indirectEvalThis","hasOwn","supportsSymbol","toPrimitiveSymbol","iteratorSymbol","supportsCreate","supportsProto","downLevel","HashMap","MakeDictionary","functionPrototype","_Map","CreateMapPolyfill","_Set","CreateSetPolyfill","_WeakMap","CreateWeakMapPolyfill","registrySymbol","metadataRegistry","GetOrCreateMetadataRegistry","metadataProvider","CreateMetadataProvider","decorate","decorators","propertyKey","attributes","IsUndefined","IsArray","IsConstructor","DecorateConstructor","IsObject","IsNull","ToPropertyKey","DecorateProperty","metadata","metadataKey","metadataValue","decorator","IsPropertyKey","OrdinaryDefineOwnMetadata","defineMetadata","hasMetadata","OrdinaryHasMetadata","hasOwnMetadata","OrdinaryHasOwnMetadata","getMetadata","OrdinaryGetMetadata","getOwnMetadata","OrdinaryGetOwnMetadata","getMetadataKeys","OrdinaryMetadataKeys","getOwnMetadataKeys","OrdinaryOwnMetadataKeys","deleteMetadata","provider","GetMetadataProvider","decorated","descriptor","MetadataKey","O","P","OrdinaryGetPrototypeOf","ToBoolean","MetadataValue","ownKeys","parentKeys","keys","_i","ownKeys_1","hasKey","_a","parentKeys_1","Type","x","IsSymbol","ToPrimitive","input","PreferredType","hint","exoticToPrim","GetMethod","OrdinaryToPrimitive","valueOf","toString_2","toString_1","IsCallable","argument","ToString","SameValueZero","y","V","func","GetIterator","obj","method","iterator","IteratorValue","iterResult","IteratorStep","IteratorClose","proto","prototype","prototypeProto","constructor","CreateMetadataRegistry","fallback","CreateFallbackProvider","first","second","rest","targetProviderMap","registry","registerProvider","getProvider","setProvider","getProviderNoCache","next","providerMap","hasProvider","existingProvider","targetMetadata","OrdinaryDeleteMetadata","GetOrCreateMetadataMap","Create","createdTargetMetadata","metadataMap","keysObj","k","nextValue","e","reflect","metadataOwner","metadataPropertySet","registeredProvider","cacheSentinel","arraySentinel","MapIterator","values","selector","error","Map","size","getKey","getValue","getEntry","insert","_","Set","UUID_SIZE","rootKey","CreateUniqueKey","WeakMap","table","GetOrCreateWeakMapTable","CreateUUID","create","FillRandomBytes","buffer","GenRandomBytes","array","data","offset","byte","Component","ctor","ARRAY_TYPE","out","glMatrix.ARRAY_TYPE","copy","a","fromValues","m00","m01","m02","m10","m11","m12","m20","m21","m22","identity","invert","a00","a01","a02","a10","a11","a12","a20","a21","a22","b01","b11","b21","det","multiply","b","b00","b02","b10","b12","b20","b22","translate","v","rotate","rad","s","scale","transformMat3","m","vec","stride","count","arg","l","_x","_y","_scaleX","_scaleY","_rotation","_skewX","_skewY","_pivotX","_pivotY","_engine","Transform","params","__privateAdd","__publicField","mat3.create","__privateSet","__privateGet","__decorateClass","RootEntity","ISystem","sceneTree","ecs","Rect","width","height","fillStyle","strokeStyle","lineWidth","alpha","render","radius","RectRenderer","ctx","transform","rect","Circle","radiusY","rotation","startAngle","endAngle","clockwise","CircleRenderer","circle","_bitmap","_width","_height","Image","ImageRenderer","image","clipX","clipY","clipW","clipH","BoundingBoxComponent","aabb","px","py","box","a1","a2","unit","TransformProcess","_parentEntityId","boundingBox","mat3.identity","mat3.translate","mat3.rotate","skewMat","mat3.fromValues","mat3.multiply","mat3.scale","parentMatrix","mat3.copy","CircleBoundingBox","cx","cy","d","rx","ry","cosR","sinR","halfW","halfH","angles","criticalAngles","minX","minY","maxX","maxY","angle","rxRot","ryRot","inv","mat3.invert","local","vec2.fromValues","vec2.transformMat3","lx","ly","tmpX","tmpY","dx","dy","distance","t_p","inArc","startX","startY","endX","endY","polygon","start","end","p","inside","j","xi","yi","xj","yj","RectBoundingBox","pivotX","pivotY","worldPoints","vec2.create","corners","cornerChecks","ImageBoundingBox","img","worldPts","wp","Polyline","points","closed","PolylineBoundingBox","polyline","pts","p1","p2","x1","y1","x2","y2","t","clampedT","closestX","closestY","Curve","opts","CurveBoundingBox","curve","steps","u","minDist","Path","options","cmd","path","PathBoundingBox","lastPos","cos","sin","hasClose","tt","stepAngle","x3","y3","r","dx1","dy1","dx2","dy2","angleDiff","centerAngle","BoundingBoxProcess","_ecs","_entityId","bbox","selfAABB","parentBBox","PathRenderer","PolylineRenderer","CurveRenderer","SceneTreeRenderSystem","canvas","displayList","process","RenderableHitProcess","_system","_context","_parentContext","PickEntitySystem","tree","visitHit","hit","EngineEvent","BoxDebugSystem","color","EventComponent","arr","stop","EventSystem","eventTypes","ev","Engine","childId","childNode","loadImageBitmap","url","crop","response","blob","sx","sy","sw","sh","err"],"mappings":"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","x_google_ignoreList":[11,13,14,15]}