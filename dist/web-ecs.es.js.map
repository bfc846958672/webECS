{"version":3,"file":"web-ecs.es.js","sources":["../src/ecs/EntityManager.ts","../src/ecs/ComponentManager.ts","../src/ecs/registry/ComponentRegistry.ts","../src/ecs/Archetype.ts","../src/ecs/ArchetypeManager.ts","../src/components/render/RenderComponent.ts","../src/ecs/EntityComponentManager.ts","../src/ecs/ECSEvent.ts","../src/ecs/ECS.ts","../src/ecs/Ticker.ts","../src/ecs/SceneTree.ts","../node_modules/.pnpm/reflect-metadata@0.2.2/node_modules/reflect-metadata/Reflect.js","../src/ecs/decorators/Component.ts","../node_modules/.pnpm/gl-matrix@3.4.4/node_modules/gl-matrix/esm/common.js","../node_modules/.pnpm/gl-matrix@3.4.4/node_modules/gl-matrix/esm/mat3.js","../node_modules/.pnpm/gl-matrix@3.4.4/node_modules/gl-matrix/esm/vec2.js","../src/components/Transform.ts","../src/ecs/RootEntity.ts","../src/ecs/System.ts","../src/components/render/Rect.ts","../src/systems/render/RectRenderer.ts","../src/components/render/Circle.ts","../src/systems/render/CircleRenderer.ts","../src/components/render/Image.ts","../src/systems/render/ImageRenderer.ts","../src/components/BoundingBoxComponent.ts","../src/systems/TransformProcess.ts","../src/systems/AABB/CircleBoundingBox.ts","../src/systems/AABB/RectBoundingBox.ts","../src/systems/AABB/ImageBoundingBox.ts","../src/components/render/Polyline.ts","../src/systems/AABB/PolylineBoundingBox.ts","../src/components/render/Curve.ts","../src/systems/AABB/CurveBoundingBox.ts","../src/components/render/Path.ts","../src/systems/AABB/PathBoundingBox.ts","../src/systems/AABB/aabbProcess.ts","../src/systems/render/PathRenderer.ts","../src/systems/render/PolylineRenderer.ts","../src/systems/render/CurveRenderer.ts","../src/systems/SceneTreeRenderSystem.ts","../src/systems/AABB/hitprocess.ts","../src/systems/PickEntitySystem.ts","../src/ecs/EngineEvent.ts","../src/systems/BoxDebugSystem.ts","../src/components/Event.ts","../src/systems/EventSystem.ts","../src/ecs/Engine.ts","../src/utils/fetchImage.ts"],"sourcesContent":["export class EntityManager {\r\n    private nextId: number = 0;\r\n    private entities: Set<number> = new Set();\r\n\r\n    /** 创建实体 */\r\n    createEntity(): number {\r\n        const id = this.nextId++;\r\n        this.entities.add(id);\r\n        return id;\r\n    }\r\n\r\n    /** 删除实体 */\r\n    removeEntity(id: number) {\r\n        this.entities.delete(id);\r\n    }\r\n\r\n    /** 是否存在 */\r\n    hasEntity(id: number): boolean {\r\n        return this.entities.has(id);\r\n    }\r\n\r\n    /** 获取所有实体 */\r\n    getAllEntities(): number[] {\r\n        return Array.from(this.entities);\r\n    }\r\n}\r\n\r\n// 使用\r\n","/**\r\n * ComponentManager - 类型安全版\r\n * 用泛型约束组件类型，移除 any\r\n */\r\n\r\nexport class ComponentManager {\r\n    // 每种组件类型对应一个 Map<entityId, component>\r\n    private componentsByType = new Map<Function, Map<number, unknown>>();\r\n\r\n    /** 添加组件 */\r\n    addComponent<T extends object>(entityId: number, component: T): void {\r\n        const type = component.constructor;\r\n        let store = this.componentsByType.get(type);\r\n        if (!store) {\r\n            store = new Map<number, T>();\r\n            this.componentsByType.set(type, store);\r\n        }\r\n        (store as Map<number, T>).set(entityId, component);\r\n    }\r\n\r\n    /** 移除组件 */\r\n    removeComponent<T extends object>(entityId: number, componentClass: new (...args: any[]) => T): void {\r\n        const store = this.componentsByType.get(componentClass);\r\n        (store as Map<number, T> | undefined)?.delete(entityId);\r\n    }\r\n\r\n    /** 获取组件 */\r\n    getComponent<T extends object>(entityId: number, componentClass: new (...args: any[]) => T): T | undefined {\r\n        const store = this.componentsByType.get(componentClass);\r\n        return (store as Map<number, T> | undefined)?.get(entityId);\r\n    }\r\n\r\n    /** 获取拥有该组件的所有实体 */\r\n    getEntitiesWithComponent<T extends object>(componentClass: new (...args: any[]) => T): number[] {\r\n        const store = this.componentsByType.get(componentClass);\r\n        return store ? Array.from((store as Map<number, T>).keys()) : [];\r\n    }\r\n\r\n    /** 检查实体是否有该组件 */\r\n    hasComponent<T extends object>(entityId: number, componentClass: new (...args: any[]) => T): boolean {\r\n        const store = this.componentsByType.get(componentClass);\r\n        return (store as Map<number, T> | undefined)?.has(entityId) ?? false;\r\n    }\r\n}\r\n","export const ComponentRegistry = new Map<string, Function>();","import { IComponent } from \"./interface/IComponent.ts\";\r\n\r\n/**\r\n * Archetype：管理一组固定组件组合的实体集合\r\n * 只负责列式存储和实体的增删\r\n */\r\nexport class Archetype {\r\n  /** 实体ID数组 */\r\n  public entities: number[] = [];\r\n\r\n  /** 组件类型集合（固定） */\r\n  public componentTypes: Set<Function>;\r\n\r\n  /** 列式存储：组件类型 -> 对应组件实例数组 */\r\n  public columns: Map<Function, IComponent[]> = new Map();\r\n\r\n  constructor(componentTypes: Set<Function>) {\r\n    this.componentTypes = componentTypes;\r\n    for (const c of componentTypes) {\r\n      this.columns.set(c, []);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 添加实体及对应组件实例\r\n   * @param entityId 实体ID\r\n   * @param components Map<组件类, 组件实例>，必须包含该 Archetype 的所有组件\r\n   */\r\n  add(entityId: number, components: Map<Function, IComponent>) {\r\n    this.entities.push(entityId);\r\n    for (const c of this.componentTypes) {\r\n      const col = this.columns.get(c)!;\r\n      const comp = components.get(c);\r\n      if (!comp) {\r\n        throw new Error(`Missing component ${c.name} for entity ${entityId}`);\r\n      }\r\n      col.push(comp);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 从 Archetype 移除实体及对应组件实例\r\n   */\r\n  remove(entityId: number) {\r\n    const index = this.entities.indexOf(entityId);\r\n    if (index === -1) return;\r\n\r\n    this.entities.splice(index, 1);\r\n    for (const col of this.columns.values()) {\r\n      col.splice(index, 1); // 保持列对齐\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 判断 Archetype 是否包含指定组件集合（子集匹配）\r\n   */\r\n  matches(queryComponents: Function[]): boolean {\r\n    return queryComponents.every(c => this.componentTypes.has(c));\r\n  }\r\n\r\n  /**\r\n   * 获取实体对应组件实例\r\n   */\r\n  getComponent<T extends IComponent>(entityId: number, componentClass: Function): T | undefined {\r\n    const index = this.entities.indexOf(entityId);\r\n    if (index === -1) return undefined;\r\n    const col = this.columns.get(componentClass);\r\n    return col ? (col[index] as T) : undefined;\r\n  }\r\n}\r\n","import { Archetype } from \"./Archetype.ts\";\r\nimport { IComponent } from \"./interface/IComponent.ts\";\r\n\r\nexport class ArchetypeManager {\r\n    private entityArchetypeMap: Map<number, Archetype> = new Map();\r\n    private archetypeMap: Map<string, Archetype> = new Map();\r\n\r\n    /** 生成组件组合 key */\r\n    private getComponentKey(components: Set<Function>): string {\r\n        return Array.from(components).map(c => c.name).sort().join(\"|\");\r\n    }\r\n\r\n    /** 获取或创建 Archetype */\r\n    getOrCreateArchetype(comps: Map<Function, IComponent>): Archetype {\r\n        const key = this.getComponentKey(new Set(comps.keys()));\r\n        let archetype = this.archetypeMap.get(key);\r\n        if (!archetype) {\r\n            archetype = new Archetype(new Set(comps.keys()));\r\n            this.archetypeMap.set(key, archetype);\r\n        }\r\n        return archetype;\r\n    }\r\n\r\n    /** 迁移实体到新的 Archetype */\r\n    migrateEntity(entityId: number, comps: Map<Function, IComponent>) {\r\n        const oldArchetype = this.entityArchetypeMap.get(entityId);\r\n        if (oldArchetype) oldArchetype.remove(entityId);\r\n\r\n        const newArchetype = this.getOrCreateArchetype(comps);\r\n        newArchetype.add(entityId, comps);\r\n        this.entityArchetypeMap.set(entityId, newArchetype);\r\n    }\r\n\r\n    /** 获取实体对应的 Archetype */\r\n    getArchetypeOf(entityId: number): Archetype | undefined {\r\n        return this.entityArchetypeMap.get(entityId);\r\n    }\r\n\r\n    /** 查询 Archetypes */\r\n    queryArchetypes(componentClasses: Function[]): Archetype[] {\r\n        const key = this.getComponentKey(new Set(componentClasses));\r\n        const archetype = this.archetypeMap.get(key);\r\n        return archetype ? [archetype] : [];\r\n    }\r\n\r\n    /** 删除实体 */\r\n    removeEntity(entityId: number) {\r\n        const archetype = this.entityArchetypeMap.get(entityId);\r\n        if (archetype) archetype.remove(entityId);\r\n        this.entityArchetypeMap.delete(entityId);\r\n    }\r\n}\r\n","import { IComponent } from \"../../ecs/interface/IComponent\";\r\nimport { Engine } from \"../../ecs/Engine.ts\";\r\n/**\r\n * 渲染组件，保证实体仅有一个渲染组件\r\n */\r\nexport class RenderComponent implements IComponent {\r\n  #engine: Engine | null;\r\n  constructor(engine: Engine | null, { }: Partial<RenderComponent> = {}) {\r\n    this.#engine = engine;\r\n    this.#engine;\r\n  }\r\n}\r\n\r\n","import { RenderComponent } from \"../components/render/RenderComponent.ts\";\r\nimport { IComponent, ComponentConstructor } from \"./interface/IComponent.ts\";\r\ntype IComponentClass = ComponentConstructor<IComponent>;\r\nexport class EntityComponentManager {\r\n    // 保证只有一个渲染组件\r\n    private renderMap = new Map<number, IComponentClass>();\r\n    // 实体 ==> 组件映射表\r\n    private map = new Map<number, Map<IComponentClass, IComponent>>();\r\n    // 新增：组件实例 ==> 实体映射\r\n    private componentEntityMap = new Map<IComponent, number>();\r\n\r\n    getComponentsMap(entityId: number): Map<IComponentClass, IComponent> | undefined {\r\n        return this.map.get(entityId);\r\n    }\r\n    isRenderComponent(component: IComponent) {\r\n        return component instanceof RenderComponent;\r\n    }\r\n    addComponent(entityId: number, component: IComponent) {\r\n        if (!this.map.has(entityId)) {\r\n            this.map.set(entityId, new Map());\r\n        }\r\n        const components = this.map.get(entityId)!;\r\n        const componentClass = component.constructor as IComponentClass;\r\n\r\n        // 如果是渲染组件，保证唯一\r\n        if (this.isRenderComponent(component)) {\r\n            const renderClass = this.renderMap.get(entityId);\r\n            if (renderClass) {\r\n                const oldComp = components.get(renderClass);\r\n                if (oldComp) this.componentEntityMap.delete(oldComp); //  删除旧映射\r\n                components.delete(renderClass);\r\n            }\r\n            this.renderMap.set(entityId, componentClass);\r\n        }\r\n\r\n        components.set(componentClass, component);\r\n        this.componentEntityMap.set(component, entityId); // 新增映射\r\n    }\r\n\r\n    removeEntity(entityId: number) {\r\n        const comps = this.map.get(entityId);\r\n        if (comps) {\r\n            for (const comp of comps.values()) {\r\n                this.componentEntityMap.delete(comp);\r\n            }\r\n        }\r\n        this.map.delete(entityId);\r\n        this.renderMap.delete(entityId);\r\n    }\r\n\r\n    removeComponent(entityId: number, componentClass: IComponentClass) {\r\n        if (componentClass === RenderComponent) {\r\n            this.renderMap.delete(entityId);\r\n        }\r\n        const comps = this.map.get(entityId);\r\n        if (!comps) return;\r\n\r\n        const comp = comps.get(componentClass);\r\n        if (comp) this.componentEntityMap.delete(comp); // 删除映射\r\n        comps.delete(componentClass);\r\n\r\n        if (comps.size === 0) {\r\n            this.map.delete(entityId);\r\n        }\r\n    }\r\n\r\n    getComponent<T extends IComponent>(entityId: number, componentClass: ComponentConstructor<T>): T | undefined {\r\n        return this.map.get(entityId)?.get(componentClass) as T | undefined;\r\n    }\r\n\r\n    getComponents(entityId: number) {\r\n        return this.map.get(entityId);\r\n    }\r\n\r\n    hasComponent(entityId: number, componentClass: IComponentClass): boolean {\r\n        return this.map.get(entityId)?.has(componentClass) ?? false;\r\n    }\r\n\r\n    /** 新增方法：根据组件实例获取所属实体ID */\r\n    getEntityIdByComponent(component: IComponent) {\r\n        return this.componentEntityMap.get(component);\r\n    }\r\n}\r\n","import type { IComponent, ComponentConstructor } from \"./interface/IComponent.ts\";\r\n\r\n/** 定义 ECS 事件及其参数类型 */\r\nexport interface ECSEventMap {\r\n  create_entity: [entityId: number];\r\n  remove_entity: [entityId: number];\r\n  add_component: [entityId: number, component: IComponent];\r\n  remove_component: [entityId: number, componentClass: ComponentConstructor<IComponent>];\r\n  // 可以增加自定义事件\r\n  [key: string]: unknown[];\r\n}\r\n\r\n/** 事件监听器类型 */\r\ntype ECSEventListener<T extends unknown[]> = (...args: T) => void;\r\n\r\nexport class ECSEvent<Events extends ECSEventMap = ECSEventMap> {\r\n  private listeners: {\r\n    [K in keyof Events]?: Set<ECSEventListener<Events[K]>>;\r\n  } = {};\r\n\r\n  /** 注册事件监听 */\r\n  on<K extends keyof Events>(event: K, listener: ECSEventListener<Events[K]>): void {\r\n    if (!this.listeners[event]) {\r\n      this.listeners[event] = new Set();\r\n    }\r\n    this.listeners[event]!.add(listener);\r\n  }\r\n\r\n  /** 注销事件监听 */\r\n  off<K extends keyof Events>(event: K, listener?: ECSEventListener<Events[K]>): void {\r\n    const set = this.listeners[event];\r\n    if (!set) return;\r\n\r\n    if (listener) {\r\n      set.delete(listener);\r\n    } else {\r\n      delete this.listeners[event];\r\n    }\r\n  }\r\n\r\n  /** 触发事件 */\r\n  emit<K extends keyof Events>(event: K, ...args: Events[K]): void {\r\n    const set = this.listeners[event];\r\n    if (!set) return;\r\n\r\n    for (const fn of set) {\r\n      fn(...args);\r\n    }\r\n  }\r\n\r\n  /** 清空所有事件监听 */\r\n  clear(): void {\r\n    for (const key in this.listeners) {\r\n      delete this.listeners[key];\r\n    }\r\n  }\r\n}\r\n","import { EntityManager } from \"./EntityManager.ts\";\r\nimport { ComponentManager } from \"./ComponentManager.ts\";\r\nimport type { ISystem, ISystemClass } from \"./System.ts\";\r\nimport { IComponent, ComponentConstructor } from \"./interface/IComponent.ts\";\r\nimport { ComponentRegistry } from \"./registry/ComponentRegistry.ts\";\r\nimport { ArchetypeManager } from \"./ArchetypeManager.ts\";\r\nimport { EntityComponentManager } from \"./EntityComponentManager.ts\";\r\nimport { ECSEvent } from \"./ECSEvent.ts\";\r\nexport class ECS {\r\n    public canvas!: HTMLCanvasElement;  // 挂载 Canvas\r\n    public event = new ECSEvent();\r\n    public entities = new EntityManager();\r\n    public components = new ComponentManager();\r\n    private systems: ISystem[] = [];\r\n    public ComponentRegistry = ComponentRegistry;\r\n    // 简单 Map：实体ID -> 组件名 -> 组件实例\r\n    private entityComponents = new EntityComponentManager();\r\n\r\n    private archetypeManager = new ArchetypeManager();\r\n\r\n    #system: Map<ISystemClass, ISystem> = new Map();\r\n    addSystem(system: ISystem) {\r\n        system.init(this);\r\n        this.systems.push(system);\r\n        this.#system.set(system.constructor as ISystemClass, system);\r\n    }\r\n    getSystem<T extends ISystem>(systemClass: ISystemClass<T>): T {\r\n        return this.#system.get(systemClass) as T;\r\n    }\r\n    hasEntity(entityId: number) {\r\n        return this.entities.hasEntity(entityId);\r\n    }\r\n    createEntity() {\r\n        const entityId = this.entities.createEntity();\r\n        this.event.emit(\"create_entity\", entityId);\r\n        return entityId;\r\n    }\r\n    removeEntity(entityId: number) {\r\n        if (!this.hasEntity(entityId)) throw new Error(`Entity ${entityId} not exists`);\r\n        this.entities.removeEntity(entityId);\r\n        this.entityComponents.removeEntity(entityId);\r\n        this.archetypeManager.removeEntity(entityId);\r\n    }\r\n    update(delta: number) {\r\n        for (const sys of this.systems) sys.update(delta);\r\n    }\r\n    addComponent(entityId: number, component: IComponent) {\r\n        if (!this.hasEntity(entityId)) throw new Error(`Entity ${entityId} not exists`);\r\n        // 1️⃣ 检查组件是否注册\r\n        const name = Reflect.getMetadata(\"component:name\", component.constructor);\r\n        if (!this.ComponentRegistry.has(name)) {\r\n            throw new Error(`Component \"${name}\" is not registered!`);\r\n        }\r\n        this.entityComponents.addComponent(entityId, component);\r\n        const comps = this.entityComponents.getComponentsMap(entityId)!;\r\n        this.archetypeManager.migrateEntity(entityId, comps);\r\n\r\n        this.event.emit(\"add_component\", entityId, component);\r\n    }\r\n    removeComponent(entityId: number, componentClass: ComponentConstructor<IComponent>) {\r\n        if (!this.hasEntity(entityId)) throw new Error(`Entity ${entityId} not exists`);\r\n        this.entityComponents.removeComponent(entityId, componentClass);\r\n        const comps = this.entityComponents.getComponentsMap(entityId);\r\n\r\n        if (comps && comps.size > 0) {\r\n            this.archetypeManager.migrateEntity(entityId, comps);\r\n        } else {\r\n            this.archetypeManager.removeEntity(entityId);\r\n        }\r\n        this.event.emit(\"remove_component\", entityId, componentClass);\r\n    }\r\n\r\n\r\n    // ------------------ 查询组件 ------------------\r\n    getComponent<T extends IComponent>(entityId: number, componentClass: ComponentConstructor<T>): T | undefined {\r\n        return this.entityComponents.getComponent<T>(entityId, componentClass);\r\n    }\r\n    getComponents(entityId: number) {\r\n        return this.entityComponents.getComponents(entityId);\r\n    }\r\n    hasComponent<T extends IComponent>(entityId: number, componentClass: ComponentConstructor<T>): boolean {\r\n        return this.entityComponents.hasComponent(entityId, componentClass);\r\n    }\r\n\r\n    /** 返回拥有指定组件组合的实体列表 */\r\n    getEntitiesWith(components: ComponentConstructor<IComponent>[]): number[] {\r\n        const archetypes = this.archetypeManager.queryArchetypes(components);\r\n        const result: number[] = [];\r\n        for (const arch of archetypes) {\r\n            result.push(...arch.entities);\r\n        }\r\n        return result;\r\n    }\r\n   \r\n    getEntityIdByComponent(component: IComponent) {\r\n        return this.entityComponents.getEntityIdByComponent(component);\r\n    }\r\n}\r\n\r\n\r\n","export class Ticker {\r\n  private lastTime = 0;\r\n  private running = false;\r\n  private callbacks: ((dt: number) => void)[] = [];\r\n\r\n  constructor() {\r\n    this.loop = this.loop.bind(this); // 绑定 this 上下文\r\n  }\r\n\r\n  add(callback: (dt: number) => void) {\r\n    this.callbacks.push(callback);\r\n  }\r\n\r\n  remove(callback: (dt: number) => void) {\r\n    const i = this.callbacks.indexOf(callback);\r\n    if (i !== -1) this.callbacks.splice(i, 1);\r\n  }\r\n\r\n  start() {\r\n    if (this.running) return;\r\n    this.running = true;\r\n    this.lastTime = performance.now();\r\n    setInterval(() => {\r\n      this.loop(performance.now());\r\n    }, 20);\r\n  }\r\n\r\n  stop() {\r\n    this.running = false;\r\n  }\r\n\r\n  private loop(now: number) {\r\n    if (!this.running) return;\r\n    const dt = (now - this.lastTime) / 1000; // 秒为单位\r\n    this.lastTime = now;\r\n\r\n    for (const cb of this.callbacks) {\r\n      cb(dt);\r\n    }\r\n    // 递归调用，实现循环,暂时不使用 requestAnimationFrame\r\n    // requestAnimationFrame(this.loop);\r\n\r\n  }\r\n}\r\n","\r\n// SceneNode.ts\r\nexport class SceneNode {\r\n    public parent: SceneNode | null = null;\r\n    public children: SceneNode[] = [];\r\n    constructor(public entityId: number) { }\r\n\r\n    /**\r\n     * 添加子节点\r\n     * @param child SceneNode\r\n     */\r\n    addChild(child: SceneNode) {\r\n        if (child.parent) {\r\n            // 从原父节点移除\r\n            const idx = child.parent.children.indexOf(child);\r\n            if (idx !== -1) child.parent.children.splice(idx, 1);\r\n        }\r\n        child.parent = this;\r\n        this.children.push(child);\r\n    }\r\n    removeChild(child: SceneNode) {\r\n        const index = this.children.indexOf(child);\r\n        if (index === -1) {\r\n            throw new Error(`Cannot remove child: entity ${child.entityId} is not a child of entity ${this.entityId}`);\r\n        }\r\n        this.children.splice(index, 1);\r\n        child.parent = null;\r\n    }\r\n\r\n    /**\r\n     * 获取所有后代节点，深度优先顺序\r\n     */\r\n    getDescendants(): SceneNode[] {\r\n        const result: SceneNode[] = [];\r\n        for (const child of this.children) {\r\n            result.push(child);\r\n            result.push(...child.getDescendants());\r\n        }\r\n        return result;\r\n    }\r\n}\r\n\r\n/**\r\n * 场景树管理\r\n * - 使用单一根节点 rootNode\r\n * - 所有实体挂在根节点下或其子节点下\r\n */\r\nexport class SceneTree {\r\n    /** 节点映射: entityId -> SceneNode */\r\n    private nodes: Map<number, SceneNode> = new Map();\r\n    /** 隐形根节点 */\r\n    readonly root: SceneNode;\r\n\r\n    constructor(public rootEntityId: number) {\r\n        this.root = new SceneNode(rootEntityId);\r\n\r\n        this.nodes.set(rootEntityId, this.root);\r\n    }\r\n\r\n    /**\r\n     * 添加节点到场景树\r\n     * @param entityId 实体ID\r\n     * @param parentId 可选父节点ID, 默认挂到 rootNode\r\n     */\r\n    add(entityId: number, parentId?: number) {\r\n        this._version++;\r\n        if (!this.nodes.has(entityId)) { this.nodes.set(entityId, new SceneNode(entityId)); }\r\n        if (parentId === undefined) parentId = this.rootEntityId;\r\n\r\n        const node = this.nodes.get(entityId)!;\r\n        const parentNode = this.nodes.get(parentId)!;\r\n        node.parent = parentNode;\r\n        parentNode.children.push(node);\r\n        this.displayList = this.build();\r\n    }\r\n    remove(entityId: number) {\r\n        this._version++;\r\n        const node = this.nodes.get(entityId);\r\n        if (!node) throw new Error(`remove fail, Entity ${entityId} not found`);\r\n        if (node.parent) {\r\n            node.parent.removeChild(node);\r\n        }\r\n        this.displayList = this.build();\r\n    }\r\n    /**\r\n     * 获取节点\r\n     */\r\n    get(entityId: number): SceneNode {\r\n        if (!this.nodes.has(entityId)) {\r\n            this.nodes.set(entityId, new SceneNode(entityId));\r\n        }\r\n        return this.nodes.get(entityId)!;\r\n    }\r\n    has(entityId: number): boolean {\r\n        return this.nodes.has(entityId);\r\n    }\r\n    /**\r\n     * 删除节点（递归删除子节点）\r\n     */\r\n    destory(entityId: number) {\r\n        this._version++;\r\n        const node = this.nodes.get(entityId);\r\n        if (!node) throw new Error(`destory fail, Entity ${entityId} not found`);\r\n\r\n        // 递归删除子节点\r\n        const descendants = node.getDescendants();\r\n        for (const desc of descendants) {\r\n            this.nodes.delete(desc.entityId);\r\n        }\r\n\r\n        // 从父节点 children 中移除自己\r\n        if (node.parent) {\r\n            const index = node.parent.children.indexOf(node);\r\n            if (index !== -1) node.parent.children.splice(index, 1);\r\n        }\r\n\r\n        this.nodes.delete(entityId);\r\n        this.displayList = this.build();\r\n    }\r\n\r\n    /**\r\n     * 获取指定节点的父节点\r\n     */\r\n    getParent(entityId: number): SceneNode | null {\r\n        const node = this.nodes.get(entityId);\r\n        return node?.parent || null;\r\n    }\r\n\r\n    /**\r\n     * 获取场景树中所有节点\r\n     */\r\n    all(): SceneNode[] {\r\n        return Array.from(this.nodes.values());\r\n    }\r\n    /** 清空所有非根节点 */\r\n    clear() {\r\n        this._version++;\r\n        // 复制 rootNode.children 避免遍历删除时修改数组\r\n        for (const child of this.root.children.slice()) {\r\n            this.destory(child.entityId);\r\n        }\r\n        this.displayList = this.build();\r\n    }\r\n\r\n    caches: Array<{ entityId: number; parentEntityId: number | null }> = [];\r\n    version = -1\r\n    _version = 0\r\n    forEach<T = unknown>(\r\n        callback: (entityId: number, parentEntityId: number | null, context: T, parentContext: T | null) => void,\r\n        rootContext?: T,\r\n        reverse = false\r\n    ) {\r\n        if (this.version === this._version && this.caches.length > 0) {\r\n            this.forEachCaches(callback, rootContext, reverse);\r\n            return;\r\n        }\r\n        const newCaches: Array<{ entityId: number; parentEntityId: number | null }> = [];\r\n\r\n        const map = new Map<number, T>();\r\n        map.set(this.root.entityId, rootContext ?? ({} as T));\r\n        const visit = (node: SceneNode) => {\r\n            const parentEntityId = node.parent?.entityId ?? null;\r\n            const parentContext = parentEntityId != null ? map.get(parentEntityId)! : null;\r\n            if (!map.has(node.entityId)) map.set(node.entityId, {} as T);\r\n            const context = map.get(node.entityId)!;\r\n            newCaches.push({ entityId: node.entityId, parentEntityId });\r\n\r\n            if (!reverse) {\r\n                callback(node.entityId, parentEntityId, context, parentContext);\r\n                for (let i = 0; i < node.children.length; i++) {\r\n                    visit(node.children[i]);\r\n                }\r\n            } else {\r\n                for (let i = node.children.length - 1; i >= 0; i--) {\r\n                    visit(node.children[i]);\r\n                }\r\n                callback(node.entityId, parentEntityId, context, parentContext);\r\n            }\r\n\r\n        };\r\n        visit(this.root);\r\n        this.caches = newCaches;\r\n        this.version = this._version;\r\n    }\r\n    forEachCaches<T = unknown>(\r\n        callback: (entityId: number, parentEntityId: number | null, context: T, parentContext: Readonly<T> | null) => void,\r\n        rootContext?: T,\r\n        reverse = false\r\n    ) {\r\n        const map = new Map<number, T>();\r\n        map.set(this.root.entityId, rootContext ?? ({} as T));\r\n        const loop = (entityId: number, parentEntityId: number | null) => {\r\n            const context = map.get(entityId) ?? ({} as T);\r\n            map.set(entityId, context);\r\n            const parentContext = parentEntityId != null ? map.get(parentEntityId)! : null;\r\n            callback(entityId, parentEntityId, context, parentContext ? parentContext as T : null);\r\n        }\r\n        if (reverse) {\r\n            for (let i = this.caches.length - 1; i >= 0; i--) {\r\n                const { entityId, parentEntityId } = this.caches[i];\r\n                loop(entityId, parentEntityId);\r\n            }\r\n        } else {\r\n            for (let i = 0; i < this.caches.length; i++) {\r\n                const { entityId, parentEntityId } = this.caches[i];\r\n                loop(entityId, parentEntityId);\r\n            }\r\n        }\r\n    }\r\n    build() {\r\n        const result: Array<[number, number | null]> = [];\r\n        function visit(node: SceneNode, parent: SceneNode | null) {\r\n            result.push([node.entityId, parent?.entityId ?? null]);\r\n            if (node.children) {\r\n                for (const child of node.children) { visit(child, node); }\r\n            }\r\n        }\r\n        visit(this.root, null);\r\n        return result;\r\n    }\r\n    displayList: Array<[number, number | null]> = []\r\n}\r\n// // 前序遍历：先访问当前节点，再递归遍历每个子节点\r\n// function visit(node, parent) {\r\n//     // 更新当前节点矩阵\r\n//     calcMatrix(node);\r\n//     // 渲染当前节点\r\n//     render(node)\r\n//     const childrenResult = []\r\n//     for (const child of node.children) {\r\n//         const result = visit(child, parent);\r\n//         childrenResult.push(result);\r\n//     }\r\n//     // 根据自身和子节点执行 计算包围盒\r\n//     calcBox(node, childrenResult);\r\n//     return result;\r\n// }","/*! *****************************************************************************\nCopyright (C) Microsoft. All rights reserved.\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\nthis file except in compliance with the License. You may obtain a copy of the\nLicense at http://www.apache.org/licenses/LICENSE-2.0\n\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\nMERCHANTABLITY OR NON-INFRINGEMENT.\n\nSee the Apache Version 2.0 License for specific language governing permissions\nand limitations under the License.\n***************************************************************************** */\nvar Reflect;\n(function (Reflect) {\n    // Metadata Proposal\n    // https://rbuckton.github.io/reflect-metadata/\n    (function (factory) {\n        var root = typeof globalThis === \"object\" ? globalThis :\n            typeof global === \"object\" ? global :\n                typeof self === \"object\" ? self :\n                    typeof this === \"object\" ? this :\n                        sloppyModeThis();\n        var exporter = makeExporter(Reflect);\n        if (typeof root.Reflect !== \"undefined\") {\n            exporter = makeExporter(root.Reflect, exporter);\n        }\n        factory(exporter, root);\n        if (typeof root.Reflect === \"undefined\") {\n            root.Reflect = Reflect;\n        }\n        function makeExporter(target, previous) {\n            return function (key, value) {\n                Object.defineProperty(target, key, { configurable: true, writable: true, value: value });\n                if (previous)\n                    previous(key, value);\n            };\n        }\n        function functionThis() {\n            try {\n                return Function(\"return this;\")();\n            }\n            catch (_) { }\n        }\n        function indirectEvalThis() {\n            try {\n                return (void 0, eval)(\"(function() { return this; })()\");\n            }\n            catch (_) { }\n        }\n        function sloppyModeThis() {\n            return functionThis() || indirectEvalThis();\n        }\n    })(function (exporter, root) {\n        var hasOwn = Object.prototype.hasOwnProperty;\n        // feature test for Symbol support\n        var supportsSymbol = typeof Symbol === \"function\";\n        var toPrimitiveSymbol = supportsSymbol && typeof Symbol.toPrimitive !== \"undefined\" ? Symbol.toPrimitive : \"@@toPrimitive\";\n        var iteratorSymbol = supportsSymbol && typeof Symbol.iterator !== \"undefined\" ? Symbol.iterator : \"@@iterator\";\n        var supportsCreate = typeof Object.create === \"function\"; // feature test for Object.create support\n        var supportsProto = { __proto__: [] } instanceof Array; // feature test for __proto__ support\n        var downLevel = !supportsCreate && !supportsProto;\n        var HashMap = {\n            // create an object in dictionary mode (a.k.a. \"slow\" mode in v8)\n            create: supportsCreate\n                ? function () { return MakeDictionary(Object.create(null)); }\n                : supportsProto\n                    ? function () { return MakeDictionary({ __proto__: null }); }\n                    : function () { return MakeDictionary({}); },\n            has: downLevel\n                ? function (map, key) { return hasOwn.call(map, key); }\n                : function (map, key) { return key in map; },\n            get: downLevel\n                ? function (map, key) { return hasOwn.call(map, key) ? map[key] : undefined; }\n                : function (map, key) { return map[key]; },\n        };\n        // Load global or shim versions of Map, Set, and WeakMap\n        var functionPrototype = Object.getPrototypeOf(Function);\n        var _Map = typeof Map === \"function\" && typeof Map.prototype.entries === \"function\" ? Map : CreateMapPolyfill();\n        var _Set = typeof Set === \"function\" && typeof Set.prototype.entries === \"function\" ? Set : CreateSetPolyfill();\n        var _WeakMap = typeof WeakMap === \"function\" ? WeakMap : CreateWeakMapPolyfill();\n        var registrySymbol = supportsSymbol ? Symbol.for(\"@reflect-metadata:registry\") : undefined;\n        var metadataRegistry = GetOrCreateMetadataRegistry();\n        var metadataProvider = CreateMetadataProvider(metadataRegistry);\n        /**\n         * Applies a set of decorators to a property of a target object.\n         * @param decorators An array of decorators.\n         * @param target The target object.\n         * @param propertyKey (Optional) The property key to decorate.\n         * @param attributes (Optional) The property descriptor for the target key.\n         * @remarks Decorators are applied in reverse order.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     Example = Reflect.decorate(decoratorsArray, Example);\n         *\n         *     // property (on constructor)\n         *     Reflect.decorate(decoratorsArray, Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     Reflect.decorate(decoratorsArray, Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     Object.defineProperty(Example, \"staticMethod\",\n         *         Reflect.decorate(decoratorsArray, Example, \"staticMethod\",\n         *             Object.getOwnPropertyDescriptor(Example, \"staticMethod\")));\n         *\n         *     // method (on prototype)\n         *     Object.defineProperty(Example.prototype, \"method\",\n         *         Reflect.decorate(decoratorsArray, Example.prototype, \"method\",\n         *             Object.getOwnPropertyDescriptor(Example.prototype, \"method\")));\n         *\n         */\n        function decorate(decorators, target, propertyKey, attributes) {\n            if (!IsUndefined(propertyKey)) {\n                if (!IsArray(decorators))\n                    throw new TypeError();\n                if (!IsObject(target))\n                    throw new TypeError();\n                if (!IsObject(attributes) && !IsUndefined(attributes) && !IsNull(attributes))\n                    throw new TypeError();\n                if (IsNull(attributes))\n                    attributes = undefined;\n                propertyKey = ToPropertyKey(propertyKey);\n                return DecorateProperty(decorators, target, propertyKey, attributes);\n            }\n            else {\n                if (!IsArray(decorators))\n                    throw new TypeError();\n                if (!IsConstructor(target))\n                    throw new TypeError();\n                return DecorateConstructor(decorators, target);\n            }\n        }\n        exporter(\"decorate\", decorate);\n        // 4.1.2 Reflect.metadata(metadataKey, metadataValue)\n        // https://rbuckton.github.io/reflect-metadata/#reflect.metadata\n        /**\n         * A default metadata decorator factory that can be used on a class, class member, or parameter.\n         * @param metadataKey The key for the metadata entry.\n         * @param metadataValue The value for the metadata entry.\n         * @returns A decorator function.\n         * @remarks\n         * If `metadataKey` is already defined for the target and target key, the\n         * metadataValue for that key will be overwritten.\n         * @example\n         *\n         *     // constructor\n         *     @Reflect.metadata(key, value)\n         *     class Example {\n         *     }\n         *\n         *     // property (on constructor, TypeScript only)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         static staticProperty;\n         *     }\n         *\n         *     // property (on prototype, TypeScript only)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         property;\n         *     }\n         *\n         *     // method (on constructor)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         static staticMethod() { }\n         *     }\n         *\n         *     // method (on prototype)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         method() { }\n         *     }\n         *\n         */\n        function metadata(metadataKey, metadataValue) {\n            function decorator(target, propertyKey) {\n                if (!IsObject(target))\n                    throw new TypeError();\n                if (!IsUndefined(propertyKey) && !IsPropertyKey(propertyKey))\n                    throw new TypeError();\n                OrdinaryDefineOwnMetadata(metadataKey, metadataValue, target, propertyKey);\n            }\n            return decorator;\n        }\n        exporter(\"metadata\", metadata);\n        /**\n         * Define a unique metadata entry on the target.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param metadataValue A value that contains attached metadata.\n         * @param target The target object on which to define metadata.\n         * @param propertyKey (Optional) The property key for the target.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example);\n         *\n         *     // property (on constructor)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example.prototype, \"method\");\n         *\n         *     // decorator factory as metadata-producing annotation.\n         *     function MyAnnotation(options): Decorator {\n         *         return (target, key?) => Reflect.defineMetadata(\"custom:annotation\", options, target, key);\n         *     }\n         *\n         */\n        function defineMetadata(metadataKey, metadataValue, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryDefineOwnMetadata(metadataKey, metadataValue, target, propertyKey);\n        }\n        exporter(\"defineMetadata\", defineMetadata);\n        /**\n         * Gets a value indicating whether the target object or its prototype chain has the provided metadata key defined.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata key was defined on the target object or its prototype chain; otherwise, `false`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function hasMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryHasMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"hasMetadata\", hasMetadata);\n        /**\n         * Gets a value indicating whether the target object has the provided metadata key defined.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata key was defined on the target object; otherwise, `false`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function hasOwnMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryHasOwnMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"hasOwnMetadata\", hasOwnMetadata);\n        /**\n         * Gets the metadata value for the provided metadata key on the target object or its prototype chain.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns The metadata value for the metadata key if found; otherwise, `undefined`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function getMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryGetMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"getMetadata\", getMetadata);\n        /**\n         * Gets the metadata value for the provided metadata key on the target object.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns The metadata value for the metadata key if found; otherwise, `undefined`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function getOwnMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryGetOwnMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"getOwnMetadata\", getOwnMetadata);\n        /**\n         * Gets the metadata keys defined on the target object or its prototype chain.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns An array of unique metadata keys.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getMetadataKeys(Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getMetadataKeys(Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getMetadataKeys(Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getMetadataKeys(Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getMetadataKeys(Example.prototype, \"method\");\n         *\n         */\n        function getMetadataKeys(target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryMetadataKeys(target, propertyKey);\n        }\n        exporter(\"getMetadataKeys\", getMetadataKeys);\n        /**\n         * Gets the unique metadata keys defined on the target object.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns An array of unique metadata keys.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getOwnMetadataKeys(Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getOwnMetadataKeys(Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getOwnMetadataKeys(Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getOwnMetadataKeys(Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getOwnMetadataKeys(Example.prototype, \"method\");\n         *\n         */\n        function getOwnMetadataKeys(target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryOwnMetadataKeys(target, propertyKey);\n        }\n        exporter(\"getOwnMetadataKeys\", getOwnMetadataKeys);\n        /**\n         * Deletes the metadata entry from the target object with the provided key.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata entry was found and deleted; otherwise, false.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function deleteMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            var provider = GetMetadataProvider(target, propertyKey, /*Create*/ false);\n            if (IsUndefined(provider))\n                return false;\n            return provider.OrdinaryDeleteMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"deleteMetadata\", deleteMetadata);\n        function DecorateConstructor(decorators, target) {\n            for (var i = decorators.length - 1; i >= 0; --i) {\n                var decorator = decorators[i];\n                var decorated = decorator(target);\n                if (!IsUndefined(decorated) && !IsNull(decorated)) {\n                    if (!IsConstructor(decorated))\n                        throw new TypeError();\n                    target = decorated;\n                }\n            }\n            return target;\n        }\n        function DecorateProperty(decorators, target, propertyKey, descriptor) {\n            for (var i = decorators.length - 1; i >= 0; --i) {\n                var decorator = decorators[i];\n                var decorated = decorator(target, propertyKey, descriptor);\n                if (!IsUndefined(decorated) && !IsNull(decorated)) {\n                    if (!IsObject(decorated))\n                        throw new TypeError();\n                    descriptor = decorated;\n                }\n            }\n            return descriptor;\n        }\n        // 3.1.1.1 OrdinaryHasMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryhasmetadata\n        function OrdinaryHasMetadata(MetadataKey, O, P) {\n            var hasOwn = OrdinaryHasOwnMetadata(MetadataKey, O, P);\n            if (hasOwn)\n                return true;\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (!IsNull(parent))\n                return OrdinaryHasMetadata(MetadataKey, parent, P);\n            return false;\n        }\n        // 3.1.2.1 OrdinaryHasOwnMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryhasownmetadata\n        function OrdinaryHasOwnMetadata(MetadataKey, O, P) {\n            var provider = GetMetadataProvider(O, P, /*Create*/ false);\n            if (IsUndefined(provider))\n                return false;\n            return ToBoolean(provider.OrdinaryHasOwnMetadata(MetadataKey, O, P));\n        }\n        // 3.1.3.1 OrdinaryGetMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarygetmetadata\n        function OrdinaryGetMetadata(MetadataKey, O, P) {\n            var hasOwn = OrdinaryHasOwnMetadata(MetadataKey, O, P);\n            if (hasOwn)\n                return OrdinaryGetOwnMetadata(MetadataKey, O, P);\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (!IsNull(parent))\n                return OrdinaryGetMetadata(MetadataKey, parent, P);\n            return undefined;\n        }\n        // 3.1.4.1 OrdinaryGetOwnMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarygetownmetadata\n        function OrdinaryGetOwnMetadata(MetadataKey, O, P) {\n            var provider = GetMetadataProvider(O, P, /*Create*/ false);\n            if (IsUndefined(provider))\n                return;\n            return provider.OrdinaryGetOwnMetadata(MetadataKey, O, P);\n        }\n        // 3.1.5.1 OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarydefineownmetadata\n        function OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P) {\n            var provider = GetMetadataProvider(O, P, /*Create*/ true);\n            provider.OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P);\n        }\n        // 3.1.6.1 OrdinaryMetadataKeys(O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarymetadatakeys\n        function OrdinaryMetadataKeys(O, P) {\n            var ownKeys = OrdinaryOwnMetadataKeys(O, P);\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (parent === null)\n                return ownKeys;\n            var parentKeys = OrdinaryMetadataKeys(parent, P);\n            if (parentKeys.length <= 0)\n                return ownKeys;\n            if (ownKeys.length <= 0)\n                return parentKeys;\n            var set = new _Set();\n            var keys = [];\n            for (var _i = 0, ownKeys_1 = ownKeys; _i < ownKeys_1.length; _i++) {\n                var key = ownKeys_1[_i];\n                var hasKey = set.has(key);\n                if (!hasKey) {\n                    set.add(key);\n                    keys.push(key);\n                }\n            }\n            for (var _a = 0, parentKeys_1 = parentKeys; _a < parentKeys_1.length; _a++) {\n                var key = parentKeys_1[_a];\n                var hasKey = set.has(key);\n                if (!hasKey) {\n                    set.add(key);\n                    keys.push(key);\n                }\n            }\n            return keys;\n        }\n        // 3.1.7.1 OrdinaryOwnMetadataKeys(O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryownmetadatakeys\n        function OrdinaryOwnMetadataKeys(O, P) {\n            var provider = GetMetadataProvider(O, P, /*create*/ false);\n            if (!provider) {\n                return [];\n            }\n            return provider.OrdinaryOwnMetadataKeys(O, P);\n        }\n        // 6 ECMAScript Data Types and Values\n        // https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values\n        function Type(x) {\n            if (x === null)\n                return 1 /* Null */;\n            switch (typeof x) {\n                case \"undefined\": return 0 /* Undefined */;\n                case \"boolean\": return 2 /* Boolean */;\n                case \"string\": return 3 /* String */;\n                case \"symbol\": return 4 /* Symbol */;\n                case \"number\": return 5 /* Number */;\n                case \"object\": return x === null ? 1 /* Null */ : 6 /* Object */;\n                default: return 6 /* Object */;\n            }\n        }\n        // 6.1.1 The Undefined Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-undefined-type\n        function IsUndefined(x) {\n            return x === undefined;\n        }\n        // 6.1.2 The Null Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-null-type\n        function IsNull(x) {\n            return x === null;\n        }\n        // 6.1.5 The Symbol Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-symbol-type\n        function IsSymbol(x) {\n            return typeof x === \"symbol\";\n        }\n        // 6.1.7 The Object Type\n        // https://tc39.github.io/ecma262/#sec-object-type\n        function IsObject(x) {\n            return typeof x === \"object\" ? x !== null : typeof x === \"function\";\n        }\n        // 7.1 Type Conversion\n        // https://tc39.github.io/ecma262/#sec-type-conversion\n        // 7.1.1 ToPrimitive(input [, PreferredType])\n        // https://tc39.github.io/ecma262/#sec-toprimitive\n        function ToPrimitive(input, PreferredType) {\n            switch (Type(input)) {\n                case 0 /* Undefined */: return input;\n                case 1 /* Null */: return input;\n                case 2 /* Boolean */: return input;\n                case 3 /* String */: return input;\n                case 4 /* Symbol */: return input;\n                case 5 /* Number */: return input;\n            }\n            var hint = PreferredType === 3 /* String */ ? \"string\" : PreferredType === 5 /* Number */ ? \"number\" : \"default\";\n            var exoticToPrim = GetMethod(input, toPrimitiveSymbol);\n            if (exoticToPrim !== undefined) {\n                var result = exoticToPrim.call(input, hint);\n                if (IsObject(result))\n                    throw new TypeError();\n                return result;\n            }\n            return OrdinaryToPrimitive(input, hint === \"default\" ? \"number\" : hint);\n        }\n        // 7.1.1.1 OrdinaryToPrimitive(O, hint)\n        // https://tc39.github.io/ecma262/#sec-ordinarytoprimitive\n        function OrdinaryToPrimitive(O, hint) {\n            if (hint === \"string\") {\n                var toString_1 = O.toString;\n                if (IsCallable(toString_1)) {\n                    var result = toString_1.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n                var valueOf = O.valueOf;\n                if (IsCallable(valueOf)) {\n                    var result = valueOf.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n            }\n            else {\n                var valueOf = O.valueOf;\n                if (IsCallable(valueOf)) {\n                    var result = valueOf.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n                var toString_2 = O.toString;\n                if (IsCallable(toString_2)) {\n                    var result = toString_2.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n            }\n            throw new TypeError();\n        }\n        // 7.1.2 ToBoolean(argument)\n        // https://tc39.github.io/ecma262/2016/#sec-toboolean\n        function ToBoolean(argument) {\n            return !!argument;\n        }\n        // 7.1.12 ToString(argument)\n        // https://tc39.github.io/ecma262/#sec-tostring\n        function ToString(argument) {\n            return \"\" + argument;\n        }\n        // 7.1.14 ToPropertyKey(argument)\n        // https://tc39.github.io/ecma262/#sec-topropertykey\n        function ToPropertyKey(argument) {\n            var key = ToPrimitive(argument, 3 /* String */);\n            if (IsSymbol(key))\n                return key;\n            return ToString(key);\n        }\n        // 7.2 Testing and Comparison Operations\n        // https://tc39.github.io/ecma262/#sec-testing-and-comparison-operations\n        // 7.2.2 IsArray(argument)\n        // https://tc39.github.io/ecma262/#sec-isarray\n        function IsArray(argument) {\n            return Array.isArray\n                ? Array.isArray(argument)\n                : argument instanceof Object\n                    ? argument instanceof Array\n                    : Object.prototype.toString.call(argument) === \"[object Array]\";\n        }\n        // 7.2.3 IsCallable(argument)\n        // https://tc39.github.io/ecma262/#sec-iscallable\n        function IsCallable(argument) {\n            // NOTE: This is an approximation as we cannot check for [[Call]] internal method.\n            return typeof argument === \"function\";\n        }\n        // 7.2.4 IsConstructor(argument)\n        // https://tc39.github.io/ecma262/#sec-isconstructor\n        function IsConstructor(argument) {\n            // NOTE: This is an approximation as we cannot check for [[Construct]] internal method.\n            return typeof argument === \"function\";\n        }\n        // 7.2.7 IsPropertyKey(argument)\n        // https://tc39.github.io/ecma262/#sec-ispropertykey\n        function IsPropertyKey(argument) {\n            switch (Type(argument)) {\n                case 3 /* String */: return true;\n                case 4 /* Symbol */: return true;\n                default: return false;\n            }\n        }\n        function SameValueZero(x, y) {\n            return x === y || x !== x && y !== y;\n        }\n        // 7.3 Operations on Objects\n        // https://tc39.github.io/ecma262/#sec-operations-on-objects\n        // 7.3.9 GetMethod(V, P)\n        // https://tc39.github.io/ecma262/#sec-getmethod\n        function GetMethod(V, P) {\n            var func = V[P];\n            if (func === undefined || func === null)\n                return undefined;\n            if (!IsCallable(func))\n                throw new TypeError();\n            return func;\n        }\n        // 7.4 Operations on Iterator Objects\n        // https://tc39.github.io/ecma262/#sec-operations-on-iterator-objects\n        function GetIterator(obj) {\n            var method = GetMethod(obj, iteratorSymbol);\n            if (!IsCallable(method))\n                throw new TypeError(); // from Call\n            var iterator = method.call(obj);\n            if (!IsObject(iterator))\n                throw new TypeError();\n            return iterator;\n        }\n        // 7.4.4 IteratorValue(iterResult)\n        // https://tc39.github.io/ecma262/2016/#sec-iteratorvalue\n        function IteratorValue(iterResult) {\n            return iterResult.value;\n        }\n        // 7.4.5 IteratorStep(iterator)\n        // https://tc39.github.io/ecma262/#sec-iteratorstep\n        function IteratorStep(iterator) {\n            var result = iterator.next();\n            return result.done ? false : result;\n        }\n        // 7.4.6 IteratorClose(iterator, completion)\n        // https://tc39.github.io/ecma262/#sec-iteratorclose\n        function IteratorClose(iterator) {\n            var f = iterator[\"return\"];\n            if (f)\n                f.call(iterator);\n        }\n        // 9.1 Ordinary Object Internal Methods and Internal Slots\n        // https://tc39.github.io/ecma262/#sec-ordinary-object-internal-methods-and-internal-slots\n        // 9.1.1.1 OrdinaryGetPrototypeOf(O)\n        // https://tc39.github.io/ecma262/#sec-ordinarygetprototypeof\n        function OrdinaryGetPrototypeOf(O) {\n            var proto = Object.getPrototypeOf(O);\n            if (typeof O !== \"function\" || O === functionPrototype)\n                return proto;\n            // TypeScript doesn't set __proto__ in ES5, as it's non-standard.\n            // Try to determine the superclass constructor. Compatible implementations\n            // must either set __proto__ on a subclass constructor to the superclass constructor,\n            // or ensure each class has a valid `constructor` property on its prototype that\n            // points back to the constructor.\n            // If this is not the same as Function.[[Prototype]], then this is definately inherited.\n            // This is the case when in ES6 or when using __proto__ in a compatible browser.\n            if (proto !== functionPrototype)\n                return proto;\n            // If the super prototype is Object.prototype, null, or undefined, then we cannot determine the heritage.\n            var prototype = O.prototype;\n            var prototypeProto = prototype && Object.getPrototypeOf(prototype);\n            if (prototypeProto == null || prototypeProto === Object.prototype)\n                return proto;\n            // If the constructor was not a function, then we cannot determine the heritage.\n            var constructor = prototypeProto.constructor;\n            if (typeof constructor !== \"function\")\n                return proto;\n            // If we have some kind of self-reference, then we cannot determine the heritage.\n            if (constructor === O)\n                return proto;\n            // we have a pretty good guess at the heritage.\n            return constructor;\n        }\n        // Global metadata registry\n        // - Allows `import \"reflect-metadata\"` and `import \"reflect-metadata/no-conflict\"` to interoperate.\n        // - Uses isolated metadata if `Reflect` is frozen before the registry can be installed.\n        /**\n         * Creates a registry used to allow multiple `reflect-metadata` providers.\n         */\n        function CreateMetadataRegistry() {\n            var fallback;\n            if (!IsUndefined(registrySymbol) &&\n                typeof root.Reflect !== \"undefined\" &&\n                !(registrySymbol in root.Reflect) &&\n                typeof root.Reflect.defineMetadata === \"function\") {\n                // interoperate with older version of `reflect-metadata` that did not support a registry.\n                fallback = CreateFallbackProvider(root.Reflect);\n            }\n            var first;\n            var second;\n            var rest;\n            var targetProviderMap = new _WeakMap();\n            var registry = {\n                registerProvider: registerProvider,\n                getProvider: getProvider,\n                setProvider: setProvider,\n            };\n            return registry;\n            function registerProvider(provider) {\n                if (!Object.isExtensible(registry)) {\n                    throw new Error(\"Cannot add provider to a frozen registry.\");\n                }\n                switch (true) {\n                    case fallback === provider: break;\n                    case IsUndefined(first):\n                        first = provider;\n                        break;\n                    case first === provider: break;\n                    case IsUndefined(second):\n                        second = provider;\n                        break;\n                    case second === provider: break;\n                    default:\n                        if (rest === undefined)\n                            rest = new _Set();\n                        rest.add(provider);\n                        break;\n                }\n            }\n            function getProviderNoCache(O, P) {\n                if (!IsUndefined(first)) {\n                    if (first.isProviderFor(O, P))\n                        return first;\n                    if (!IsUndefined(second)) {\n                        if (second.isProviderFor(O, P))\n                            return first;\n                        if (!IsUndefined(rest)) {\n                            var iterator = GetIterator(rest);\n                            while (true) {\n                                var next = IteratorStep(iterator);\n                                if (!next) {\n                                    return undefined;\n                                }\n                                var provider = IteratorValue(next);\n                                if (provider.isProviderFor(O, P)) {\n                                    IteratorClose(iterator);\n                                    return provider;\n                                }\n                            }\n                        }\n                    }\n                }\n                if (!IsUndefined(fallback) && fallback.isProviderFor(O, P)) {\n                    return fallback;\n                }\n                return undefined;\n            }\n            function getProvider(O, P) {\n                var providerMap = targetProviderMap.get(O);\n                var provider;\n                if (!IsUndefined(providerMap)) {\n                    provider = providerMap.get(P);\n                }\n                if (!IsUndefined(provider)) {\n                    return provider;\n                }\n                provider = getProviderNoCache(O, P);\n                if (!IsUndefined(provider)) {\n                    if (IsUndefined(providerMap)) {\n                        providerMap = new _Map();\n                        targetProviderMap.set(O, providerMap);\n                    }\n                    providerMap.set(P, provider);\n                }\n                return provider;\n            }\n            function hasProvider(provider) {\n                if (IsUndefined(provider))\n                    throw new TypeError();\n                return first === provider || second === provider || !IsUndefined(rest) && rest.has(provider);\n            }\n            function setProvider(O, P, provider) {\n                if (!hasProvider(provider)) {\n                    throw new Error(\"Metadata provider not registered.\");\n                }\n                var existingProvider = getProvider(O, P);\n                if (existingProvider !== provider) {\n                    if (!IsUndefined(existingProvider)) {\n                        return false;\n                    }\n                    var providerMap = targetProviderMap.get(O);\n                    if (IsUndefined(providerMap)) {\n                        providerMap = new _Map();\n                        targetProviderMap.set(O, providerMap);\n                    }\n                    providerMap.set(P, provider);\n                }\n                return true;\n            }\n        }\n        /**\n         * Gets or creates the shared registry of metadata providers.\n         */\n        function GetOrCreateMetadataRegistry() {\n            var metadataRegistry;\n            if (!IsUndefined(registrySymbol) && IsObject(root.Reflect) && Object.isExtensible(root.Reflect)) {\n                metadataRegistry = root.Reflect[registrySymbol];\n            }\n            if (IsUndefined(metadataRegistry)) {\n                metadataRegistry = CreateMetadataRegistry();\n            }\n            if (!IsUndefined(registrySymbol) && IsObject(root.Reflect) && Object.isExtensible(root.Reflect)) {\n                Object.defineProperty(root.Reflect, registrySymbol, {\n                    enumerable: false,\n                    configurable: false,\n                    writable: false,\n                    value: metadataRegistry\n                });\n            }\n            return metadataRegistry;\n        }\n        function CreateMetadataProvider(registry) {\n            // [[Metadata]] internal slot\n            // https://rbuckton.github.io/reflect-metadata/#ordinary-object-internal-methods-and-internal-slots\n            var metadata = new _WeakMap();\n            var provider = {\n                isProviderFor: function (O, P) {\n                    var targetMetadata = metadata.get(O);\n                    if (IsUndefined(targetMetadata))\n                        return false;\n                    return targetMetadata.has(P);\n                },\n                OrdinaryDefineOwnMetadata: OrdinaryDefineOwnMetadata,\n                OrdinaryHasOwnMetadata: OrdinaryHasOwnMetadata,\n                OrdinaryGetOwnMetadata: OrdinaryGetOwnMetadata,\n                OrdinaryOwnMetadataKeys: OrdinaryOwnMetadataKeys,\n                OrdinaryDeleteMetadata: OrdinaryDeleteMetadata,\n            };\n            metadataRegistry.registerProvider(provider);\n            return provider;\n            function GetOrCreateMetadataMap(O, P, Create) {\n                var targetMetadata = metadata.get(O);\n                var createdTargetMetadata = false;\n                if (IsUndefined(targetMetadata)) {\n                    if (!Create)\n                        return undefined;\n                    targetMetadata = new _Map();\n                    metadata.set(O, targetMetadata);\n                    createdTargetMetadata = true;\n                }\n                var metadataMap = targetMetadata.get(P);\n                if (IsUndefined(metadataMap)) {\n                    if (!Create)\n                        return undefined;\n                    metadataMap = new _Map();\n                    targetMetadata.set(P, metadataMap);\n                    if (!registry.setProvider(O, P, provider)) {\n                        targetMetadata.delete(P);\n                        if (createdTargetMetadata) {\n                            metadata.delete(O);\n                        }\n                        throw new Error(\"Wrong provider for target.\");\n                    }\n                }\n                return metadataMap;\n            }\n            // 3.1.2.1 OrdinaryHasOwnMetadata(MetadataKey, O, P)\n            // https://rbuckton.github.io/reflect-metadata/#ordinaryhasownmetadata\n            function OrdinaryHasOwnMetadata(MetadataKey, O, P) {\n                var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n                if (IsUndefined(metadataMap))\n                    return false;\n                return ToBoolean(metadataMap.has(MetadataKey));\n            }\n            // 3.1.4.1 OrdinaryGetOwnMetadata(MetadataKey, O, P)\n            // https://rbuckton.github.io/reflect-metadata/#ordinarygetownmetadata\n            function OrdinaryGetOwnMetadata(MetadataKey, O, P) {\n                var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n                if (IsUndefined(metadataMap))\n                    return undefined;\n                return metadataMap.get(MetadataKey);\n            }\n            // 3.1.5.1 OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P)\n            // https://rbuckton.github.io/reflect-metadata/#ordinarydefineownmetadata\n            function OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P) {\n                var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ true);\n                metadataMap.set(MetadataKey, MetadataValue);\n            }\n            // 3.1.7.1 OrdinaryOwnMetadataKeys(O, P)\n            // https://rbuckton.github.io/reflect-metadata/#ordinaryownmetadatakeys\n            function OrdinaryOwnMetadataKeys(O, P) {\n                var keys = [];\n                var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n                if (IsUndefined(metadataMap))\n                    return keys;\n                var keysObj = metadataMap.keys();\n                var iterator = GetIterator(keysObj);\n                var k = 0;\n                while (true) {\n                    var next = IteratorStep(iterator);\n                    if (!next) {\n                        keys.length = k;\n                        return keys;\n                    }\n                    var nextValue = IteratorValue(next);\n                    try {\n                        keys[k] = nextValue;\n                    }\n                    catch (e) {\n                        try {\n                            IteratorClose(iterator);\n                        }\n                        finally {\n                            throw e;\n                        }\n                    }\n                    k++;\n                }\n            }\n            function OrdinaryDeleteMetadata(MetadataKey, O, P) {\n                var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n                if (IsUndefined(metadataMap))\n                    return false;\n                if (!metadataMap.delete(MetadataKey))\n                    return false;\n                if (metadataMap.size === 0) {\n                    var targetMetadata = metadata.get(O);\n                    if (!IsUndefined(targetMetadata)) {\n                        targetMetadata.delete(P);\n                        if (targetMetadata.size === 0) {\n                            metadata.delete(targetMetadata);\n                        }\n                    }\n                }\n                return true;\n            }\n        }\n        function CreateFallbackProvider(reflect) {\n            var defineMetadata = reflect.defineMetadata, hasOwnMetadata = reflect.hasOwnMetadata, getOwnMetadata = reflect.getOwnMetadata, getOwnMetadataKeys = reflect.getOwnMetadataKeys, deleteMetadata = reflect.deleteMetadata;\n            var metadataOwner = new _WeakMap();\n            var provider = {\n                isProviderFor: function (O, P) {\n                    var metadataPropertySet = metadataOwner.get(O);\n                    if (!IsUndefined(metadataPropertySet) && metadataPropertySet.has(P)) {\n                        return true;\n                    }\n                    if (getOwnMetadataKeys(O, P).length) {\n                        if (IsUndefined(metadataPropertySet)) {\n                            metadataPropertySet = new _Set();\n                            metadataOwner.set(O, metadataPropertySet);\n                        }\n                        metadataPropertySet.add(P);\n                        return true;\n                    }\n                    return false;\n                },\n                OrdinaryDefineOwnMetadata: defineMetadata,\n                OrdinaryHasOwnMetadata: hasOwnMetadata,\n                OrdinaryGetOwnMetadata: getOwnMetadata,\n                OrdinaryOwnMetadataKeys: getOwnMetadataKeys,\n                OrdinaryDeleteMetadata: deleteMetadata,\n            };\n            return provider;\n        }\n        /**\n         * Gets the metadata provider for an object. If the object has no metadata provider and this is for a create operation,\n         * then this module's metadata provider is assigned to the object.\n         */\n        function GetMetadataProvider(O, P, Create) {\n            var registeredProvider = metadataRegistry.getProvider(O, P);\n            if (!IsUndefined(registeredProvider)) {\n                return registeredProvider;\n            }\n            if (Create) {\n                if (metadataRegistry.setProvider(O, P, metadataProvider)) {\n                    return metadataProvider;\n                }\n                throw new Error(\"Illegal state.\");\n            }\n            return undefined;\n        }\n        // naive Map shim\n        function CreateMapPolyfill() {\n            var cacheSentinel = {};\n            var arraySentinel = [];\n            var MapIterator = /** @class */ (function () {\n                function MapIterator(keys, values, selector) {\n                    this._index = 0;\n                    this._keys = keys;\n                    this._values = values;\n                    this._selector = selector;\n                }\n                MapIterator.prototype[\"@@iterator\"] = function () { return this; };\n                MapIterator.prototype[iteratorSymbol] = function () { return this; };\n                MapIterator.prototype.next = function () {\n                    var index = this._index;\n                    if (index >= 0 && index < this._keys.length) {\n                        var result = this._selector(this._keys[index], this._values[index]);\n                        if (index + 1 >= this._keys.length) {\n                            this._index = -1;\n                            this._keys = arraySentinel;\n                            this._values = arraySentinel;\n                        }\n                        else {\n                            this._index++;\n                        }\n                        return { value: result, done: false };\n                    }\n                    return { value: undefined, done: true };\n                };\n                MapIterator.prototype.throw = function (error) {\n                    if (this._index >= 0) {\n                        this._index = -1;\n                        this._keys = arraySentinel;\n                        this._values = arraySentinel;\n                    }\n                    throw error;\n                };\n                MapIterator.prototype.return = function (value) {\n                    if (this._index >= 0) {\n                        this._index = -1;\n                        this._keys = arraySentinel;\n                        this._values = arraySentinel;\n                    }\n                    return { value: value, done: true };\n                };\n                return MapIterator;\n            }());\n            var Map = /** @class */ (function () {\n                function Map() {\n                    this._keys = [];\n                    this._values = [];\n                    this._cacheKey = cacheSentinel;\n                    this._cacheIndex = -2;\n                }\n                Object.defineProperty(Map.prototype, \"size\", {\n                    get: function () { return this._keys.length; },\n                    enumerable: true,\n                    configurable: true\n                });\n                Map.prototype.has = function (key) { return this._find(key, /*insert*/ false) >= 0; };\n                Map.prototype.get = function (key) {\n                    var index = this._find(key, /*insert*/ false);\n                    return index >= 0 ? this._values[index] : undefined;\n                };\n                Map.prototype.set = function (key, value) {\n                    var index = this._find(key, /*insert*/ true);\n                    this._values[index] = value;\n                    return this;\n                };\n                Map.prototype.delete = function (key) {\n                    var index = this._find(key, /*insert*/ false);\n                    if (index >= 0) {\n                        var size = this._keys.length;\n                        for (var i = index + 1; i < size; i++) {\n                            this._keys[i - 1] = this._keys[i];\n                            this._values[i - 1] = this._values[i];\n                        }\n                        this._keys.length--;\n                        this._values.length--;\n                        if (SameValueZero(key, this._cacheKey)) {\n                            this._cacheKey = cacheSentinel;\n                            this._cacheIndex = -2;\n                        }\n                        return true;\n                    }\n                    return false;\n                };\n                Map.prototype.clear = function () {\n                    this._keys.length = 0;\n                    this._values.length = 0;\n                    this._cacheKey = cacheSentinel;\n                    this._cacheIndex = -2;\n                };\n                Map.prototype.keys = function () { return new MapIterator(this._keys, this._values, getKey); };\n                Map.prototype.values = function () { return new MapIterator(this._keys, this._values, getValue); };\n                Map.prototype.entries = function () { return new MapIterator(this._keys, this._values, getEntry); };\n                Map.prototype[\"@@iterator\"] = function () { return this.entries(); };\n                Map.prototype[iteratorSymbol] = function () { return this.entries(); };\n                Map.prototype._find = function (key, insert) {\n                    if (!SameValueZero(this._cacheKey, key)) {\n                        this._cacheIndex = -1;\n                        for (var i = 0; i < this._keys.length; i++) {\n                            if (SameValueZero(this._keys[i], key)) {\n                                this._cacheIndex = i;\n                                break;\n                            }\n                        }\n                    }\n                    if (this._cacheIndex < 0 && insert) {\n                        this._cacheIndex = this._keys.length;\n                        this._keys.push(key);\n                        this._values.push(undefined);\n                    }\n                    return this._cacheIndex;\n                };\n                return Map;\n            }());\n            return Map;\n            function getKey(key, _) {\n                return key;\n            }\n            function getValue(_, value) {\n                return value;\n            }\n            function getEntry(key, value) {\n                return [key, value];\n            }\n        }\n        // naive Set shim\n        function CreateSetPolyfill() {\n            var Set = /** @class */ (function () {\n                function Set() {\n                    this._map = new _Map();\n                }\n                Object.defineProperty(Set.prototype, \"size\", {\n                    get: function () { return this._map.size; },\n                    enumerable: true,\n                    configurable: true\n                });\n                Set.prototype.has = function (value) { return this._map.has(value); };\n                Set.prototype.add = function (value) { return this._map.set(value, value), this; };\n                Set.prototype.delete = function (value) { return this._map.delete(value); };\n                Set.prototype.clear = function () { this._map.clear(); };\n                Set.prototype.keys = function () { return this._map.keys(); };\n                Set.prototype.values = function () { return this._map.keys(); };\n                Set.prototype.entries = function () { return this._map.entries(); };\n                Set.prototype[\"@@iterator\"] = function () { return this.keys(); };\n                Set.prototype[iteratorSymbol] = function () { return this.keys(); };\n                return Set;\n            }());\n            return Set;\n        }\n        // naive WeakMap shim\n        function CreateWeakMapPolyfill() {\n            var UUID_SIZE = 16;\n            var keys = HashMap.create();\n            var rootKey = CreateUniqueKey();\n            return /** @class */ (function () {\n                function WeakMap() {\n                    this._key = CreateUniqueKey();\n                }\n                WeakMap.prototype.has = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? HashMap.has(table, this._key) : false;\n                };\n                WeakMap.prototype.get = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? HashMap.get(table, this._key) : undefined;\n                };\n                WeakMap.prototype.set = function (target, value) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ true);\n                    table[this._key] = value;\n                    return this;\n                };\n                WeakMap.prototype.delete = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? delete table[this._key] : false;\n                };\n                WeakMap.prototype.clear = function () {\n                    // NOTE: not a real clear, just makes the previous data unreachable\n                    this._key = CreateUniqueKey();\n                };\n                return WeakMap;\n            }());\n            function CreateUniqueKey() {\n                var key;\n                do\n                    key = \"@@WeakMap@@\" + CreateUUID();\n                while (HashMap.has(keys, key));\n                keys[key] = true;\n                return key;\n            }\n            function GetOrCreateWeakMapTable(target, create) {\n                if (!hasOwn.call(target, rootKey)) {\n                    if (!create)\n                        return undefined;\n                    Object.defineProperty(target, rootKey, { value: HashMap.create() });\n                }\n                return target[rootKey];\n            }\n            function FillRandomBytes(buffer, size) {\n                for (var i = 0; i < size; ++i)\n                    buffer[i] = Math.random() * 0xff | 0;\n                return buffer;\n            }\n            function GenRandomBytes(size) {\n                if (typeof Uint8Array === \"function\") {\n                    var array = new Uint8Array(size);\n                    if (typeof crypto !== \"undefined\") {\n                        crypto.getRandomValues(array);\n                    }\n                    else if (typeof msCrypto !== \"undefined\") {\n                        msCrypto.getRandomValues(array);\n                    }\n                    else {\n                        FillRandomBytes(array, size);\n                    }\n                    return array;\n                }\n                return FillRandomBytes(new Array(size), size);\n            }\n            function CreateUUID() {\n                var data = GenRandomBytes(UUID_SIZE);\n                // mark as random - RFC 4122 § 4.4\n                data[6] = data[6] & 0x4f | 0x40;\n                data[8] = data[8] & 0xbf | 0x80;\n                var result = \"\";\n                for (var offset = 0; offset < UUID_SIZE; ++offset) {\n                    var byte = data[offset];\n                    if (offset === 4 || offset === 6 || offset === 8)\n                        result += \"-\";\n                    if (byte < 16)\n                        result += \"0\";\n                    result += byte.toString(16).toLowerCase();\n                }\n                return result;\n            }\n        }\n        // uses a heuristic used by v8 and chakra to force an object into dictionary mode.\n        function MakeDictionary(obj) {\n            obj.__ = undefined;\n            delete obj.__;\n            return obj;\n        }\n    });\n})(Reflect || (Reflect = {}));\n","import 'reflect-metadata';\r\nimport { ComponentRegistry } from '../registry/ComponentRegistry.ts';\r\nexport function Component(name: string) {\r\n  return function (ctor: Function) {\r\n    // 绑定元数据（方便 ECS 或调试工具读取）\r\n    Reflect.defineMetadata(\"component:name\", name, ctor);\r\n    // 自动注册到全局组件注册表\r\n    ComponentRegistry.set(name, ctor);\r\n  };\r\n}\r\n\r\n","/**\n * Common utilities\n * @module glMatrix\n */\n\n// Configuration Constants\nexport var EPSILON = 0.000001;\nexport var ARRAY_TYPE = typeof Float32Array !== \"undefined\" ? Float32Array : Array;\nexport var RANDOM = Math.random;\nexport var ANGLE_ORDER = \"zyx\";\n\n/**\n * Symmetric round\n * see https://www.npmjs.com/package/round-half-up-symmetric#user-content-detailed-background\n *\n * @param {Number} a value to round\n */\nexport function round(a) {\n  if (a >= 0) return Math.round(a);\n  return a % 0.5 === 0 ? Math.floor(a) : Math.round(a);\n}\n\n/**\n * Sets the type of array used when creating new vectors and matrices\n *\n * @param {Float32ArrayConstructor | ArrayConstructor} type Array type, such as Float32Array or Array\n */\nexport function setMatrixArrayType(type) {\n  ARRAY_TYPE = type;\n}\nvar degree = Math.PI / 180;\nvar radian = 180 / Math.PI;\n\n/**\n * Convert Degree To Radian\n *\n * @param {Number} a Angle in Degrees\n */\nexport function toRadian(a) {\n  return a * degree;\n}\n\n/**\n * Convert Radian To Degree\n *\n * @param {Number} a Angle in Radians\n */\nexport function toDegree(a) {\n  return a * radian;\n}\n\n/**\n * Tests whether or not the arguments have approximately the same value, within an absolute\n * or relative tolerance of glMatrix.EPSILON (an absolute tolerance is used for values less\n * than or equal to 1.0, and a relative tolerance is used for larger values)\n *\n * @param {Number} a          The first number to test.\n * @param {Number} b          The second number to test.\n * @param {Number} tolerance  Absolute or relative tolerance (default glMatrix.EPSILON)\n * @returns {Boolean} True if the numbers are approximately equal, false otherwise.\n */\nexport function equals(a, b) {\n  var tolerance = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : EPSILON;\n  return Math.abs(a - b) <= tolerance * Math.max(1, Math.abs(a), Math.abs(b));\n}","import * as glMatrix from \"./common.js\";\n\n/**\n * 3x3 Matrix\n * @module mat3\n */\n\n/**\n * Creates a new identity mat3\n *\n * @returns {mat3} a new 3x3 matrix\n */\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(9);\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[5] = 0;\n    out[6] = 0;\n    out[7] = 0;\n  }\n  out[0] = 1;\n  out[4] = 1;\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Copies the upper-left 3x3 values into the given mat3.\n *\n * @param {mat3} out the receiving 3x3 matrix\n * @param {ReadonlyMat4} a   the source 4x4 matrix\n * @returns {mat3} out\n */\nexport function fromMat4(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[4];\n  out[4] = a[5];\n  out[5] = a[6];\n  out[6] = a[8];\n  out[7] = a[9];\n  out[8] = a[10];\n  return out;\n}\n\n/**\n * Creates a new mat3 initialized with values from an existing matrix\n *\n * @param {ReadonlyMat3} a matrix to clone\n * @returns {mat3} a new 3x3 matrix\n */\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(9);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  return out;\n}\n\n/**\n * Copy the values from one mat3 to another\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the source matrix\n * @returns {mat3} out\n */\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  return out;\n}\n\n/**\n * Create a new mat3 with the given values\n *\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m10 Component in column 1, row 0 position (index 3)\n * @param {Number} m11 Component in column 1, row 1 position (index 4)\n * @param {Number} m12 Component in column 1, row 2 position (index 5)\n * @param {Number} m20 Component in column 2, row 0 position (index 6)\n * @param {Number} m21 Component in column 2, row 1 position (index 7)\n * @param {Number} m22 Component in column 2, row 2 position (index 8)\n * @returns {mat3} A new mat3\n */\nexport function fromValues(m00, m01, m02, m10, m11, m12, m20, m21, m22) {\n  var out = new glMatrix.ARRAY_TYPE(9);\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m10;\n  out[4] = m11;\n  out[5] = m12;\n  out[6] = m20;\n  out[7] = m21;\n  out[8] = m22;\n  return out;\n}\n\n/**\n * Set the components of a mat3 to the given values\n *\n * @param {mat3} out the receiving matrix\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m10 Component in column 1, row 0 position (index 3)\n * @param {Number} m11 Component in column 1, row 1 position (index 4)\n * @param {Number} m12 Component in column 1, row 2 position (index 5)\n * @param {Number} m20 Component in column 2, row 0 position (index 6)\n * @param {Number} m21 Component in column 2, row 1 position (index 7)\n * @param {Number} m22 Component in column 2, row 2 position (index 8)\n * @returns {mat3} out\n */\nexport function set(out, m00, m01, m02, m10, m11, m12, m20, m21, m22) {\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m10;\n  out[4] = m11;\n  out[5] = m12;\n  out[6] = m20;\n  out[7] = m21;\n  out[8] = m22;\n  return out;\n}\n\n/**\n * Set a mat3 to the identity matrix\n *\n * @param {mat3} out the receiving matrix\n * @returns {mat3} out\n */\nexport function identity(out) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 1;\n  out[5] = 0;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Transpose the values of a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the source matrix\n * @returns {mat3} out\n */\nexport function transpose(out, a) {\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\n  if (out === a) {\n    var a01 = a[1],\n      a02 = a[2],\n      a12 = a[5];\n    out[1] = a[3];\n    out[2] = a[6];\n    out[3] = a01;\n    out[5] = a[7];\n    out[6] = a02;\n    out[7] = a12;\n  } else {\n    out[0] = a[0];\n    out[1] = a[3];\n    out[2] = a[6];\n    out[3] = a[1];\n    out[4] = a[4];\n    out[5] = a[7];\n    out[6] = a[2];\n    out[7] = a[5];\n    out[8] = a[8];\n  }\n  return out;\n}\n\n/**\n * Inverts a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the source matrix\n * @returns {mat3 | null} out, or null if source matrix is not invertible\n */\nexport function invert(out, a) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2];\n  var a10 = a[3],\n    a11 = a[4],\n    a12 = a[5];\n  var a20 = a[6],\n    a21 = a[7],\n    a22 = a[8];\n  var b01 = a22 * a11 - a12 * a21;\n  var b11 = -a22 * a10 + a12 * a20;\n  var b21 = a21 * a10 - a11 * a20;\n\n  // Calculate the determinant\n  var det = a00 * b01 + a01 * b11 + a02 * b21;\n  if (!det) {\n    return null;\n  }\n  det = 1.0 / det;\n  out[0] = b01 * det;\n  out[1] = (-a22 * a01 + a02 * a21) * det;\n  out[2] = (a12 * a01 - a02 * a11) * det;\n  out[3] = b11 * det;\n  out[4] = (a22 * a00 - a02 * a20) * det;\n  out[5] = (-a12 * a00 + a02 * a10) * det;\n  out[6] = b21 * det;\n  out[7] = (-a21 * a00 + a01 * a20) * det;\n  out[8] = (a11 * a00 - a01 * a10) * det;\n  return out;\n}\n\n/**\n * Calculates the adjugate of a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the source matrix\n * @returns {mat3} out\n */\nexport function adjoint(out, a) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2];\n  var a10 = a[3],\n    a11 = a[4],\n    a12 = a[5];\n  var a20 = a[6],\n    a21 = a[7],\n    a22 = a[8];\n  out[0] = a11 * a22 - a12 * a21;\n  out[1] = a02 * a21 - a01 * a22;\n  out[2] = a01 * a12 - a02 * a11;\n  out[3] = a12 * a20 - a10 * a22;\n  out[4] = a00 * a22 - a02 * a20;\n  out[5] = a02 * a10 - a00 * a12;\n  out[6] = a10 * a21 - a11 * a20;\n  out[7] = a01 * a20 - a00 * a21;\n  out[8] = a00 * a11 - a01 * a10;\n  return out;\n}\n\n/**\n * Calculates the determinant of a mat3\n *\n * @param {ReadonlyMat3} a the source matrix\n * @returns {Number} determinant of a\n */\nexport function determinant(a) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2];\n  var a10 = a[3],\n    a11 = a[4],\n    a12 = a[5];\n  var a20 = a[6],\n    a21 = a[7],\n    a22 = a[8];\n  return a00 * (a22 * a11 - a12 * a21) + a01 * (-a22 * a10 + a12 * a20) + a02 * (a21 * a10 - a11 * a20);\n}\n\n/**\n * Multiplies two mat3's\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the first operand\n * @param {ReadonlyMat3} b the second operand\n * @returns {mat3} out\n */\nexport function multiply(out, a, b) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2];\n  var a10 = a[3],\n    a11 = a[4],\n    a12 = a[5];\n  var a20 = a[6],\n    a21 = a[7],\n    a22 = a[8];\n  var b00 = b[0],\n    b01 = b[1],\n    b02 = b[2];\n  var b10 = b[3],\n    b11 = b[4],\n    b12 = b[5];\n  var b20 = b[6],\n    b21 = b[7],\n    b22 = b[8];\n  out[0] = b00 * a00 + b01 * a10 + b02 * a20;\n  out[1] = b00 * a01 + b01 * a11 + b02 * a21;\n  out[2] = b00 * a02 + b01 * a12 + b02 * a22;\n  out[3] = b10 * a00 + b11 * a10 + b12 * a20;\n  out[4] = b10 * a01 + b11 * a11 + b12 * a21;\n  out[5] = b10 * a02 + b11 * a12 + b12 * a22;\n  out[6] = b20 * a00 + b21 * a10 + b22 * a20;\n  out[7] = b20 * a01 + b21 * a11 + b22 * a21;\n  out[8] = b20 * a02 + b21 * a12 + b22 * a22;\n  return out;\n}\n\n/**\n * Translate a mat3 by the given vector\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the matrix to translate\n * @param {ReadonlyVec2} v vector to translate by\n * @returns {mat3} out\n */\nexport function translate(out, a, v) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2],\n    a10 = a[3],\n    a11 = a[4],\n    a12 = a[5],\n    a20 = a[6],\n    a21 = a[7],\n    a22 = a[8],\n    x = v[0],\n    y = v[1];\n  out[0] = a00;\n  out[1] = a01;\n  out[2] = a02;\n  out[3] = a10;\n  out[4] = a11;\n  out[5] = a12;\n  out[6] = x * a00 + y * a10 + a20;\n  out[7] = x * a01 + y * a11 + a21;\n  out[8] = x * a02 + y * a12 + a22;\n  return out;\n}\n\n/**\n * Rotates a mat3 by the given angle\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat3} out\n */\nexport function rotate(out, a, rad) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2],\n    a10 = a[3],\n    a11 = a[4],\n    a12 = a[5],\n    a20 = a[6],\n    a21 = a[7],\n    a22 = a[8],\n    s = Math.sin(rad),\n    c = Math.cos(rad);\n  out[0] = c * a00 + s * a10;\n  out[1] = c * a01 + s * a11;\n  out[2] = c * a02 + s * a12;\n  out[3] = c * a10 - s * a00;\n  out[4] = c * a11 - s * a01;\n  out[5] = c * a12 - s * a02;\n  out[6] = a20;\n  out[7] = a21;\n  out[8] = a22;\n  return out;\n}\n\n/**\n * Scales the mat3 by the dimensions in the given vec2\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the matrix to scale\n * @param {ReadonlyVec2} v the vec2 to scale the matrix by\n * @returns {mat3} out\n **/\nexport function scale(out, a, v) {\n  var x = v[0],\n    y = v[1];\n  out[0] = x * a[0];\n  out[1] = x * a[1];\n  out[2] = x * a[2];\n  out[3] = y * a[3];\n  out[4] = y * a[4];\n  out[5] = y * a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  return out;\n}\n\n/**\n * Creates a matrix from a vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat3.identity(dest);\n *     mat3.translate(dest, dest, vec);\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {ReadonlyVec2} v Translation vector\n * @returns {mat3} out\n */\nexport function fromTranslation(out, v) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 1;\n  out[5] = 0;\n  out[6] = v[0];\n  out[7] = v[1];\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from a given angle\n * This is equivalent to (but much faster than):\n *\n *     mat3.identity(dest);\n *     mat3.rotate(dest, dest, rad);\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat3} out\n */\nexport function fromRotation(out, rad) {\n  var s = Math.sin(rad),\n    c = Math.cos(rad);\n  out[0] = c;\n  out[1] = s;\n  out[2] = 0;\n  out[3] = -s;\n  out[4] = c;\n  out[5] = 0;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from a vector scaling\n * This is equivalent to (but much faster than):\n *\n *     mat3.identity(dest);\n *     mat3.scale(dest, dest, vec);\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {ReadonlyVec2} v Scaling vector\n * @returns {mat3} out\n */\nexport function fromScaling(out, v) {\n  out[0] = v[0];\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = v[1];\n  out[5] = 0;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Copies the values from a mat2d into a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat2d} a the matrix to copy\n * @returns {mat3} out\n **/\nexport function fromMat2d(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = 0;\n  out[3] = a[2];\n  out[4] = a[3];\n  out[5] = 0;\n  out[6] = a[4];\n  out[7] = a[5];\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Calculates a 3x3 matrix from the given quaternion\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {ReadonlyQuat} q Quaternion to create matrix from\n *\n * @returns {mat3} out\n */\nexport function fromQuat(out, q) {\n  var x = q[0],\n    y = q[1],\n    z = q[2],\n    w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var yx = y * x2;\n  var yy = y * y2;\n  var zx = z * x2;\n  var zy = z * y2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - yy - zz;\n  out[3] = yx - wz;\n  out[6] = zx + wy;\n  out[1] = yx + wz;\n  out[4] = 1 - xx - zz;\n  out[7] = zy - wx;\n  out[2] = zx - wy;\n  out[5] = zy + wx;\n  out[8] = 1 - xx - yy;\n  return out;\n}\n\n/**\n * Calculates a 3x3 normal matrix (transpose inverse) from the 4x4 matrix\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {ReadonlyMat4} a Mat4 to derive the normal matrix from\n *\n * @returns {mat3} out\n */\nexport function normalFromMat4(out, a) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2],\n    a03 = a[3];\n  var a10 = a[4],\n    a11 = a[5],\n    a12 = a[6],\n    a13 = a[7];\n  var a20 = a[8],\n    a21 = a[9],\n    a22 = a[10],\n    a23 = a[11];\n  var a30 = a[12],\n    a31 = a[13],\n    a32 = a[14],\n    a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32;\n\n  // Calculate the determinant\n  var det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n  if (!det) {\n    return null;\n  }\n  det = 1.0 / det;\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n  out[1] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n  out[2] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n  out[3] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n  out[4] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n  out[5] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n  out[6] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n  out[7] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n  out[8] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n  return out;\n}\n\n/**\n * Generates a 2D projection matrix with the given bounds\n *\n * @param {mat3} out mat3 frustum matrix will be written into\n * @param {number} width Width of your gl context\n * @param {number} height Height of gl context\n * @returns {mat3} out\n */\nexport function projection(out, width, height) {\n  out[0] = 2 / width;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = -2 / height;\n  out[5] = 0;\n  out[6] = -1;\n  out[7] = 1;\n  out[8] = 1;\n  return out;\n}\n\n/**\n * Returns a string representation of a mat3\n *\n * @param {ReadonlyMat3} a matrix to represent as a string\n * @returns {String} string representation of the matrix\n */\nexport function str(a) {\n  return \"mat3(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \", \" + a[4] + \", \" + a[5] + \", \" + a[6] + \", \" + a[7] + \", \" + a[8] + \")\";\n}\n\n/**\n * Returns Frobenius norm of a mat3\n *\n * @param {ReadonlyMat3} a the matrix to calculate Frobenius norm of\n * @returns {Number} Frobenius norm\n */\nexport function frob(a) {\n  return Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2] + a[3] * a[3] + a[4] * a[4] + a[5] * a[5] + a[6] * a[6] + a[7] * a[7] + a[8] * a[8]);\n}\n\n/**\n * Adds two mat3's\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the first operand\n * @param {ReadonlyMat3} b the second operand\n * @returns {mat3} out\n */\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  out[4] = a[4] + b[4];\n  out[5] = a[5] + b[5];\n  out[6] = a[6] + b[6];\n  out[7] = a[7] + b[7];\n  out[8] = a[8] + b[8];\n  return out;\n}\n\n/**\n * Subtracts matrix b from matrix a\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the first operand\n * @param {ReadonlyMat3} b the second operand\n * @returns {mat3} out\n */\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  out[4] = a[4] - b[4];\n  out[5] = a[5] - b[5];\n  out[6] = a[6] - b[6];\n  out[7] = a[7] - b[7];\n  out[8] = a[8] - b[8];\n  return out;\n}\n\n/**\n * Multiply each element of the matrix by a scalar.\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the matrix to scale\n * @param {Number} b amount to scale the matrix's elements by\n * @returns {mat3} out\n */\nexport function multiplyScalar(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  out[4] = a[4] * b;\n  out[5] = a[5] * b;\n  out[6] = a[6] * b;\n  out[7] = a[7] * b;\n  out[8] = a[8] * b;\n  return out;\n}\n\n/**\n * Adds two mat3's after multiplying each element of the second operand by a scalar value.\n *\n * @param {mat3} out the receiving vector\n * @param {ReadonlyMat3} a the first operand\n * @param {ReadonlyMat3} b the second operand\n * @param {Number} scale the amount to scale b's elements by before adding\n * @returns {mat3} out\n */\nexport function multiplyScalarAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  out[3] = a[3] + b[3] * scale;\n  out[4] = a[4] + b[4] * scale;\n  out[5] = a[5] + b[5] * scale;\n  out[6] = a[6] + b[6] * scale;\n  out[7] = a[7] + b[7] * scale;\n  out[8] = a[8] + b[8] * scale;\n  return out;\n}\n\n/**\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyMat3} a The first matrix.\n * @param {ReadonlyMat3} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] && a[8] === b[8];\n}\n\n/**\n * Returns whether or not the matrices have approximately the same elements in the same position.\n *\n * @param {ReadonlyMat3} a The first matrix.\n * @param {ReadonlyMat3} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\nexport function equals(a, b) {\n  var a0 = a[0],\n    a1 = a[1],\n    a2 = a[2],\n    a3 = a[3],\n    a4 = a[4],\n    a5 = a[5],\n    a6 = a[6],\n    a7 = a[7],\n    a8 = a[8];\n  var b0 = b[0],\n    b1 = b[1],\n    b2 = b[2],\n    b3 = b[3],\n    b4 = b[4],\n    b5 = b[5],\n    b6 = b[6],\n    b7 = b[7],\n    b8 = b[8];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7)) && Math.abs(a8 - b8) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a8), Math.abs(b8));\n}\n\n/**\n * Alias for {@link mat3.multiply}\n * @function\n */\nexport var mul = multiply;\n\n/**\n * Alias for {@link mat3.subtract}\n * @function\n */\nexport var sub = subtract;","import * as glMatrix from \"./common.js\";\n\n/**\n * 2 Dimensional Vector\n * @module vec2\n */\n\n/**\n * Creates a new, empty vec2\n *\n * @returns {vec2} a new 2D vector\n */\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(2);\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n  }\n  return out;\n}\n\n/**\n * Creates a new vec2 initialized with values from an existing vector\n *\n * @param {ReadonlyVec2} a vector to clone\n * @returns {vec2} a new 2D vector\n */\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(2);\n  out[0] = a[0];\n  out[1] = a[1];\n  return out;\n}\n\n/**\n * Creates a new vec2 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @returns {vec2} a new 2D vector\n */\nexport function fromValues(x, y) {\n  var out = new glMatrix.ARRAY_TYPE(2);\n  out[0] = x;\n  out[1] = y;\n  return out;\n}\n\n/**\n * Copy the values from one vec2 to another\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the source vector\n * @returns {vec2} out\n */\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  return out;\n}\n\n/**\n * Set the components of a vec2 to the given values\n *\n * @param {vec2} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @returns {vec2} out\n */\nexport function set(out, x, y) {\n  out[0] = x;\n  out[1] = y;\n  return out;\n}\n\n/**\n * Adds two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  return out;\n}\n\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  return out;\n}\n\n/**\n * Multiplies two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  return out;\n}\n\n/**\n * Divides two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  return out;\n}\n\n/**\n * Math.ceil the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to ceil\n * @returns {vec2} out\n */\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  return out;\n}\n\n/**\n * Math.floor the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to floor\n * @returns {vec2} out\n */\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  return out;\n}\n\n/**\n * Returns the minimum of two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  return out;\n}\n\n/**\n * Returns the maximum of two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  return out;\n}\n\n/**\n * symmetric round the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to round\n * @returns {vec2} out\n */\nexport function round(out, a) {\n  out[0] = glMatrix.round(a[0]);\n  out[1] = glMatrix.round(a[1]);\n  return out;\n}\n\n/**\n * Scales a vec2 by a scalar number\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec2} out\n */\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  return out;\n}\n\n/**\n * Adds two vec2's after scaling the second operand by a scalar value\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec2} out\n */\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  return out;\n}\n\n/**\n * Calculates the euclidian distance between two vec2's\n *\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {Number} distance between a and b\n */\nexport function distance(a, b) {\n  var x = b[0] - a[0],\n    y = b[1] - a[1];\n  return Math.sqrt(x * x + y * y);\n}\n\n/**\n * Calculates the squared euclidian distance between two vec2's\n *\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {Number} squared distance between a and b\n */\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0],\n    y = b[1] - a[1];\n  return x * x + y * y;\n}\n\n/**\n * Calculates the length of a vec2\n *\n * @param {ReadonlyVec2} a vector to calculate length of\n * @returns {Number} length of a\n */\nexport function length(a) {\n  var x = a[0],\n    y = a[1];\n  return Math.sqrt(x * x + y * y);\n}\n\n/**\n * Calculates the squared length of a vec2\n *\n * @param {ReadonlyVec2} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\nexport function squaredLength(a) {\n  var x = a[0],\n    y = a[1];\n  return x * x + y * y;\n}\n\n/**\n * Negates the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to negate\n * @returns {vec2} out\n */\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  return out;\n}\n\n/**\n * Returns the inverse of the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to invert\n * @returns {vec2} out\n */\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  return out;\n}\n\n/**\n * Normalize a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to normalize\n * @returns {vec2} out\n */\nexport function normalize(out, a) {\n  var x = a[0],\n    y = a[1];\n  var len = x * x + y * y;\n  if (len > 0) {\n    //TODO: evaluate use of glm_invsqrt here?\n    len = 1 / Math.sqrt(len);\n  }\n  out[0] = a[0] * len;\n  out[1] = a[1] * len;\n  return out;\n}\n\n/**\n * Calculates the dot product of two vec2's\n *\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {Number} dot product of a and b\n */\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1];\n}\n\n/**\n * Computes the cross product of two vec2's\n * Note that the cross product must by definition produce a 3D vector\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec3} out\n */\nexport function cross(out, a, b) {\n  var z = a[0] * b[1] - a[1] * b[0];\n  out[0] = out[1] = 0;\n  out[2] = z;\n  return out;\n}\n\n/**\n * Performs a linear interpolation between two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec2} out\n */\nexport function lerp(out, a, b, t) {\n  var ax = a[0],\n    ay = a[1];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  return out;\n}\n\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec2} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If omitted, a unit vector will be returned\n * @returns {vec2} out\n */\nexport function random(out, scale) {\n  scale = scale === undefined ? 1.0 : scale;\n  var r = glMatrix.RANDOM() * 2.0 * Math.PI;\n  out[0] = Math.cos(r) * scale;\n  out[1] = Math.sin(r) * scale;\n  return out;\n}\n\n/**\n * Transforms the vec2 with a mat2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat2} m matrix to transform with\n * @returns {vec2} out\n */\nexport function transformMat2(out, a, m) {\n  var x = a[0],\n    y = a[1];\n  out[0] = m[0] * x + m[2] * y;\n  out[1] = m[1] * x + m[3] * y;\n  return out;\n}\n\n/**\n * Transforms the vec2 with a mat2d\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat2d} m matrix to transform with\n * @returns {vec2} out\n */\nexport function transformMat2d(out, a, m) {\n  var x = a[0],\n    y = a[1];\n  out[0] = m[0] * x + m[2] * y + m[4];\n  out[1] = m[1] * x + m[3] * y + m[5];\n  return out;\n}\n\n/**\n * Transforms the vec2 with a mat3\n * 3rd vector component is implicitly '1'\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat3} m matrix to transform with\n * @returns {vec2} out\n */\nexport function transformMat3(out, a, m) {\n  var x = a[0],\n    y = a[1];\n  out[0] = m[0] * x + m[3] * y + m[6];\n  out[1] = m[1] * x + m[4] * y + m[7];\n  return out;\n}\n\n/**\n * Transforms the vec2 with a mat4\n * 3rd vector component is implicitly '0'\n * 4th vector component is implicitly '1'\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat4} m matrix to transform with\n * @returns {vec2} out\n */\nexport function transformMat4(out, a, m) {\n  var x = a[0];\n  var y = a[1];\n  out[0] = m[0] * x + m[4] * y + m[12];\n  out[1] = m[1] * x + m[5] * y + m[13];\n  return out;\n}\n\n/**\n * Rotate a 2D vector\n * @param {vec2} out The receiving vec2\n * @param {ReadonlyVec2} a The vec2 point to rotate\n * @param {ReadonlyVec2} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec2} out\n */\nexport function rotate(out, a, b, rad) {\n  //Translate point to the origin\n  var p0 = a[0] - b[0],\n    p1 = a[1] - b[1],\n    sinC = Math.sin(rad),\n    cosC = Math.cos(rad);\n\n  //perform rotation and translate to correct position\n  out[0] = p0 * cosC - p1 * sinC + b[0];\n  out[1] = p0 * sinC + p1 * cosC + b[1];\n  return out;\n}\n\n/**\n * Get the smallest angle between two 2D vectors\n * @param {ReadonlyVec2} a The first operand\n * @param {ReadonlyVec2} b The second operand\n * @returns {Number} The angle in radians\n */\nexport function angle(a, b) {\n  var ax = a[0],\n    ay = a[1],\n    bx = b[0],\n    by = b[1];\n  return Math.abs(Math.atan2(ay * bx - ax * by, ax * bx + ay * by));\n}\n\n/**\n * Get the signed angle in the interval [-pi,pi] between two 2D vectors (positive if `a` is to the right of `b`)\n * \n * @param {ReadonlyVec2} a The first vector\n * @param {ReadonlyVec2} b The second vector\n * @returns {number} The signed angle in radians\n */\nexport function signedAngle(a, b) {\n  var ax = a[0],\n    ay = a[1],\n    bx = b[0],\n    by = b[1];\n  return Math.atan2(ax * by - ay * bx, ax * bx + ay * by);\n}\n\n/**\n * Set the components of a vec2 to zero\n *\n * @param {vec2} out the receiving vector\n * @returns {vec2} out\n */\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  return out;\n}\n\n/**\n * Returns a string representation of a vector\n *\n * @param {ReadonlyVec2} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\nexport function str(a) {\n  return \"vec2(\" + a[0] + \", \" + a[1] + \")\";\n}\n\n/**\n * Returns whether or not the vectors exactly have the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyVec2} a The first vector.\n * @param {ReadonlyVec2} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1];\n}\n\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {ReadonlyVec2} a The first vector.\n * @param {ReadonlyVec2} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\nexport function equals(a, b) {\n  var a0 = a[0],\n    a1 = a[1];\n  var b0 = b[0],\n    b1 = b[1];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1));\n}\n\n/**\n * Alias for {@link vec2.length}\n * @function\n */\nexport var len = length;\n\n/**\n * Alias for {@link vec2.subtract}\n * @function\n */\nexport var sub = subtract;\n\n/**\n * Alias for {@link vec2.multiply}\n * @function\n */\nexport var mul = multiply;\n\n/**\n * Alias for {@link vec2.divide}\n * @function\n */\nexport var div = divide;\n\n/**\n * Alias for {@link vec2.distance}\n * @function\n */\nexport var dist = distance;\n\n/**\n * Alias for {@link vec2.squaredDistance}\n * @function\n */\nexport var sqrDist = squaredDistance;\n\n/**\n * Alias for {@link vec2.squaredLength}\n * @function\n */\nexport var sqrLen = squaredLength;\n\n/**\n * Perform some operation over an array of vec2s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec2. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec2s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n    if (!stride) {\n      stride = 2;\n    }\n    if (!offset) {\n      offset = 0;\n    }\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n    }\n    return a;\n  };\n}();","import { Component } from \"../ecs/decorators/Component\";\r\nimport { IComponent } from \"../ecs/interface/IComponent\";\r\nimport { mat3 } from \"gl-matrix\";\r\nimport { Engine } from \"../ecs/Engine.ts\";\r\n@Component('Transform')\r\nexport class Transform implements IComponent {\r\n  #x = 0;\r\n  #y = 0;\r\n  #scaleX = 1;\r\n  #scaleY = 1;\r\n  #rotation = 0;\r\n  #skewX = 0;\r\n  #skewY = 0;\r\n  #pivotX = 0;\r\n  #pivotY = 0;\r\n\r\n  localMatrix = mat3.create();\r\n  worldMatrix = mat3.create();\r\n  dirty = true;\r\n  #engine: Engine | null;\r\n  constructor(engine: Engine | null, params: Partial<Transform> = {}) {\r\n    this.#engine = engine;\r\n    this.#engine;\r\n    const keys = [\"x\", \"y\", \"scaleX\", \"scaleY\", \"rotation\", \"skewX\", \"skewY\", \"pivotX\", \"pivotY\"] as const;\r\n    for (const key of keys) {\r\n      if (params[key] !== undefined) { this[key] = params[key]!; }\r\n    }\r\n  }\r\n\r\n  get x() { return this.#x; }\r\n  set x(v: number) { this.#x = v; this.dirty = true; }\r\n\r\n  get y() { return this.#y; }\r\n  set y(v: number) { this.#y = v; this.dirty = true; }\r\n\r\n  get scaleX() { return this.#scaleX; }\r\n  set scaleX(v: number) { this.#scaleX = v; this.dirty = true; }\r\n\r\n  get scaleY() { return this.#scaleY; }\r\n  set scaleY(v: number) { this.#scaleY = v; this.dirty = true; }\r\n\r\n  get rotation() { return this.#rotation; }\r\n  set rotation(v: number) { this.#rotation = v; this.dirty = true; }\r\n\r\n  get skewX() { return this.#skewX; }\r\n  set skewX(v: number) { this.#skewX = v; this.dirty = true; }\r\n\r\n  get skewY() { return this.#skewY; }\r\n  set skewY(v: number) { this.#skewY = v; this.dirty = true; }\r\n\r\n  get pivotX() { return this.#pivotX; }\r\n  set pivotX(v: number) { this.#pivotX = v; this.dirty = true; }\r\n\r\n  get pivotY() { return this.#pivotY; }\r\n  set pivotY(v: number) { this.#pivotY = v; this.dirty = true; }\r\n}\r\n","// src/ecs/RootEntity.ts\r\nimport { Engine } from \"./Engine.ts\";\r\nimport { Transform } from \"../components/Transform.ts\";\r\n\r\nexport class RootEntity {\r\n    public readonly entityId: number;\r\n\r\n    constructor(private engine: Engine) {\r\n        this.entityId = this.engine.ecs.createEntity();\r\n        this.engine.ecs.addComponent(this.entityId, new Transform(this.engine, { x: 0, y: 0, }));\r\n    }\r\n\r\n    /**\r\n     * 获取 Transform 组件\r\n     */\r\n    get transform(): Transform | undefined {\r\n        return this.engine.ecs.getComponent(this.entityId, Transform);\r\n    }\r\n}\r\n","import type { ECS } from \"./ECS.ts\";\r\nimport { Engine } from \"./Engine.ts\";\r\nimport { SceneTree } from \"./SceneTree.ts\";\r\n\r\nexport abstract class ISystem {\r\n    ecs!: ECS;\r\n    constructor(public engine: Engine, public sceneTree: SceneTree) { }\r\n    init(ecs: ECS): void {\r\n        this.ecs = ecs;\r\n        this.onInit();\r\n    }\r\n\r\n    protected onInit(): void {\r\n    }\r\n    abstract update(delta: number): void;\r\n}\r\n/**\r\n * 系统类构造函数类型\r\n * T 是 ISystem 的子类\r\n */\r\nexport type ISystemClass<T extends ISystem = ISystem> = new (engine: Engine, sceneTree: SceneTree) => T;","import { Component } from \"../../ecs/decorators/Component\";\r\nimport { IComponent } from \"../../ecs/interface/IComponent\";\r\nimport { RenderComponent } from \"./RenderComponent.ts\";\r\nimport { Engine } from \"../../ecs/Engine.ts\";\r\n\r\n/**\r\n * 矩形组件，仅存储渲染数据\r\n * 不包含绘制逻辑，系统负责渲染\r\n */\r\n@Component(\"Rect\")\r\nexport class Rect extends RenderComponent implements IComponent {\r\n  width: number;\r\n  height: number;\r\n  render: boolean = true;\r\n  fillStyle: string;\r\n  strokeStyle?: string;\r\n  lineWidth: number;\r\n  alpha: number;\r\n  radius: number;\r\n  constructor(engine: Engine | null, {\r\n    width = 0,\r\n    height = 0,\r\n    fillStyle = \"#181b1dff\",\r\n    strokeStyle,\r\n    lineWidth = 0,\r\n    alpha = 1.0,\r\n    render = true,\r\n    radius = 0,\r\n  }: Partial<Rect> = {}) {\r\n    super(engine);\r\n    this.width = width;\r\n    this.height = height;\r\n    this.fillStyle = fillStyle || \"#181b1dff\";\r\n    this.strokeStyle = strokeStyle || \"#181b1dff\";\r\n    this.lineWidth = lineWidth || 0;\r\n    this.alpha = alpha || 1.0;\r\n    this.radius = radius || 0;\r\n    this.render = render;\r\n  }\r\n}\r\n\r\n","import { ECS } from \"../../ecs/ECS.ts\";\r\nimport { Transform } from \"../../components/Transform.ts\";\r\nimport { Rect } from \"../../components/render/Rect.ts\";\r\nimport { IProcess } from \"../../ecs/interface/IRender.ts\";\r\nimport type { ISystem } from \"../../ecs/System.ts\";\r\n\r\n/**\r\n * 渲染器：负责绘制 Rect 组件（支持圆角矩形）\r\n */\r\nexport class RectRenderer implements IProcess {\r\n    match(ecs: ECS, entityId: number) {\r\n        return ecs.hasComponent(entityId, Rect);\r\n    }\r\n\r\n    exec(system: ISystem, entityId: number) {\r\n        const ecs = system.ecs;\r\n        const ctx = ecs.canvas.getContext(\"2d\")!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n        const rect = ecs.getComponent(entityId, Rect)!;\r\n        if (!rect.render) return;\r\n\r\n        ctx.save();\r\n        ctx.globalAlpha = rect.alpha;\r\n\r\n        const m = transform.worldMatrix;\r\n        ctx.setTransform(\r\n            m[0], // a = m00\r\n            m[1], // b = m10\r\n            m[3], // c = m01\r\n            m[4], // d = m11\r\n            m[6], // e = m20 (平移x)\r\n            m[7]  // f = m21 (平移y)\r\n        );\r\n\r\n        // 支持圆角矩形\r\n        const { width, height, radius = 0 } = rect;\r\n        ctx.beginPath();\r\n        if (radius > 0) {\r\n            // 使用 modern Canvas API roundRect（兼容大多数浏览器）\r\n            ctx.roundRect(0, 0, width, height, radius);\r\n        } else {\r\n            ctx.rect(0, 0, width, height);\r\n        }\r\n\r\n        if (rect.fillStyle) {\r\n            ctx.fillStyle = rect.fillStyle;\r\n            ctx.fill();\r\n        }\r\n\r\n        if (rect.strokeStyle && rect.lineWidth > 0) {\r\n            ctx.strokeStyle = rect.strokeStyle;\r\n            ctx.lineWidth = rect.lineWidth;\r\n            ctx.stroke();\r\n        }\r\n\r\n        ctx.restore();\r\n    }\r\n}\r\n","import { Component } from \"../../ecs/decorators/Component\";\r\nimport { IComponent } from \"../../ecs/interface/IComponent\";\r\nimport { RenderComponent } from \"./RenderComponent.ts\";\r\nimport { Engine } from \"../../ecs/Engine.ts\";\r\n\r\n/**\r\n * Circle（兼容椭圆与圆弧）\r\n * 若 radiusY 与 radius 相同，则为圆形；否则为椭圆。\r\n * 可通过 startAngle、endAngle 和 clockwise 绘制圆弧。\r\n */\r\n@Component(\"Circle\")\r\nexport class Circle extends RenderComponent implements IComponent {\r\n  render = true;\r\n\r\n  /** 主半径（x 方向） */\r\n  radius: number;\r\n  /** 次半径（y 方向，默认为 radius） */\r\n  radiusY!: number;\r\n  /** 填充颜色 */\r\n  fillStyle: string;\r\n  /** 描边颜色 */\r\n  strokeStyle?: string;\r\n  /** 描边宽度 */\r\n  lineWidth: number;\r\n  /** 透明度 */\r\n  alpha: number;\r\n  /** 椭圆旋转角度（弧度） */\r\n  rotation: number;\r\n\r\n  /** 圆弧起始角度（弧度，0 = 3点钟方向） */\r\n  startAngle: number;\r\n  /** 圆弧结束角度（弧度） */\r\n  endAngle: number;\r\n  /** 是否顺时针绘制圆弧（默认为 true） */\r\n  clockwise: boolean;\r\n\r\n  constructor(\r\n    engine: Engine | null,\r\n    {\r\n      radius = 10,\r\n      radiusY, // 可选，不传时自动与 radius 相等\r\n      fillStyle = \"#e74c3c\",\r\n      strokeStyle,\r\n      lineWidth = 0,\r\n      alpha = 1.0,\r\n      rotation = 0,\r\n      render = true,\r\n      startAngle = 0,\r\n      endAngle = Math.PI * 2,\r\n      clockwise = true,\r\n    }: Partial<Circle> = {}\r\n  ) {\r\n    super(engine);\r\n    this.radius = radius;\r\n    if (radiusY) this.radiusY = radiusY; // 默认与 radius 相等（圆形）\r\n    this.fillStyle = fillStyle;\r\n    this.strokeStyle = strokeStyle ?? \"#c0392b\";\r\n    this.lineWidth = lineWidth;\r\n    this.alpha = alpha;\r\n    this.rotation = rotation;\r\n    this.render = render;\r\n    this.startAngle = startAngle;\r\n    this.endAngle = endAngle;\r\n    this.clockwise = clockwise;\r\n  }\r\n\r\n  /** 是否是圆形（辅助判断） */\r\n  get isCircle(): boolean {\r\n    return this.radius === this.radiusY;\r\n  }\r\n\r\n  /** 是否是完整圆或完整椭圆（start = 0, end = 2π） */\r\n  get isFullCircle(): boolean {\r\n    return (\r\n      Math.abs(this.endAngle - this.startAngle) >= Math.PI * 2 &&\r\n      this.isCircle\r\n    );\r\n  }\r\n}\r\n","import { ECS } from \"../../ecs/ECS.ts\";\r\nimport { Transform } from \"../../components/Transform.ts\";\r\nimport { Circle } from \"../../components/render/Circle.ts\";\r\nimport { IProcess } from \"../../ecs/interface/IRender.ts\";\r\nimport type { ISystem } from \"../../ecs/System.ts\";\r\n\r\n/**\r\n * 渲染器：负责绘制 Circle 组件\r\n * Canvas API 原生渲染，startAngle/endAngle/clockwise 原样使用\r\n */\r\nexport class CircleRenderer implements IProcess {\r\n  match(ecs: ECS, entityId: number) {\r\n    return ecs.hasComponent(entityId, Circle);\r\n  }\r\n\r\n  exec(system: ISystem, entityId: number) {\r\n    const ecs = system.ecs;\r\n    const ctx = ecs.canvas.getContext(\"2d\")!;\r\n    const transform = ecs.getComponent(entityId, Transform)!;\r\n    const circle = ecs.getComponent(entityId, Circle)!;\r\n    if (!circle.render) return;\r\n\r\n    ctx.save();\r\n    ctx.globalAlpha = circle.alpha;\r\n\r\n    // 应用世界变换矩阵\r\n    const m = transform.worldMatrix;\r\n    ctx.setTransform(\r\n      m[0], m[1], m[3], m[4], m[6], m[7]\r\n    );\r\n\r\n    const { radius, radiusY = radius, rotation = 0, startAngle = 0, endAngle = Math.PI*2, clockwise = false } = circle;\r\n    ctx.beginPath();\r\n    if (radiusY === radius) {\r\n      // 圆 / 圆弧\r\n      ctx.arc(0, 0, radius, startAngle, endAngle, !!clockwise);\r\n    } else {\r\n      // 椭圆 / 椭圆弧\r\n      ctx.ellipse(0, 0, radius, radiusY, rotation, startAngle, endAngle, !!clockwise);\r\n    }\r\n\r\n    // 填充\r\n    if (circle.fillStyle) {\r\n      ctx.fillStyle = circle.fillStyle;\r\n      ctx.fill();\r\n    }\r\n\r\n    // 描边\r\n    if (circle.strokeStyle && circle.lineWidth > 0) {\r\n      ctx.strokeStyle = circle.strokeStyle;\r\n      ctx.lineWidth = circle.lineWidth;\r\n      ctx.stroke();\r\n    }\r\n\r\n    ctx.restore();\r\n  }\r\n}\r\n","import { Component } from \"../../ecs/decorators/Component\";\r\nimport { IComponent } from \"../../ecs/interface/IComponent\";\r\nimport { RenderComponent } from \"./RenderComponent.ts\";\r\nimport { Engine } from \"../../ecs/Engine.ts\";\r\n\r\n/**\r\n * 图片组件，仅存储渲染数据\r\n * 不包含绘制逻辑，系统负责渲染\r\n */\r\n@Component(\"Image\")\r\nexport class Image extends RenderComponent implements IComponent {\r\n    #bitmap: ImageBitmap | null = null;  // 私有 bitmap\r\n    #width: number = 0;                   // 私有宽度\r\n    #height: number = 0;                  // 私有高度\r\n    alpha: number = 1.0;                  // 透明度\r\n    render: boolean = true;               // 是否渲染\r\n    clip?: [number, number, number, number] = undefined; // 裁剪区域 [x, y, w, h]\r\n    constructor(engine: Engine | null, params: Partial<Image> = {}) {\r\n        super(engine);\r\n        if (params.clip !== undefined) this.clip = params.clip;\r\n        if (params.bitmap !== undefined) this.bitmap = params.bitmap;\r\n        if (params.width !== undefined) this.width = params.width;\r\n        if (params.height !== undefined) this.height = params.height;\r\n        if (params.alpha !== undefined) this.alpha = params.alpha;\r\n        if (params.render !== undefined) this.render = params.render;\r\n    }\r\n    get bitmap(): ImageBitmap | null {\r\n        return this.#bitmap;\r\n    }\r\n    set bitmap(value: ImageBitmap | null) {\r\n        this.#bitmap = value;\r\n        // 如果 width/height 未设置，则默认取 bitmap 尺寸\r\n        if (value && this.#width === 0) this.#width = value.width;\r\n        if (value && this.#height === 0) this.#height = value.height;\r\n    }\r\n\r\n    get width(): number {\r\n        return this.#width;\r\n    }\r\n    set width(value: number) {\r\n        this.#width = value;\r\n    }\r\n\r\n    get height(): number {\r\n        return this.#height;\r\n    }\r\n    set height(value: number) {\r\n        this.#height = value;\r\n    }\r\n}","import { ECS } from \"../../ecs/ECS.ts\";\r\nimport { Transform } from \"../../components/Transform.ts\";\r\nimport { Image } from \"../../components/render/Image.ts\";\r\nimport { IProcess } from \"../../ecs/interface/IRender.ts\";\r\nimport type { ISystem } from \"../../ecs/System.ts\";\r\n\r\n/**\r\n * 渲染器：负责绘制 Image 组件\r\n */\r\nexport class ImageRenderer implements IProcess {\r\n\r\n  match(ecs: ECS, entityId: number) {\r\n    return ecs.hasComponent(entityId, Image);\r\n  }\r\n\r\n  exec(system: ISystem, entityId: number) {\r\n    const ecs = system.ecs;\r\n    const ctx = ecs.canvas.getContext(\"2d\")!;\r\n\r\n    const transform = ecs.getComponent(entityId, Transform)!;\r\n    const image = ecs.getComponent(entityId, Image)!;\r\n    if (!image.render) return;\r\n    if (!image.bitmap) return; // 没有纹理就不画\r\n\r\n    ctx.save();\r\n    ctx.globalAlpha = image.alpha;\r\n    const [clipX, clipY, clipW, clipH] = image.clip || [0, 0, image.bitmap.width, image.bitmap.height];\r\n    // 应用世界矩阵\r\n    const m = transform.worldMatrix;\r\n    ctx.setTransform(\r\n      m[0], // a = m00\r\n      m[1], // b = m10\r\n      m[3], // c = m01\r\n      m[4], // d = m11\r\n      m[6], // e = m20\r\n      m[7]  // f = m21\r\n    );\r\n    // 绘制图片，缩放到指定大小\r\n    ctx.drawImage(\r\n      image.bitmap,\r\n      clipX, clipY,\r\n      clipW, clipH,\r\n\r\n      0, 0,                       // 目标起点\r\n      image.width,                // 目标宽\r\n      image.height                // 目标高\r\n    );\r\n\r\n    ctx.restore();\r\n  }\r\n}\r\n","import { Component } from \"../ecs/decorators/Component\";\r\nimport { IComponent } from \"../ecs/interface/IComponent\";\r\nimport { IAABB } from \"../interface/AABB\";\r\n\r\n/**\r\n * BoundingBoxComponent\r\n * 维护三类包围盒：\r\n * - selfAABB: 当前节点自身图形\r\n * - childrenAABB: 所有子节点包围盒\r\n * - totalAABB: self + children\r\n */\r\n@Component(\"BoundingBoxComponent\")\r\nexport class BoundingBoxComponent implements IComponent {\r\n    // 当前节点自身图形包围盒\r\n    selfAABB: IAABB = { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity };\r\n    childrenAABB: IAABB = { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity };\r\n    totalAABB: IAABB = { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity };\r\n    dirty: boolean = true;\r\n    constructor() { }\r\n    reset() {\r\n        this.selfAABB = { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity };\r\n        this.childrenAABB = { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity };\r\n        this.totalAABB = { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity };\r\n    }\r\n    // 设置自身 AABB\r\n    setSelf(aabb: IAABB) {\r\n        this.selfAABB.minX = aabb.minX;\r\n        this.selfAABB.minY = aabb.minY;\r\n        this.selfAABB.maxX = aabb.maxX;\r\n        this.selfAABB.maxY = aabb.maxY;\r\n        this.dirty = true; \r\n    }\r\n\r\n    // 设置子节点 AABB\r\n    setChildren(aabb: IAABB) {\r\n        this.childrenAABB.minX = aabb.minX;\r\n        this.childrenAABB.minY = aabb.minY;\r\n        this.childrenAABB.maxX = aabb.maxX;\r\n        this.childrenAABB.maxY = aabb.maxY;\r\n        this.dirty = true; \r\n    }\r\n\r\n    // 计算总包围盒（self + children）\r\n    updateTotalAABB() {\r\n        this.totalAABB = { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity };\r\n        this.merge(this.totalAABB, this.selfAABB);\r\n        this.merge(this.totalAABB, this.childrenAABB);\r\n        this.dirty = false;\r\n    }\r\n\r\n    // 命中检测（可以选择 self / children / total）\r\n    hitTest(px: number, py: number, type: \"self\" | \"children\" | \"total\" = \"total\"): boolean {\r\n        let box: IAABB;\r\n        switch (type) {\r\n            case \"self\": box = this.selfAABB; break;\r\n            case \"children\": box = this.childrenAABB; break;\r\n            case \"total\": box = this.totalAABB; break;\r\n        }\r\n        return px >= box.minX && py >= box.minY && px <= box.maxX && py <= box.maxY;\r\n    }\r\n    merge(a1: IAABB, a2: IAABB) {\r\n        a1.minX = Math.min(a1.minX, a2.minX);\r\n        a1.minY = Math.min(a1.minY, a2.minY);\r\n        a1.maxX = Math.max(a1.maxX, a2.maxX);\r\n        a1.maxY = Math.max(a1.maxY, a2.maxY);\r\n    }\r\n}\r\n","import { ECS } from \"../ecs/ECS.ts\";\r\nimport { Transform } from \"../components/Transform.ts\";\r\nimport { IProcess } from \"../ecs/interface/IRender.ts\";\r\nimport { mat3 } from \"gl-matrix\";\r\nimport { BoundingBoxComponent } from \"../components/BoundingBoxComponent.ts\";\r\nimport type { ISystem } from \"../ecs/System.ts\";\r\n\r\nconst unit = mat3.create();\r\nexport class TransformProcess implements IProcess<{ dirty: boolean }, { dirty: boolean }> {\r\n    match(ecs: ECS, entityId: number) {\r\n        return true || ecs.hasComponent(entityId, Transform);\r\n    }\r\n    /**\r\n     * 执行渲染逻辑\r\n     */\r\n    exec(system: ISystem, entityId: number, _parentEntityId: number | null, context: { dirty: boolean }, parentContext: { dirty: boolean } | null) {\r\n        const ecs = system.ecs;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n        context.dirty = transform.dirty;\r\n        const needUpdate = context.dirty || (parentContext ? parentContext.dirty : false);\r\n        if (!needUpdate) return;\r\n        // 向未来子节点传递 dirty 标记\r\n        context.dirty = true;\r\n        transform.dirty = false;\r\n        // 标记包围盒\r\n        const boundingBox = system.ecs.getComponent(entityId, BoundingBoxComponent);\r\n        if (boundingBox) boundingBox.dirty = true\r\n        this.updateEntityMatrix(system, entityId);\r\n    }\r\n    updateEntityMatrix(system: ISystem, entityId: number) {\r\n        const ecs = system.ecs;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n\r\n        mat3.identity(transform.localMatrix);\r\n\r\n        const px = transform.pivotX;\r\n        const py = transform.pivotY;\r\n        // M=T(position)⋅T(pivot)⋅R⋅S⋅T(−pivot)\r\n        mat3.translate(transform.localMatrix, transform.localMatrix, [transform.x + px, transform.y + py]);\r\n        mat3.rotate(transform.localMatrix, transform.localMatrix, transform.rotation);\r\n        if (transform.skewX !== 0 || transform.skewY !== 0) {\r\n            const skewMat = mat3.fromValues(\r\n                1, Math.tan(transform.skewX), 0,\r\n                Math.tan(transform.skewY), 1, 0,\r\n                0, 0, 1\r\n            );\r\n            mat3.multiply(transform.localMatrix, transform.localMatrix, skewMat);\r\n        }\r\n        // 缩放\r\n        mat3.scale(transform.localMatrix, transform.localMatrix, [transform.scaleX, transform.scaleY]);\r\n        mat3.translate(transform.localMatrix, transform.localMatrix, [-px, -py]);\r\n\r\n        // 计算世界矩阵\r\n        const parent = system.sceneTree.getParent(entityId);\r\n        if (parent != null) {\r\n            const parentTransform = ecs.getComponent(parent.entityId, Transform);\r\n            const parentMatrix = parentTransform?.worldMatrix || unit;\r\n            mat3.multiply(transform.worldMatrix, parentMatrix, transform.localMatrix);\r\n        } else {\r\n            mat3.copy(transform.worldMatrix, transform.localMatrix);\r\n        }\r\n    }\r\n}","import { ECS } from \"../../ecs/ECS.ts\";\r\nimport { Transform } from \"../../components/Transform.ts\";\r\nimport { Circle } from \"../../components/render/Circle.ts\";\r\nimport { IBoundingBoxStrategy } from \"./AABB\";\r\nimport { mat3, vec2 } from \"gl-matrix\";\r\n\r\n/**\r\n * Circle / Ellipse 包围盒策略\r\n * 完整支持圆弧 / 扇形\r\n */\r\nexport class CircleBoundingBox implements IBoundingBoxStrategy {\r\n  match(ecs: ECS, entityId: number) {\r\n    return ecs.hasComponent(entityId, Circle);\r\n  }\r\n\r\n  /** 计算世界空间下 AABB */\r\n  computeAABB(ecs: ECS, entityId: number) {\r\n    const circle = ecs.getComponent(entityId, Circle)!;\r\n    const transform = ecs.getComponent(entityId, Transform)!;\r\n    const { radius, radiusY = radius, rotation = 0, startAngle, endAngle, clockwise } = circle;\r\n    const m = transform.worldMatrix;\r\n\r\n    const cx = m[6];\r\n    const cy = m[7];\r\n\r\n    // 提取缩放分量\r\n    const a = m[0], b = m[1], c = m[3], d = m[4];\r\n    const rx = radius * Math.hypot(a, b);\r\n    const ry = radiusY * Math.hypot(c, d);\r\n\r\n    const isFull = startAngle === 0 && endAngle === 2 * Math.PI;\r\n\r\n    if (isFull) {\r\n      // 完整圆/椭圆\r\n      const cosR = Math.cos(rotation);\r\n      const sinR = Math.sin(rotation);\r\n      const halfW = Math.abs(rx * cosR) + Math.abs(ry * sinR);\r\n      const halfH = Math.abs(rx * sinR) + Math.abs(ry * cosR);\r\n      return {\r\n        minX: cx - halfW,\r\n        minY: cy - halfH,\r\n        maxX: cx + halfW,\r\n        maxY: cy + halfH,\r\n      };\r\n    } else {\r\n      // 圆弧/椭圆弧 → 考虑 start/end + 关键角 + 圆心闭合\r\n      const angles = [startAngle, endAngle];\r\n      const criticalAngles = [0, Math.PI / 2, Math.PI, (3 * Math.PI) / 2];\r\n      for (const a of criticalAngles) {\r\n        if (this.isAngleBetween(a, startAngle, endAngle, clockwise)) angles.push(a);\r\n      }\r\n\r\n      let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\r\n      const cosR = Math.cos(rotation);\r\n      const sinR = Math.sin(rotation);\r\n\r\n      for (const angle of angles) {\r\n        const px = rx * Math.cos(angle);\r\n        const py = ry * Math.sin(angle);\r\n        const rxRot = px * cosR - py * sinR;\r\n        const ryRot = px * sinR + py * cosR;\r\n        minX = Math.min(minX, rxRot);\r\n        minY = Math.min(minY, ryRot);\r\n        maxX = Math.max(maxX, rxRot);\r\n        maxY = Math.max(maxY, ryRot);\r\n      }\r\n\r\n      // 包括圆心闭合\r\n      minX = Math.min(minX, 0);\r\n      minY = Math.min(minY, 0);\r\n      maxX = Math.max(maxX, 0);\r\n      maxY = Math.max(maxY, 0);\r\n\r\n      return {\r\n        minX: cx + minX,\r\n        minY: cy + minY,\r\n        maxX: cx + maxX,\r\n        maxY: cy + maxY,\r\n      };\r\n    }\r\n  }\r\n\r\n  /** 命中检测 */\r\n  hit(ecs: ECS, entityId: number, x: number, y: number): boolean {\r\n    const circle = ecs.getComponent(entityId, Circle)!;\r\n    const isFull = circle.startAngle === 0 && circle.endAngle === 2 * Math.PI;\r\n    return isFull\r\n      ? this.hitFullCircle(ecs, entityId, x, y)\r\n      : this.hitArc(ecs, entityId, x, y);\r\n  }\r\n\r\n  /** 完整圆 / 椭圆命中检测 */\r\n  private hitFullCircle(ecs: ECS, entityId: number, x: number, y: number): boolean {\r\n    const circle = ecs.getComponent(entityId, Circle)!;\r\n    const transform = ecs.getComponent(entityId, Transform)!;\r\n    const { radius, radiusY = radius, rotation = 0 } = circle;\r\n\r\n    const m = transform.worldMatrix;\r\n    const inv = mat3.create();\r\n    mat3.invert(inv, m);\r\n    const local = vec2.fromValues(x, y);\r\n    vec2.transformMat3(local, local, inv);\r\n\r\n    let lx = local[0];\r\n    let ly = local[1];\r\n    if (rotation !== 0) {\r\n      const cosR = Math.cos(-rotation);\r\n      const sinR = Math.sin(-rotation);\r\n      const tmpX = lx * cosR - ly * sinR;\r\n      const tmpY = lx * sinR + ly * cosR;\r\n      lx = tmpX;\r\n      ly = tmpY;\r\n    }\r\n\r\n    const norm = (lx * lx) / (radius * radius) + (ly * ly) / (radiusY * radiusY);\r\n    return norm <= 1;\r\n  }\r\n\r\n  /** 圆弧 / 扇形命中检测 */\r\n  private hitArc(ecs: ECS, entityId: number, x: number, y: number): boolean {\r\n    const circle = ecs.getComponent(entityId, Circle)!;\r\n    const transform = ecs.getComponent(entityId, Transform)!;\r\n    const { radius, radiusY = radius, rotation = 0, startAngle, endAngle, clockwise } = circle;\r\n\r\n    const m = transform.worldMatrix;\r\n    const inv = mat3.create();\r\n    mat3.invert(inv, m);\r\n    const local = vec2.fromValues(x, y);\r\n    vec2.transformMat3(local, local, inv);\r\n\r\n    let lx = local[0];\r\n    let ly = local[1];\r\n    if (rotation !== 0) {\r\n      const cosR = Math.cos(-rotation);\r\n      const sinR = Math.sin(-rotation);\r\n      const tmpX = lx * cosR - ly * sinR;\r\n      const tmpY = lx * sinR + ly * cosR;\r\n      lx = tmpX;\r\n      ly = tmpY;\r\n    }\r\n\r\n    // 归一化椭圆坐标\r\n    const dx = lx / radius;\r\n    const dy = ly / radiusY;\r\n    const distance = Math.hypot(dx, dy);\r\n\r\n    // 参数角 t\r\n    let t_p = Math.atan2(dy, dx);\r\n    if (t_p < 0) t_p += 2 * Math.PI;\r\n\r\n    const inArc = this.isAngleBetween(t_p, startAngle, endAngle, clockwise);\r\n\r\n    // 点在圆弧范围内\r\n    if (distance <= 1 && inArc) return true;\r\n\r\n    // Canvas 扇形闭合面积，圆心 + 起点 + 终点\r\n    const startX = radius * Math.cos(startAngle);\r\n    const startY = radiusY * Math.sin(startAngle);\r\n    const endX = radius * Math.cos(endAngle);\r\n    const endY = radiusY * Math.sin(endAngle);\r\n\r\n    const polygon = clockwise\r\n      ? [{ x: 0, y: 0 }, { x: startX, y: startY }, { x: endX, y: endY }]\r\n      : [{ x: 0, y: 0 }, { x: endX, y: endY }, { x: startX, y: startY }];\r\n\r\n    if (this.pointInPolygon({ x: lx, y: ly }, polygon)) return true;\r\n\r\n    return false;\r\n  }\r\n\r\n  /** 判断角度是否在弧段内（顺时针或逆时针） */\r\n  private isAngleBetween(angle: number, start: number, end: number, clockwise: boolean) {\r\n    angle = (angle + 2 * Math.PI) % (2 * Math.PI);\r\n    start = (start + 2 * Math.PI) % (2 * Math.PI);\r\n    end = (end + 2 * Math.PI) % (2 * Math.PI);\r\n    return clockwise\r\n      ? ((start - angle + 2 * Math.PI) % (2 * Math.PI)) <= ((start - end + 2 * Math.PI) % (2 * Math.PI))\r\n      : ((angle - start + 2 * Math.PI) % (2 * Math.PI)) <= ((end - start + 2 * Math.PI) % (2 * Math.PI));\r\n  }\r\n\r\n  /** 点是否在多边形内（射线法） */\r\n  private pointInPolygon(p: { x: number, y: number }, polygon: { x: number, y: number }[]) {\r\n    let inside = false;\r\n    const n = polygon.length;\r\n    for (let i = 0, j = n - 1; i < n; j = i++) {\r\n      const xi = polygon[i].x, yi = polygon[i].y;\r\n      const xj = polygon[j].x, yj = polygon[j].y;\r\n      const intersect = ((yi > p.y) !== (yj > p.y)) &&\r\n                        (p.x < (xj - xi) * (p.y - yi) / (yj - yi + 1e-10) + xi);\r\n      if (intersect) inside = !inside;\r\n    }\r\n    return inside;\r\n  }\r\n}\r\n","import { vec2, mat3 } from \"gl-matrix\";\r\nimport { ECS } from \"../../ecs/ECS\";\r\nimport { Transform } from \"../../components/Transform\";\r\nimport { Rect } from \"../../components/render/Rect\";\r\nimport { IBoundingBoxStrategy } from \"./AABB\";\r\n\r\n/**\r\n * Rect 包围盒策略（支持圆角矩形）\r\n */\r\nexport class RectBoundingBox implements IBoundingBoxStrategy {\r\n    match(ecs: ECS, entityId: number) {\r\n        return ecs.hasComponent(entityId, Rect);\r\n    }\r\n\r\n    computeAABB(ecs: ECS, entityId: number) {\r\n        const rect = ecs.getComponent(entityId, Rect)!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n\r\n        const { width, height } = rect;\r\n        const { pivotX, pivotY } = transform;\r\n        const m = transform.worldMatrix;\r\n\r\n        // 四个局部顶点（考虑 pivot）\r\n        const points = [\r\n            vec2.fromValues(-pivotX, -pivotY),\r\n            vec2.fromValues(width - pivotX, -pivotY),\r\n            vec2.fromValues(width - pivotX, height - pivotY),\r\n            vec2.fromValues(-pivotX, height - pivotY),\r\n        ];\r\n\r\n        // 变换到世界坐标\r\n        const worldPoints = points.map((p) => vec2.transformMat3(vec2.create(), p, m));\r\n\r\n        // 计算AABB\r\n        let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\r\n        for (const p of worldPoints) {\r\n            minX = Math.min(minX, p[0]);\r\n            minY = Math.min(minY, p[1]);\r\n            maxX = Math.max(maxX, p[0]);\r\n            maxY = Math.max(maxY, p[1]);\r\n        }\r\n\r\n        return { minX, minY, maxX, maxY };\r\n    }\r\n\r\n    hit(ecs: ECS, entityId: number, x: number, y: number): boolean {\r\n        const rect = ecs.getComponent(entityId, Rect)!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n\r\n        const { width, height, radius = 0 } = rect;\r\n        const { pivotX, pivotY } = transform;\r\n        const m = transform.worldMatrix;\r\n\r\n        // 将世界坐标反变换回局部空间\r\n        const inv = mat3.create();\r\n        mat3.invert(inv, m);\r\n        const local = vec2.fromValues(x, y);\r\n        vec2.transformMat3(local, local, inv);\r\n        const lx = local[0];\r\n        const ly = local[1];\r\n\r\n        // 1. 快速排除矩形外部\r\n        if (lx < -pivotX || lx > width - pivotX || ly < -pivotY || ly > height - pivotY) {\r\n            return false;\r\n        }\r\n\r\n        if (radius <= 0) return true; // 普通矩形直接命中\r\n\r\n        // 2. 检查四个圆角\r\n        const corners = [\r\n            [-pivotX + radius, -pivotY + radius], // 左上\r\n            [width - pivotX - radius, -pivotY + radius], // 右上\r\n            [width - pivotX - radius, height - pivotY - radius], // 右下\r\n            [-pivotX + radius, height - pivotY - radius], // 左下\r\n        ];\r\n\r\n        const cornerChecks = [\r\n            lx < -pivotX + radius && ly < -pivotY + radius, // 左上\r\n            lx > width - pivotX - radius && ly < -pivotY + radius, // 右上\r\n            lx > width - pivotX - radius && ly > height - pivotY - radius, // 右下\r\n            lx < -pivotX + radius && ly > height - pivotY - radius, // 左下\r\n        ];\r\n\r\n        for (let i = 0; i < 4; i++) {\r\n            if (cornerChecks[i]) {\r\n                const dx = lx - corners[i][0];\r\n                const dy = ly - corners[i][1];\r\n                if (dx * dx + dy * dy > radius * radius) return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n}\r\n","import { ECS } from \"../../ecs/ECS\";\r\nimport { Transform } from \"../../components/Transform\";\r\nimport { Image } from \"../../components/render/Image\";\r\nimport { IBoundingBoxStrategy } from \"./AABB\";\r\nimport { mat3, vec2 } from \"gl-matrix\";\r\n\r\n/**\r\n * Image 包围盒策略\r\n */\r\nexport class ImageBoundingBox implements IBoundingBoxStrategy {\r\n    match(ecs: ECS, entityId: number) {\r\n        return ecs.hasComponent(entityId, Image);\r\n    }\r\n\r\n    /**\r\n     * 计算图片的世界包围盒（考虑变换矩阵）\r\n     */\r\n    computeAABB(ecs: ECS, entityId: number) {\r\n        const img = ecs.getComponent(entityId, Image)!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n\r\n        const { width, height } = img;\r\n        const m = transform.worldMatrix; // mat3 (列主序)\r\n\r\n        // 图片四个顶点（局部坐标）\r\n        const points = [\r\n            vec2.fromValues(0, 0),\r\n            vec2.fromValues(width, 0),\r\n            vec2.fromValues(0, height),\r\n            vec2.fromValues(width, height),\r\n        ];\r\n\r\n        // 转换到世界坐标\r\n        const worldPts = points.map(p => {\r\n            const wp = vec2.create();\r\n            vec2.transformMat3(wp, p, m);\r\n            return wp;\r\n        });\r\n\r\n        // 求最小包围盒\r\n        let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\r\n        for (const p of worldPts) {\r\n            if (p[0] < minX) minX = p[0];\r\n            if (p[1] < minY) minY = p[1];\r\n            if (p[0] > maxX) maxX = p[0];\r\n            if (p[1] > maxY) maxY = p[1];\r\n        }\r\n\r\n        return { minX, minY, maxX, maxY };\r\n    }\r\n\r\n    /**\r\n     * 命中检测：判断点击点 (x, y) 是否落在图片内部（考虑旋转、缩放、平移）\r\n     */\r\n    hit(ecs: ECS, entityId: number, x: number, y: number): boolean {\r\n        const img = ecs.getComponent(entityId, Image)!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n\r\n        const { width, height } = img;\r\n        const m = transform.worldMatrix;\r\n\r\n        // 逆矩阵，把世界坐标转回本地坐标\r\n        const inv = mat3.create();\r\n        mat3.invert(inv, m);\r\n\r\n        const local = vec2.fromValues(x, y);\r\n        vec2.transformMat3(local, local, inv);\r\n\r\n        const lx = local[0];\r\n        const ly = local[1];\r\n\r\n        // 检查是否在 [0, width] × [0, height] 内\r\n        return lx >= 0 && lx <= width && ly >= 0 && ly <= height;\r\n    }\r\n}\r\n","import { Component } from \"../../ecs/decorators/Component\";\r\nimport { IComponent } from \"../../ecs/interface/IComponent\";\r\nimport { RenderComponent } from \"./RenderComponent.ts\";\r\nimport { Engine } from \"../../ecs/Engine.ts\";\r\n\r\n/**\r\n * 折线 / 多边形组件\r\n * 仅存储渲染数据，不包含绘制逻辑\r\n * 系统（RenderSystem）负责渲染\r\n */\r\n@Component(\"Polyline\")\r\nexport class Polyline extends RenderComponent implements IComponent {\r\n  /** 顶点列表，例如 [{x:0, y:0}, {x:100, y:50}] */\r\n  points: [number,number][] = [];\r\n\r\n  /** 是否闭合成多边形 */\r\n  closed: boolean = false;\r\n\r\n  /** 填充样式（闭合时有效） */\r\n  fillStyle?: string;\r\n\r\n  /** 线条样式 */\r\n  strokeStyle: string;\r\n\r\n  /** 线宽 */\r\n  lineWidth: number;\r\n\r\n  /** 透明度 */\r\n  alpha: number;\r\n\r\n  /** 是否参与渲染 */\r\n  render: boolean = true;\r\n\r\n  constructor(\r\n    engine: Engine | null,\r\n    {\r\n      points = [],\r\n      closed = false,\r\n      fillStyle,\r\n      strokeStyle = \"#000000\",\r\n      lineWidth = 1,\r\n      alpha = 1.0,\r\n      render = true,\r\n    }: Partial<Polyline> = {}\r\n  ) {\r\n    super(engine);\r\n    this.points = points;\r\n    this.closed = closed;\r\n    this.fillStyle = fillStyle;\r\n    this.strokeStyle = strokeStyle;\r\n    this.lineWidth = lineWidth;\r\n    this.alpha = alpha;\r\n    this.render = render;\r\n  }\r\n}\r\n","import { vec2, mat3 } from \"gl-matrix\";\r\nimport { ECS } from \"../../ecs/ECS\";\r\nimport { Transform } from \"../../components/Transform\";\r\nimport { Polyline } from \"../../components/render/Polyline\";\r\nimport { IBoundingBoxStrategy } from \"./AABB\";\r\n\r\n/**\r\n * Polyline 包围盒策略\r\n */\r\nexport class PolylineBoundingBox implements IBoundingBoxStrategy {\r\n    match(ecs: ECS, entityId: number) {\r\n        return ecs.hasComponent(entityId, Polyline);\r\n    }\r\n\r\n    computeAABB(ecs: ECS, entityId: number) {\r\n        const polyline = ecs.getComponent(entityId, Polyline)!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n        const m = transform.worldMatrix;\r\n\r\n        if (!polyline.points || polyline.points.length === 0) {\r\n            return { minX: 0, minY: 0, maxX: 0, maxY: 0 };\r\n        }\r\n\r\n        // 将所有点变换到世界坐标\r\n        const worldPoints = polyline.points.map((p) =>\r\n            vec2.transformMat3(vec2.create(), vec2.fromValues(p[0], p[1]), m)\r\n        );\r\n\r\n        // 计算 AABB\r\n        let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\r\n        for (const p of worldPoints) {\r\n            minX = Math.min(minX, p[0]);\r\n            minY = Math.min(minY, p[1]);\r\n            maxX = Math.max(maxX, p[0]);\r\n            maxY = Math.max(maxY, p[1]);\r\n        }\r\n\r\n        return { minX, minY, maxX, maxY };\r\n    }\r\n\r\n    hit(ecs: ECS, entityId: number, x: number, y: number): boolean {\r\n        const polyline = ecs.getComponent(entityId, Polyline)!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n\r\n        if (!polyline.points || polyline.points.length < 2) return false;\r\n\r\n        // 世界 -> 局部\r\n        const inv = mat3.create();\r\n        mat3.invert(inv, transform.worldMatrix);\r\n        const local = vec2.fromValues(x, y);\r\n        vec2.transformMat3(local, local, inv);\r\n\r\n        const pts = polyline.points;\r\n        const px = local[0], py = local[1];\r\n\r\n        if (polyline.closed) {\r\n            // --- 闭合路径：点在多边形内检测（奇偶规则）\r\n            let inside = false;\r\n            for (let i = 0, j = pts.length - 1; i < pts.length; j = i++) {\r\n                const xi = pts[i][0], yi = pts[i][1];\r\n                const xj = pts[j][0], yj = pts[j][1];\r\n\r\n                const intersect =\r\n                    yi > py !== yj > py &&\r\n                    px < ((xj - xi) * (py - yi)) / (yj - yi) + xi;\r\n\r\n                if (intersect) inside = !inside;\r\n            }\r\n            return inside;\r\n        } else {\r\n            // --- 非闭合折线：判断点到线段的最短距离是否小于阈值\r\n            const threshold = 3; // 可根据像素密度调整\r\n            for (let i = 0; i < pts.length - 1; i++) {\r\n                const p1 = pts[i], p2 = pts[i + 1];\r\n                if (this.pointToSegmentDistance(px, py, p1[0], p1[1], p2[0], p2[1]) <= threshold)\r\n                    return true;\r\n            }\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /** 计算点到线段的最短距离 */\r\n    private pointToSegmentDistance(px: number, py: number, x1: number, y1: number, x2: number, y2: number): number {\r\n        const dx = x2 - x1;\r\n        const dy = y2 - y1;\r\n        if (dx === 0 && dy === 0) {\r\n            return Math.hypot(px - x1, py - y1);\r\n        }\r\n        const t = ((px - x1) * dx + (py - y1) * dy) / (dx * dx + dy * dy);\r\n        const clampedT = Math.max(0, Math.min(1, t));\r\n        const closestX = x1 + clampedT * dx;\r\n        const closestY = y1 + clampedT * dy;\r\n        return Math.hypot(px - closestX, py - closestY);\r\n    }\r\n}\r\n","import { Component } from \"../../ecs/decorators/Component\";\r\nimport { IComponent } from \"../../ecs/interface/IComponent\";\r\nimport { RenderComponent } from \"./RenderComponent\";\r\nimport { Engine } from \"../../ecs/Engine\";\r\n\r\n@Component(\"Curve\")\r\nexport class Curve extends RenderComponent implements IComponent {\r\n  start: [number, number] = [0, 0];\r\n  cp1: [number, number] = [0, 0];\r\n  cp2?: [number, number];\r\n  end: [number, number] = [0, 0];\r\n\r\n  strokeStyle: string = \"#000\";\r\n  lineWidth: number = 1;\r\n  alpha: number = 1;\r\n  render: boolean = true;\r\n\r\n  constructor(engine: Engine | null, opts: Partial<Curve> = {}) {\r\n    super(engine);\r\n    this.start = opts.start || this.start;\r\n    this.cp1 = opts.cp1 || this.cp1;\r\n    this.cp2 = opts.cp2 || this.cp2;\r\n    this.end = opts.end || this.end;\r\n    this.strokeStyle = opts.strokeStyle || this.strokeStyle;\r\n    this.lineWidth = opts.lineWidth || this.lineWidth;\r\n    this.alpha = opts.alpha || this.alpha;\r\n    this.render = opts.render || this.render;\r\n  }\r\n}\r\n","import { vec2, mat3 } from \"gl-matrix\";\r\nimport { ECS } from \"../../ecs/ECS\";\r\nimport { Transform } from \"../../components/Transform\";\r\nimport { Curve } from \"../../components/render/Curve\";\r\nimport { IBoundingBoxStrategy } from \"./AABB\";\r\n\r\n/**\r\n * Curve 包围盒策略\r\n */\r\nexport class CurveBoundingBox implements IBoundingBoxStrategy {\r\n    match(ecs: ECS, entityId: number) {\r\n        return ecs.hasComponent(entityId, Curve);\r\n    }\r\n\r\n    computeAABB(ecs: ECS, entityId: number) {\r\n        const curve = ecs.getComponent(entityId, Curve)!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n        const m = transform.worldMatrix;\r\n\r\n        // 采样曲线点\r\n        const points: vec2[] = [];\r\n        const steps = 30; // 分段数，越大越精确\r\n        for (let t = 0; t <= 1; t += 1 / steps) {\r\n            let x: number, y: number;\r\n            if (curve.cp2) {\r\n                // 三次贝塞尔\r\n                const u = 1 - t;\r\n                x = u ** 3 * curve.start[0] +\r\n                    3 * u ** 2 * t * curve.cp1[0] +\r\n                    3 * u * t ** 2 * curve.cp2[0] +\r\n                    t ** 3 * curve.end[0];\r\n                y = u ** 3 * curve.start[1] +\r\n                    3 * u ** 2 * t * curve.cp1[1] +\r\n                    3 * u * t ** 2 * curve.cp2[1] +\r\n                    t ** 3 * curve.end[1];\r\n            } else {\r\n                // 二次贝塞尔\r\n                const u = 1 - t;\r\n                x = u ** 2 * curve.start[0] + 2 * u * t * curve.cp1[0] + t ** 2 * curve.end[0];\r\n                y = u ** 2 * curve.start[1] + 2 * u * t * curve.cp1[1] + t ** 2 * curve.end[1];\r\n            }\r\n            const p = vec2.fromValues(x, y);\r\n            vec2.transformMat3(p, p, m);\r\n            points.push(p);\r\n        }\r\n\r\n        // 计算AABB\r\n        let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\r\n        for (const p of points) {\r\n            minX = Math.min(minX, p[0]);\r\n            minY = Math.min(minY, p[1]);\r\n            maxX = Math.max(maxX, p[0]);\r\n            maxY = Math.max(maxY, p[1]);\r\n        }\r\n\r\n        return { minX, minY, maxX, maxY };\r\n    }\r\n\r\n    hit(ecs: ECS, entityId: number, x: number, y: number): boolean {\r\n        const curve = ecs.getComponent(entityId, Curve)!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n        const m = transform.worldMatrix;\r\n\r\n        // 将世界坐标反变换回局部空间\r\n        const inv = mat3.create();\r\n        mat3.invert(inv, m);\r\n        const local = vec2.fromValues(x, y);\r\n        vec2.transformMat3(local, local, inv);\r\n\r\n        // 点到曲线距离，使用简单采样法\r\n        const steps = 50;\r\n        let minDist = Infinity;\r\n        for (let t = 0; t <= 1; t += 1 / steps) {\r\n            let px: number, py: number;\r\n            if (curve.cp2) {\r\n                const u = 1 - t;\r\n                px = u ** 3 * curve.start[0] +\r\n                    3 * u ** 2 * t * curve.cp1[0] +\r\n                    3 * u * t ** 2 * curve.cp2[0] +\r\n                    t ** 3 * curve.end[0];\r\n                py = u ** 3 * curve.start[1] +\r\n                    3 * u ** 2 * t * curve.cp1[1] +\r\n                    3 * u * t ** 2 * curve.cp2[1] +\r\n                    t ** 3 * curve.end[1];\r\n            } else {\r\n                const u = 1 - t;\r\n                px = u ** 2 * curve.start[0] + 2 * u * t * curve.cp1[0] + t ** 2 * curve.end[0];\r\n                py = u ** 2 * curve.start[1] + 2 * u * t * curve.cp1[1] + t ** 2 * curve.end[1];\r\n            }\r\n            const dx = local[0] - px;\r\n            const dy = local[1] - py;\r\n            minDist = Math.min(minDist, Math.sqrt(dx * dx + dy * dy));\r\n        }\r\n\r\n        return minDist <= (curve.lineWidth || 5); // 允许一定像素误差\r\n    }\r\n}\r\n","import { Component } from \"../../ecs/decorators/Component.ts\";\r\nimport { IComponent } from \"../../ecs/interface/IComponent.ts\";\r\nimport { RenderComponent } from \"./RenderComponent.ts\";\r\nimport { Engine } from \"../../ecs/Engine.ts\";\r\n\r\n/** 🧩 支持的路径命令 */\r\nexport type IPathCommand =\r\n  | { type: \"moveTo\"; x: number; y: number }\r\n  | { type: \"lineTo\"; x: number; y: number }\r\n  | { type: \"quadraticCurveTo\"; cp: [number, number]; end: [number, number] }\r\n  | { type: \"bezierCurveTo\"; cp1: [number, number]; cp2: [number, number]; end: [number, number] }\r\n  | { type: \"arc\"; center: [number, number]; radius: number; start: number; end: number; counterClockwise?: boolean }\r\n  | { type: \"arcTo\"; cp1: [number, number]; cp2: [number, number]; radius: number }\r\n  | { type: \"ellipse\"; center: [number, number]; radiusX: number; radiusY: number; rotation?: number; start?: number; end?: number; counterClockwise?: boolean } // 新增椭圆\r\n  | { type: \"close\" };\r\n\r\n@Component(\"Path\")\r\nexport class Path extends RenderComponent implements IComponent {\r\n  commands: IPathCommand[] = [];\r\n  strokeStyle?: string;\r\n  fillStyle?: string;\r\n  lineWidth: number = 1;\r\n  alpha: number = 1.0;\r\n  render: boolean = true;\r\n\r\n  /** 🆕 缓存 Path2D 对象 */\r\n  path2D?: Path2D;\r\n\r\n  constructor(engine: Engine | null, options: Partial<Path> & { commands?: IPathCommand[] } = {}) {\r\n    super(engine);\r\n    this.commands = options.commands || [];\r\n    this.strokeStyle = options.strokeStyle || \"#000000\";\r\n    this.fillStyle = options.fillStyle || undefined;\r\n    this.lineWidth = options.lineWidth ?? 1;\r\n    this.alpha = options.alpha ?? 1.0;\r\n    this.render = options.render ?? true;\r\n    this.updatePath2D();\r\n  }\r\n\r\n  /** 添加一个命令 */\r\n  addCommand(cmd: IPathCommand) {\r\n    this.commands.push(cmd);\r\n    this.updatePath2D();\r\n  }\r\n\r\n  /** 清空路径 */\r\n  clear() {\r\n    this.commands.length = 0;\r\n    this.updatePath2D(); // 更新 Path2D\r\n  }\r\n\r\n  /** 🆕 根据 commands 更新 Path2D 对象 */\r\n  updatePath2D() {\r\n    const path = new Path2D();\r\n\r\n    for (const cmd of this.commands) {\r\n      switch (cmd.type) {\r\n        case \"moveTo\":\r\n          path.moveTo(cmd.x, cmd.y);\r\n          break;\r\n        case \"lineTo\":\r\n          path.lineTo(cmd.x, cmd.y);\r\n          break;\r\n        case \"quadraticCurveTo\":\r\n          path.quadraticCurveTo(cmd.cp[0], cmd.cp[1], cmd.end[0], cmd.end[1]);\r\n          break;\r\n        case \"bezierCurveTo\":\r\n          path.bezierCurveTo(cmd.cp1[0], cmd.cp1[1], cmd.cp2[0], cmd.cp2[1], cmd.end[0], cmd.end[1]);\r\n          break;\r\n        case \"arc\":\r\n          path.arc(cmd.center[0], cmd.center[1], cmd.radius, cmd.start, cmd.end, cmd.counterClockwise);\r\n          break;\r\n        case \"arcTo\":\r\n          path.arcTo(cmd.cp1[0], cmd.cp1[1], cmd.cp2[0], cmd.cp2[1], cmd.radius);\r\n          break;\r\n        case \"ellipse\":\r\n          path.ellipse(\r\n            cmd.center[0],\r\n            cmd.center[1],\r\n            cmd.radiusX,\r\n            cmd.radiusY,\r\n            cmd.rotation ?? 0,\r\n            cmd.start ?? 0,\r\n            cmd.end ?? 2 * Math.PI,\r\n            cmd.counterClockwise ?? false\r\n          );\r\n          break;\r\n        case \"close\":\r\n          path.closePath();\r\n          break;\r\n      }\r\n    }\r\n\r\n    this.path2D = path;\r\n  }\r\n}\r\n","import { vec2, mat3 } from \"gl-matrix\";\r\nimport { ECS } from \"../../ecs/ECS\";\r\nimport { Transform } from \"../../components/Transform\";\r\nimport { Path } from \"../../components/render/Path\";\r\nimport { IBoundingBoxStrategy } from \"./AABB\";\r\n\r\nexport class PathBoundingBox implements IBoundingBoxStrategy {\r\n    private offscreenCanvas: HTMLCanvasElement;\r\n    private offscreenCtx: CanvasRenderingContext2D;\r\n\r\n    constructor() {\r\n        this.offscreenCanvas = document.createElement(\"canvas\");\r\n        this.offscreenCanvas.width = 1;\r\n        this.offscreenCanvas.height = 1;\r\n        const ctx = this.offscreenCanvas.getContext(\"2d\");\r\n        if (!ctx) throw new Error(\"Offscreen canvas context not available\");\r\n        this.offscreenCtx = ctx;\r\n    }\r\n\r\n    match(ecs: ECS, entityId: number) {\r\n        return ecs.hasComponent(entityId, Path);\r\n    }\r\n\r\n    computeAABB(ecs: ECS, entityId: number) {\r\n        const path = ecs.getComponent(entityId, Path)!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n        const m = transform.worldMatrix;\r\n\r\n        const points: vec2[] = [];\r\n        let lastPos: [number, number] = [0, 0];\r\n        const steps = 20;\r\n\r\n        for (const cmd of path.commands) {\r\n            switch (cmd.type) {\r\n                case \"moveTo\":\r\n                    lastPos = [cmd.x, cmd.y];\r\n                    points.push(vec2.fromValues(...lastPos));\r\n                    break;\r\n                case \"lineTo\":\r\n                    lastPos = [cmd.x, cmd.y];\r\n                    points.push(vec2.fromValues(...lastPos));\r\n                    break;\r\n                case \"quadraticCurveTo\":\r\n                    for (let t = 0; t <= 1; t += 1 / steps) {\r\n                        const u = 1 - t;\r\n                        const x = u ** 2 * lastPos[0] + 2 * u * t * cmd.cp[0] + t ** 2 * cmd.end[0];\r\n                        const y = u ** 2 * lastPos[1] + 2 * u * t * cmd.cp[1] + t ** 2 * cmd.end[1];\r\n                        points.push(vec2.fromValues(x, y));\r\n                    }\r\n                    lastPos = [...cmd.end];\r\n                    break;\r\n                case \"bezierCurveTo\":\r\n                    for (let t = 0; t <= 1; t += 1 / steps) {\r\n                        const u = 1 - t;\r\n                        const x =\r\n                            u ** 3 * lastPos[0] +\r\n                            3 * u ** 2 * t * cmd.cp1[0] +\r\n                            3 * u * t ** 2 * cmd.cp2[0] +\r\n                            t ** 3 * cmd.end[0];\r\n                        const y =\r\n                            u ** 3 * lastPos[1] +\r\n                            3 * u ** 2 * t * cmd.cp1[1] +\r\n                            3 * u * t ** 2 * cmd.cp2[1] +\r\n                            t ** 3 * cmd.end[1];\r\n                        points.push(vec2.fromValues(x, y));\r\n                    }\r\n                    lastPos = [...cmd.end];\r\n                    break;\r\n                case \"arc\": {\r\n                    const [cx, cy] = cmd.center;\r\n                    for (let t = 0; t <= 1; t += 1 / steps) {\r\n                        const angle = cmd.start + t * (cmd.end - cmd.start);\r\n                        const x = cx + cmd.radius * Math.cos(angle);\r\n                        const y = cy + cmd.radius * Math.sin(angle);\r\n                        points.push(vec2.fromValues(x, y));\r\n                    }\r\n                    lastPos = [cx + cmd.radius * Math.cos(cmd.end), cy + cmd.radius * Math.sin(cmd.end)];\r\n                    break;\r\n                }\r\n                case \"arcTo\":\r\n                    points.push(vec2.fromValues(cmd.cp1[0], cmd.cp1[1]));\r\n                    points.push(vec2.fromValues(cmd.cp2[0], cmd.cp2[1]));\r\n                    lastPos = [...cmd.cp2];\r\n                    break;\r\n                case \"ellipse\": {\r\n                    const [cx, cy] = cmd.center;\r\n                    const rx = cmd.radiusX;\r\n                    const ry = cmd.radiusY;\r\n                    const rotation = cmd.rotation ?? 0;\r\n                    for (let t = 0; t <= 1; t += 1 / steps) {\r\n                        const angle = t * 2 * Math.PI;\r\n                        const cos = Math.cos(angle);\r\n                        const sin = Math.sin(angle);\r\n                        const x = cx + rx * cos * Math.cos(rotation) - ry * sin * Math.sin(rotation);\r\n                        const y = cy + rx * cos * Math.sin(rotation) + ry * sin * Math.cos(rotation);\r\n                        points.push(vec2.fromValues(x, y));\r\n                    }\r\n                    lastPos = [cx + rx * Math.cos(0), cy + ry * Math.sin(0)];\r\n                    break;\r\n                }\r\n                case \"close\":\r\n                    break;\r\n            }\r\n        }\r\n\r\n        const worldPoints = points.map(p => vec2.transformMat3(vec2.create(), p, m));\r\n        let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\r\n        for (const p of worldPoints) {\r\n            minX = Math.min(minX, p[0]);\r\n            minY = Math.min(minY, p[1]);\r\n            maxX = Math.max(maxX, p[0]);\r\n            maxY = Math.max(maxY, p[1]);\r\n        }\r\n\r\n        return { minX, minY, maxX, maxY };\r\n    }\r\n\r\n    hit(ecs: ECS, entityId: number, x: number, y: number): boolean {\r\n        const path = ecs.getComponent(entityId, Path)!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n        const m = transform.worldMatrix;\r\n\r\n        const inv = mat3.create();\r\n        mat3.invert(inv, m);\r\n        const local = vec2.fromValues(x, y);\r\n        vec2.transformMat3(local, local, inv);\r\n\r\n        const hasClose = path.commands.some(cmd => cmd.type === \"close\");\r\n\r\n        if (path.path2D) {\r\n            const ctx = this.offscreenCtx;\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, 1, 1);\r\n            ctx.lineWidth = path.lineWidth ?? 1;\r\n            const result = hasClose \r\n                ? ctx.isPointInPath(path.path2D, local[0], local[1])\r\n                : ctx.isPointInStroke(path.path2D, local[0], local[1]);\r\n            ctx.restore();\r\n            return result;\r\n        } else {\r\n            if (hasClose) {\r\n                return this.isPointInPath(path, local[0], local[1]);\r\n            } else {\r\n                return PathBoundingBox.isPointNearPath(path, local[0], local[1]);\r\n            }\r\n        }\r\n    }\r\n\r\n    private isPointInPath(path: Path, x: number, y: number): boolean {\r\n        const ctx = this.offscreenCtx;\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, 1, 1);\r\n\r\n        ctx.beginPath();\r\n        for (const cmd of path.commands) {\r\n            switch (cmd.type) {\r\n                case \"moveTo\": ctx.moveTo(cmd.x, cmd.y); break;\r\n                case \"lineTo\": ctx.lineTo(cmd.x, cmd.y); break;\r\n                case \"quadraticCurveTo\": ctx.quadraticCurveTo(cmd.cp[0], cmd.cp[1], cmd.end[0], cmd.end[1]); break;\r\n                case \"bezierCurveTo\": ctx.bezierCurveTo(cmd.cp1[0], cmd.cp1[1], cmd.cp2[0], cmd.cp2[1], cmd.end[0], cmd.end[1]); break;\r\n                case \"arc\": ctx.arc(cmd.center[0], cmd.center[1], cmd.radius, cmd.start, cmd.end, cmd.counterClockwise); break;\r\n                case \"arcTo\": ctx.arcTo(cmd.cp1[0], cmd.cp1[1], cmd.cp2[0], cmd.cp2[1], cmd.radius); break;\r\n                case \"ellipse\": ctx.ellipse(cmd.center[0], cmd.center[1], cmd.radiusX, cmd.radiusY, cmd.rotation ?? 0, 0, 2 * Math.PI); break;\r\n                case \"close\": ctx.closePath(); break;\r\n            }\r\n        }\r\n\r\n        const result = ctx.isPointInPath(x, y);\r\n        ctx.restore();\r\n        return result;\r\n    }\r\n\r\n    static isPointNearPath(path: Path, x: number, y: number): boolean {\r\n        const steps = 50;\r\n        const lineWidth = path.lineWidth ?? 5;\r\n        let lastPos: [number, number] = [0, 0];\r\n        let minDist = Infinity;\r\n\r\n        for (const cmd of path.commands) {\r\n            switch (cmd.type) {\r\n                case \"moveTo\": lastPos = [cmd.x, cmd.y]; break;\r\n                case \"lineTo\": {\r\n                    const dx = cmd.x - lastPos[0];\r\n                    const dy = cmd.y - lastPos[1];\r\n                    if (dx !== 0 || dy !== 0) {\r\n                        const t = ((x - lastPos[0]) * dx + (y - lastPos[1]) * dy) / (dx * dx + dy * dy);\r\n                        const tt = Math.max(0, Math.min(1, t));\r\n                        const px = lastPos[0] + dx * tt;\r\n                        const py = lastPos[1] + dy * tt;\r\n                        minDist = Math.min(minDist, Math.hypot(x - px, y - py));\r\n                    }\r\n                    lastPos = [cmd.x, cmd.y];\r\n                    break;\r\n                }\r\n                case \"quadraticCurveTo\":\r\n                    for (let t = 0; t <= 1; t += 1 / steps) {\r\n                        const u = 1 - t;\r\n                        const px = u ** 2 * lastPos[0] + 2 * u * t * cmd.cp[0] + t ** 2 * cmd.end[0];\r\n                        const py = u ** 2 * lastPos[1] + 2 * u * t * cmd.cp[1] + t ** 2 * cmd.end[1];\r\n                        minDist = Math.min(minDist, Math.hypot(x - px, y - py));\r\n                    }\r\n                    lastPos = [...cmd.end];\r\n                    break;\r\n                case \"bezierCurveTo\":\r\n                    for (let t = 0; t <= 1; t += 1 / steps) {\r\n                        const u = 1 - t;\r\n                        const px =\r\n                            u ** 3 * lastPos[0] +\r\n                            3 * u ** 2 * t * cmd.cp1[0] +\r\n                            3 * u * t ** 2 * cmd.cp2[0] +\r\n                            t ** 3 * cmd.end[0];\r\n                        const py =\r\n                            u ** 3 * lastPos[1] +\r\n                            3 * u ** 2 * t * cmd.cp1[1] +\r\n                            3 * u * t ** 2 * cmd.cp2[1] +\r\n                            t ** 3 * cmd.end[1];\r\n                        minDist = Math.min(minDist, Math.hypot(x - px, y - py));\r\n                    }\r\n                    lastPos = [...cmd.end];\r\n                    break;\r\n                case \"arc\": {\r\n                    const [cx, cy] = cmd.center;\r\n                    const startAngle = cmd.start;\r\n                    const endAngle = cmd.end;\r\n                    const stepAngle = (endAngle - startAngle) / steps;\r\n                    for (let i = 0; i <= steps; i++) {\r\n                        const angle = startAngle + stepAngle * i;\r\n                        const px = cx + cmd.radius * Math.cos(angle);\r\n                        const py = cy + cmd.radius * Math.sin(angle);\r\n                        minDist = Math.min(minDist, Math.hypot(x - px, y - py));\r\n                    }\r\n                    lastPos = [cx + cmd.radius * Math.cos(endAngle), cy + cmd.radius * Math.sin(endAngle)];\r\n                    break;\r\n                }\r\n                case \"arcTo\": {\r\n                    const [x1, y1] = lastPos;\r\n                    const [x2, y2] = cmd.cp1;\r\n                    const [x3, y3] = cmd.cp2;\r\n                    const r = cmd.radius;\r\n\r\n                    const dx1 = x1 - x2;\r\n                    const dy1 = y1 - y2;\r\n                    const dx2 = x3 - x2;\r\n                    const dy2 = y3 - y2;\r\n\r\n                    const a1 = Math.atan2(dy1, dx1);\r\n                    const a2 = Math.atan2(dy2, dx2);\r\n                    const angleDiff = ((a2 - a1 + Math.PI * 3) % (Math.PI * 2)) - Math.PI;\r\n\r\n                    const centerAngle = a1 + angleDiff / 2;\r\n                    const cx = x2 + r * Math.cos(centerAngle + Math.PI / 2);\r\n                    const cy = y2 + r * Math.sin(centerAngle + Math.PI / 2);\r\n\r\n                    const startAngle = Math.atan2(y1 - cy, x1 - cx);\r\n                    const endAngle = Math.atan2(y3 - cy, x3 - cx);\r\n\r\n                    for (let i = 0; i <= steps; i++) {\r\n                        const t = i / steps;\r\n                        const angle = startAngle + (endAngle - startAngle) * t;\r\n                        const px = cx + r * Math.cos(angle);\r\n                        const py = cy + r * Math.sin(angle);\r\n                        minDist = Math.min(minDist, Math.hypot(x - px, y - py));\r\n                    }\r\n                    lastPos = [x3, y3];\r\n                    break;\r\n                }\r\n                case \"ellipse\": {\r\n                    const [cx, cy] = cmd.center;\r\n                    const rx = cmd.radiusX;\r\n                    const ry = cmd.radiusY;\r\n                    const rotation = cmd.rotation ?? 0;\r\n                    for (let i = 0; i <= steps; i++) {\r\n                        const t = i / steps * 2 * Math.PI;\r\n                        const cos = Math.cos(t);\r\n                        const sin = Math.sin(t);\r\n                        const px = cx + rx * cos * Math.cos(rotation) - ry * sin * Math.sin(rotation);\r\n                        const py = cy + rx * cos * Math.sin(rotation) + ry * sin * Math.cos(rotation);\r\n                        minDist = Math.min(minDist, Math.hypot(x - px, y - py));\r\n                    }\r\n                    lastPos = [cx + rx * Math.cos(0), cy + ry * Math.sin(0)];\r\n                    break;\r\n                }\r\n                case \"close\": break;\r\n            }\r\n        }\r\n\r\n        return minDist <= Math.max(5, lineWidth / 2);\r\n    }\r\n}\r\n","import { ECS } from \"../../ecs/ECS.ts\";\r\nimport { IProcess } from \"../../ecs/interface/IRender.ts\";\r\nimport type { ISystem } from \"../../ecs/System.ts\";\r\nimport { IBoundingBoxStrategy } from \"./AABB.ts\";\r\nimport { CircleBoundingBox } from \"./CircleBoundingBox.ts\";\r\nimport { RectBoundingBox } from \"./RectBoundingBox.ts\";\r\nimport { ImageBoundingBox } from \"./ImageBoundingBox.ts\";\r\nimport { PolylineBoundingBox } from \"./PolylineBoundingBox.ts\";\r\nimport { CurveBoundingBox } from \"./CurveBoundingBox.ts\";\r\nimport { BoundingBoxComponent } from \"../../components/BoundingBoxComponent.ts\";\r\nimport { IAABB } from \"../../interface/AABB.ts\";\r\nimport { IShareContext } from \"../../interface/System.ts\";\r\nimport { PathBoundingBox } from \"./PathBoundingBox.ts\";\r\nexport class BoundingBoxProcess implements IProcess {\r\n    match(_ecs: ECS, _entityId: number) {\r\n        return true\r\n    }\r\n    private strategies: IBoundingBoxStrategy[];\r\n    // 某一组子节点的包围盒，遍历完子节点后 更新\r\n    none: () => IAABB = () => ({ minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity });\r\n    constructor() {\r\n        this.strategies = [];\r\n        this.strategies.push(new CircleBoundingBox());\r\n        this.strategies.push(new RectBoundingBox());\r\n        this.strategies.push(new ImageBoundingBox());\r\n        this.strategies.push(new PolylineBoundingBox());\r\n        this.strategies.push(new CurveBoundingBox());\r\n        this.strategies.push(new PathBoundingBox());    \r\n    }\r\n    compute(ecs: ECS, entityId: number) {\r\n        for (const s of this.strategies) {\r\n            if (s.match(ecs, entityId)) {\r\n                const aabb = s.computeAABB(ecs, entityId);\r\n                return aabb;\r\n            }\r\n        }\r\n        return { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity } as IAABB;\r\n    }\r\n    exec(system: ISystem, entityId: number, parentEntityId: number | null, context: IShareContext, parentContext: IShareContext | null) {\r\n        let bbox = system.ecs.getComponent(entityId, BoundingBoxComponent);\r\n        if (!bbox) {\r\n            bbox = new BoundingBoxComponent();\r\n            system.ecs.addComponent(entityId, bbox);\r\n        }\r\n        if (!bbox.dirty) return;\r\n        const selfAABB = this.compute(system.ecs, entityId);\r\n        bbox.setSelf(selfAABB);\r\n        bbox.setChildren(context.childrenAABB || this.none());\r\n        bbox.updateTotalAABB();\r\n        if (parentEntityId !== null && parentContext !== null) {\r\n            let parentBBox = system.ecs.getComponent(parentEntityId!, BoundingBoxComponent);\r\n            if (!parentBBox) {\r\n                parentBBox = new BoundingBoxComponent();\r\n                system.ecs.addComponent(parentEntityId!, parentBBox);\r\n            }\r\n            if (!parentContext.childrenAABB) {\r\n                parentContext.childrenAABB = this.none();\r\n            }\r\n            this.merge(parentContext.childrenAABB, bbox.totalAABB);\r\n            parentBBox.dirty = true;\r\n        }\r\n    }\r\n    merge(aabb: IAABB, bbox: IAABB) {\r\n        aabb.minX = Math.min(aabb.minX, bbox.minX);\r\n        aabb.minY = Math.min(aabb.minY, bbox.minY);\r\n        aabb.maxX = Math.max(aabb.maxX, bbox.maxX);\r\n        aabb.maxY = Math.max(aabb.maxY, bbox.maxY);\r\n    }\r\n}","import { ECS } from \"../../ecs/ECS.ts\";\r\nimport { Transform } from \"../../components/Transform.ts\";\r\nimport { Path } from \"../../components/render/Path.ts\";\r\nimport { IProcess } from \"../../ecs/interface/IRender.ts\";\r\nimport type { ISystem } from \"../../ecs/System.ts\";\r\n\r\n/**\r\n * 渲染器：负责绘制 Path 组件（支持 moveTo/lineTo/曲线/arc/arcTo/ellipse）\r\n */\r\nexport class PathRenderer implements IProcess {\r\n    match(ecs: ECS, entityId: number) {\r\n        return ecs.hasComponent(entityId, Path);\r\n    }\r\n\r\n    /**\r\n     * 执行渲染逻辑\r\n     */\r\n    exec(system: ISystem, entityId: number) {\r\n        const ecs = system.ecs;\r\n        const ctx = ecs.canvas.getContext(\"2d\")!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n        const path = ecs.getComponent(entityId, Path)!;\r\n\r\n        if (!path.render || !path.commands.length) return;\r\n\r\n        ctx.save();\r\n        ctx.globalAlpha = path.alpha;\r\n        const m = transform.worldMatrix;\r\n        ctx.setTransform(\r\n            m[0], // a = m00\r\n            m[1], // b = m10\r\n            m[3], // c = m01\r\n            m[4], // d = m11\r\n            m[6], // e = m20 (平移x)\r\n            m[7]  // f = m21 (平移y)\r\n        );\r\n\r\n        ctx.beginPath();\r\n\r\n        for (const cmd of path.commands) {\r\n            switch (cmd.type) {\r\n                case \"moveTo\":\r\n                    ctx.moveTo(cmd.x, cmd.y);\r\n                    break;\r\n                case \"lineTo\":\r\n                    ctx.lineTo(cmd.x, cmd.y);\r\n                    break;\r\n                case \"quadraticCurveTo\":\r\n                    ctx.quadraticCurveTo(cmd.cp[0], cmd.cp[1], cmd.end[0], cmd.end[1]);\r\n                    break;\r\n                case \"bezierCurveTo\":\r\n                    ctx.bezierCurveTo(cmd.cp1[0], cmd.cp1[1], cmd.cp2[0], cmd.cp2[1], cmd.end[0], cmd.end[1]);\r\n                    break;\r\n                case \"arc\":\r\n                    ctx.arc(cmd.center[0], cmd.center[1], cmd.radius, cmd.start, cmd.end, !!cmd.counterClockwise);\r\n                    break;\r\n                case \"arcTo\":\r\n                    ctx.arcTo(cmd.cp1[0], cmd.cp1[1], cmd.cp2[0], cmd.cp2[1], cmd.radius);\r\n                    break;\r\n                case \"ellipse\":\r\n                    ctx.ellipse(\r\n                        cmd.center[0],\r\n                        cmd.center[1],\r\n                        cmd.radiusX,\r\n                        cmd.radiusY,\r\n                        cmd.rotation ?? 0,\r\n                        cmd.start ?? 0,\r\n                        cmd.end ?? 2 * Math.PI,\r\n                        !!cmd.counterClockwise\r\n                    );\r\n                    break;\r\n                case \"close\":\r\n                    ctx.closePath();\r\n                    break;\r\n            }\r\n        }\r\n\r\n        if (path.fillStyle) {\r\n            ctx.fillStyle = path.fillStyle;\r\n            ctx.fill();\r\n        }\r\n\r\n        if (path.strokeStyle && path.lineWidth > 0) {\r\n            ctx.strokeStyle = path.strokeStyle;\r\n            ctx.lineWidth = path.lineWidth;\r\n            ctx.stroke();\r\n        }\r\n\r\n        ctx.restore();\r\n    }\r\n}\r\n","import { ECS } from \"../../ecs/ECS.ts\";\r\nimport { Transform } from \"../../components/Transform.ts\";\r\nimport { Polyline } from \"../../components/render/Polyline.ts\";\r\nimport { IProcess } from \"../../ecs/interface/IRender.ts\";\r\nimport type { ISystem } from \"../../ecs/System.ts\";\r\n\r\n/**\r\n * 渲染器：负责绘制 Polyline 组件\r\n */\r\nexport class PolylineRenderer implements IProcess {\r\n    match(ecs: ECS, entityId: number) {\r\n        return ecs.hasComponent(entityId, Polyline);\r\n    }\r\n\r\n    exec(system: ISystem, entityId: number) {\r\n        const ecs = system.ecs;\r\n        const ctx = ecs.canvas.getContext(\"2d\")!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n        const polyline = ecs.getComponent(entityId, Polyline)!;\r\n        if (!polyline.render || polyline.points.length < 2) return;\r\n\r\n        ctx.save();\r\n        ctx.globalAlpha = polyline.alpha;\r\n\r\n        // 设置世界变换矩阵\r\n        const m = transform.worldMatrix;\r\n        ctx.setTransform(\r\n            m[0], // a\r\n            m[1], // b\r\n            m[3], // c\r\n            m[4], // d\r\n            m[6], // e\r\n            m[7]  // f\r\n        );\r\n\r\n        ctx.beginPath();\r\n\r\n        // 绘制折线路径\r\n        const pts = polyline.points;\r\n        ctx.moveTo(pts[0][0], pts[0][1]);\r\n        for (let i = 1; i < pts.length; i++) {\r\n            ctx.lineTo(pts[i][0], pts[i][1]);\r\n        }\r\n\r\n        // 闭合路径（可选）\r\n        if (polyline.closed) {\r\n            ctx.closePath();\r\n        }\r\n\r\n        // 填充（仅在闭合时生效）\r\n        if (polyline.closed && polyline.fillStyle) {\r\n            ctx.fillStyle = polyline.fillStyle;\r\n            ctx.fill();\r\n        }\r\n\r\n        // 描边\r\n        if (polyline.strokeStyle && polyline.lineWidth > 0) {\r\n            ctx.strokeStyle = polyline.strokeStyle;\r\n            ctx.lineWidth = polyline.lineWidth;\r\n            ctx.stroke();\r\n        }\r\n\r\n        ctx.restore();\r\n    }\r\n}\r\n","import { ECS } from \"../../ecs/ECS.ts\";\r\nimport { Transform } from \"../../components/Transform.ts\";\r\nimport { Curve } from \"../../components/render/Curve.ts\";\r\nimport { IProcess } from \"../../ecs/interface/IRender.ts\";\r\nimport type { ISystem } from \"../../ecs/System.ts\";\r\n\r\n/**\r\n * 渲染器：负责绘制 Curve 组件（支持二次和三次贝塞尔曲线）\r\n */\r\nexport class CurveRenderer implements IProcess {\r\n    match(ecs: ECS, entityId: number) {\r\n        return ecs.hasComponent(entityId, Curve);\r\n    }\r\n\r\n    exec(system: ISystem, entityId: number) {\r\n        const ecs = system.ecs;\r\n        const ctx = ecs.canvas.getContext(\"2d\")!;\r\n        const transform = ecs.getComponent(entityId, Transform)!;\r\n        const curve = ecs.getComponent(entityId, Curve)!;\r\n\r\n        if (!curve.render) return;\r\n\r\n        ctx.save();\r\n        ctx.globalAlpha = curve.alpha;\r\n\r\n        const m = transform.worldMatrix;\r\n        ctx.setTransform(\r\n            m[0], // a = m00\r\n            m[1], // b = m10\r\n            m[3], // c = m01\r\n            m[4], // d = m11\r\n            m[6], // e = m20 (平移x)\r\n            m[7]  // f = m21 (平移y)\r\n        );\r\n\r\n        ctx.beginPath();\r\n        ctx.moveTo(curve.start[0], curve.start[1]);\r\n\r\n        if (curve.cp2) {\r\n            // 三次贝塞尔曲线\r\n            ctx.bezierCurveTo(\r\n                curve.cp1[0], curve.cp1[1],\r\n                curve.cp2[0], curve.cp2[1],\r\n                curve.end[0], curve.end[1]\r\n            );\r\n        } else {\r\n            // 二次贝塞尔曲线\r\n            ctx.quadraticCurveTo(\r\n                curve.cp1[0], curve.cp1[1],\r\n                curve.end[0], curve.end[1]\r\n            );\r\n        }\r\n\r\n        if (curve.strokeStyle && curve.lineWidth > 0) {\r\n            ctx.strokeStyle = curve.strokeStyle;\r\n            ctx.lineWidth = curve.lineWidth;\r\n            ctx.stroke();\r\n        }\r\n\r\n        ctx.restore();\r\n    }\r\n}\r\n","import { ISystem } from \"../ecs/System.ts\";\r\nimport { SceneTree } from \"../ecs/SceneTree.ts\";\r\nimport { IProcess } from \"../ecs/interface/IRender.ts\";\r\nimport { RectRenderer } from './render/RectRenderer.ts'\r\nimport { CircleRenderer } from './render/CircleRenderer.ts'\r\nimport { ImageRenderer } from './render/ImageRenderer.ts'\r\nimport { TransformProcess } from './TransformProcess.ts'\r\nimport { Engine } from \"../ecs/Engine.ts\";\r\nimport { BoundingBoxProcess } from './AABB/aabbProcess.ts'\r\nimport { PathRenderer } from \"./render/PathRenderer.ts\";\r\nimport { IShareContext } from \"../interface/System.ts\";\r\nimport { PolylineRenderer } from \"./render/PolylineRenderer.ts\";\r\nimport { CurveRenderer } from \"./render/CurveRenderer.ts\";\r\nexport class SceneTreeRenderSystem extends ISystem {\r\n\r\n    ctx!: CanvasRenderingContext2D;\r\n    constructor(public engine: Engine, public sceneTree: SceneTree) {\r\n        super(engine, sceneTree);\r\n    }\r\n    processes: IProcess<{ dirty: boolean }, { dirty: boolean }>[] = [];\r\n    protected onInit(): void {\r\n        const canvas = this.ecs.canvas;\r\n        if (!canvas) throw new Error(\"Canvas not set on ECS\");\r\n        const ctx = canvas.getContext(\"2d\");\r\n        if (!ctx) throw new Error(\"Cannot get CanvasRenderingContext2D\");\r\n        this.ctx = ctx;\r\n\r\n        this.processes.push(\r\n            new TransformProcess(),\r\n            new RectRenderer(),\r\n            new CircleRenderer(),\r\n            new ImageRenderer(),\r\n            new PolylineRenderer(),\r\n            new CurveRenderer(),\r\n            new PathRenderer(),\r\n        );\r\n        this.bboxProcess = new BoundingBoxProcess();\r\n    }\r\n    bboxProcess!: BoundingBoxProcess;\r\n    update(): void {\r\n        console.log('渲染')\r\n        this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n        const map = new Map<number | null, IShareContext>();\r\n        // 根节点的父节点的上下文\r\n        map.set(null, { dirty: false } as IShareContext);\r\n        const displayList = this.sceneTree.displayList;\r\n        for (let i = 0; i < displayList.length; i++) {\r\n            const [entityId, parentEntityId] = displayList[i];\r\n            if (!map.has(entityId)) map.set(entityId, {} as IShareContext);\r\n            const context = map.get(entityId)!;\r\n            const parentContext = map.get(parentEntityId)!;\r\n            for (const process of this.processes) {\r\n                if (process.match(this.ecs, entityId)) {\r\n                    process.exec(this, entityId, parentEntityId, context, parentContext);\r\n                }\r\n            }\r\n        }\r\n        for (let i = displayList.length - 1; i >= 0; i--) {\r\n            const [entityId, parentEntityId] = displayList[i];\r\n            const context = map.get(entityId)!;\r\n            const parentContext = map.get(parentEntityId)!;\r\n            this.bboxProcess.exec(this, entityId, parentEntityId, context, parentContext);\r\n        }\r\n    }\r\n}\r\n","import { ECS } from \"../../ecs/ECS.ts\";\r\nimport { IProcess } from \"../../ecs/interface/IRender.ts\";\r\nimport type { ISystem } from \"../../ecs/System.ts\";\r\nimport { IBoundingBoxStrategy } from \"./AABB.ts\";\r\nimport { CircleBoundingBox } from \"./CircleBoundingBox.ts\";\r\nimport { RectBoundingBox } from \"./RectBoundingBox.ts\";\r\nimport { ImageBoundingBox } from \"./ImageBoundingBox.ts\";\r\nimport { PolylineBoundingBox } from \"./PolylineBoundingBox.ts\";\r\nimport { CurveBoundingBox } from \"./CurveBoundingBox.ts\";\r\nimport { PathBoundingBox } from \"./PathBoundingBox.ts\";\r\n\r\nimport { IShareContext } from \"../../interface/System.ts\";\r\nexport class RenderableHitProcess implements IProcess {\r\n    match(_ecs: ECS, _entityId: number) {\r\n        return true\r\n    }\r\n    private strategies: IBoundingBoxStrategy[];\r\n    // 某一组子节点的包围盒，遍历完子节点后 更新\r\n    constructor() {\r\n        this.strategies = [];\r\n        this.strategies.push(new CircleBoundingBox());\r\n        this.strategies.push(new RectBoundingBox());\r\n        this.strategies.push(new ImageBoundingBox());\r\n        this.strategies.push(new PolylineBoundingBox());\r\n        this.strategies.push(new CurveBoundingBox());\r\n        this.strategies.push(new PathBoundingBox());\r\n    }\r\n    hit(ecs: ECS, entityId: number, x: number, y: number) {\r\n        for (const s of this.strategies) {\r\n            if (s.match(ecs, entityId)) {\r\n                return s.hit(ecs, entityId, x, y);\r\n            }\r\n        }\r\n        return false\r\n    }\r\n    exec(_system: ISystem, _entityId: number, _parentEntityId: number | null, _context: IShareContext, _parentContext: unknown) {\r\n    }\r\n}","// import { RenderComponent } from \"../components/render/RenderComponent.ts\";\r\nimport { IAABB } from \"../interface/AABB.ts\";\r\nimport { SceneNode } from \"../ecs/SceneTree.ts\";\r\nimport { ISystem } from \"../ecs/System.ts\";\r\nimport { BoundingBoxComponent } from \"../components/BoundingBoxComponent.ts\";\r\nimport { BoundingBoxProcess } from './AABB/aabbProcess.ts'\r\nimport { RenderableHitProcess } from './AABB/hitprocess.ts'\r\n\r\n\r\nimport { TransformProcess } from './TransformProcess.ts'\r\nimport { IShareContext } from \"../interface/System.ts\";\r\nexport class PickEntitySystem extends ISystem {\r\n    ctx!: CanvasRenderingContext2D;\r\n    eventEntities: number[] = [];\r\n    bboxProcess!: BoundingBoxProcess;\r\n    transformProcess!: TransformProcess;\r\n    RenderableHitProcess!: RenderableHitProcess;    \r\n    protected onInit(): void {\r\n        this.transformProcess = new TransformProcess();\r\n        this.bboxProcess = new BoundingBoxProcess();\r\n        this.RenderableHitProcess = new RenderableHitProcess();\r\n    }\r\n    hitAABB(x: number, y: number, box: IAABB) {\r\n        return x >= box.minX && y >= box.minY && x <= box.maxX && y <= box.maxY;\r\n    }\r\n    hitRenderable(x: number, y: number, entityId: number) {\r\n        return this.RenderableHitProcess.hit(this.ecs, entityId, x, y);\r\n    }\r\n    hitTree(x: number, y: number) {\r\n        const tree = this.sceneTree;\r\n        const visitHit = (node: SceneNode): SceneNode | null => {\r\n            if (node === null) return null;\r\n            const bbox = this.ecs.getComponent(node.entityId, BoundingBoxComponent)!;\r\n            if (!this.hitAABB(x, y, bbox.totalAABB)) return null;\r\n\r\n            // 逆序遍历子节点（后渲染的在前面）\r\n            for (let i = node.children.length - 1; i >= 0; i--) {\r\n                const hit = visitHit(node.children[i]);\r\n                if (hit) return hit;\r\n            }\r\n            // 再检测自身包围盒\r\n            if (this.hitAABB(x, y, bbox.selfAABB) && this.hitRenderable(x, y, node.entityId)) {\r\n                return node;\r\n            }\r\n            return null\r\n        }\r\n        const node = visitHit(tree.root);\r\n        return node !== null ? node.entityId : null\r\n    }\r\n    pickEntityAt(x: number, y: number) {\r\n        this.updateTree();\r\n        return this.hitTree(x, y);\r\n    }\r\n\r\n    updateTree() {\r\n        const map = new Map<number | null, IShareContext>();\r\n        // 根节点的父节点的上下文\r\n        map.set(null, { dirty: false } as IShareContext);\r\n        const displayList = this.sceneTree.displayList;\r\n        for (let i = 0; i < displayList.length; i++) {\r\n            const [entityId, parentEntityId] = displayList[i];\r\n            if (!map.has(entityId)) map.set(entityId, {} as IShareContext);\r\n            const context = map.get(entityId)!;\r\n            const parentContext = map.get(parentEntityId)!;\r\n            this.transformProcess.exec(this, entityId, parentEntityId, context, parentContext);\r\n        }\r\n        for (let i = displayList.length - 1; i >= 0; i--) {\r\n            const [entityId, parentEntityId] = displayList[i];\r\n            const context = map.get(entityId)!;\r\n            const parentContext = map.get(parentEntityId)!;\r\n            this.bboxProcess.exec(this, entityId, parentEntityId, context, parentContext);\r\n        }\r\n    }\r\n    update() { }\r\n}","// 文件：ecs/EngineEvent.ts\r\n\r\nimport { IEngine } from \"./interface/IEngine.ts\";\r\n\r\n/**\r\n * 泛型事件系统（零 any 版本）\r\n * 支持类型安全的 on/off/emit 调用\r\n */\r\nexport class EngineEvent<\r\n  // ✅ 改动：允许任意接口（不强制 Record<string, ...>）\r\n  T extends { [K in keyof T]: (...args: never[]) => void } = IEngine\r\n> {\r\n  private listeners: {\r\n    [K in keyof T]?: Set<T[K]>;\r\n  } = {};\r\n\r\n  /** 监听事件 */\r\n  on<K extends keyof T>(event: K, callback: T[K]): void {\r\n    (this.listeners[event] ??= new Set()).add(callback);\r\n  }\r\n\r\n  /** 取消监听 */\r\n  off<K extends keyof T>(event: K, callback?: T[K]): void {\r\n    if (callback) this.listeners[event]?.delete(callback);\r\n    else delete this.listeners[event];\r\n  }\r\n\r\n  /** 触发事件 */\r\n  emit<K extends keyof T>(event: K, ...args: Parameters<T[K]>): void {\r\n    const set = this.listeners[event];\r\n    if (!set) return;\r\n    for (const cb of set) cb(...args);\r\n  }\r\n\r\n  /** 清除监听器 */\r\n  clear<K extends keyof T>(event?: K): void {\r\n    if (event) delete this.listeners[event];\r\n    else this.listeners = {};\r\n  }\r\n}\r\n","import { ISystem } from \"../ecs/System.ts\";\r\nimport { SceneTree } from \"../ecs/SceneTree.ts\";\r\nimport { IProcess } from \"../ecs/interface/IRender.ts\";\r\nimport { Engine } from \"../ecs/Engine.ts\";\r\nimport { IShareContext } from \"../interface/System.ts\";\r\nimport { BoundingBoxComponent } from \"../main.ts\";\r\nimport { IAABB } from \"../interface/AABB.ts\";\r\nexport class BoxDebugSystem extends ISystem {\r\n\r\n    ctx!: CanvasRenderingContext2D;\r\n    constructor(public engine: Engine, public sceneTree: SceneTree) {\r\n        super(engine, sceneTree);\r\n    }\r\n    processes: IProcess<{ dirty: boolean }, { dirty: boolean }>[] = [];\r\n    protected onInit(): void {\r\n        const canvas = this.ecs.canvas;\r\n        if (!canvas) throw new Error(\"Canvas not set on ECS\");\r\n        const ctx = canvas.getContext(\"2d\");\r\n        if (!ctx) throw new Error(\"Cannot get CanvasRenderingContext2D\");\r\n        this.ctx = ctx;\r\n    }\r\n\r\n    update(): void {\r\n        if (!(this.engine).boxDebug) return;\r\n        // this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n        const map = new Map<number | null, IShareContext>();\r\n        // 根节点的父节点的上下文\r\n        map.set(null, { dirty: false } as IShareContext);\r\n        const displayList = this.sceneTree.displayList;\r\n        for (let i = displayList.length - 1; i >= 0; i--) {\r\n            const [entityId, _parentEntityId] = displayList[i];\r\n            if (!map.has(entityId)) map.set(entityId, {} as IShareContext);\r\n            this.drawTotal(entityId);\r\n            // this.drawChildren(entityId);\r\n            this.drawSelf(entityId);\r\n        }\r\n    }\r\n    drawSelf(entityId: number,): void {\r\n        const bbox = this.ecs.getComponent(entityId, BoundingBoxComponent)!;\r\n        if (!bbox) return;\r\n        this.draw(bbox.totalAABB, '#ff0000', 1);\r\n    }\r\n    drawTotal(entityId: number,): void {\r\n        const bbox = this.ecs.getComponent(entityId, BoundingBoxComponent)!;\r\n        if (!bbox) return;\r\n        this.draw(bbox.selfAABB, 'blue', 3);\r\n    }\r\n    drawChildren(entityId: number,): void {\r\n        const bbox = this.ecs.getComponent(entityId, BoundingBoxComponent)!;\r\n        if (!bbox) return;\r\n        this.draw(bbox.childrenAABB, 'green', 2);\r\n    }\r\n\r\n    draw(aabb: IAABB, color: string = '#ff0000', width: number = 1): void {\r\n        const ctx = this.ctx;\r\n        ctx.save()\r\n        ctx.beginPath()\r\n        ctx.moveTo(aabb.minX, aabb.minY)\r\n        ctx.lineTo(aabb.maxX, aabb.minY)\r\n        ctx.lineTo(aabb.maxX, aabb.maxY)\r\n        ctx.lineTo(aabb.minX, aabb.maxY)\r\n        ctx.closePath()\r\n        ctx.strokeStyle = color\r\n        ctx.lineWidth = width\r\n        ctx.stroke()\r\n        ctx.restore()\r\n    }\r\n}\r\n","import { Component } from \"../ecs/decorators/Component.ts\";\r\nimport { IComponent } from \"../ecs/interface/IComponent.ts\";\r\n\r\nexport type IEventType =\r\n    | \"click\" | \"dblclick\"\r\n    | \"mousedown\" | \"mouseup\" | \"mousemove\" | \"contextmenu\" | \"wheel\"\r\n    | \"touchstart\" | \"touchmove\" | \"touchend\" | \"touchcancel\"\r\n    | \"pointerdown\" | \"pointermove\" | \"pointerup\" | \"pointercancel\";\r\n\r\nexport type IScreenEvent = MouseEvent | PointerEvent | WheelEvent | TouchEvent;\r\nexport type EventCallback = (event: IScreenEvent, entityId: number) => boolean | void;\r\n\r\n@Component(\"Event\")\r\nexport class EventComponent implements IComponent {\r\n    public events = new Map<IEventType, EventCallback[]>();\r\n\r\n    /** 注册事件 */\r\n    on(type: IEventType, callback: EventCallback) {\r\n        if (!this.events.has(type)) this.events.set(type, []);\r\n        this.events.get(type)!.push(callback);\r\n    }\r\n\r\n    /** 移除事件 */\r\n    off(type: IEventType, callback?: EventCallback) {\r\n        if (!callback) {\r\n            this.events.delete(type);\r\n        } else {\r\n            const arr = this.events.get(type);\r\n            if (!arr) return;\r\n            this.events.set(type, arr.filter(cb => cb !== callback));\r\n        }\r\n    }\r\n\r\n    /** 触发事件，返回 true 表示阻止冒泡 */\r\n    emit(type: IEventType, event: IScreenEvent, entityId: number) {\r\n        const arr = this.events.get(type);\r\n        if (!arr) return false;\r\n\r\n        let stop = false;\r\n        for (const cb of arr) {\r\n            const result = cb(event, entityId);\r\n            if (result === true) stop = true;\r\n        }\r\n        return stop;\r\n    }\r\n}\r\n","import { ISystem } from \"../ecs/System.ts\";\r\nimport { EventComponent, IEventType, IScreenEvent } from \"../components/Event.ts\";\r\nimport { SceneNode } from \"../ecs/SceneTree.ts\";\r\nimport { PickEntitySystem } from \"./PickEntitySystem.ts\";\r\n/**\r\n * EventSystem：仅处理具有屏幕坐标的输入事件\r\n * 包含鼠标、触摸、指针、滚轮等\r\n */\r\nexport class EventSystem extends ISystem {\r\n    protected onInit(): void {\r\n        this.initPointerEvents();\r\n    }\r\n\r\n    /** 初始化事件监听 */\r\n    private initPointerEvents() {\r\n        const canvas = (this.ecs as any).canvas as HTMLCanvasElement;\r\n        if (!canvas) throw new Error(\"ECS.canvas 未设置\");\r\n\r\n        const eventTypes: IEventType[] = [\r\n            // 鼠标事件\r\n            \"click\",\r\n            // \"dblclick\",\r\n            // \"mousedown\",\r\n            // \"mouseup\",\r\n            // \"mousemove\",\r\n            // \"contextmenu\",\r\n            // \"wheel\",\r\n\r\n            // // 触摸事件\r\n            // \"touchstart\",\r\n            // \"touchmove\",\r\n            // \"touchend\",\r\n            // \"touchcancel\",\r\n\r\n            // // 指针事件\r\n            // \"pointerdown\",\r\n            // \"pointermove\",\r\n            // \"pointerup\",\r\n            // \"pointercancel\",\r\n        ];\r\n\r\n        for (const type of eventTypes) {\r\n            canvas.addEventListener(type, (e) => this.handleEvent(e as IScreenEvent, type));\r\n        }\r\n    }\r\n\r\n    /** 提取带坐标的事件类型 */\r\n    private handleEvent(e: IScreenEvent, type: IEventType) {\r\n        const canvas = (this.ecs as any).canvas as HTMLCanvasElement;\r\n        const rect = canvas.getBoundingClientRect();\r\n\r\n        // 计算坐标\r\n        let x = 0, y = 0;\r\n\r\n        if (\"clientX\" in e && \"clientY\" in e) {\r\n            // 鼠标、指针、滚轮事件\r\n            x = e.clientX - rect.left;\r\n            y = e.clientY - rect.top;\r\n        } else if (\"touches\" in e && e.touches.length > 0) {\r\n            // 触摸事件\r\n            const t = e.touches[0];\r\n            x = t.clientX - rect.left;\r\n            y = t.clientY - rect.top;\r\n        }\r\n\r\n        // 命中检测\r\n        const entityId = this.ecs.getSystem(PickEntitySystem).pickEntityAt(x, y);\r\n        if (entityId == null) return;\r\n\r\n        this.propagateEvent(entityId, type, e);\r\n    }\r\n\r\n    /** 冒泡事件分发 */\r\n    private propagateEvent(entityId: number, type: IEventType, e: IScreenEvent) {\r\n        let node: SceneNode | null = this.sceneTree.get(entityId);\r\n        while (node) {\r\n            const ev = this.ecs.getComponent(node.entityId, EventComponent);\r\n            if (ev) {\r\n                const stop = ev.emit(type, e, node.entityId);\r\n                if (stop) break; // 阻止冒泡\r\n            }\r\n            node = node.parent;\r\n        }\r\n    }\r\n\r\n    update(): void {}\r\n}\r\n","import { ECS } from \"./ECS.ts\";\r\nimport { Ticker } from \"./Ticker.ts\";\r\nimport { SceneTree } from \"../ecs/SceneTree\";\r\nimport { RootEntity } from \"./RootEntity.ts\";\r\nimport { SceneTreeRenderSystem } from \"../systems/SceneTreeRenderSystem.ts\";\r\nimport { PickEntitySystem } from \"../systems/PickEntitySystem.ts\";\r\nimport { IEngine } from \"./interface/IEngine.ts\";\r\nimport { EngineEvent } from \"./EngineEvent.ts\";\r\nimport { BoxDebugSystem } from \"../systems/BoxDebugSystem.ts\";\r\nimport { EventSystem } from \"../systems/EventSystem.ts\";\r\nexport class Engine implements IEngine {\r\n    public boxDebug: boolean = false;\r\n    public ecs: ECS;\r\n    private ticker: Ticker;\r\n    public sceneTree: SceneTree;\r\n    public rootEntity: RootEntity;\r\n    public event: EngineEvent<IEngine>;\r\n    constructor(canvas: HTMLCanvasElement) {\r\n        this.event = new EngineEvent();\r\n        this.ecs = new ECS();\r\n        this.ecs.canvas = canvas;\r\n        this.rootEntity = new RootEntity(this);\r\n        this.sceneTree = new SceneTree(this.rootEntity.entityId);\r\n\r\n        // 注册系统\r\n        this.ecs.addSystem(new SceneTreeRenderSystem(this, this.sceneTree));\r\n        this.ecs.addSystem(new BoxDebugSystem(this, this.sceneTree));\r\n        this.ecs.addSystem(new PickEntitySystem(this, this.sceneTree));\r\n        this.ecs.addSystem(new EventSystem(this, this.sceneTree));\r\n        // 绑定 Ticker → ECS\r\n        this.ticker = new Ticker();\r\n        this.ticker.add((dt) => this.ecs.update(dt));\r\n    }\r\n    start() {\r\n        this.ticker.start();\r\n        this.event.emit(\"start\");\r\n    }\r\n\r\n    stop() {\r\n        this.ticker.stop();\r\n        this.event.emit(\"stop\");\r\n    }\r\n\r\n    /**\r\n     * 在场景树中添加一个实体\r\n     * @param entityId 新实体ID\r\n     * @param parentId 父实体ID, 默认挂到根节点\r\n     */\r\n    add(entityId: number, parentId?: number) {\r\n        if (!this.ecs.hasEntity(entityId)) throw new Error(`Entity ${entityId} not exists`);\r\n        if (parentId && !this.ecs.hasEntity(parentId)) throw new Error(`Parent entity ${parentId} not found`);\r\n        // 检查是否已存在\r\n        if (parentId && !this.sceneTree.has(parentId))\r\n            throw new Error(`Entity ${parentId} not exists`);\r\n        this.sceneTree.add(entityId, parentId);\r\n        // 通知系统添加实体\r\n        this.event.emit(\"add\", entityId);\r\n    }\r\n\r\n    /**\r\n     * 将子节点添加到父节点\r\n     */\r\n    setParent(parentId: number, childId: number,) {\r\n        if (!this.ecs.hasEntity(childId)) throw new Error(`Entity ${childId} not exists`);\r\n        if (parentId && !this.ecs.hasEntity(parentId)) throw new Error(`Parent entity ${parentId} not found`);\r\n        // 检查树中是否存在\r\n        if (!this.sceneTree.has(parentId))\r\n            throw new Error(`Entity ${parentId} not exists`);\r\n        const parentNode = this.sceneTree.get(parentId);\r\n        const childNode = this.sceneTree.get(childId);\r\n\r\n        parentNode.addChild(childNode);\r\n        // 通知系统设置父节点\r\n        this.event.emit(\"setParent\", parentId, childId);\r\n    }\r\n\r\n    /**\r\n     * 删除实体及其子节点\r\n     */\r\n    remove(entityId: number) {\r\n        this.sceneTree.destory(entityId);\r\n        this.ecs.removeEntity(entityId);\r\n        // 通知系统删除实体\r\n        this.event.emit(\"remove\", entityId);\r\n    }\r\n\r\n    /**\r\n     * 获取实体的父节点\r\n     */\r\n    getParent(entityId: number) {\r\n        return this.sceneTree.getParent(entityId);\r\n    }\r\n\r\n    /**\r\n     * 获取实体对应的 SceneNode\r\n     */\r\n    getNode(entityId: number) {\r\n        return this.sceneTree.get(entityId);\r\n    }\r\n\r\n    /**\r\n     * 清空场景树（保留根节点）\r\n     */\r\n    clear() {\r\n        this.sceneTree.clear();\r\n        // 通知系统清空场景树\r\n        this.event.emit(\"clear\");\r\n    }\r\n}\r\n","/**\r\n * 异步加载图片并返回 ImageBitmap\r\n * @param url 图片地址\r\n * @param crop 可选裁剪区域：[sx, sy, sw, sh]\r\n * @param options 可选 createImageBitmap 参数\r\n */\r\nexport async function loadImageBitmap(\r\n  url: string,\r\n  crop?: [number, number, number, number],\r\n  options?: ImageBitmapOptions\r\n): Promise<ImageBitmap> {\r\n  try {\r\n    const response = await fetch(url, { mode: \"cors\" });\r\n    if (!response.ok) {\r\n      throw new Error(`Failed to load image: ${url}, status ${response.status}`);\r\n    }\r\n\r\n    const blob = await response.blob();\r\n\r\n    // 根据是否提供 crop 决定调用方式\r\n    if (crop) {\r\n      const [sx, sy, sw, sh] = crop;\r\n      return await createImageBitmap(blob, sx, sy, sw, sh, options);\r\n    } else {\r\n      return await createImageBitmap(blob, options);\r\n    }\r\n  } catch (err) {\r\n    console.error(\"loadImageBitmap error:\", err);\r\n    throw err;\r\n  }\r\n}\r\n"],"names":["EntityManager","id","ComponentManager","entityId","component","type","store","componentClass","ComponentRegistry","Archetype","componentTypes","c","components","col","comp","index","queryComponents","ArchetypeManager","comps","key","archetype","oldArchetype","newArchetype","componentClasses","RenderComponent","#engine","engine","EntityComponentManager","renderClass","oldComp","ECSEvent","event","listener","set","args","fn","ECS","#system","system","systemClass","delta","sys","name","archetypes","result","arch","Ticker","callback","i","now","dt","cb","SceneNode","child","idx","SceneTree","rootEntityId","parentId","node","parentNode","descendants","desc","rootContext","reverse","newCaches","map","visit","parentEntityId","parentContext","context","loop","parent","Reflect","factory","root","global","sloppyModeThis","exporter","makeExporter","target","previous","value","functionThis","indirectEvalThis","hasOwn","supportsSymbol","toPrimitiveSymbol","iteratorSymbol","supportsCreate","supportsProto","downLevel","HashMap","MakeDictionary","functionPrototype","_Map","CreateMapPolyfill","_Set","CreateSetPolyfill","_WeakMap","CreateWeakMapPolyfill","registrySymbol","metadataRegistry","GetOrCreateMetadataRegistry","metadataProvider","CreateMetadataProvider","decorate","decorators","propertyKey","attributes","IsUndefined","IsArray","IsConstructor","DecorateConstructor","IsObject","IsNull","ToPropertyKey","DecorateProperty","metadata","metadataKey","metadataValue","decorator","IsPropertyKey","OrdinaryDefineOwnMetadata","defineMetadata","hasMetadata","OrdinaryHasMetadata","hasOwnMetadata","OrdinaryHasOwnMetadata","getMetadata","OrdinaryGetMetadata","getOwnMetadata","OrdinaryGetOwnMetadata","getMetadataKeys","OrdinaryMetadataKeys","getOwnMetadataKeys","OrdinaryOwnMetadataKeys","deleteMetadata","provider","GetMetadataProvider","decorated","descriptor","MetadataKey","O","P","OrdinaryGetPrototypeOf","ToBoolean","MetadataValue","ownKeys","parentKeys","keys","_i","ownKeys_1","hasKey","_a","parentKeys_1","Type","x","IsSymbol","ToPrimitive","input","PreferredType","hint","exoticToPrim","GetMethod","OrdinaryToPrimitive","valueOf","toString_2","toString_1","IsCallable","argument","ToString","SameValueZero","y","V","func","GetIterator","obj","method","iterator","IteratorValue","iterResult","IteratorStep","IteratorClose","proto","prototype","prototypeProto","constructor","CreateMetadataRegistry","fallback","CreateFallbackProvider","first","second","rest","targetProviderMap","registry","registerProvider","getProvider","setProvider","getProviderNoCache","next","providerMap","hasProvider","existingProvider","targetMetadata","OrdinaryDeleteMetadata","GetOrCreateMetadataMap","Create","createdTargetMetadata","metadataMap","keysObj","k","nextValue","e","reflect","metadataOwner","metadataPropertySet","registeredProvider","cacheSentinel","arraySentinel","MapIterator","values","selector","error","Map","size","getKey","getValue","getEntry","insert","_","Set","UUID_SIZE","rootKey","CreateUniqueKey","WeakMap","table","GetOrCreateWeakMapTable","CreateUUID","create","FillRandomBytes","buffer","GenRandomBytes","array","data","offset","byte","Component","ctor","ARRAY_TYPE","out","glMatrix.ARRAY_TYPE","copy","a","fromValues","m00","m01","m02","m10","m11","m12","m20","m21","m22","identity","invert","a00","a01","a02","a10","a11","a12","a20","a21","a22","b01","b11","b21","det","multiply","b","b00","b02","b10","b12","b20","b22","translate","v","rotate","rad","s","scale","transformMat3","m","vec","stride","count","arg","l","_x","_y","_scaleX","_scaleY","_rotation","_skewX","_skewY","_pivotX","_pivotY","_engine","Transform","params","__privateAdd","__publicField","mat3.create","__privateSet","__privateGet","__decorateClass","RootEntity","ISystem","sceneTree","ecs","Rect","width","height","fillStyle","strokeStyle","lineWidth","alpha","render","radius","RectRenderer","ctx","transform","rect","Circle","radiusY","rotation","startAngle","endAngle","clockwise","CircleRenderer","circle","_bitmap","_width","_height","Image","ImageRenderer","image","clipX","clipY","clipW","clipH","BoundingBoxComponent","aabb","px","py","box","a1","a2","unit","TransformProcess","_parentEntityId","boundingBox","mat3.identity","mat3.translate","mat3.rotate","skewMat","mat3.fromValues","mat3.multiply","mat3.scale","parentMatrix","mat3.copy","CircleBoundingBox","cx","cy","d","rx","ry","cosR","sinR","halfW","halfH","angles","criticalAngles","minX","minY","maxX","maxY","angle","rxRot","ryRot","inv","mat3.invert","local","vec2.fromValues","vec2.transformMat3","lx","ly","tmpX","tmpY","dx","dy","distance","t_p","inArc","startX","startY","endX","endY","polygon","start","end","p","inside","j","xi","yi","xj","yj","RectBoundingBox","pivotX","pivotY","worldPoints","vec2.create","corners","cornerChecks","ImageBoundingBox","img","worldPts","wp","Polyline","points","closed","PolylineBoundingBox","polyline","pts","p1","p2","x1","y1","x2","y2","t","clampedT","closestX","closestY","Curve","opts","CurveBoundingBox","curve","steps","u","minDist","Path","options","cmd","path","PathBoundingBox","lastPos","cos","sin","hasClose","tt","stepAngle","x3","y3","r","dx1","dy1","dx2","dy2","angleDiff","centerAngle","BoundingBoxProcess","_ecs","_entityId","bbox","selfAABB","parentBBox","PathRenderer","PolylineRenderer","CurveRenderer","SceneTreeRenderSystem","canvas","displayList","process","RenderableHitProcess","_system","_context","_parentContext","PickEntitySystem","tree","visitHit","hit","EngineEvent","BoxDebugSystem","color","EventComponent","arr","stop","EventSystem","eventTypes","ev","Engine","childId","childNode","loadImageBitmap","url","crop","response","blob","sx","sy","sw","sh","err"],"mappings":"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","x_google_ignoreList":[11,13,14,15]}